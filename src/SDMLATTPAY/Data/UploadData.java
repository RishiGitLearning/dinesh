/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package SDMLATTPAY.Data;

import EITLERP.data;

/**
 *
 * @author Ashutosh
 */
public class UploadData {

    /**
     * @param args the command line arguments
     */
    public static void main(String[] args) {
        // TODO code application logic here
        String sql;
        sql = "DELETE FROM SDMLATTPAY.TMP_ATT_DATA";
        data.Execute(sql);
        //sql = "LOAD DATA LOCAL INFILE \"E:/brdstaff.txt\" IGNORE INTO TABLE SDMLATTPAY.TMP_ATT_DATA";
        sql = "LOAD DATA LOCAL INFILE \"/database/sjdata/attdata/brdstaff.txt\" IGNORE INTO TABLE SDMLATTPAY.TMP_ATT_DATA";
        //sql = "LOAD DATA LOCAL INFILE \"/database/sjdata/attdata/151220.txt\" IGNORE INTO TABLE SDMLATTPAY.TMP_ATT_DATA";
        //sql = "LOAD DATA LOCAL INFILE \"E:/sdmldp.txt\" IGNORE INTO TABLE SDMLATTPAY.TMP_ATT_DATA";
        data.Execute(sql);
        //sql = "LOAD DATA LOCAL INFILE \"E:/BWRKSPP.txt\" IGNORE INTO TABLE SDMLATTPAY.TMP_ATT_DATA";
        sql = "LOAD DATA LOCAL INFILE \"/database/sjdata/attdata/BWRKSPP.TXT\" IGNORE INTO TABLE SDMLATTPAY.TMP_ATT_DATA";
        //sql = "LOAD DATA LOCAL INFILE \"E:/brdw.txt\" IGNORE INTO TABLE SDMLATTPAY.TMP_ATT_DATA";
        data.Execute(sql);
        sql = "INSERT INTO SDMLATTPAY.ATT_DATA (T1) SELECT T1 FROM SDMLATTPAY.TMP_ATT_DATA "
                + "WHERE T1 NOT IN (SELECT COALESCE(T1,0) FROM SDMLATTPAY.ATT_DATA)";
        data.Execute(sql);

        System.out.println("Data Loaded...");

        sql = "UPDATE SDMLATTPAY.ATT_DATA "
                + "SET EMP_CODE=CONCAT('BRD',LEFT(T1,6)),P_DATE=SUBSTRING(T1,11,8),P_TIME=CONCAT(SUBSTRING(T1,7,2),':',SUBSTRING(T1,9,2)),MACHINE=SUBSTRING(T1,19,2) "
                + "WHERE EMP_CODE IS NULL";
        data.Execute(sql);

        sql = "DELETE FROM SDMLATTPAY.ATT_DATA WHERE LENGTH(EMP_CODE)<6";
        data.Execute(sql);

        sql = "UPDATE SDMLATTPAY.ATT_DATA SET A_DATE=CONCAT(SUBSTRING(P_DATE,1,4),'-',SUBSTRING(P_DATE,5,2),'-',SUBSTRING(P_DATE,7,2)) "
                + "WHERE A_DATE IS NULL";
        data.Execute(sql);
        sql = "UPDATE SDMLATTPAY.ATT_DATA SET A_DATETIME=CONCAT(A_DATE,' ',P_TIME) "
                + "WHERE A_DATETIME IS NULL";
        data.Execute(sql);
        System.out.println("Data Loaded Update...");
        data.Execute("DELETE FROM SDMLATTPAY.EMP_PUNCH WHERE EP_DATE>=SUBDATE(CURDATE(),INTERVAL 30 DAY) AND EP_DATE<=ADDDATE(CURDATE(),INTERVAL 30 DAY)");
        sql = "INSERT INTO SDMLATTPAY.EMP_PUNCH (EP_EMP_CODE,EP_DATE,EP_TIME1,EP_TIME2,EP_TIME3,EP_TIME4,EP_TIME5"
                + ",EP_TIME6,EP_TIME7,EP_TIME8,EP_TIME9,EP_TIME10"
                + ",EP_TIME11,EP_TIME12,EP_TIME13,EP_TIME14,EP_TIME15"
                + ",EP_TIME16,EP_TIME17,EP_TIME18,EP_TIME19,EP_TIME20) SELECT LEFT(P,6) AS EMP,SUBSTRING(P,8,10) AS DT,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,19,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,19,5)) ELSE '' END AS P1,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,25,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,25,5)) ELSE '' END AS P2,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,31,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,31,5)) ELSE '' END AS P3,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,37,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,37,5)) ELSE '' END AS P4,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,43,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,43,5)) ELSE '' END AS P5,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,49,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,49,5)) ELSE '' END AS P6,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,55,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,55,5)) ELSE '' END AS P7,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,61,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,61,5)) ELSE '' END AS P8,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,67,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,67,5)) ELSE '' END AS P9,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,73,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,73,5)) ELSE '' END AS P10,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,79,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,79,5)) ELSE '' END AS P11,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,85,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,85,5)) ELSE '' END AS P12,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,91,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,91,5)) ELSE '' END AS P13,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,97,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,97,5)) ELSE '' END AS P14,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,103,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,103,5)) ELSE '' END AS P15,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,109,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,109,5)) ELSE '' END AS P16,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,115,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,115,5)) ELSE '' END AS P17,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,121,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,121,5)) ELSE '' END AS P18,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,127,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,127,5)) ELSE '' END AS P19,"
                + "CASE WHEN LENGTH(CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,133,5)))>12 THEN CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,133,5)) ELSE '' END AS P20 "
                /*
                
                 + "CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,19,5)) AS P1,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,25,5)) AS P2,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,31,5)) AS P3,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,37,5)) AS P4,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,43,5)) AS P5,"
                 + "CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,49,5)) AS P6,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,55,5)) AS P7,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,61,5)) AS P8,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,67,5)) AS P9,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,73,5)) AS P10,"
                 + "CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,79,5)) AS P11,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,85,5)) AS P12,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,91,5)) AS P13,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,97,5)) AS P14,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,103,5)) AS P15,"
                 + "CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,109,5)) AS P16,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,115,5)) AS P17,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,121,5)) AS P18,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,127,5)) AS P19,CONCAT(SUBSTRING(P,8,10),' ',SUBSTRING(P,133,5)) AS P20 "
                 */
                + " FROM (SELECT CONCAT(RIGHT(TRIM(EMP_CODE),6),\",\",A_DATE,\",\",GROUP_CONCAT(DISTINCT P_TIME ORDER BY P_TIME)) AS P FROM SDMLATTPAY.ATT_DATA "
                + "WHERE A_DATE>=SUBDATE(CURDATE(),INTERVAL 30 DAY) AND A_DATE<=ADDDATE(CURDATE(),INTERVAL 30 DAY) "
                + "GROUP BY EMP_CODE,A_DATE "
                + "ORDER BY EMP_CODE,A_DATE) AS D ";
        System.out.println("Punch:" + sql);
        data.Execute(sql);
        sql = "UPDATE SDMLATTPAY.EMP_PUNCH "
                + "SET EP_TIME1=CASE WHEN TIME(EP_TIME1)='00:00:00' THEN '' ELSE EP_TIME1 END,"
                + "EP_TIME2=CASE WHEN TIME(EP_TIME2)='00:00:00' THEN '' ELSE EP_TIME2 END,"
                + "EP_TIME3=CASE WHEN TIME(EP_TIME3)='00:00:00' THEN '' ELSE EP_TIME3 END,"
                + "EP_TIME4=CASE WHEN TIME(EP_TIME4)='00:00:00' THEN '' ELSE EP_TIME4 END,"
                + "EP_TIME5=CASE WHEN TIME(EP_TIME5)='00:00:00' THEN '' ELSE EP_TIME5 END,"
                + "EP_TIME6=CASE WHEN TIME(EP_TIME6)='00:00:00' THEN '' ELSE EP_TIME6 END,"
                + "EP_TIME7=CASE WHEN TIME(EP_TIME7)='00:00:00' THEN '' ELSE EP_TIME7 END,"
                + "EP_TIME8=CASE WHEN TIME(EP_TIME8)='00:00:00' THEN '' ELSE EP_TIME8 END,"
                + "EP_TIME9=CASE WHEN TIME(EP_TIME9)='00:00:00' THEN '' ELSE EP_TIME9 END,"
                + "EP_TIME10=CASE WHEN TIME(EP_TIME10)='00:00:00' THEN '' ELSE EP_TIME10 END,"
                + "EP_TIME11=CASE WHEN TIME(EP_TIME11)='00:00:00' THEN '' ELSE EP_TIME11 END,"
                + "EP_TIME12=CASE WHEN TIME(EP_TIME12)='00:00:00' THEN '' ELSE EP_TIME12 END,"
                + "EP_TIME13=CASE WHEN TIME(EP_TIME13)='00:00:00' THEN '' ELSE EP_TIME13 END,"
                + "EP_TIME14=CASE WHEN TIME(EP_TIME14)='00:00:00' THEN '' ELSE EP_TIME14 END,"
                + "EP_TIME15=CASE WHEN TIME(EP_TIME15)='00:00:00' THEN '' ELSE EP_TIME15 END,"
                + "EP_TIME16=CASE WHEN TIME(EP_TIME16)='00:00:00' THEN '' ELSE EP_TIME16 END,"
                + "EP_TIME17=CASE WHEN TIME(EP_TIME17)='00:00:00' THEN '' ELSE EP_TIME17 END,"
                + "EP_TIME18=CASE WHEN TIME(EP_TIME18)='00:00:00' THEN '' ELSE EP_TIME18 END,"
                + "EP_TIME19=CASE WHEN TIME(EP_TIME19)='00:00:00' THEN '' ELSE EP_TIME19 END,"
                + "EP_TIME20=CASE WHEN TIME(EP_TIME20)='00:00:00' THEN '' ELSE EP_TIME20 END "
                + "WHERE EP_DATE>=SUBDATE(CURDATE(),INTERVAL 30 DAY) AND EP_DATE<=ADDDATE(CURDATE(),INTERVAL 30 DAY) ";
        //System.out.println("update:" + sql);
        //     data.Execute(sql);
        sql = "UPDATE SDMLATTPAY.EMP_PUNCH P,SDMLATTPAY.ATTPAY_EMPMST M  "
                + "SET EP_EMP_CODE=M.PAY_EMP_NO "
                + "WHERE P.EP_EMP_CODE=M.EMP_NO AND EP_DATE>=SUBDATE(CURDATE(),INTERVAL 30 DAY) AND EP_DATE<=ADDDATE(CURDATE(),INTERVAL 30 DAY) ";

        data.Execute(sql);
    }

}
