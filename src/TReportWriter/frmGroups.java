/*
 * frmGroups.java
 *
 * Created on July 9, 2007, 12:34 PM
 */

package TReportWriter;

/**
 *
 * @author  root
 */
import javax.swing.*;
import java.awt.*;
import java.util.*;

public class frmGroups extends javax.swing.JApplet {
    
    
    public TReport objTReport=new TReport();
    public HashMap colGroups=new HashMap();
    public boolean cancelled=false;
    private TEITLComboModel objComboModel=new TEITLComboModel();
    
    private JDialog aDialog;
    
    /** Initializes the applet frmGroups */
    public frmGroups() {
        setSize(347,290);
        initComponents();
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jScrollPane1 = new javax.swing.JScrollPane();
        GroupList = new javax.swing.JList();
        cmdUp = new javax.swing.JButton();
        cmdDown = new javax.swing.JButton();
        cmdNew = new javax.swing.JButton();
        cmdEdit = new javax.swing.JButton();
        cmdOK = new javax.swing.JButton();
        cmdCancel = new javax.swing.JButton();
        cmdDelete = new javax.swing.JButton();

        getContentPane().setLayout(null);

        addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                formMouseClicked(evt);
            }
        });

        jScrollPane1.setViewportView(GroupList);

        getContentPane().add(jScrollPane1);
        jScrollPane1.setBounds(13, 32, 220, 220);

        cmdUp.setText("Up");
        cmdUp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdUpActionPerformed(evt);
            }
        });

        getContentPane().add(cmdUp);
        cmdUp.setBounds(236, 105, 80, 25);

        cmdDown.setText("Down");
        cmdDown.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdDownActionPerformed(evt);
            }
        });

        getContentPane().add(cmdDown);
        cmdDown.setBounds(237, 134, 80, 25);

        cmdNew.setText("New");
        cmdNew.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdNewActionPerformed(evt);
            }
        });

        getContentPane().add(cmdNew);
        cmdNew.setBounds(237, 163, 80, 25);

        cmdEdit.setText("Edit");
        cmdEdit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdEditActionPerformed(evt);
            }
        });

        getContentPane().add(cmdEdit);
        cmdEdit.setBounds(238, 195, 80, 25);

        cmdOK.setText("OK");
        cmdOK.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdOKActionPerformed(evt);
            }
        });

        getContentPane().add(cmdOK);
        cmdOK.setBounds(237, 32, 80, 25);

        cmdCancel.setText("Cancel");
        cmdCancel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdCancelActionPerformed(evt);
            }
        });

        getContentPane().add(cmdCancel);
        cmdCancel.setBounds(237, 59, 80, 25);

        cmdDelete.setText("Delete");
        cmdDelete.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdDeleteActionPerformed(evt);
            }
        });

        getContentPane().add(cmdDelete);
        cmdDelete.setBounds(239, 226, 80, 25);

    }//GEN-END:initComponents
    
    private void cmdDeleteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdDeleteActionPerformed
        // TODO add your handling code here:
        try {
            if(GroupList.getSelectedIndex()>=0) {
                
                HashMap GroupsBackup=(HashMap)colGroups.clone();
                
                TBand objSelBand=(TBand)colGroups.get(Integer.toString(TGLOBAL.getComboCode(GroupList)));
                
                colGroups.clear();
                
                for(int i=1;i<=GroupsBackup.size();i++) {
                    TBand objBand=(TBand)GroupsBackup.get(Integer.toString(i));
                    if(!objBand.BandName.trim().toLowerCase().equals(objSelBand.BandName.trim().toLowerCase())) {
                        colGroups.put(Integer.toString(colGroups.size()+1),objBand);
                    }
                }
                
                
                GenerateList();
            }
        }
        catch(Exception e) {
            
        }
        
    }//GEN-LAST:event_cmdDeleteActionPerformed
    
    private void cmdCancelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdCancelActionPerformed
        // TODO add your handling code here:
        cancelled=true;
        aDialog.dispose();
    }//GEN-LAST:event_cmdCancelActionPerformed
    
    private void cmdOKActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdOKActionPerformed
        // TODO add your handling code here:
        try {
            cancelled=false;
            TBand ReportHeader=objTReport.getReportHeaderBand();
            TBand PageHeader=objTReport.getPageHeaderBand();
            TBand Detail=objTReport.getDetailBand();
            TBand PageFooter=objTReport.getPageFooterBand();
            TBand ReportFooter=objTReport.getReportFooterBand();
            
            objTReport.colBands.clear();
            
            objTReport.colBands.put(Integer.toString(objTReport.colBands.size()+1),ReportHeader);
            objTReport.colBands.put(Integer.toString(objTReport.colBands.size()+1),PageHeader);
            
            //Group Headers
            for(int i=1;i<=colGroups.size();i++) {
                TBand objBand=new TBand();
                objBand= ((TBand)colGroups.get(Integer.toString(i))).getCopy();
                if(objBand.BandType==TBand.GroupHeader) {
                    objTReport.colBands.put(Integer.toString(objTReport.colBands.size()+1),objBand);
                }
            }
            
            //Detail Band
            objTReport.colBands.put(Integer.toString(objTReport.colBands.size()+1),Detail);
            
            //Group Footers
            for(int i=colGroups.size();i>=1;i--) {
                TBand objFooterBand=new TBand();
                objFooterBand=((TBand)colGroups.get(Integer.toString(i))).getCopy();
                
                if(objFooterBand.BandType==TBand.GroupFooter) {
                    objTReport.colBands.put(Integer.toString(objTReport.colBands.size()+1),objFooterBand);
                }
            }
            
            //Page Footer
            objTReport.colBands.put(Integer.toString(objTReport.colBands.size()+1),PageFooter);
            
            objTReport.colBands.put(Integer.toString(objTReport.colBands.size()+1),ReportFooter);
            
            aDialog.dispose();
            
        }
        catch(Exception e) {
            
        }
    }//GEN-LAST:event_cmdOKActionPerformed
    
    private void cmdDownActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdDownActionPerformed
        // TODO add your handling code here:
        try {
            int currentIndex=TGLOBAL.getComboCode(GroupList);
            
            if(currentIndex<colGroups.size()) {
                TBand objBand=(TBand)colGroups.get(Integer.toString(currentIndex+1));
                TBand objBand2=(TBand)colGroups.get(Integer.toString(currentIndex));
                
                colGroups.put(Integer.toString(currentIndex+1),objBand2);
                colGroups.put(Integer.toString(currentIndex),objBand);
                
                GenerateList();
            }
        }
        catch(Exception e) {
            
        }
        
    }//GEN-LAST:event_cmdDownActionPerformed
    
    private void cmdUpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdUpActionPerformed
        // TODO add your handling code here:
        try {
            
            int currentIndex=TGLOBAL.getComboCode(GroupList);
            
            if(currentIndex>1) {
                TBand objBand=(TBand)colGroups.get(Integer.toString(currentIndex-1));
                TBand objBand2=(TBand)colGroups.get(Integer.toString(currentIndex));
                
                colGroups.put(Integer.toString(currentIndex-1),objBand2);
                colGroups.put(Integer.toString(currentIndex),objBand);
                
                GenerateList();
            }
        }
        catch(Exception e) {
            
        }
    }//GEN-LAST:event_cmdUpActionPerformed
    
    private void cmdEditActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdEditActionPerformed
        // TODO add your handling code here:
        try {
            if(GroupList.getSelectedIndex()>=0) {
                
                TBand objBand=(TBand)colGroups.get(Integer.toString(TGLOBAL.getComboCode(GroupList)));
                
                frmGroup objGroup=new frmGroup();
                objGroup.objBand=objBand;
                objGroup.ShowDialog();
                
                if(!objGroup.cancelled) {
                    colGroups.remove(Integer.toString(TGLOBAL.getComboCode(GroupList)));
                    colGroups.put(Integer.toString(TGLOBAL.getComboCode(GroupList)),objGroup.objBand);
                }
                
                GenerateList();
            }
        }
        catch(Exception e) {
            
        }
    }//GEN-LAST:event_cmdEditActionPerformed
    
    private void formMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_formMouseClicked
    
    private void cmdNewActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdNewActionPerformed
        // TODO add your handling code here:
        try {
            TBand objNewBand=new TBand();
            
            objNewBand.BandType=TBand.GroupHeader;
            objNewBand.BandHeight=5;
            
            frmGroup objGroup=new frmGroup();
            objGroup.objBand=objNewBand;
            objGroup.ShowDialog();
            
            if(!objGroup.cancelled) {
                
                TBand objHeaderBand=new TBand();
                objHeaderBand=objGroup.objBand.getCopy();
                objHeaderBand.BandType=3;
                colGroups.put(Integer.toString(colGroups.size()+1), objHeaderBand);
                
                TBand objFooterBand=new TBand();
                objFooterBand=objGroup.objBand.getCopy();
                objFooterBand.BandType=5;
                colGroups.put(Integer.toString(colGroups.size()+1), objFooterBand);
                
                GenerateList();
            }
        }
        catch(Exception e) {
            
        }
    }//GEN-LAST:event_cmdNewActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JList GroupList;
    private javax.swing.JButton cmdCancel;
    private javax.swing.JButton cmdDelete;
    private javax.swing.JButton cmdDown;
    private javax.swing.JButton cmdEdit;
    private javax.swing.JButton cmdNew;
    private javax.swing.JButton cmdOK;
    private javax.swing.JButton cmdUp;
    private javax.swing.JScrollPane jScrollPane1;
    // End of variables declaration//GEN-END:variables
    
    private Frame findParentFrame(JApplet pApplet) {
        Container c = (Container) pApplet;
        while(c != null){
            if (c instanceof Frame)
                return (Frame)c;
            
            c = c.getParent();
        }
        return (Frame)null;
    }
    
    
    public void ShowDialog() {
        setSize(347,290);
        
        LoadGroups();
        GenerateList();
        
        Frame f=findParentFrame(this);
        
        aDialog=new JDialog(f,"Report Group",true);
        
        aDialog.getContentPane().add("Center",this);
        Dimension appletSize = this.getSize();
        aDialog.setSize(appletSize);
        aDialog.setResizable(false);
        
        //Place it to center of the screen
        Dimension screenSize=Toolkit.getDefaultToolkit().getScreenSize();
        aDialog.setLocation((int)(screenSize.getWidth()-appletSize.getWidth())/2,(int)(screenSize.getHeight()-appletSize.getHeight())/2);
        
        aDialog.setDefaultCloseOperation(javax.swing.JDialog.DISPOSE_ON_CLOSE);
        aDialog.show();
    }
    
    private void GenerateList() {
        try {
            
            objComboModel=new TEITLComboModel();
            GroupList.removeAll();
            GroupList.setModel(objComboModel);
            
            for(int i=1;i<=colGroups.size();i++) {
                TBand objBand=(TBand)colGroups.get(Integer.toString(i));
                if(objBand.BandType==TBand.GroupHeader) {
                    TComboData objComboData=new TComboData();
                    objComboData.Text=objBand.BandName;
                    objComboData.Code=i;
                    objComboModel.addElement(objComboData);
                }
            }
            
        }
        catch(Exception e) {
            
        }
    }
    
    
    
    private void LoadGroups() {
        try {
            colGroups.clear();
            
            for(int i=1;i<=objTReport.colBands.size();i++) {
                TBand objBand=(TBand)objTReport.colBands.get(Integer.toString(i));
                if(objBand.BandType==TBand.GroupHeader) {
                    colGroups.put(Integer.toString(colGroups.size()+1),objBand);
                }
            }
            
            for(int i=objTReport.colBands.size();i>=1;i--) {
                TBand objBand=(TBand)objTReport.colBands.get(Integer.toString(i));
                if(objBand.BandType==TBand.GroupFooter) {
                    colGroups.put(Integer.toString(colGroups.size()+1),objBand);
                }
            }
            
            
            GenerateList();
        }
        catch(Exception e) {
            
        }
    }
    
    
}
