/*
 * frmPrintPreview.java
 *
 * Created on November 30, 2007, 5:43 PM
 */

package TReportWriter;

/**
 *
 * @author  root
 */
import java.util.*;
import javax.swing.*;
import java.awt.*;


public class frmPrintPreview extends javax.swing.JApplet {
    
    public TReportEngine objReportEngine;
    private JDialog aDialog;
    
    private int CurrentPage=1;
    
    /** Initializes the applet frmPrintPreview */
    public void init() {
        setSize(879, 568);
        initComponents();
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        ToolBar = new javax.swing.JToolBar();
        jPanel1 = new javax.swing.JPanel();
        cmdFirst = new javax.swing.JButton();
        cmdBack = new javax.swing.JButton();
        cmdNext = new javax.swing.JButton();
        cmdLast = new javax.swing.JButton();
        txtPage = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        cmdPrintAll = new javax.swing.JButton();
        lblTotalPages = new javax.swing.JLabel();
        ScrollPane = new javax.swing.JScrollPane();
        ReportText = new javax.swing.JTextArea();

        getContentPane().setLayout(null);

        addComponentListener(new java.awt.event.ComponentAdapter() {
            public void componentResized(java.awt.event.ComponentEvent evt) {
                formComponentResized(evt);
            }
        });
        addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                formMouseClicked(evt);
            }
        });

        jPanel1.setLayout(null);

        cmdFirst.setText("<<");
        cmdFirst.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdFirstActionPerformed(evt);
            }
        });

        jPanel1.add(cmdFirst);
        cmdFirst.setBounds(0, 1, 60, 25);

        cmdBack.setText("<");
        cmdBack.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdBackActionPerformed(evt);
            }
        });

        jPanel1.add(cmdBack);
        cmdBack.setBounds(61, 1, 60, 25);

        cmdNext.setText(">");
        cmdNext.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdNextActionPerformed(evt);
            }
        });

        jPanel1.add(cmdNext);
        cmdNext.setBounds(122, 1, 60, 25);

        cmdLast.setText(">>");
        cmdLast.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdLastActionPerformed(evt);
            }
        });

        jPanel1.add(cmdLast);
        cmdLast.setBounds(184, 1, 60, 25);

        txtPage.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtPageKeyPressed(evt);
            }
        });

        jPanel1.add(txtPage);
        txtPage.setBounds(282, 3, 50, 20);

        jLabel1.setText("Page");
        jPanel1.add(jLabel1);
        jLabel1.setBounds(249, 5, 40, 15);

        cmdPrintAll.setText("Print ");
        cmdPrintAll.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdPrintAllActionPerformed(evt);
            }
        });

        jPanel1.add(cmdPrintAll);
        cmdPrintAll.setBounds(456, 1, 88, 25);

        lblTotalPages.setText("..");
        jPanel1.add(lblTotalPages);
        lblTotalPages.setBounds(338, 5, 90, 15);

        ToolBar.add(jPanel1);

        getContentPane().add(ToolBar);
        ToolBar.setBounds(1, 1, 1060, 30);

        ScrollPane.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_ALWAYS);
        ScrollPane.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);
        ScrollPane.setAutoscrolls(true);
        ReportText.setEditable(false);
        ReportText.setFont(new java.awt.Font("Monospaced", 0, 11));
        ScrollPane.setViewportView(ReportText);

        getContentPane().add(ScrollPane);
        ScrollPane.setBounds(2, 30, 810, 440);

    }//GEN-END:initComponents

    private void cmdPrintAllActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdPrintAllActionPerformed
        // TODO add your handling code here:
        try
        {
          frmPrintPages objPrintPages=new frmPrintPages();
          
          objPrintPages.objReportEngine=objReportEngine;
          
          objPrintPages.Show();
          
        }
        catch(Exception e)
        {
            
        }
    }//GEN-LAST:event_cmdPrintAllActionPerformed

    private void formComponentResized(java.awt.event.ComponentEvent evt) {//GEN-FIRST:event_formComponentResized
        // TODO add your handling code here:
        try
        {
          ScrollPane.setSize(aDialog.getWidth()-10, aDialog.getHeight()-ToolBar.getHeight()-30);
          ScrollPane.setLocation(0, ToolBar.getHeight());
        }
        catch(Exception e)
        {
            
        }
    }//GEN-LAST:event_formComponentResized
    
    private void txtPageKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtPageKeyPressed
        // TODO add your handling code here:
        
        if(evt.getKeyCode()==10) {
            try {
                int PageNo=Integer.parseInt(txtPage.getText());
                
                if(PageNo>=1&&PageNo<=objReportEngine.PrintPages.size()) {
                    CurrentPage=PageNo;
                    ShowPage(CurrentPage);
                }
            }
            catch(Exception e) {
                
            }
        }
    }//GEN-LAST:event_txtPageKeyPressed
    
    private void cmdLastActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdLastActionPerformed
        // TODO add your handling code here:
        try {
            CurrentPage=objReportEngine.PrintPages.size();
            ShowPage(CurrentPage);
        }
        catch(Exception e) {
            
        }
        
    }//GEN-LAST:event_cmdLastActionPerformed
    
    private void cmdNextActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdNextActionPerformed
        // TODO add your handling code here:
        try {
            if(CurrentPage<objReportEngine.PrintPages.size()) {
                CurrentPage++;
                ShowPage(CurrentPage);
            }
        }
        catch(Exception e) {
            
        }
        
    }//GEN-LAST:event_cmdNextActionPerformed
    
    private void cmdBackActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdBackActionPerformed
        // TODO add your handling code here:
        try {
            if(CurrentPage>1) {
                CurrentPage--;
                ShowPage(CurrentPage);
            }
        }
        catch(Exception e) {
            
        }
        
    }//GEN-LAST:event_cmdBackActionPerformed
    
    private void cmdFirstActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdFirstActionPerformed
        // TODO add your handling code here:
        try {
            ShowPage(1);
        }
        catch(Exception e) {
            
        }
    }//GEN-LAST:event_cmdFirstActionPerformed
    
    private void formMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_formMouseClicked
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextArea ReportText;
    private javax.swing.JScrollPane ScrollPane;
    private javax.swing.JToolBar ToolBar;
    private javax.swing.JButton cmdBack;
    private javax.swing.JButton cmdFirst;
    private javax.swing.JButton cmdLast;
    private javax.swing.JButton cmdNext;
    private javax.swing.JButton cmdPrintAll;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JLabel lblTotalPages;
    private javax.swing.JTextField txtPage;
    // End of variables declaration//GEN-END:variables
    
    private Frame findParentFrame(JApplet pApplet) {
        Container c = (Container) pApplet;
        while(c != null){
            if (c instanceof Frame)
                return (Frame)c;
            
            c = c.getParent();
        }
        return (Frame)null;
    }
    
    
    public void ShowPreview() {
        setSize(879, 568);
        initComponents();
        
        Frame f=findParentFrame(this);
        
        aDialog=new JDialog(f,"Print Preview",true);
        
        aDialog.getContentPane().add("Center",this);
        Dimension appletSize = this.getSize();
        aDialog.setSize(appletSize);
        aDialog.setResizable(true);
        
        
        aDialog.addComponentListener(new java.awt.event.ComponentAdapter() {
            public void componentResized(java.awt.event.ComponentEvent evt) {
                formComponentResized(evt);
            }
        });     
        
        //Place it to center of the screen
        Dimension screenSize=Toolkit.getDefaultToolkit().getScreenSize();
        aDialog.setLocation((int)(screenSize.getWidth()-appletSize.getWidth())/2,(int)(screenSize.getHeight()-appletSize.getHeight())/2);
        
        ShowPage(1);
        
        aDialog.setDefaultCloseOperation(javax.swing.JDialog.DISPOSE_ON_CLOSE);
        aDialog.show();
    }
    
    
    private void ShowPage(int PageNo) {
        try {
            
            CurrentPage=PageNo;
            
            txtPage.setText(Integer.toString(PageNo));
            lblTotalPages.setText(" of "+objReportEngine.PrintPages.size());
            
            ReportText.setText("");
            
            if(PageNo>=1&&PageNo<=objReportEngine.PrintPages.size()) {
                
                TReportPage objPage=(TReportPage)objReportEngine.PrintPages.get(Integer.toString(PageNo));
                
                for(int l=1;l<=objPage.PrintLines.size();l++) {
                    
                    TReportLine objLine=(TReportLine)objPage.PrintLines.get(Integer.toString(l));
                    
                    ReportText.setText(ReportText.getText()+"\n"+objLine.OutputText);
                }
            }
            
            ReportText.setCaretPosition(0);
        }
        catch(Exception e) {
            
        }
    }
    
}
