/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package EITLERP.FeltSales;

import EITLERP.FeltSales.Reports.clsExcelExporter;
import EITLERP.FeltSales.common.JavaMail;
import EITLERP.data;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.zip.ZipEntry;
import java.util.zip.ZipOutputStream;

/**
 *
 * @author Dharmendra
 */
public class Monthly_Production_Report {

    /**
     * @param args the command line arguments
     */
    private static clsExcelExporter exprt = new clsExcelExporter();

    public static void main(String[] args) {
        // TODO code application logic here

        String recievers, responce, mweaving, mneedling, mmending, mfinishing;
        recievers = "abtewary@dineshmills.com,apurva@dineshmills.com,rakeshdalal@dineshmills.com,hemantprajapati@dineshmills.com,"
                + "soumen@dineshmills.com,vdshanbhag@dineshmills.com,yrpatel@dineshmills.com,amitkanti@dineshmills.com,"
                + "feltpp@dineshmills.com,ppgen@dineshmills.com,raghavendra@dineshmills.com,"
                + "brdfltneedle@dineshmills.com,balgondapatil@dineshmills.com,brdfltfin@dineshmills.com"
                + "brdflteng@dineshmills.com,raghavendra@dineshmills.com";
        //recievers = "dharmendra@dineshmills.com";
        String mdate = data.getStringValueFromDB("SELECT CONCAT(MONTHNAME(CURDATE()),' - ',YEAR(CURDATE())) FROM DUAL");
        String mdate1 = data.getStringValueFromDB("SELECT DATE_FORMAT(NOW(),'%d/%m/%Y %H:%i') FROM DUAL");
        mweaving = "SELECT 'WEAVING' AS DEPARTMENT,DATE_FORMAT(PROD_DATE,'%d/%m/%Y') AS PRODUCTION_DATE,PROD_DOC_NO AS DOC_NO,SR_NO,PROD_PIECE_NO AS PIECE_NO,WIP_OC_MONTHYEAR AS OC_MONTH,WIP_PARTY_CODE AS PARTY_CODE,PARTY_NAME,ROUND(THORITICAL_WEIGHT,2) AS THORITICAL_WEIGHT,ROUND(WEIGHT,2) AS WEIGHT,ROUND(PICKS_PER_10CMS,2) AS PICKS_PER_10CMS,ROUND(PICK,2) AS PICK,ROUND(PICKMTR,2) AS PICK_METER,ROUND(REED_SPACE,2) AS REED_SPACE,ROUND(LENGTH,2) AS LENGTH,LOOM_NO,WEAVE_DATE,WEAVE_DIFF_DAYS,WARP_NO,REMARKS,WIP_PRODUCT_CODE AS PRODUCT_CODE,WIP_GROUP AS \"GROUP\",WIP_GSM AS GSM,WIP_STYLE AS STYLE,DATE_FORMAT(APPROVED_DATE,'%d/%m/%Y %H:%i') AS APPROVED_DATE ,DATE_FORMAT(NOW(),'%d/%m/%Y %H:%i') AS RUN_DATE FROM (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,THORITICAL_WEIGHT,WEIGHT,PICKS_PER_10CMS,PICK,PICKMTR,REED_SPACE,LENGTH,LOOM_NO,WEAVE_DATE,WEAVE_DIFF_DAYS,WARP_NO,REMARKS,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA WHERE MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'WEAVING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO  "
                + "UNION ALL  "
                + "SELECT  'WEAVING' AS DEPT,DATE_FORMAT(A.PROD_DATE,'%d/%m/%Y') AS PROD_DATE,'',' DAY TOTAL',COUNT(*) AS TOT_PIECE,OC AS WIP_OC_MONTHYEAR,'' AS WIP_PARTY_CODE,'' AS PARTY_NAME,SUM(THORITICAL_WEIGHT) AS THEO,SUM(WEIGHT) AS WIEGHT,SUM(PICKS_PER_10CMS),SUM(PICK),SUM(PICKMTR),'' AS REED_SPACE,SUM(LENGTH),'' AS LOOM_NO,'' AS WEAVE_DATE,'' AS WEAVE_DIFF_DAYS,'' AS WARP_NO,'' AS REMARKS,'' AS WIP_PRODUCT_CODE,'' AS WIP_GROUP,'' AS WIP_GSM,'' AS WIP_STYLE,'' AS APPROVED_DATE , DATE_FORMAT(NOW(),'%d/%m/%Y %H:%i') FROM (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,THORITICAL_WEIGHT,WEIGHT,PICKS_PER_10CMS,PICK,PICKMTR,REED_SPACE,LENGTH,LOOM_NO,WEAVE_DATE,WEAVE_DIFF_DAYS,WARP_NO,REMARKS,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA WHERE MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'WEAVING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO LEFT JOIN (SELECT PROD_DATE,SUM(CNT), GROUP_CONCAT(CONCAT(WIP_OC_MONTHYEAR,' (',CNT,')') ORDER BY WIP_OC_LAST_DDMMYY) AS OC FROM (SELECT PROD_DATE,COUNT(*) AS CNT, WIP_OC_MONTHYEAR,WIP_OC_LAST_DDMMYY  FROM (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,HEAT_SETTING_OUT_DATE,HEAT_SETTING_IN_DATE,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA WHERE MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'WEAVING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR, WIP_OC_LAST_DDMMYY FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO GROUP BY  PROD_DATE,WIP_OC_MONTHYEAR) AS M GROUP BY PROD_DATE) AS O ON O.PROD_DATE = A.PROD_DATE GROUP BY  A.PROD_DATE  "
                + "UNION ALL  "
                + "SELECT 'WEAVING' AS DEPT,IFNULL(DATE_FORMAT(M.PROD_DATE,'%d/%m/%Y'),M.PROD_DATE) AS PROD_DATE,PROD_DOC_NO,SR_NO ,TOT_PIECE,OC AS WIP_OC_MONTHYEAR,WIP_PARTY_CODE,PARTY_NAME,THEO,WEIGHT,PICKS_PER_10CMS,PICK,PICKMTR,REED_SPACE,LENGTH,LOOM_NO,WEAVE_DATE,WEAVE_DIFF_DAYS,WARP_NO,REMARKS,WIP_PRODUCT_CODE,WIP_GROUP,WIP_GSM,WIP_STYLE,APPROVED_DATE,DATE_FORMAT(NOW(),'%d/%m/%Y %H:%i') FROM (SELECT 'MONTH_TOTAL' AS PROD_DATE,'' AS PROD_DOC_NO,'TOTAL' AS SR_NO ,COUNT(*) AS TOT_PIECE,'' AS WIP_OC_MONTHYEAR,'' AS WIP_PARTY_CODE,'' AS PARTY_NAME,SUM(THORITICAL_WEIGHT) AS THEO,SUM(WEIGHT) AS WEIGHT,SUM(PICKS_PER_10CMS) AS PICKS_PER_10CMS,SUM(PICK) AS PICK,SUM(PICKMTR) AS PICKMTR,'' AS REED_SPACE,SUM(LENGTH) AS LENGTH,'' AS LOOM_NO,'' AS WEAVE_DATE,'' AS WEAVE_DIFF_DAYS,'' AS WARP_NO,'' AS REMARKS,'' AS WIP_PRODUCT_CODE,'' AS WIP_GROUP,'' AS WIP_GSM,'' AS WIP_STYLE,'' AS APPROVED_DATE FROM (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,THORITICAL_WEIGHT,WEIGHT,PICKS_PER_10CMS,PICK,PICKMTR,REED_SPACE,LENGTH,LOOM_NO,WEAVE_DATE,WEAVE_DIFF_DAYS,WARP_NO,REMARKS,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA WHERE MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'WEAVING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO) AS M LEFT JOIN (SELECT PROD_DATE,SUM(CNT), GROUP_CONCAT(CONCAT(WIP_OC_MONTHYEAR,' (',CNT,')') ORDER BY WIP_OC_LAST_DDMMYY) AS OC FROM (SELECT 'MONTH_TOTAL' AS PROD_DATE,COUNT(*) AS CNT, WIP_OC_MONTHYEAR,WIP_OC_LAST_DDMMYY  FROM (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,HEAT_SETTING_OUT_DATE,HEAT_SETTING_IN_DATE,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA WHERE MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'WEAVING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR, WIP_OC_LAST_DDMMYY FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO GROUP BY  WIP_OC_MONTHYEAR) AS M ) AS O ON O.PROD_DATE = M.PROD_DATE ORDER BY PRODUCTION_DATE DESC,SR_NO +0";

        System.out.println("Weaving:" + mweaving);
        mneedling = "SELECT 'NEEDLING' AS DEPARTMENT,DATE_FORMAT(PROD_DATE,'%d/%m/%Y') AS PRODUCTION_DATE ,PROD_DOC_NO AS DOC_NO,SR_NO,PROD_PIECE_NO AS PIECE_NO,WIP_OC_MONTHYEAR AS OC_MONTH, WIP_PARTY_CODE AS PARTY_CODE,PARTY_NAME,ROUND(WEIGHT,2) AS WEIGHT,LOOM_NO,WIP_GROUP AS \"GROUP\",WIP_GSM AS GSM,WIP_STYLE AS STYLE, HEAT_SETTING_OUT_DATE,HEAT_SETTING_IN_DATE,DATE_FORMAT(APPROVED_DATE,'%d/%m/%Y %H:%i') AS APPROVED_DATE ,DATE_FORMAT(now(),'%d/%m/%Y %H:%i') AS RUN_DATE FROM (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,HEAT_SETTING_OUT_DATE,HEAT_SETTING_IN_DATE,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA WHERE MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'NEEDLING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO  "
                + "UNION ALL  "
                + "SELECT 'NEEDLING' AS DEPT,DATE_FORMAT(A.PROD_DATE,'%d/%m/%Y'),'',' DAY TOTAL',COUNT(*) AS TOT_PIECE,OC AS WIP_OC_MONTHYEAR,'' AS WIP_PARTY_CODE,'' AS PARTY_NAME,SUM(WEIGHT),'' AS LOOM_NO,'' AS WIP_GROUP,'' AS WIP_GSM,'' AS WIP_STYLE,'' AS HEAT_SETTING_OUT_DATE,'' AS HEAT_SETTING_IN_DATE,'' AS APPROVED_DATE ,DATE_FORMAT(now(),'%d/%m%Y %H:%i') FROM (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,HEAT_SETTING_OUT_DATE,HEAT_SETTING_IN_DATE,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA  WHERE  MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'NEEDLING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO LEFT JOIN  (SELECT PROD_DATE,SUM(CNT), GROUP_CONCAT(CONCAT(WIP_OC_MONTHYEAR,' (',CNT,')') ORDER BY WIP_OC_LAST_DDMMYY) AS OC FROM  (SELECT PROD_DATE,COUNT(*) AS CNT, WIP_OC_MONTHYEAR,WIP_OC_LAST_DDMMYY  FROM  (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,HEAT_SETTING_OUT_DATE,HEAT_SETTING_IN_DATE,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA  WHERE  MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'NEEDLING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR, WIP_OC_LAST_DDMMYY FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO GROUP BY  PROD_DATE,WIP_OC_MONTHYEAR) AS M GROUP BY PROD_DATE) AS O ON O.PROD_DATE = A.PROD_DATE GROUP BY  A.PROD_DATE  "
                + "UNION ALL   "
                + "SELECT 'NEEDLING' AS DEPT,M.PROD_DATE,'' AS PROD_DOC_NO,SR_NO ,TOT_PIECE,OC AS WIP_OC_MONTHYEAR, WIP_PARTY_CODE, PARTY_NAME,WEIGHT,LOOM_NO,WIP_GROUP,WIP_GSM,WIP_STYLE,HEAT_SETTING_OUT_DATE,HEAT_SETTING_IN_DATE,APPROVED_DATE ,DATE_FORMAT(now(),'%d/%m%Y %H:%i') FROM  (SELECT 'MONTH_TOTAL' AS PROD_DATE,PROD_DOC_NO,'TOTAL' AS SR_NO ,COUNT(*) AS TOT_PIECE,'' AS WIP_OC_MONTHYEAR,'' AS WIP_PARTY_CODE,'' AS PARTY_NAME,SUM(WEIGHT) AS WEIGHT,'' AS LOOM_NO,'' AS WIP_GROUP,'' AS WIP_GSM,'' AS WIP_STYLE,'' AS HEAT_SETTING_OUT_DATE,'' AS HEAT_SETTING_IN_DATE,'' AS APPROVED_DATE FROM  (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,HEAT_SETTING_OUT_DATE,HEAT_SETTING_IN_DATE,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA  WHERE  MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'NEEDLING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO) AS M  LEFT JOIN   (SELECT PROD_DATE,SUM(CNT), GROUP_CONCAT(CONCAT(WIP_OC_MONTHYEAR,' (',CNT,')') ORDER BY WIP_OC_LAST_DDMMYY) AS OC FROM  (SELECT 'MONTH_TOTAL' AS PROD_DATE,COUNT(*) AS CNT, WIP_OC_MONTHYEAR,WIP_OC_LAST_DDMMYY  FROM  (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,HEAT_SETTING_OUT_DATE,HEAT_SETTING_IN_DATE,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA  WHERE  MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'NEEDLING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR, WIP_OC_LAST_DDMMYY FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO GROUP BY  WIP_OC_MONTHYEAR) AS M ) AS O ON O.PROD_DATE = M.PROD_DATE  "
                + "ORDER BY PRODUCTION_DATE DESC,SR_NO+0";
        System.out.println("Needling:" + mneedling);
        mmending = "SELECT 'MENDING' AS DEPARTMENT,DATE_FORMAT(PROD_DATE,'%d/%m/%Y')  AS PRODUCTION_DATE,PROD_DOC_NO AS DOC_NO,SR_NO,PROD_PIECE_NO AS PIECE_NO,WIP_OC_MONTHYEAR AS OC_MONTH,WIP_PARTY_CODE AS PARTY_CODE,PARTY_NAME,WEIGHT,LOOM_NO,WIP_GROUP AS \"GROUP\",WIP_GSM AS GSM,WIP_STYLE AS STYLE,DATE_FORMAT(APPROVED_DATE,'%d/%m/%Y %H:%i') AS APPROVED_DATE ,DATE_FORMAT(now(),'%d/%m%Y %H:%i') AS RUNDATE FROM (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA WHERE MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'MENDING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO  UNION ALL  "
                + "SELECT 'MENDING' AS DEPT,IFNULL(DATE_FORMAT(A.PROD_DATE,'%d/%m/%Y'),A.PROD_DATE) AS PROD_DATE,'',' DAY TOTAL',COUNT(*) AS TOT_PIECE,OC AS WIP_OC_MONTHYEAR,'' AS WIP_PARTY_CODE,'' AS PARTY_NAME,SUM(WEIGHT),'' AS LOOM_NO,'' AS WIP_GROUP,''AS WIP_GSM,'' AS WIP_STYLE,'' AS APPROVED_DATE ,DATE_FORMAT(now(),'%d/%m%Y %H:%i') FROM (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA WHERE MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'MENDING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO LEFT JOIN (SELECT PROD_DATE,SUM(CNT), GROUP_CONCAT(CONCAT(WIP_OC_MONTHYEAR,'(',CNT,')') ORDER BY WIP_OC_LAST_DDMMYY) AS OC FROM (SELECT PROD_DATE,COUNT(*) AS CNT, WIP_OC_MONTHYEAR,WIP_OC_LAST_DDMMYY  FROM (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA WHERE MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'MENDING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR, WIP_OC_LAST_DDMMYY FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE =WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO GROUP BY  PROD_DATE,WIP_OC_MONTHYEAR) AS M GROUP BY PROD_DATE) AS O ON O.PROD_DATE = A.PROD_DATE GROUP BY  A.PROD_DATE  UNION ALL  "
                + "SELECT 'MENDING' AS DEPT,IFNULL(DATE_FORMAT(M.PROD_DATE,'%d/%m/%Y'),M.PROD_DATE) AS PROD_DATE,PROD_DOC_NO,SR_NO ,TOT_PIECE,OC AS WIP_OC_MONTHYEAR, WIP_PARTY_CODE,PARTY_NAME,WEIGHT,LOOM_NO,WIP_GROUP,WIP_GSM,WIP_STYLE,APPROVED_DATE ,DATE_FORMAT(now(),'%d/%m%Y %H:%i') FROM (SELECT 'MONTH_TOTAL' AS PROD_DATE,'' AS PROD_DOC_NO,'TOTAL' AS SR_NO ,COUNT(*) AS TOT_PIECE,'' AS WIP_OC_MONTHYEAR,'' AS WIP_PARTY_CODE,'' AS PARTY_NAME,SUM(WEIGHT) AS WEIGHT,'' AS LOOM_NO,'' AS WIP_GROUP,'' AS WIP_GSM,'' AS WIP_STYLE,'' AS HEAT_SETTING_OUT_DATE,'' AS HEAT_SETTING_IN_DATE,'' AS APPROVED_DATE FROM (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,HEAT_SETTING_OUT_DATE,HEAT_SETTING_IN_DATE,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA WHERE MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'MENDING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO) AS M LEFT JOIN (SELECT PROD_DATE,SUM(CNT), GROUP_CONCAT(CONCAT(WIP_OC_MONTHYEAR,'(',CNT,')') ORDER BY WIP_OC_LAST_DDMMYY) AS OC FROM (SELECT 'MONTH_TOTAL' AS PROD_DATE,COUNT(*) AS CNT, WIP_OC_MONTHYEAR,WIP_OC_LAST_DDMMYY  FROM (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA WHERE MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT = 'MENDING') AS A LEFT JOIN (SELECT WIP_PIECE_NO,WIP_EXT_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR, WIP_OC_LAST_DDMMYY FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE =WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_EXT_PIECE_NO GROUP BY  WIP_OC_MONTHYEAR) AS M ) AS O ON O.PROD_DATE =M.PROD_DATE ORDER BY PRODUCTION_DATE DESC,SR_NO+0";
        System.out.println("Mending:" + mmending);
        mfinishing = "SELECT 'FINISHING' AS DEPARTMENT,DATE_FORMAT(PROD_DATE,'%d/%m/%Y') AS PRODUCTION_DATE,PROD_DOC_NO AS DOC_NO,SR_NO,PROD_PIECE_NO AS PIECE_NO,WIP_OC_MONTHYEAR AS OC_MONTH,WIP_PARTY_CODE AS PARTY_CODE,PARTY_NAME,PR_FELT_VALUE_WITHOUT_DISCOUNT AS AMOUNT,WEIGHT,WEIGHTV,TAG_WEIGHT,LENGTH,WIDTH,WIP_PRODUCT_CODE AS PRODUCT_CODE,WIP_GROUP AS \"GROUP\",WIP_GSM AS GSM,WIP_STYLE AS STYLE,DATE_FORMAT(APPROVED_DATE,'%d/%m/%Y %H:%i') AS APPROVED_DATE ,DATE_FORMAT(now(),'%d/%m%Y %H:%i') AS RUN_DATE FROM  (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE, CASE WHEN PROD_PIECE_NO LIKE ('%V%') THEN 0 ELSE WEIGHT END AS WEIGHT, CASE WHEN PROD_PIECE_NO NOT LIKE ('%V%') THEN 0 ELSE WEIGHT END AS WEIGHTV, TAG_WEIGHT,LENGTH,WIDTH,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA  WHERE  MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT =  'FELT FINISHING') AS A  "
                + "LEFT JOIN (SELECT PR_PIECE_NO,PR_FELT_VALUE_WITHOUT_DISCOUNT FROM PRODUCTION.FELT_SALES_PIECE_REGISTER) AS P ON A.PROD_PIECE_NO=P.PR_PIECE_NO  "
                + "LEFT JOIN (SELECT DISTINCT WIP_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR,WIP_OC_LAST_DDMMYY FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_PIECE_NO  "
                + "UNION ALL   "
                + "SELECT 'FINISHING' AS DEPT,IFNULL(DATE_FORMAT(A.PROD_DATE,'%d/%m/%Y'),A.PROD_DATE) AS PROD_DATE,'',' DAY TOTAL',COUNT(*) AS TOT_PIECE,OC AS WIP_OC_MONTHYEAR,'' AS WIP_PARTY_CODE,'' AS PARTY_NAME,SUM(PR_FELT_VALUE_WITHOUT_DISCOUNT),SUM(WEIGHT), SUM(WEIGHTV),SUM(TAG_WEIGHT),'' AS LENGTH,'' AS WIDTH,''AS WIP_PRODUCT_CODE, '' AS WIP_GROUP,'' AS WIP_GSM,'' AS WIP_STYLE,'' AS APPROVED_DATE ,DATE_FORMAT(now(),'%d/%m/%Y %H:%i')  FROM  (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE, CASE WHEN PROD_PIECE_NO LIKE ('%V%') THEN 0 ELSE WEIGHT END AS WEIGHT, CASE WHEN PROD_PIECE_NO NOT LIKE ('%V%') THEN 0 ELSE WEIGHT END AS WEIGHTV, TAG_WEIGHT,LENGTH,WIDTH,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA  WHERE  MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT =  'FELT FINISHING') AS A  "
                + "LEFT JOIN (SELECT PR_PIECE_NO,PR_FELT_VALUE_WITHOUT_DISCOUNT FROM PRODUCTION.FELT_SALES_PIECE_REGISTER) AS P ON A.PROD_PIECE_NO=P.PR_PIECE_NO  "
                + "LEFT JOIN (SELECT DISTINCT WIP_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR,WIP_OC_LAST_DDMMYY FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_PIECE_NO LEFT JOIN  (SELECT PROD_DATE,SUM(CNT), GROUP_CONCAT(CONCAT(WIP_OC_MONTHYEAR,' (',CNT,')') ORDER BY WIP_OC_LAST_DDMMYY) AS OC FROM  (SELECT PROD_DATE,COUNT(*) AS CNT, WIP_OC_MONTHYEAR,WIP_OC_LAST_DDMMYY  FROM  (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA  WHERE  MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT =  'FELT FINISHING') AS A LEFT JOIN (SELECT DISTINCT WIP_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR,WIP_OC_LAST_DDMMYY FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_PIECE_NO GROUP BY  PROD_DATE,WIP_OC_MONTHYEAR) AS M GROUP BY PROD_DATE) AS O ON O.PROD_DATE = A.PROD_DATE GROUP BY  A.PROD_DATE  "
                + "UNION ALL   "
                + "SELECT 'FINISHING' AS DEPT,M.PROD_DATE,'' AS PROD_DOC_NO,SR_NO ,TOT_PIECE,OC AS WIP_OC_MONTHYEAR, WIP_PARTY_CODE, PARTY_NAME,PR_FELT_VALUE_WITHOUT_DISCOUNT,WEIGHT,WEIGHTV,TAG_WEIGHT,LENGTH,WIDTH,WIP_PRODUCT_CODE,WIP_GROUP,WIP_GSM,WIP_STYLE,APPROVED_DATE ,DATE_FORMAT(now(),'%d/%m%Y %H:%i') FROM  (SELECT 'MONTH_TOTAL' AS PROD_DATE,PROD_DOC_NO,'TOTAL' AS SR_NO ,COUNT(*) AS TOT_PIECE,'' AS WIP_OC_MONTHYEAR,'' AS WIP_PARTY_CODE,'' AS PARTY_NAME,SUM(PR_FELT_VALUE_WITHOUT_DISCOUNT) AS PR_FELT_VALUE_WITHOUT_DISCOUNT,SUM(WEIGHT) AS WEIGHT, SUM(WEIGHTV) AS WEIGHTV, SUM(TAG_WEIGHT) AS TAG_WEIGHT, '' AS LENGTH, '' AS WIDTH, '' AS WIP_PRODUCT_CODE, '' AS WIP_GROUP,'' AS WIP_GSM,'' AS WIP_STYLE,'' AS HEAT_SETTING_OUT_DATE,'' AS HEAT_SETTING_IN_DATE,'' AS APPROVED_DATE FROM  (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE, CASE WHEN PROD_PIECE_NO LIKE ('%V%') THEN 0 ELSE WEIGHT END AS WEIGHT, CASE WHEN PROD_PIECE_NO NOT LIKE ('%V%') THEN 0 ELSE WEIGHT END AS WEIGHTV, TAG_WEIGHT,LENGTH,WIDTH,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA  WHERE  MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT =  'FELT FINISHING') AS A  "
                + "LEFT JOIN (SELECT PR_PIECE_NO,PR_FELT_VALUE_WITHOUT_DISCOUNT FROM PRODUCTION.FELT_SALES_PIECE_REGISTER) AS P ON A.PROD_PIECE_NO=P.PR_PIECE_NO  "
                + "LEFT JOIN (SELECT DISTINCT WIP_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR,WIP_OC_LAST_DDMMYY FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_PIECE_NO) AS M LEFT JOIN  (SELECT PROD_DATE,SUM(CNT), GROUP_CONCAT(CONCAT(WIP_OC_MONTHYEAR,' (',CNT,')') ORDER BY WIP_OC_LAST_DDMMYY) AS OC FROM  (SELECT 'MONTH_TOTAL' AS PROD_DATE,COUNT(*) AS CNT, WIP_OC_MONTHYEAR,WIP_OC_LAST_DDMMYY  FROM  (SELECT PROD_DATE,PROD_DOC_NO,SR_NO,PROD_PIECE_NO,PROD_PARTY_CODE,WEIGHT,LOOM_NO,APPROVED_DATE FROM PRODUCTION.FELT_PROD_DATA  WHERE  MONTH(PROD_DATE) =MONTH(CURDATE()) AND YEAR(PROD_DATE) =YEAR(CURDATE()) AND APPROVED =1 AND CANCELED =0 AND PROD_DEPT =  'FELT FINISHING') AS A LEFT JOIN (SELECT DISTINCT WIP_PIECE_NO,WIP_PARTY_CODE,PARTY_NAME,WIP_GROUP,WIP_PRODUCT_CODE,WIP_GSM,WIP_STYLE,WIP_OC_MONTHYEAR,WIP_OC_LAST_DDMMYY FROM PRODUCTION.FELT_WIP_PIECE_REGISTER,DINESHMILLS.D_SAL_PARTY_MASTER WHERE PARTY_CODE = WIP_PARTY_CODE) AS B ON PROD_PIECE_NO = WIP_PIECE_NO GROUP BY  WIP_OC_MONTHYEAR) AS M ) AS O ON O.PROD_DATE = M.PROD_DATE ORDER BY PRODUCTION_DATE DESC,SR_NO+0  ";
        System.out.println("Finishing:" + mfinishing);
        exprt.fillData(mweaving + "#" + mmending + "#" + mneedling + "#" + mfinishing, new File("/Email_Attachment/MONTHLY_PRODUCTION_REPORT.xls"), "WEAVING#MENDING#NEEDLING#FINISHING");
        responce = sendNotificationMailWithAttachement("Monthly Felt Production Report For " + mdate + " till " + mdate1, "PFA", recievers, "aditya@dineshmills.com,sdmlerp@dineshmills.com", "/Email_Attachment/MONTHLY_PRODUCTION_REPORT.xls", "MONTHLY_PRODUCTION_REPORT.xls");
        System.out.println("Mail Response:" + responce);
    }

    public static String sendNotificationMailWithAttachement(String pSubject, String pMessage, String recievers, String pcc, String Path, String PFiles) {
        try {
            System.out.println("Recivers : " + recievers);
            System.out.println("pSubject : " + pSubject);
            System.out.println("pMessage : " + pMessage);
            System.out.println("pCC      : " + pcc);
            System.out.println("Files    : " + PFiles);

            JavaMail.SendMailwithAttachment(recievers, pMessage, pSubject, pcc, Path, PFiles);
        } catch (Exception e) {
            System.out.println("Error Msg " + e.getMessage());
            e.printStackTrace();
        }
        return "Mail Sending Done....!";
    }

    public static void writeToZipFile(String path, ZipOutputStream zipStream) throws FileNotFoundException, IOException {
        System.out.println("Writing file : '" + path + "' to zip file");
        File aFile = new File(path);
        FileInputStream fis = new FileInputStream(aFile);
        ZipEntry zipEntry = new ZipEntry(path);
        zipStream.putNextEntry(zipEntry);
        byte[] bytes = new byte[1024];
        int length;
        while ((length = fis.read(bytes)) >= 0) {
            zipStream.write(bytes, 0, length);
        }
        zipStream.closeEntry();
        fis.close();
    }

}
