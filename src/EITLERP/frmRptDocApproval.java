/*
 * frmRptDocApproval.java
 *
 * Created on January 24, 2005, 11:14 AM
 */

package EITLERP;

/**
 *
 * @author  root
 */
import javax.swing.*;
import javax.swing.table.*;
import java.awt.*;
import java.util.*;
import EITLERP.Stores.*;
import EITLERP.*;
import java.sql.*;
import java.net.*;


public class frmRptDocApproval extends javax.swing.JApplet {
    
    private EITLTableModel DataModel=new EITLTableModel();
    private EITLComboModel cmbDeptModel=new EITLComboModel();
    
    /** Initializes the applet frmRptDocApproval */
    public void init() {
        setSize(640,511);
        initComponents();
        GenerateCombo();
        FormatGridNormal();
        lblStatus.setVisible(false);
        Bar.setVisible(false);
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jLabel1 = new javax.swing.JLabel();
        cmdShow = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        Table = new javax.swing.JTable();
        Bar = new javax.swing.JProgressBar();
        jLabel2 = new javax.swing.JLabel();
        lblTotal = new javax.swing.JLabel();
        chkDept = new javax.swing.JCheckBox();
        cmbDept = new javax.swing.JComboBox();
        lblStatus = new javax.swing.JLabel();
        
        getContentPane().setLayout(null);
        
        jLabel1.setBackground(new java.awt.Color(0, 102, 153));
        jLabel1.setForeground(java.awt.Color.white);
        jLabel1.setText(" USERWISE PENDING DOCUMENT INFORMATION");
        jLabel1.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        jLabel1.setOpaque(true);
        getContentPane().add(jLabel1);
        jLabel1.setBounds(0, 1, 650, 25);
        
        cmdShow.setText("Show");
        cmdShow.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdShowActionPerformed(evt);
            }
        });
        
        getContentPane().add(cmdShow);
        cmdShow.setBounds(457, 41, 88, 25);
        
        Table.setModel(new javax.swing.table.DefaultTableModel(
        new Object [][] {
            {null, null, null, null},
            {null, null, null, null},
            {null, null, null, null},
            {null, null, null, null}
        },
        new String [] {
            "Title 1", "Title 2", "Title 3", "Title 4"
        }
        ));
        jScrollPane1.setViewportView(Table);
        
        getContentPane().add(jScrollPane1);
        jScrollPane1.setBounds(6, 77, 593, 357);
        
        getContentPane().add(Bar);
        Bar.setBounds(8, 461, 274, 19);
        
        jLabel2.setText("Total Documents Pending");
        jLabel2.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jLabel2MouseClicked(evt);
            }
        });
        
        getContentPane().add(jLabel2);
        jLabel2.setBounds(322, 453, 173, 15);
        
        lblTotal.setFont(new java.awt.Font("Dialog", 1, 14));
        lblTotal.setForeground(new java.awt.Color(51, 51, 255));
        lblTotal.setText("...");
        getContentPane().add(lblTotal);
        lblTotal.setBounds(503, 451, 94, 18);
        
        chkDept.setText("Department");
        chkDept.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                chkDeptItemStateChanged(evt);
            }
        });
        
        getContentPane().add(chkDept);
        chkDept.setBounds(10, 43, 114, 23);
        
        cmbDept.setEnabled(false);
        getContentPane().add(cmbDept);
        cmbDept.setBounds(126, 43, 315, 24);
        
        lblStatus.setText("..");
        getContentPane().add(lblStatus);
        lblStatus.setBounds(10, 442, 242, 15);
        
    }//GEN-END:initComponents

    private void jLabel2MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jLabel2MouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_jLabel2MouseClicked
    
    private void cmdShowActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdShowActionPerformed
        // TODO add your handling code here:
        
        new Thread(){
            
            public void run() {
                int SelDept=EITLERPGLOBAL.getComboCode(cmbDept);
                int DeptID=0;
                int ModuleID=0;
                int UserCount=0,TotalCount=0;
                int DeptCount=0;
                int UserSrNo=0;
                int CurrentUserID=EITLERPGLOBAL.gUserID; //Temporary Storage
                
                boolean Continue=false;
                HashMap List=new HashMap();
                HashMap UserList=new HashMap();
                HashMap ModuleList=new HashMap();
                clsUser ObjUser=new clsUser();
                Object[] rowData;
                
                Bar.setVisible(true);
                lblStatus.setVisible(true);
                lblStatus.setText("");
                Bar.setValue(0);
                
                
                try {
                    
                    frmPendingApprovals ObjPending=new frmPendingApprovals();
                    ObjPending.init();
                    
                    ModuleList=clsModules.getList(" WHERE COMPANY_ID="+EITLERPGLOBAL.gCompanyID);
                    
                    FormatGridNormal();
                    
                    List=clsDepartment.getList(" WHERE COMPANY_ID="+EITLERPGLOBAL.gCompanyID);
                    for(int i=1;i<=List.size();i++) {
                        clsDepartment ObjDept=(clsDepartment) List.get(Integer.toString(i));
                        DeptID=(int) ObjDept.getAttribute("DEPT_ID").getVal();
                        String DeptName=(String)ObjDept.getAttribute("DEPT_DESC").getObj();
                        
                        
                        
                        DeptCount=0;
                        UserCount=0;
                        UserSrNo=0;
                        
                        Continue=false;
                        if(chkDept.isSelected()) {
                            if(DeptID==SelDept) {
                                Continue=true;
                            }
                        }
                        else {
                            Continue=true;
                        }
                        
                        
                        if(Continue) {
                            
                            rowData=new Object[3];  //Department Name
                            rowData[0]=DeptName;
                            rowData[1]="###############################################";
                            rowData[2]="###############################################";
                            DataModel.addRow(rowData);
                            rowData=new Object[3];      //Adding Blank Row
                            DataModel.addRow(rowData);
                            
                            //Now get all the users of this department
                            UserList=ObjUser.getList(" WHERE COMPANY_ID="+EITLERPGLOBAL.gCompanyID+" AND DEPT_ID="+DeptID);
                            
                            Bar.setMaximum(UserList.size());
                            Bar.setMinimum(0);
                            Bar.setValue(0);
                            
                            for(int j=1;j<=UserList.size();j++) {
                                clsUser theUser=(clsUser)UserList.get(Integer.toString(j));
                                //Get the Count
                                int UserID=(int)theUser.getAttribute("USER_ID").getVal();
                                String UserName=(String)theUser.getAttribute("USER_NAME").getObj();
                                
                                lblStatus.setText(UserName);
                                lblStatus.repaint();
                                Bar.setValue(j);
                                
                                UserCount=0;
                                EITLERPGLOBAL.gUserID=UserID;
                                
                                //========== In First Pass Get the Count =============
                                for(int m=1;m<=ModuleList.size();m++) {
                                    clsModules ObjModule=(clsModules)ModuleList.get(Integer.toString(m));
                                    
                                    ModuleID=(int)ObjModule.getAttribute("MODULE_ID").getVal();
                                    String ModuleName=(String)ObjModule.getAttribute("MODULE_DESC").getObj();
                                    
                                    int Count=ObjPending.GetCount(ModuleID);
                                    
                                    UserCount+=Count;
                                    DeptCount+=Count;
                                    TotalCount+=Count;
                                }
                                //========================================================
                                
                                
                                
                                //==================Add User Name (only if count >0)================//
                                if(UserCount>0) {
                                    UserSrNo++;
                                    rowData=new Object[3];
                                    rowData[0]="("+UserSrNo+")";
                                    rowData[1]=UserName;
                                    DataModel.addRow(rowData);
                                    
                                    for(int m=1;m<=ModuleList.size();m++) {
                                        clsModules ObjModule=(clsModules)ModuleList.get(Integer.toString(m));
                                        
                                        ModuleID=(int)ObjModule.getAttribute("MODULE_ID").getVal();
                                        String ModuleName=(String)ObjModule.getAttribute("MODULE_DESC").getObj();
                                        
                                        int Count=ObjPending.GetCount(ModuleID);
                                        
                                        if(Count>0) {
                                            rowData=new Object[3];
                                            rowData[0]="";
                                            rowData[1]=ModuleName;
                                            rowData[2]=Integer.toString(Count);
                                            DataModel.addRow(rowData);
                                        }
                                    }
                                }
                                //=================================================================//
                                
                            }
                        }
                        
                        //========== Add Department Total =============//
                        if(Continue)
                        {
                        rowData=new Object[3];
                        rowData[0]="";
                        rowData[1]="Department Total ";
                        rowData[2]=Integer.toString(DeptCount);
                        DataModel.addRow(rowData);
                        rowData=new Object[3];
                        DataModel.addRow(rowData);
                        }
                        //===========================================//
                        
                    }//Dept
                    
                    lblTotal.setText(Integer.toString(TotalCount));
                    EITLERPGLOBAL.gUserID=CurrentUserID;
                    
                    lblStatus.setVisible(false);
                    Bar.setVisible(false);
                }
                catch(Exception e) {
                    EITLERPGLOBAL.gUserID=CurrentUserID;
                    lblStatus.setVisible(false);
                    Bar.setVisible(false);
                    
                }
            };
        }.start();
        
    }//GEN-LAST:event_cmdShowActionPerformed
    
    private void chkDeptItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_chkDeptItemStateChanged
        // TODO add your handling code here:
        cmbDept.setEnabled(chkDept.isSelected());
    }//GEN-LAST:event_chkDeptItemStateChanged
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JProgressBar Bar;
    private javax.swing.JTable Table;
    private javax.swing.JCheckBox chkDept;
    private javax.swing.JComboBox cmbDept;
    private javax.swing.JButton cmdShow;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lblStatus;
    private javax.swing.JLabel lblTotal;
    // End of variables declaration//GEN-END:variables
    
    private void GenerateCombo() {
        //Generates Combo Boxes
        HashMap List=new HashMap();
        String strCondition="";
        
        
        //----- Generate Department Combo ------- //
        cmbDeptModel=new EITLComboModel();
        cmbDept.removeAllItems();
        cmbDept.setModel(cmbDeptModel);
        
        List=clsDepartment.getList(" WHERE COMPANY_ID="+EITLERPGLOBAL.gCompanyID);
        for(int i=1;i<=List.size();i++) {
            clsDepartment ObjDept=(clsDepartment) List.get(Integer.toString(i));
            ComboData aData=new ComboData();
            aData.Code=(int) ObjDept.getAttribute("DEPT_ID").getVal();
            aData.Text=(String)ObjDept.getAttribute("DEPT_DESC").getObj();
            cmbDeptModel.addElement(aData);
        }
        //------------------------------ //
        
        
    }
    
    
    private void FormatGridNormal() {
        DataModel=new EITLTableModel();
        
        Table.removeAll();
        Table.setModel(DataModel);
        
        //Set the table Readonly
        DataModel.TableReadOnly(true);
        
        //Add Columns
        DataModel.addColumn("Department");
        DataModel.addColumn("User/Document");
        DataModel.addColumn("Pending Count");
        
        //Now hide the column 1
        TableColumnModel ColModel=Table.getColumnModel();
        Table.setAutoResizeMode(JTable.AUTO_RESIZE_OFF);
        Table.getColumnModel().getColumn(0).setMinWidth(150);
        Table.getColumnModel().getColumn(1).setMinWidth(300);
        Table.getColumnModel().getColumn(2).setMinWidth(100);
        
    }
}
