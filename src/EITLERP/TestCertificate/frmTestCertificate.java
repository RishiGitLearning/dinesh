/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package EITLERP.TestCertificate;

import EITLERP.EITLERPGLOBAL;
import EITLERP.FeltWH.*;
import EITLERP.JTextFieldHint;
import EITLERP.LOV;
import EITLERP.ReportRegister;
import EITLERP.data;
import java.sql.Connection;
import java.util.HashMap;
import javax.swing.JOptionPane;
import javax.swing.JTextField;

/**
 *
 * @author Dharmendra
 */
public class frmTestCertificate extends javax.swing.JApplet {

    /**
     * Initializes the applet FrmTagCard
     */
    @Override
    public void init() {
        /* Create and display the applet */
        setSize(500, 300);
        initComponents();
    }

    /**
     * This method is called from within the init() method to initialize the
     * form. WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jButton1 = new javax.swing.JButton();
        txtPieceNo = new javax.swing.JTextField();
        txtPieceNo = new JTextFieldHint(new JTextField(),"Search by F1");
        txtInvNo = new javax.swing.JTextField();
        txtInvNo = new JTextFieldHint(new JTextField(),"Search by F1");
        jLabel2 = new javax.swing.JLabel();
        txtInvDate = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();

        getContentPane().setLayout(null);

        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel1.setText("Inv Date");
        getContentPane().add(jLabel1);
        jLabel1.setBounds(230, 100, 90, 30);

        jButton1.setText("Print");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        getContentPane().add(jButton1);
        jButton1.setBounds(100, 170, 110, 30);

        txtPieceNo.setToolTipText("Press F1 ");
        txtPieceNo.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtPieceNoFocusLost(evt);
            }
        });
        txtPieceNo.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtPieceNoKeyPressed(evt);
            }
        });
        getContentPane().add(txtPieceNo);
        txtPieceNo.setBounds(100, 60, 120, 30);

        txtInvNo.setToolTipText("Press F1 ");
        txtInvNo.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtInvNoFocusLost(evt);
            }
        });
        txtInvNo.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtInvNoKeyPressed(evt);
            }
        });
        getContentPane().add(txtInvNo);
        txtInvNo.setBounds(330, 60, 120, 30);

        jLabel2.setText("Piece No.");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(20, 60, 70, 30);

        txtInvDate.setToolTipText("Press F1 ");
        txtInvDate.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtInvDateFocusLost(evt);
            }
        });
        txtInvDate.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtInvDateKeyPressed(evt);
            }
        });
        getContentPane().add(txtInvDate);
        txtInvDate.setBounds(330, 100, 120, 30);

        jLabel3.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel3.setText("OR      Inv No");
        getContentPane().add(jLabel3);
        jLabel3.setBounds(220, 60, 100, 30);
    }// </editor-fold>//GEN-END:initComponents

    private void txtPieceNoFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtPieceNoFocusLost
        // TODO add your handling code here:
        String SQL = "";
        SQL = "SELECT PIECE_NO FROM PRODUCTION.FELT_SAL_INVOICE_HEADER WHERE PIECE_NO LIKE '%" + txtPieceNo.getText().trim()+ "%'";

        if (txtPieceNo.getText().equalsIgnoreCase("")) {

        } else if (data.getStringValueFromDB(SQL).equalsIgnoreCase("")) {
            JOptionPane.showMessageDialog(this, "Invalid Piece No.", "ERROR", JOptionPane.ERROR_MESSAGE);
            txtPieceNo.setText("");
            txtPieceNo.requestFocus();
        }
    }//GEN-LAST:event_txtPieceNoFocusLost

    private void txtPieceNoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtPieceNoKeyPressed
        // TODO add your handling code here:
        if (evt.getKeyCode() == 112) //F1 Key pressed
        {
            LOV aList = new LOV();

            //aList.SQL="SELECT PARTY_CODE,NAME FROM DINESHMILLS.D_SAL_PARTY_MASTER ORDER BY NAME";
            aList.SQL = "SELECT DISTINCT PIECE_NO FROM PRODUCTION.FELT_SAL_INVOICE_HEADER WHERE APPROVED=1 AND CANCELLED=0";

            aList.ReturnCol = 1;
            aList.ShowReturnCol = true;
            aList.DefaultSearchOn = 1;

            if (aList.ShowLOV()) {
                txtPieceNo.setText(aList.ReturnVal);
                String invNo=data.getStringValueFromDB("SELECT INVOICE_NO FROM PRODUCTION.FELT_SAL_INVOICE_HEADER WHERE PIECE_NO='"+aList.ReturnVal+"'");
                String invDate=data.getStringValueFromDB("SELECT INVOICE_DATE FROM PRODUCTION.FELT_SAL_INVOICE_HEADER WHERE INVOICE_NO='"+invNo+"' AND PIECE_NO='"+aList.ReturnVal+"' ");
                txtInvNo.setText(invNo);
                txtInvDate.setText(EITLERPGLOBAL.formatDate(invDate));
                
            }
        }
    }//GEN-LAST:event_txtPieceNoKeyPressed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        // TODO add your handling code here:
        try {
            Connection Conn = EITLERP.data.getConn();
            HashMap parameterMap = new HashMap();
            String strCondition="";
            if(!txtPieceNo.getText().equals("")){
                strCondition+= " AND PIECE_NO='"+txtPieceNo.getText().trim()+"' ";
            }
            if(!txtInvNo.getText().equals("")){
                strCondition+= " AND INVOICE_NO='"+txtInvNo.getText().trim()+"' ";
            }
            if(!txtInvDate.getText().equals("")){
                strCondition+= " AND INVOICE_DATE='"+EITLERPGLOBAL.formatDateDB(txtInvDate.getText().trim())+"' ";
            }

            ReportRegister rpt = new ReportRegister(parameterMap, Conn);
            String strSQL = "SELECT CURDATE() AS CURDATE,INVOICE_NO,INVOICE_DATE,PARTY_CODE,PARTY_NAME,ADDRESS1,ADDRESS2,\n"
                    + "CITY_ID,DISPATCH_STATION,PLACE_OF_SUPPLY,PRODUCT_DESC,PIECE_NO,\n"
                    + "CONCAT('PM',' ',MACHINE_NO,' ',UPPER(POSITION_DESC)) AS POSITION,\n"
                    + "CONCAT(LENGTH,' X ',WIDTH) AS SIZE,ROUND(GSM,0) AS GSM FROM \n"
                    + "PRODUCTION.FELT_SAL_INVOICE_HEADER WHERE COMPANY_ID=2 " + strCondition;
            System.out.println(strSQL);
            rpt.setReportName("/EITLERP/TestCertificate/Test_Certificate.jrxml", 1, strSQL); //productlist is the name of my jasper file.
            rpt.callReport();
        } catch (Exception e) {

        }
    }//GEN-LAST:event_jButton1ActionPerformed

    private void txtInvNoFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtInvNoFocusLost
        // TODO add your handling code here:
    }//GEN-LAST:event_txtInvNoFocusLost

    private void txtInvNoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtInvNoKeyPressed
             // TODO add your handling code here:
     if (evt.getKeyCode() == 112) //F1 Key pressed
        {
            LOV aList = new LOV();            
            aList.SQL = "SELECT INVOICE_NO,INVOICE_DATE,PIECE_NO FROM PRODUCTION.FELT_SAL_INVOICE_HEADER WHERE APPROVED=1 AND CANCELLED=0";

            aList.ReturnCol = 1;
            aList.ShowReturnCol = true;
            aList.DefaultSearchOn = 1;
            aList.SecondCol=2;

            if (aList.ShowLOV()) {
                txtInvNo.setText(aList.ReturnVal);
                txtInvDate.setText(aList.SecondVal);
                System.out.println(EITLERPGLOBAL.formatDateDB(aList.SecondVal));
                String pieceNo=data.getStringValueFromDB("SELECT PIECE_NO FROM PRODUCTION.FELT_SAL_INVOICE_HEADER WHERE INVOICE_NO='"+aList.ReturnVal+"' AND INVOICE_DATE='"+EITLERPGLOBAL.formatDateDB(aList.SecondVal)+"'");
                //String pieceNo=data.getStringValueFromDB("SELECT PIECE_NO FROM PRODUCTION.FELT_SAL_INVOICE_HEADER WHERE INVICE_NO='"+aList.ReturnVal+"' AND INVOICE_DATE='"+aList.SecondVal+"'");
                txtPieceNo.setText(pieceNo);
            }
        }             
             
    }//GEN-LAST:event_txtInvNoKeyPressed

    private void txtInvDateFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtInvDateFocusLost
        // TODO add your handling code here:
    }//GEN-LAST:event_txtInvDateFocusLost

    private void txtInvDateKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtInvDateKeyPressed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtInvDateKeyPressed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JTextField txtInvDate;
    private javax.swing.JTextField txtInvNo;
    private javax.swing.JTextField txtPieceNo;
    // End of variables declaration//GEN-END:variables
}
