/*
 * frmRptGRNInfo.java
 *
 * Created on April 16, 2008, 12:01 PM
 */

package EITLERP.Suitings;

/**
 *
 * @author  root
 */
import EITLERP.*;
import EITLERP.Finance.*;
import EITLERP.Utils.*;
import EITLERP.Utils.SimpleDataProvider.*;
import javax.swing.*;
import java.awt.*;
import java.sql.*;
import java.net.*;
import java.util.*;
import TReportWriter.*;
import java.io.File;



import java.util.HashMap;
import java.sql.Connection;
import java.sql.Statement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.net.URL;
import javax.swing.JOptionPane;

import EITLERP.EITLERPGLOBAL;
import EITLERP.EITLComboModel;
import EITLERP.EITLTableModel;
import EITLERP.data;
import EITLERP.ComboData;



public class frmCN_Printing_13_15 extends javax.swing.JApplet {
    
    private EITLComboModel cmbReceiptTypeModel;
    private EITLComboModel cmbReportTypeModel;
    private TReportEngine objEngine=new TReportEngine();
    private TReportWriter.SimpleDataProvider.TTable objData=new TReportWriter.SimpleDataProvider.TTable();
    
    
    /** Initializes the applet frmRptGRNInfo */
    public void init() {
        setSize(424,264);
        initComponents();
        
        
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jPanel3 = new javax.swing.JPanel();
        jLabel6 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        txtFromDate = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        txtToDate = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        jButton3 = new javax.swing.JButton();
        txtBookCode = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();

        getContentPane().setLayout(null);

        addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                formMouseClicked(evt);
            }
        });

        jPanel3.setLayout(null);

        jPanel3.setBackground(new java.awt.Color(0, 153, 204));
        jPanel3.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        jLabel6.setText("CREDIT NOTE BOOK 13 15 PRINTING REPORT");
        jPanel3.add(jLabel6);
        jLabel6.setBounds(9, 8, 450, 15);

        getContentPane().add(jPanel3);
        jPanel3.setBounds(0, 2, 800, 30);

        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel2.setText("From Date :");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(20, 70, 90, 20);

        txtFromDate.setColumns(10);
        getContentPane().add(txtFromDate);
        txtFromDate.setBounds(130, 70, 120, 19);

        jLabel3.setText("To Date :");
        getContentPane().add(jLabel3);
        jLabel3.setBounds(270, 70, 60, 20);

        txtToDate.setColumns(10);
        getContentPane().add(txtToDate);
        txtToDate.setBounds(346, 70, 114, 20);

        jLabel1.setText("Period");
        getContentPane().add(jLabel1);
        jLabel1.setBounds(14, 46, 90, 15);

        jButton3.setText("CN printing ");
        jButton3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton3ActionPerformed(evt);
            }
        });

        getContentPane().add(jButton3);
        jButton3.setBounds(130, 140, 130, 25);

        txtBookCode.setColumns(10);
        getContentPane().add(txtBookCode);
        txtBookCode.setBounds(130, 100, 120, 20);

        jLabel4.setText("Book Code :");
        getContentPane().add(jLabel4);
        jLabel4.setBounds(40, 100, 90, 20);

    }//GEN-END:initComponents

    private void jButton3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton3ActionPerformed
            if ( ! Validate()) {
          return;
        }
         processcnprint() ;
      
        
        
        
       
    }//GEN-LAST:event_jButton3ActionPerformed
    
    private void formMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_formMouseClicked
        
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton3;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JTextField txtBookCode;
    private javax.swing.JTextField txtFromDate;
    private javax.swing.JTextField txtToDate;
    // End of variables declaration//GEN-END:variables
    

     
     private void GenerateReport() {
        try {
            TReportWriter.SimpleDataProvider.TRow objRow;
            TReportWriter.SimpleDataProvider.TTable objReportData=new TReportWriter.SimpleDataProvider.TTable();
            
            objReportData.AddColumn("VOUCHER_NO");
            objReportData.AddColumn("VOUCHER_DATE");
            objReportData.AddColumn("BOOK_CODE");
            objReportData.AddColumn("LEGACY_NO");
            objReportData.AddColumn("REASON_CODE");
            objReportData.AddColumn("REASON_DESC");
            objReportData.AddColumn("EFFECT");
            objReportData.AddColumn("MAIN_ACCOUNT_CODE");
            objReportData.AddColumn("MAIN_CODE");
            objReportData.AddColumn("SUB_ACCOUNT_CODE");
            objReportData.AddColumn("LINK_NO");
            objReportData.AddColumn("AMOUNT");
            objReportData.AddColumn("TOT_AMOUNT");
            objReportData.AddColumn("TOT_GROSS_AMT");
            objReportData.AddColumn("TOTAL_DISC_REVERSAL");
            objReportData.AddColumn("HREMARK");
            objReportData.AddColumn("DREMARK");
            objReportData.AddColumn("INVOICE_NO");
            objReportData.AddColumn("INVOICE_DATE");
            objReportData.AddColumn("PARTY_NAME");
            objReportData.AddColumn("CITY");
             
            TReportWriter.SimpleDataProvider.TRow objOpeningRow=objReportData.newRow();
            objOpeningRow.setValue("VOUCHER_NO","");
            objOpeningRow.setValue("VOUCHER_DATE","");
            objOpeningRow.setValue("BOOK_CODE","");
            objOpeningRow.setValue("LEGACY_NO","");
            objOpeningRow.setValue("REASON_CODE","");
            objOpeningRow.setValue("REASON_DESC","");
            objOpeningRow.setValue("EFFECT","");
            objOpeningRow.setValue("MAIN_ACCOUNT_CODE","");
            objOpeningRow.setValue("MAIN_CODE","");
            objOpeningRow.setValue("SUB_ACCOUNT_CODE","");
            objOpeningRow.setValue("LINK_NO","");
            objOpeningRow.setValue("AMOUNT","");
            objOpeningRow.setValue("TOT_AMOUNT","");
            objOpeningRow.setValue("TOTAL_GROSS_AMT","");
            objOpeningRow.setValue("TOT_DISC_REVERSAL","");
            objOpeningRow.setValue("HREMARK","");
            objOpeningRow.setValue("DREMARK","");
            objOpeningRow.setValue("INVOICE_NO","");
            objOpeningRow.setValue("INVOICE_DATE","");
            objOpeningRow.setValue("PARTY_NAME","");
            objOpeningRow.setValue("CITY","");

            
            String strSQL = "";
            //strSQL="SELECT SUM(COLUMN_9_AMT) AS INSURANCE,SUM(SD_AMT+NET_AMOUNT) AS TURN_OVER FROM DINESHMILLS.D_SAL_INVOICE_HEADER WHERE INVOICE_TYPE=2 AND INVOICE_DATE >= '"+ EITLERPGLOBAL.formatDateDB(txtFromDate.getText()) +"' AND INVOICE_DATE <= '"+ EITLERPGLOBAL.formatDateDB(txtToDate.getText()) +"' AND COLUMN_9_AMT>0 AND CHANGED_DATE IS NULL ORDER BY INVOICE_NO";
            strSQL="SELECT * FROM FINANCE.TMP_CREDIT_NOTE_DETAIL13_15 ORDER BY LEGACY_NO+0,SUB_ACCOUNT_CODE,LINK_NO";
            
            System.out.println(strSQL);
            ResultSet rsTmp=data.getResult(strSQL);
            rsTmp.first();
            
            int Counter = 0;
            
          if(rsTmp.getRow()>0) {
                while(!rsTmp.isAfterLast()) {
                    Counter ++;
                   objRow=objReportData.newRow();
                   Object[] rowData=new Object[5];
                    
                   objRow.setValue("VOUCHER_NO",UtilFunctions.getString(rsTmp,"VOUCHER_NO",""));
                   objRow.setValue("VOUCHER_DATE",UtilFunctions.getString(rsTmp,"VOUCHER_DATE",""));
                   objRow.setValue("BOOK_CODE",UtilFunctions.getString(rsTmp,"BOOK_CODE",""));
                   objRow.setValue("LEGACY_NO",UtilFunctions.getString(rsTmp,"LEGACY_NO",""));
                   objRow.setValue("REASON_CODE",UtilFunctions.getString(rsTmp,"REASON_CODE",""));
                   objRow.setValue("REASON_DESC",UtilFunctions.getString(rsTmp,"REASON_DESC",""));
                   objRow.setValue("EFFECT",UtilFunctions.getString(rsTmp,"EFFECT",""));
                   objRow.setValue("MAIN_ACCOUNT_CODE",UtilFunctions.getString(rsTmp,"MAIN_ACCOUNT_CODE",""));
                   objRow.setValue("MAIN_CODE",UtilFunctions.getString(rsTmp,"MAIN_CODE",""));
                   objRow.setValue("SUB_ACCOUNT_CODE",UtilFunctions.getString(rsTmp,"SUB_ACCOUNT_CODE",""));
                   objRow.setValue("LINK_NO",UtilFunctions.getString(rsTmp,"LINK_NO",""));
                   objRow.setValue("AMOUNT",UtilFunctions.getString(rsTmp,"AMOUNT",""));
                   objRow.setValue("TOT_AMOUNT",UtilFunctions.getString(rsTmp,"TOT_AMOUNT",""));
                   objRow.setValue("TOTAL_GROSS_AMT",UtilFunctions.getString(rsTmp,"TOTAL_GROSS_AMT",""));
                   objRow.setValue("TOT_DISC_REVERSAL",UtilFunctions.getString(rsTmp,"TOT_DISC_REVERSAL",""));
                   objRow.setValue("HREMARK",UtilFunctions.getString(rsTmp,"HREMARK",""));
                   objRow.setValue("DREMARK",UtilFunctions.getString(rsTmp,"DREMARK",""));
                   objRow.setValue("INVOICE_NO",UtilFunctions.getString(rsTmp,"INVOICE_NO",""));
                   objRow.setValue("INVOICE_DATE",UtilFunctions.getString(rsTmp,"INVOICE_DATE",""));
                   objRow.setValue("PARTY_NAME",UtilFunctions.getString(rsTmp,"PARTY_NAME",""));
                   objRow.setValue("CITY",UtilFunctions.getString(rsTmp,"CITY",""));

                   objReportData.AddRow(objRow);
                    
                    rsTmp.next();
               }
           }
        
            int Comp_ID = EITLERPGLOBAL.gCompanyID;
          //  int Monthtype = cmbMonthType.getSelectedIndex();
            HashMap Parameters=new HashMap();
           //  Parameters.put("FROM_DATE",txtFromDate.getText().trim());
            // Parameters.put("TO_DATE",txtToDate.getText().trim());
           // Parameters.put("SYS_DATE",EITLERPGLOBAL.getCurrentDate());
           
            objEngine.PreviewReport("http://"+EITLERPGLOBAL.HostIP+"/EITLERP/Reports/sales/cn1315new.rpt",Parameters,objReportData);
       
            
        }
        catch(Exception e) {
            e.printStackTrace();
        }
    }


       private void processcnprint(){
         try {
           
       
        Connection conn=data.getConn();
        Statement stmt=conn.createStatement();
        
        /*
        stmt.execute("TRUNCATE TABLE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15");
        
        stmt.execute("INSERT INTO FINANCE.TMP_CREDIT_NOTE_DETAIL13_15 (VOUCHER_NO,VOUCHER_DATE,BOOK_CODE,LEGACY_NO,REASON_CODE,EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE,AMOUNT,LINK_NO,PERCENTAGE,HREMARK, DREMARK) SELECT H.VOUCHER_NO,VOUCHER_DATE,BOOK_CODE,LEGACY_NO+0,REASON_CODE,EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE,SUM(AMOUNT),D.LINK_NO,PERCENTAGE,H.REMARKS AS HREMARK,D.REMARKS AS DREMARK FROM FINANCE.D_FIN_VOUCHER_HEADER H,FINANCE.D_FIN_VOUCHER_DETAIL D WHERE H.VOUCHER_NO = D.VOUCHER_NO AND H.APPROVED =1 AND H.CANCELLED =0  AND VOUCHER_DATE >= '"+ EITLERPGLOBAL.formatDateDB(txtFromDate.getText()) +"' AND VOUCHER_DATE <= '"+ EITLERPGLOBAL.formatDateDB(txtToDate.getText()) +"' AND BOOK_CODE = '"+txtBookCode.getText()+"' AND EFFECT ='C' GROUP BY  H.VOUCHER_NO,VOUCHER_DATE,BOOK_CODE,LEGACY_NO,REASON_CODE,EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE,D.LINK_NO,PERCENTAGE,H.REMARKS,D.REMARKS");
        
        stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  A,(SELECT H.VOUCHER_NO,VOUCHER_DATE,BOOK_CODE,LEGACY_NO,REASON_CODE,EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE,AMOUNT,D.LINK_NO,PERCENTAGE,H.REMARKS AS HREMARK,D.REMARKS AS DREMARK FROM FINANCE.D_FIN_VOUCHER_HEADER H,FINANCE.D_FIN_VOUCHER_DETAIL D WHERE H.VOUCHER_NO = D.VOUCHER_NO AND H.APPROVED =1 AND H.CANCELLED =0 AND VOUCHER_DATE >= '"+ EITLERPGLOBAL.formatDateDB(txtFromDate.getText()) +"' AND VOUCHER_DATE <= '"+ EITLERPGLOBAL.formatDateDB(txtToDate.getText()) +"' AND BOOK_CODE = '"+txtBookCode.getText()+"' AND EFFECT ='D' ) AS HD SET A.MAIN_CODE = HD.MAIN_ACCOUNT_CODE WHERE A.VOUCHER_NO = HD.VOUCHER_NO AND A.VOUCHER_DATE = HD.VOUCHER_DATE AND A.LINK_NO = HD.LINK_NO");

        stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  A,(SELECT H.VOUCHER_NO, H.VOUCHER_DATE,SUM(AMOUNT) AS AMT FROM FINANCE.D_FIN_VOUCHER_HEADER H,FINANCE.D_FIN_VOUCHER_DETAIL D WHERE H.VOUCHER_NO = D.VOUCHER_NO AND H.APPROVED =1 AND H.CANCELLED =0 AND  VOUCHER_DATE >= '"+ EITLERPGLOBAL.formatDateDB(txtFromDate.getText()) +"' AND VOUCHER_DATE <= '"+ EITLERPGLOBAL.formatDateDB(txtToDate.getText()) +"' AND BOOK_CODE = '"+txtBookCode.getText()+"' AND EFFECT ='D'  GROUP BY H.VOUCHER_NO, H.VOUCHER_DATE ) AS HD SET A.TOT_AMOUNT = AMT WHERE A.VOUCHER_NO = HD.VOUCHER_NO AND A.VOUCHER_DATE = HD.VOUCHER_DATE");
        
        stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  A,(SELECT H.VOUCHER_NO,VOUCHER_DATE, MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE IN (210010,210027,210072) THEN SUB_ACCOUNT_CODE END,0)) AS SUBS1  , MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE IN (210010,210027,210072) THEN MAIN_ACCOUNT_CODE END,0)) AS SUBS0  , MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE IN (210010,210027,210072) THEN AMOUNT END,0)) AS SUBS2  , MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE NOT IN (210010,210027,210072) THEN MAIN_ACCOUNT_CODE END,0)) AS SP1  ,MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE NOT IN (210010,210027,210072) THEN 99999 END,0)) AS SP2  , MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE NOT IN (210010,210027,210072) THEN AMOUNT END,0)) AS SP3   FROM FINANCE.D_FIN_VOUCHER_HEADER H,FINANCE.D_FIN_VOUCHER_DETAIL D  WHERE H.VOUCHER_NO = D.VOUCHER_NO AND H.APPROVED =1 AND H.CANCELLED =0  AND VOUCHER_DATE >= '"+ EITLERPGLOBAL.formatDateDB(txtFromDate.getText()) +"' AND VOUCHER_DATE <= '"+ EITLERPGLOBAL.formatDateDB(txtToDate.getText()) +"' AND BOOK_CODE = '"+txtBookCode.getText()+"' AND EFFECT ='C' GROUP BY H.VOUCHER_NO,VOUCHER_DATE ) AS HD SET A.EXT1 = SUBS1,A.EXT2= SUBS2,A.EXT3=SP1,A.EXT4=SP2,EXT5 =SUBS0 WHERE A.VOUCHER_NO = HD.VOUCHER_NO AND A.VOUCHER_DATE = HD.VOUCHER_DATE ");
        
        stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15 SET SUB_ACCOUNT_CODE = EXT1,LINK_NO ='DISC. REVERSAL',MAIN_ACCOUNT_CODE =EXT5 WHERE MAIN_ACCOUNT_CODE=EXT3  AND EXT4 =99999");

        
        stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  VN  ,FINANCE.D_FIN_REASONCODE_MASTER RM SET REASON_DESC = REASON_CODE_DESC WHERE INVOICE_TYPE =1 AND MAIN_ACCOUNT_CODE = 210027 AND RM.REASON_CODE = VN.REASON_CODE");
        
        stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  VN  ,DINESHMILLS.D_SAL_PARTY_MASTER PM SET VN.PARTY_NAME = PM.PARTY_NAME, VN.CITY = PM.CITY_ID WHERE PM.MAIN_ACCOUNT_CODE = VN.MAIN_ACCOUNT_CODE AND PARTY_CODE = SUB_ACCOUNT_CODE");
        */
        
        
        /*
   stmt.execute("DELETE FROM FINANCE.TMP_CREDIT_NOTE_DETAIL13_15");
        
        stmt.execute("INSERT INTO FINANCE.TMP_CREDIT_NOTE_DETAIL13_15 (VOUCHER_NO,VOUCHER_DATE,BOOK_CODE,LEGACY_NO,REASON_CODE,EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE,AMOUNT,LINK_NO,PERCENTAGE,HREMARK, DREMARK) SELECT H.VOUCHER_NO,VOUCHER_DATE,BOOK_CODE,LEGACY_NO+0,REASON_CODE,EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE,SUM(AMOUNT),D.LINK_NO,PERCENTAGE,H.REMARKS AS HREMARK,D.REMARKS AS DREMARK FROM FINANCE.D_FIN_VOUCHER_HEADER H,FINANCE.D_FIN_VOUCHER_DETAIL D WHERE H.VOUCHER_NO = D.VOUCHER_NO AND H.APPROVED =1 AND H.CANCELLED =0  AND VOUCHER_DATE >= '"+ EITLERPGLOBAL.formatDateDB(txtFromDate.getText()) +"' AND VOUCHER_DATE <= '"+ EITLERPGLOBAL.formatDateDB(txtToDate.getText()) +"' AND BOOK_CODE = '"+txtBookCode.getText()+"' AND EFFECT ='C' GROUP BY  H.VOUCHER_NO,VOUCHER_DATE,BOOK_CODE,LEGACY_NO,REASON_CODE,EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE,D.LINK_NO,PERCENTAGE,H.REMARKS,D.REMARKS");
        
       stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  A,(SELECT H.VOUCHER_NO,VOUCHER_DATE,BOOK_CODE,LEGACY_NO,REASON_CODE,EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE,AMOUNT,D.LINK_NO,PERCENTAGE,H.REMARKS AS HREMARK,D.REMARKS AS DREMARK FROM FINANCE.D_FIN_VOUCHER_HEADER H,FINANCE.D_FIN_VOUCHER_DETAIL D WHERE H.VOUCHER_NO = D.VOUCHER_NO AND H.APPROVED =1 AND H.CANCELLED =0 AND VOUCHER_DATE >= '"+ EITLERPGLOBAL.formatDateDB(txtFromDate.getText()) +"' AND VOUCHER_DATE <= '"+ EITLERPGLOBAL.formatDateDB(txtToDate.getText()) +"' AND BOOK_CODE = '"+txtBookCode.getText()+"' AND EFFECT ='D' ) AS HD SET A.MAIN_CODE = HD.MAIN_ACCOUNT_CODE WHERE A.VOUCHER_NO = HD.VOUCHER_NO AND A.VOUCHER_DATE = HD.VOUCHER_DATE AND A.LINK_NO = HD.LINK_NO");

        stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  A,(SELECT H.VOUCHER_NO, H.VOUCHER_DATE,SUM(AMOUNT) AS AMT FROM FINANCE.D_FIN_VOUCHER_HEADER H,FINANCE.D_FIN_VOUCHER_DETAIL D WHERE H.VOUCHER_NO = D.VOUCHER_NO AND H.APPROVED =1 AND H.CANCELLED =0 AND VOUCHER_DATE >= '"+ EITLERPGLOBAL.formatDateDB(txtFromDate.getText()) +"' AND VOUCHER_DATE <= '"+ EITLERPGLOBAL.formatDateDB(txtToDate.getText()) +"' AND BOOK_CODE = '"+txtBookCode.getText()+"' AND EFFECT ='D'  GROUP BY H.VOUCHER_NO, H.VOUCHER_DATE ) AS HD SET A.TOT_AMOUNT = AMT,A.TOTAL_GROSS_AMT = AMT WHERE A.VOUCHER_NO = HD.VOUCHER_NO AND A.VOUCHER_DATE = HD.VOUCHER_DATE");
   


stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  A ,(SELECT H.VOUCHER_NO,VOUCHER_DATE, MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE IN (210010,210027,210072) THEN SUB_ACCOUNT_CODE END,0)) AS SUBS1  ,MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE IN (210010,210027,210072) THEN MAIN_ACCOUNT_CODE END,0)) AS SUBS0  , MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE IN (210010,210027,210072) THEN AMOUNT END,0)) AS SUBS2  , MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE NOT IN (210010,210027,210072) THEN MAIN_ACCOUNT_CODE END,0)) AS SP1  ,MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE NOT IN (210010,210027,210072) THEN 99999 END,0)) AS SP2  ,MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE NOT IN (210010,210027,210072) THEN AMOUNT END,0)) AS SP3 FROM FINANCE.D_FIN_VOUCHER_HEADER H,FINANCE.D_FIN_VOUCHER_DETAIL D  WHERE H.VOUCHER_NO = D.VOUCHER_NO AND H.APPROVED =1 AND H.CANCELLED =0  AND VOUCHER_DATE >= '2017-07-01' AND VOUCHER_DATE <= '2018-01-31' AND BOOK_CODE = '13' AND EFFECT ='C' GROUP BY H.VOUCHER_NO,VOUCHER_DATE ) AS HD  SET A.EXT1 = SUBS1,A.EXT2= SUBS2,A.EXT3=SP1,A.EXT4=SP2,EXT5 =SUBS0,A.EXT6= SP3 ,A.TOT_DISC_REVERSAL =SP3 WHERE A.VOUCHER_NO = HD.VOUCHER_NO AND A.VOUCHER_DATE = HD.VOUCHER_DATE");
        

stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15 SET SUB_ACCOUNT_CODE = EXT1,LINK_NO ='DISC. REVERSAL',MAIN_ACCOUNT_CODE =EXT5 WHERE MAIN_ACCOUNT_CODE=EXT3  AND EXT4 =99999");


   stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15 SET  TOT_AMOUNT = TOTAL_GROSS_AMT -TOT_DISC_REVERSAL");
    stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15 SET  MAIN_CODE ='' WHERE BOOK_CODE =13");

        stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  VN  ,FINANCE.D_FIN_REASONCODE_MASTER RM SET REASON_DESC = REASON_CODE_DESC WHERE INVOICE_TYPE =1 AND MAIN_ACCOUNT_CODE = 210027 AND RM.REASON_CODE = VN.REASON_CODE");
        
        stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  VN  ,DINESHMILLS.D_SAL_PARTY_MASTER PM SET VN.PARTY_NAME = PM.PARTY_NAME, VN.CITY = PM.CITY_ID WHERE PM.MAIN_ACCOUNT_CODE = VN.MAIN_ACCOUNT_CODE AND PARTY_CODE = SUB_ACCOUNT_CODE");
        
        */
                
        stmt.execute("DELETE FROM FINANCE.TMP_CREDIT_NOTE_DETAIL13_15");
        
        stmt.execute("INSERT INTO FINANCE.TMP_CREDIT_NOTE_DETAIL13_15 (VOUCHER_NO,VOUCHER_DATE,BOOK_CODE,LEGACY_NO,REASON_CODE,EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE,AMOUNT,LINK_NO,PERCENTAGE,HREMARK, DREMARK) SELECT H.VOUCHER_NO,VOUCHER_DATE,BOOK_CODE,LEGACY_NO+0,REASON_CODE,EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE,SUM(AMOUNT),D.LINK_NO,PERCENTAGE,H.REMARKS AS HREMARK,D.REMARKS AS DREMARK FROM FINANCE.D_FIN_VOUCHER_HEADER H,FINANCE.D_FIN_VOUCHER_DETAIL D WHERE H.VOUCHER_NO = D.VOUCHER_NO AND H.APPROVED =1 AND H.CANCELLED =0  AND VOUCHER_DATE >= '"+ EITLERPGLOBAL.formatDateDB(txtFromDate.getText()) +"' AND VOUCHER_DATE <= '"+ EITLERPGLOBAL.formatDateDB(txtToDate.getText()) +"' AND BOOK_CODE = '"+txtBookCode.getText()+"' AND EFFECT ='C' GROUP BY  H.VOUCHER_NO,VOUCHER_DATE,BOOK_CODE,LEGACY_NO,REASON_CODE,EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE,D.LINK_NO,PERCENTAGE,H.REMARKS,D.REMARKS");
        
       stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  A,(SELECT H.VOUCHER_NO,VOUCHER_DATE,BOOK_CODE,LEGACY_NO,REASON_CODE,EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE,AMOUNT,D.LINK_NO,PERCENTAGE,H.REMARKS AS HREMARK,D.REMARKS AS DREMARK FROM FINANCE.D_FIN_VOUCHER_HEADER H,FINANCE.D_FIN_VOUCHER_DETAIL D WHERE H.VOUCHER_NO = D.VOUCHER_NO AND H.APPROVED =1 AND H.CANCELLED =0 AND VOUCHER_DATE >= '"+ EITLERPGLOBAL.formatDateDB(txtFromDate.getText()) +"' AND VOUCHER_DATE <= '"+ EITLERPGLOBAL.formatDateDB(txtToDate.getText()) +"' AND BOOK_CODE = '"+txtBookCode.getText()+"' AND EFFECT ='D' ) AS HD SET A.MAIN_CODE = HD.MAIN_ACCOUNT_CODE WHERE A.VOUCHER_NO = HD.VOUCHER_NO AND A.VOUCHER_DATE = HD.VOUCHER_DATE AND A.LINK_NO = HD.LINK_NO");

        stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  A,(SELECT H.VOUCHER_NO, H.VOUCHER_DATE,SUM(AMOUNT) AS AMT FROM FINANCE.D_FIN_VOUCHER_HEADER H,FINANCE.D_FIN_VOUCHER_DETAIL D WHERE H.VOUCHER_NO = D.VOUCHER_NO AND H.APPROVED =1 AND H.CANCELLED =0 AND VOUCHER_DATE >= '"+ EITLERPGLOBAL.formatDateDB(txtFromDate.getText()) +"' AND VOUCHER_DATE <= '"+ EITLERPGLOBAL.formatDateDB(txtToDate.getText()) +"' AND BOOK_CODE = '"+txtBookCode.getText()+"' AND EFFECT ='D'  GROUP BY H.VOUCHER_NO, H.VOUCHER_DATE ) AS HD SET A.TOT_AMOUNT = AMT,A.TOTAL_GROSS_AMT = AMT WHERE A.VOUCHER_NO = HD.VOUCHER_NO AND A.VOUCHER_DATE = HD.VOUCHER_DATE");
   


stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  A ,(SELECT H.VOUCHER_NO,VOUCHER_DATE, MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE IN (210010,210027,210072) THEN SUB_ACCOUNT_CODE END,0)) AS SUBS1  ,MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE IN (210010,210027,210072) THEN MAIN_ACCOUNT_CODE END,0)) AS SUBS0  , MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE IN (210010,210027,210072) THEN AMOUNT END,0)) AS SUBS2  , MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE NOT IN (210010,210027,210072) THEN MAIN_ACCOUNT_CODE END,0)) AS SP1  ,MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE NOT IN (210010,210027,210072) THEN 99999 END,0)) AS SP2  ,MAX(COALESCE(CASE WHEN MAIN_ACCOUNT_CODE NOT IN (210010,210027,210072) THEN AMOUNT END,0)) AS SP3 FROM FINANCE.D_FIN_VOUCHER_HEADER H,FINANCE.D_FIN_VOUCHER_DETAIL D  WHERE H.VOUCHER_NO = D.VOUCHER_NO AND H.APPROVED =1 AND H.CANCELLED =0  AND VOUCHER_DATE >= '"+ EITLERPGLOBAL.formatDateDB(txtFromDate.getText()) +"' AND VOUCHER_DATE <= '"+ EITLERPGLOBAL.formatDateDB(txtToDate.getText()) +"' AND BOOK_CODE = '13' AND EFFECT ='C' GROUP BY H.VOUCHER_NO,VOUCHER_DATE ) AS HD  SET A.EXT1 = SUBS1,A.EXT2= SUBS2,A.EXT3=SP1,A.EXT4=SP2,EXT5 =SUBS0,A.EXT6= SP3 ,A.TOT_DISC_REVERSAL =SP3 WHERE A.VOUCHER_NO = HD.VOUCHER_NO AND A.VOUCHER_DATE = HD.VOUCHER_DATE");
        

stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15 SET SUB_ACCOUNT_CODE = EXT1,LINK_NO ='DISC. REVERSAL',MAIN_ACCOUNT_CODE =EXT5 WHERE MAIN_ACCOUNT_CODE=EXT3  AND EXT4 =99999");


   stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15 SET  TOT_AMOUNT = TOTAL_GROSS_AMT -TOT_DISC_REVERSAL");
    stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15 SET  MAIN_CODE ='' WHERE BOOK_CODE =13");

        stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  VN  ,FINANCE.D_FIN_REASONCODE_MASTER RM SET REASON_DESC = REASON_CODE_DESC WHERE INVOICE_TYPE =1 AND MAIN_ACCOUNT_CODE = 210027 AND RM.REASON_CODE = VN.REASON_CODE");
        
        stmt.execute("UPDATE FINANCE.TMP_CREDIT_NOTE_DETAIL13_15  VN  ,DINESHMILLS.D_SAL_PARTY_MASTER PM SET VN.PARTY_NAME = PM.PARTY_NAME, VN.CITY = PM.CITY_ID WHERE PM.MAIN_ACCOUNT_CODE = VN.MAIN_ACCOUNT_CODE AND PARTY_CODE = SUB_ACCOUNT_CODE");
        
        
        System.out.println("1"); 
      
        
        GenerateReport();    
        
           }
        catch(Exception e) {
            e.printStackTrace();
        }  
    }
     
     
    private boolean Validate() {
        //Form level validations
        
        if(txtFromDate.getText().trim().equals("")) {
            JOptionPane.showMessageDialog(null,"Please Enter from Date");
            return false;
        } else if(!EITLERPGLOBAL.isDate(txtFromDate.getText())) {
            JOptionPane.showMessageDialog(null,"Invalid From Date in DD/MM/YYYY format.");
            return false;
        }
        
        if(txtToDate.getText().trim().equals("")) {
            JOptionPane.showMessageDialog(null,"Please Enter To Date");
            return false;
        } else if(!EITLERPGLOBAL.isDate(txtToDate.getText())) {
            JOptionPane.showMessageDialog(null,"Invalid To Date in DD/MM/YYYY format.");
            return false;
        }
        
        return true;
    }
    
    
    
}
