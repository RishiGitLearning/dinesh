/*
 * frmBarcodePrint.java
 *
 * Created on July 12, 2004, 6:04 PM
 */

package EITLERP.Stores;

/**
 *
 * @author  root
 */
/*<APPLET CODE=frmBarcodePrint.class WIDTH=428 HEIGHT=320></APPLET>*/


import EITLERP.*;
import EITLERP.Utils.*;
import javax.swing.*;
import java.awt.*;
import java.io.*;
import javax.print.*;
import java.sql.*;
import java.net.*;

public class frmBarcodePrint extends javax.swing.JApplet {
    
    private EITLComboModel cmbSelectionModel;
    private EITLComboModel cmbTypeModel;
    
    /** Initializes the applet frmBarcodePrint */
    public void init() {
        setSize(428,320);
        initComponents();
        GenerateCombo();
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        cmbSelection = new javax.swing.JComboBox();
        cmdPrint = new javax.swing.JButton();
        cmdExit = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        lblStatus = new javax.swing.JLabel();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel1 = new javax.swing.JPanel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        txtFromNo = new javax.swing.JTextField();
        txtToNo = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        cmbType = new javax.swing.JComboBox();
        jPanel3 = new javax.swing.JPanel();
        jLabel6 = new javax.swing.JLabel();
        txtFromItemID = new javax.swing.JTextField();
        txtToItemID = new javax.swing.JTextField();
        jLabel7 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        jPanel4 = new javax.swing.JPanel();
        jLabel9 = new javax.swing.JLabel();
        txtValue = new javax.swing.JTextField();
        txtQty = new javax.swing.JTextField();
        jLabel10 = new javax.swing.JLabel();
        chkMoving = new javax.swing.JCheckBox();
        jLabel11 = new javax.swing.JLabel();
        txtDate = new javax.swing.JTextField();

        getContentPane().setLayout(null);

        jLabel1.setBackground(new java.awt.Color(0, 102, 153));
        jLabel1.setForeground(java.awt.Color.white);
        jLabel1.setText(" BARCODE PRINTING");
        jLabel1.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        jLabel1.setOpaque(true);
        getContentPane().add(jLabel1);
        jLabel1.setBounds(1, 3, 666, 25);

        jLabel2.setText("Selection");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(7, 45, 66, 15);

        cmbSelection.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                cmbSelectionItemStateChanged(evt);
            }
        });

        getContentPane().add(cmbSelection);
        cmbSelection.setBounds(80, 40, 302, 24);

        cmdPrint.setText("Start Print");
        cmdPrint.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdPrintActionPerformed(evt);
            }
        });

        getContentPane().add(cmdPrint);
        cmdPrint.setBounds(173, 218, 115, 25);

        cmdExit.setText("Exit");
        cmdExit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdExitActionPerformed(evt);
            }
        });

        getContentPane().add(cmdExit);
        cmdExit.setBounds(295, 218, 88, 25);

        jPanel2.setLayout(null);

        jPanel2.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.LOWERED));
        lblStatus.setText(" Ready");
        jPanel2.add(lblStatus);
        lblStatus.setBounds(3, 2, 390, 15);

        getContentPane().add(jPanel2);
        jPanel2.setBounds(3, 275, 396, 20);

        jPanel1.setLayout(null);

        jPanel1.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 0, 0)));
        jLabel3.setText("From MIR No.");
        jPanel1.add(jLabel3);
        jLabel3.setBounds(9, 47, 97, 15);

        jLabel4.setText("To MIR No.");
        jPanel1.add(jLabel4);
        jLabel4.setBounds(24, 80, 77, 15);

        txtFromNo.setEnabled(false);
        jPanel1.add(txtFromNo);
        txtFromNo.setBounds(109, 44, 114, 23);

        txtToNo.setEnabled(false);
        jPanel1.add(txtToNo);
        txtToNo.setBounds(109, 78, 114, 23);

        jLabel5.setText("MIR Type");
        jPanel1.add(jLabel5);
        jLabel5.setBounds(32, 15, 68, 15);

        cmbType.setEnabled(false);
        jPanel1.add(cmbType);
        cmbType.setBounds(108, 9, 116, 24);

        jTabbedPane1.addTab("MIR Selection", jPanel1);

        jPanel3.setLayout(null);

        jPanel3.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 0, 0)));
        jLabel6.setText("From Item Code");
        jPanel3.add(jLabel6);
        jLabel6.setBounds(12, 9, 105, 15);

        txtFromItemID.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtFromItemIDKeyPressed(evt);
            }
        });

        jPanel3.add(txtFromItemID);
        txtFromItemID.setBounds(121, 7, 108, 19);

        txtToItemID.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtToItemIDKeyPressed(evt);
            }
        });

        jPanel3.add(txtToItemID);
        txtToItemID.setBounds(121, 35, 108, 19);

        jLabel7.setText("To Code");
        jPanel3.add(jLabel7);
        jLabel7.setBounds(57, 38, 57, 15);

        jLabel8.setText("Keep both code blank to print all items barcode");
        jPanel3.add(jLabel8);
        jLabel8.setBounds(9, 70, 342, 15);

        jTabbedPane1.addTab("Item Selection", jPanel3);

        jPanel4.setLayout(null);

        jPanel4.setBorder(new javax.swing.border.EtchedBorder());
        jLabel9.setText("Value >=");
        jPanel4.add(jLabel9);
        jLabel9.setBounds(52, 38, 65, 15);

        jPanel4.add(txtValue);
        txtValue.setBounds(121, 35, 108, 19);

        jPanel4.add(txtQty);
        txtQty.setBounds(121, 7, 108, 19);

        jLabel10.setText("Qty >=");
        jPanel4.add(jLabel10);
        jLabel10.setBounds(65, 9, 49, 15);

        chkMoving.setText("Only Moving Items");
        jPanel4.add(chkMoving);
        chkMoving.setBounds(219, 80, 150, 23);

        jLabel11.setText("As On Date");
        jPanel4.add(jLabel11);
        jLabel11.setBounds(37, 64, 80, 15);

        jPanel4.add(txtDate);
        txtDate.setBounds(122, 62, 108, 19);

        jTabbedPane1.addTab("More Criteria", jPanel4);

        getContentPane().add(jTabbedPane1);
        jTabbedPane1.setBounds(7, 74, 377, 133);

    }//GEN-END:initComponents
    
    private void txtToItemIDKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtToItemIDKeyPressed
        // TODO add your handling code here:
        if(evt.getKeyCode()==112) //F1 Key pressed
        {
            LOV aList=new LOV();
            
            aList.SQL="SELECT ITEM_ID,ITEM_DESCRIPTION FROM D_INV_ITEM_MASTER WHERE COMPANY_ID="+EITLERPGLOBAL.gCompanyID+" AND CANCELLED=0  ORDER BY ITEM_ID";
            aList.ReturnCol=1;
            aList.ShowReturnCol=true;
            aList.DefaultSearchOn=2;
            
            if(aList.ShowLOV()) {
                txtToItemID.setText(aList.ReturnVal);
            }
        }
        
    }//GEN-LAST:event_txtToItemIDKeyPressed
    
    private void txtFromItemIDKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtFromItemIDKeyPressed
        // TODO add your handling code here:
        if(evt.getKeyCode()==112) //F1 Key pressed
        {
            LOV aList=new LOV();
            
            aList.SQL="SELECT ITEM_ID,ITEM_DESCRIPTION FROM D_INV_ITEM_MASTER WHERE COMPANY_ID="+EITLERPGLOBAL.gCompanyID+" AND CANCELLED=0  ORDER BY ITEM_ID";
            aList.ReturnCol=1;
            aList.ShowReturnCol=true;
            aList.DefaultSearchOn=2;
            
            if(aList.ShowLOV()) {
                txtFromItemID.setText(aList.ReturnVal);
            }
        }
        
    }//GEN-LAST:event_txtFromItemIDKeyPressed
    
    private void cmdExitActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdExitActionPerformed
        // TODO add your handling code here:
        ((JFrame)getParent().getParent().getParent().getParent()).dispose();
    }//GEN-LAST:event_cmdExitActionPerformed
    
    private void cmdPrintActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdPrintActionPerformed
        // TODO add your handling code here:
        EITLERPGLOBAL.ChangeCursorToWait(this);
        
        if(EITLERPGLOBAL.getComboCode(cmbSelection)==2||EITLERPGLOBAL.getComboCode(cmbSelection)==1) {
            Print();
        }
        
        if(EITLERPGLOBAL.getComboCode(cmbSelection)==3) {
            PrintStockBarcode();
        }
        
        EITLERPGLOBAL.ChangeCursorToDefault(this);
    }//GEN-LAST:event_cmdPrintActionPerformed
    
    private void cmbSelectionItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_cmbSelectionItemStateChanged
        // TODO add your handling code here:
        if(cmbSelection.getSelectedIndex()==1||cmbSelection.getSelectedIndex()==2) {
            txtFromNo.setEnabled(false);
            txtToNo.setEnabled(false);
            cmbType.setEnabled(false);
        }
        else {
            txtFromNo.setEnabled(true);
            txtToNo.setEnabled(true);
            cmbType.setEnabled(true);
        }
    }//GEN-LAST:event_cmbSelectionItemStateChanged
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JCheckBox chkMoving;
    private javax.swing.JComboBox cmbSelection;
    private javax.swing.JComboBox cmbType;
    private javax.swing.JButton cmdExit;
    private javax.swing.JButton cmdPrint;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JLabel lblStatus;
    private javax.swing.JTextField txtDate;
    private javax.swing.JTextField txtFromItemID;
    private javax.swing.JTextField txtFromNo;
    private javax.swing.JTextField txtQty;
    private javax.swing.JTextField txtToItemID;
    private javax.swing.JTextField txtToNo;
    private javax.swing.JTextField txtValue;
    // End of variables declaration//GEN-END:variables
    
    private void GenerateCombo() {
        //--- Generate Type Combo ------//
        cmbSelectionModel =new EITLComboModel();
        cmbSelection.removeAllItems();
        cmbSelection.setModel(cmbSelectionModel);
        
        
        ComboData aData=new ComboData();
        aData.Code=2;
        aData.Text="Specify the range";
        cmbSelectionModel.addElement(aData);
        
        aData=new ComboData();
        aData.Code=1;
        aData.Text="Print all pending";
        cmbSelectionModel.addElement(aData);
        
        aData=new ComboData();
        aData.Code=3;
        aData.Text="Print Stock Barcode";
        cmbSelectionModel.addElement(aData);
        //===============================//
        
        
        cmbTypeModel=new EITLComboModel();
        cmbType.removeAllItems();
        cmbType.setModel(cmbTypeModel);
        
        aData=new ComboData();
        aData.Code=1;
        aData.Text="General";
        cmbTypeModel.addElement(aData);
        
        aData=new ComboData();
        aData.Code=2;
        aData.Text="Raw Material";
        cmbTypeModel.addElement(aData);
    }
    
    private void Print() {
        
        new Thread() {
            
            public void run() {
                Connection tmpConn;
                Statement stTmp;
                ResultSet rsTmp;
                String strSQL="";
                BufferedWriter aFile;
                
                int LastCol=2;
                
                if(cmbSelection.getSelectedIndex()==0) {
                    if(txtFromNo.getText().trim().equals("")||txtToNo.getText().trim().equals("")) {
                        JOptionPane.showMessageDialog(null,"Please specify From and To MIR No.");
                        return;
                    }
                }
                
                lblStatus.setText("Creating File.");
                
                try {
                    aFile=new BufferedWriter(new FileWriter(new File("inbarcode.rpt")));
                }
                catch(Exception e) {
                    JOptionPane.showMessageDialog(null,"Error creating file. Error is "+e.getMessage());
                    return;
                }
                
                
                try {
                    tmpConn=data.getConn();
                    stTmp=tmpConn.createStatement();
                    
                    int MIRType=EITLERPGLOBAL.getComboCode(cmbType);
                    
                    if(cmbSelection.getSelectedIndex()==1) {
                        strSQL="SELECT DISTINCT(D_INV_MIR_HEADER.MIR_NO),SR_NO,D_INV_MIR_HEADER.MIR_TYPE FROM D_INV_MIR_HEADER,D_INV_MIR_DETAIL WHERE D_INV_MIR_HEADER.COMPANY_ID=D_INV_MIR_DETAIL.COMPANY_ID AND D_INV_MIR_HEADER.MIR_NO=D_INV_MIR_DETAIL.MIR_NO AND D_INV_MIR_HEADER.MIR_TYPE=D_INV_MIR_DETAIL.MIR_TYPE AND D_INV_MIR_HEADER.COMPANY_ID="+EITLERPGLOBAL.gCompanyID+" AND D_INV_MIR_DETAIL.PRINTED=0 AND D_INV_MIR_DETAIL.BARCODE_TYPE<>'N' ORDER BY D_INV_MIR_DETAIL.MIR_NO";
                    }
                    else {
                        strSQL="SELECT DISTINCT(D_INV_MIR_HEADER.MIR_NO),SR_NO,D_INV_MIR_HEADER.MIR_TYPE FROM D_INV_MIR_HEADER,D_INV_MIR_DETAIL WHERE D_INV_MIR_HEADER.COMPANY_ID=D_INV_MIR_DETAIL.COMPANY_ID AND D_INV_MIR_HEADER.MIR_NO=D_INV_MIR_DETAIL.MIR_NO AND D_INV_MIR_HEADER.MIR_TYPE=D_INV_MIR_DETAIL.MIR_TYPE AND D_INV_MIR_HEADER.COMPANY_ID="+EITLERPGLOBAL.gCompanyID+" AND D_INV_MIR_HEADER.MIR_NO>='"+txtFromNo.getText().trim()+"' AND D_INV_MIR_HEADER.MIR_NO<='"+txtToNo.getText().trim()+"' AND D_INV_MIR_HEADER.MIR_TYPE="+MIRType+" AND D_INV_MIR_DETAIL.BARCODE_TYPE<>'N' ORDER BY D_INV_MIR_DETAIL.MIR_NO";
                    }
                    
                    rsTmp=stTmp.executeQuery(strSQL);
                    rsTmp.first();
                    
                    if(rsTmp.getRow()>0) {
                        while(!rsTmp.isAfterLast()) {
                            String MIRNo=rsTmp.getString("MIR_NO");
                            int MIRSrNo=rsTmp.getInt("SR_NO");
                            int Type=rsTmp.getInt("MIR_TYPE");
                            
                            lblStatus.setText("Processing :"+MIRNo);
                            clsMIRRaw tmpObj=new clsMIRRaw();
                            tmpObj.LoadData(EITLERPGLOBAL.gCompanyID);
                            
                            clsMIRRaw ObjMIR=(clsMIRRaw)tmpObj.getObject(EITLERPGLOBAL.gCompanyID,MIRNo,Type);
                            
                            for(int i=1;i<=ObjMIR.colMIRItems.size();i++) {
                                clsMIRRawItem ObjItem=(clsMIRRawItem)ObjMIR.colMIRItems.get(Integer.toString(i));
                                
                                if((int)ObjItem.getAttribute("SR_NO").getVal()==MIRSrNo) {
                                    
                                    String ItemID=(String)ObjItem.getAttribute("ITEM_ID").getObj();
                                    String ItemName=clsItem.getItemName(EITLERPGLOBAL.gCompanyID,ItemID).trim().replaceAll("\""," ");
                                    int DeptID=(int)ObjItem.getAttribute("DEPT_ID").getVal();
                                    
                                    String ItemLine1="";
                                    String ItemLine2="";
                                    
                                    if(ItemName.length()>18) {
                                        ItemLine1=ItemName.substring(0,18);
                                        if(ItemName.length()>36) {
                                            ItemLine2=ItemName.substring(19,36);
                                        }
                                        else {
                                            ItemLine2=ItemName.substring(19);
                                        }
                                    }
                                    else {
                                        ItemLine1=ItemName.trim();
                                        ItemLine2="";
                                    }
                                    
                                    
                                    String Location=(String)ObjItem.getAttribute("LOCATION_ID").getObj();
                                    String DeptName=clsDepartment.getDeptName(EITLERPGLOBAL.gCompanyID, DeptID);
                                    String tMIRNo=EITLERPGLOBAL.Replicate(" ", 7-MIRNo.trim().length())+MIRNo.trim();
                                    String tMIRSrNo=EITLERPGLOBAL.Replicate(" ", 3-Integer.toString(MIRSrNo).trim().length())+ Integer.toString(MIRSrNo).trim();
                                    String tType=Integer.toString(Type);
                                    String tMIRDate=EITLERPGLOBAL.formatDate((String)ObjMIR.getAttribute("MIR_DATE").getObj());
                                    //String tBarCode=ItemID+tMIRNo+tMIRSrNo;
                                    String tBarCode=ItemID.substring(0,8)+tMIRNo.substring(0,7);
                                    
                                    String BarcodeType=(String)ObjItem.getAttribute("BARCODE_TYPE").getObj();
                                    double Qty=ObjItem.getAttribute("RECEIVED_QTY").getVal();
                                    int UnitID=(int)ObjItem.getAttribute("UNIT").getVal();
                                    String UnitName=clsParameter.getParaDescription(EITLERPGLOBAL.gCompanyID,"UNIT",UnitID);
                                    String SuppCode=(String)ObjMIR.getAttribute("SUPP_ID").getObj();
                                    String SuppName=clsSupplier.getSupplierName(EITLERPGLOBAL.gCompanyID,SuppCode).trim();
                                    
                                    
                                    if(SuppName.length()>18) {
                                        SuppName=SuppName.substring(0,18);
                                    }
                                    
                                    
                                    if(BarcodeType.equals("S")) {
                                        
                                        //Print Single Barcode for single Item
                                        if(LastCol==2) {
                                            //Add Escape Sequences
                                            aFile.write("OD");
                                            aFile.newLine();
                                            aFile.write("N");
                                            aFile.newLine();
                                            aFile.write("q816");
                                            aFile.newLine();
                                            aFile.write("Q400,24+0");
                                            aFile.newLine();
                                            aFile.write("S3");
                                            aFile.newLine();
                                            aFile.write("D8");
                                            aFile.newLine();
                                            aFile.write("ZT");
                                            aFile.newLine();
                                        }
                                        
                                        if(LastCol==2) {
                                            aFile.write("A16,27,0,a,1,1,N,\"CODE :\"");
                                            aFile.newLine();
                                            aFile.write("A106,27,0,4,1,1,N,\""+ItemID+"\"");
                                            aFile.newLine();
                                            aFile.write("A16,67,0,a,1,1,N,\"DESC :\"");
                                            aFile.newLine();
                                            aFile.write("A106,67,0,a,1,1,N,\""+ItemLine1+"\"");
                                            aFile.newLine();
                                            aFile.write("A106,97,0,a,1,1,N,\""+ItemLine2+"\"");
                                            aFile.newLine();
                                            aFile.write("A16,136,0,a,1,1,N,\"SUPP  :\"");
                                            aFile.newLine();
                                            aFile.write("A106,136,0,a,1,1,N,\""+SuppName+"\"");
                                            aFile.newLine();
                                            aFile.write("A16,174,0,a,1,1,N,\"MIR   :\"");
                                            aFile.newLine();
                                            aFile.write("A106,174,0,4,1,1,N,\""+MIRNo+"\"");
                                            aFile.newLine();
                                            aFile.write("A264,172,0,a,1,1,N,\""+tMIRDate+"\"");
                                            aFile.newLine();
                                            aFile.write("A16,213,0,a,1,1,N,\"QTY.:\"");
                                            aFile.newLine();
                                            aFile.write("A106,213,0,4,1,1,N,\""+EITLERPGLOBAL.round(Qty,2)+"\"");
                                            aFile.newLine();
                                            aFile.write("A260,213,0,a,1,1,N,\""+UnitName+"\"");
                                            aFile.newLine();
                                            aFile.write("A16,256,0,a,1,1,N,\"LOC. :\"");
                                            aFile.newLine();
                                            aFile.write("A106,256,0,4,1,1,N,\""+Location+"\"");
                                            aFile.newLine();
                                            aFile.write("A270,256,0,a,1,1,N,\""+DeptName+"\"");
                                            aFile.newLine();
                                            
                                            //aFile.write("B55,292,0,1,2,2,41,B,\""+tBarCode+"\"");
                                            aFile.write("B25,292,0,1,2,2,41,B,\""+tBarCode+"\"");
                                            //?'B471,292,0,1,2,2,41,B,'+'"&mbar1"'
                                            aFile.newLine();
                                            aFile.newLine();
                                        }
                                        
                                        if(LastCol==1) {
                                            aFile.write("A432,27,0,a,1,1,N,\"CODE :\"");
                                            aFile.newLine();
                                            aFile.write("A522,27,0,4,1,1,N,\""+ItemID+"\"");
                                            aFile.newLine();
                                            aFile.write("A432,67,0,a,1,1,N,\"DESC :\"");
                                            aFile.newLine();
                                            aFile.write("A522,67,0,a,1,1,N,\""+ItemLine1+"\"");
                                            aFile.newLine();
                                            aFile.write("A522,97,0,a,1,1,N,\""+ItemLine2+"\"");
                                            aFile.newLine();
                                            aFile.write("A432,136,0,a,1,1,N,\"SUPP  :\"");
                                            aFile.newLine();
                                            aFile.write("A522,136,0,a,1,1,N,\""+SuppName+"\"");
                                            aFile.newLine();
                                            aFile.write("A432,174,0,a,1,1,N,\"MIR   :\"");
                                            aFile.newLine();
                                            aFile.write("A522,174,0,4,1,1,N,\""+MIRNo+"\"");
                                            aFile.newLine();
                                            aFile.write("A680,172,0,a,1,1,N,\""+tMIRDate+"\"");
                                            aFile.newLine();
                                            aFile.write("A432,213,0,a,1,1,N,\"QTY.:\"");
                                            aFile.newLine();
                                            aFile.write("A522,213,0,4,1,1,N,\""+EITLERPGLOBAL.round(Qty,2)+"\"");
                                            aFile.newLine();
                                            aFile.write("A676,213,0,a,1,1,N,\""+UnitName+"\"");
                                            aFile.newLine();
                                            aFile.write("A432,256,0,a,1,1,N,\"LOC. :\"");
                                            aFile.newLine();
                                            aFile.write("A522,256,0,4,1,1,N,\""+Location+"\"");
                                            aFile.newLine();
                                            aFile.write("A680,256,0,a,1,1,N,\""+DeptName+"\"");
                                            aFile.newLine();
                                            aFile.write("B450,292,0,1,2,2,41,B,\""+tBarCode+"\"");
                                            aFile.newLine();
                                            aFile.newLine();
                                        }
                                        
                                        
                                        
                                        if(LastCol==1) {
                                            aFile.write("P1");
                                            //aFile.newLine();
                                            //aFile.write(" ");
                                            aFile.newLine();
                                        }
                                        
                                        if(LastCol==1) {
                                            LastCol=2;
                                        }
                                        else {
                                            LastCol=1;
                                        }
                                    }
                                    
                                    
                                    if(BarcodeType.equals("I")) {
                                        //Print Individual Barcode for item.
                                        for(int q=1;q<=Qty;q++) {
                                            
                                            //Print Single Barcode for single Item
                                            if(LastCol==2) {
                                                //Add Escape Sequences
                                                aFile.write("OD");
                                                aFile.newLine();
                                                aFile.write("N");
                                                aFile.newLine();
                                                aFile.write("q816");
                                                aFile.newLine();
                                                aFile.write("Q400,24+0");
                                                aFile.newLine();
                                                aFile.write("S3");
                                                aFile.newLine();
                                                aFile.write("D8");
                                                aFile.newLine();
                                                aFile.write("ZT");
                                                aFile.newLine();
                                            }
                                            
                                            if(LastCol==2) {
                                                aFile.write("A16,27,0,a,1,1,N,\"CODE :\"");
                                                aFile.newLine();
                                                aFile.write("A106,27,0,4,1,1,N,\""+ItemID+"\"");
                                                aFile.newLine();
                                                aFile.write("A16,67,0,a,1,1,N,\"DESC :\"");
                                                aFile.newLine();
                                                aFile.write("A106,67,0,a,1,1,N,\""+ItemLine1+"\"");
                                                aFile.newLine();
                                                aFile.write("A106,97,0,a,1,1,N,\""+ItemLine2+"\"");
                                                aFile.newLine();
                                                aFile.write("A16,136,0,a,1,1,N,\"SUPP  :\"");
                                                aFile.newLine();
                                                aFile.write("A106,136,0,a,1,1,N,\""+SuppName+"\"");
                                                aFile.newLine();
                                                aFile.write("A16,174,0,a,1,1,N,\"MIR   :\"");
                                                aFile.newLine();
                                                aFile.write("A106,174,0,4,1,1,N,\""+MIRNo+"\"");
                                                aFile.newLine();
                                                aFile.write("A264,172,0,a,1,1,N,\""+tMIRDate+"\"");
                                                aFile.newLine();
                                                aFile.write("A16,213,0,a,1,1,N,\"QTY.:\"");
                                                aFile.newLine();
                                                aFile.write("A106,213,0,4,1,1,N,\""+"1"+"\"");
                                                aFile.newLine();
                                                aFile.write("A260,213,0,a,1,1,N,\""+UnitName+"\"");
                                                aFile.newLine();
                                                aFile.write("A16,256,0,a,1,1,N,\"LOC. :\"");
                                                aFile.newLine();
                                                aFile.write("A106,256,0,4,1,1,N,\""+Location+"\"");
                                                aFile.newLine();
                                                aFile.write("A270,256,0,a,1,1,N,\""+DeptName+"\"");
                                                aFile.newLine();
                                                //aFile.write("B55,292,0,1,2,2,41,B,\""+tBarCode+"\"");
                                                //aFile.write("B471,292,0,1,2,2,41,B,\""+tBarCode+"\"");
                                                aFile.write("B25,292,0,1,2,2,41,B,\""+tBarCode+"\"");
                                                
                                                aFile.newLine();
                                                aFile.newLine();
                                            }
                                            
                                            
                                            if(LastCol==1) {
                                                aFile.write("A432,27,0,a,1,1,N,\"CODE :\"");
                                                aFile.newLine();
                                                aFile.write("A522,27,0,4,1,1,N,\""+ItemID+"\"");
                                                aFile.newLine();
                                                aFile.write("A432,67,0,a,1,1,N,\"DESC :\"");
                                                aFile.newLine();
                                                aFile.write("A522,67,0,a,1,1,N,\""+ItemLine1+"\"");
                                                aFile.newLine();
                                                aFile.write("A522,97,0,a,1,1,N,\""+ItemLine2+"\"");
                                                aFile.newLine();
                                                aFile.write("A432,136,0,a,1,1,N,\"SUPP  :\"");
                                                aFile.newLine();
                                                aFile.write("A522,136,0,a,1,1,N,\""+SuppName+"\"");
                                                aFile.newLine();
                                                aFile.write("A432,174,0,a,1,1,N,\"MIR   :\"");
                                                aFile.newLine();
                                                aFile.write("A522,174,0,4,1,1,N,\""+MIRNo+"\"");
                                                aFile.newLine();
                                                aFile.write("A680,172,0,a,1,1,N,\""+tMIRDate+"\"");
                                                aFile.newLine();
                                                aFile.write("A432,213,0,a,1,1,N,\"QTY.:\"");
                                                aFile.newLine();
                                                aFile.write("A522,213,0,4,1,1,N,\""+"1"+"\"");
                                                aFile.newLine();
                                                aFile.write("A676,213,0,a,1,1,N,\""+UnitName+"\"");
                                                aFile.newLine();
                                                aFile.write("A432,256,0,a,1,1,N,\"LOC. :\"");
                                                aFile.newLine();
                                                aFile.write("A522,256,0,4,1,1,N,\""+Location+"\"");
                                                aFile.newLine();
                                                aFile.write("A680,256,0,a,1,1,N,\""+DeptName+"\"");
                                                aFile.newLine();
                                                aFile.write("B450,292,0,1,2,2,41,B,\""+tBarCode+"\"");
                                                aFile.newLine();
                                                aFile.newLine();
                                            }
                                            
                                            if(LastCol==1) {
                                                aFile.write("P1");
                                                //aFile.newLine();
                                                //aFile.write(" ");
                                                aFile.newLine();
                                            }
                                            
                                            if(LastCol==1) {
                                                LastCol=2;
                                            }
                                            else {
                                                LastCol=1;
                                            }
                                            
                                        }
                                    }
                                }
                            }
                            rsTmp.next();
                        }
                        
                        aFile.close();
                        lblStatus.setText("File has been created. Starting Print");
                        
                        EITLPrint.PrintTextFile("inbarcode.rpt");
                        
                        lblStatus.setText("Sent to Printer");
                        
                        lblStatus.setText("Ready");
                        
                        //Now Update the Status
                        rsTmp.first();
                        
                        while(!rsTmp.isAfterLast()) {
                            String MIRNo=rsTmp.getString("MIR_NO");
                            int MIRSrNo=rsTmp.getInt("SR_NO");
                            int Type=rsTmp.getInt("MIR_TYPE");
                            
                            data.Execute("UPDATE D_INV_MIR_DETAIL SET PRINTED=1,CHANGED=1,CHANGED_DATE=CURDATE() WHERE COMPANY_ID="+EITLERPGLOBAL.gCompanyID+" AND MIR_NO='"+MIRNo+"' AND MIR_TYPE="+Type+" AND SR_NO="+MIRSrNo);
                            rsTmp.next();
                        }
                        
                        
                    }
                    else {
                        JOptionPane.showMessageDialog(null,"No Pending Records found");
                    }
                    
                    
                    
                }
                catch(Exception e) {
                    lblStatus.setText(e.getMessage());
                }
            };
        }.start();
    }
    
    
    
    private void PrintStockBarcode() {
        Connection tmpConn;
        Statement stTmp,stItem,stGRN;
        ResultSet rsTmp,rsItem,rsGRN;
        String strSQL="",ItemID="",Location="",StockDate="";
        double StockQty=0,InQty=0,StockValue=0;
        
        BufferedWriter aFile;
        
        int LastCol=2;
        
        
        lblStatus.setText("Creating File.");
        
        
        if(!EITLERPGLOBAL.IsNumber(txtValue.getText())) {
            JOptionPane.showMessageDialog(null,"Please enter any number in value");
            return;
        }
        
        
        try {
            aFile=new BufferedWriter(new FileWriter(new File("inbarcode.rpt")));
        }
        catch(Exception e) {
            JOptionPane.showMessageDialog(null,"Error creating file. Error is "+e.getMessage());
            return;
        }
        
        try {
            tmpConn=data.getConn();
            stTmp=tmpConn.createStatement();
            
            int MIRType=1;
            
            //Full Range
            if(!txtFromItemID.getText().trim().equals("")&&!txtToItemID.getText().trim().equals("")) {
                strSQL="SELECT * FROM D_INV_ITEM_MASTER WHERE ITEM_ID>='"+txtFromItemID.getText().trim()+"' AND ITEM_ID<='"+txtToItemID.getText().trim()+"' AND CANCELLED=0";
            }
            
            //Only From
            if(!txtFromItemID.getText().trim().equals("")&&txtToItemID.getText().trim().equals("")) {
                strSQL="SELECT * FROM D_INV_ITEM_MASTER WHERE ITEM_ID>='"+txtFromItemID.getText().trim()+"' AND CANCELLED=0";
            }
            
            //Only To
            if(txtFromItemID.getText().trim().equals("")&&(!txtToItemID.getText().trim().equals(""))) {
                strSQL="SELECT * FROM D_INV_ITEM_MASTER WHERE ITEM_ID<='"+txtToItemID.getText().trim()+"' AND CANCELLED=0";
            }
            
            //All
            if(txtFromItemID.getText().trim().equals("")&&txtToItemID.getText().trim().equals("")) {
                strSQL="SELECT * FROM D_INV_ITEM_MASTER WHERE CANCELLED=0";
            }
            
            
            //            if(Double.parseDouble(txtQty.getText())>0)
            //            {
            //              strSQL+=" AND ON_HAND_QTY>="+txtQty.getText()+" ";
            //            }
            //
            //
            //            if(Double.parseDouble(txtValue.getText())>0)
            //            {
            //              strSQL+=" AND ITEM_ID IN (SELECT ITEM_ID FROM D_INV_ITEM_MASTER WHERE CLOSING_VALUE>="+txtValue.getText()+") ";
            //            }
            
            //            if(chkMoving.isSelected())
            //            {
            //              strSQL+=" AND ITEM_ID IN (SELECT DISTINCT(ITEM_ID) ITEM_ID FROM D_INV_GRN_HEADER A,D_INV_GRN_DETAIL B WHERE A.GRN_NO=B.GRN_NO AND A.GRN_TYPE=B.GRN_TYPE AND A.APPROVED=1 AND A.CANCELLED=0 AND A.GRN_DATE>='"+EITLERPGLOBAL.FinFromDateDB+"' AND A.GRN_DATE<='"+EITLERPGLOBAL.FinToDateDB+"' UNION SELECT DISTINCT(ITEM_CODE) AS ITEM_ID FROM D_INV_ISSUE_HEADER A,D_INV_ISSUE_DETAIL B WHERE A.ISSUE_NO=B.ISSUE_NO AND A.APPROVED=1 AND A.CANCELED=0 AND A.ISSUE_DATE>='"+EITLERPGLOBAL.FinFromDateDB+"' AND A.ISSUE_DATE<='"+EITLERPGLOBAL.FinToDateDB+"')";
            //            }
            
            
            boolean Continue=true;
            StockDate=EITLERPGLOBAL.formatDateDB(txtDate.getText());
            stItem=tmpConn.createStatement();
            rsItem=stItem.executeQuery(strSQL);
            rsItem.first();
            
            if(rsItem.getRow()>0) {
                while(!rsItem.isAfterLast()) {
                    ItemID=rsItem.getString("ITEM_ID");
                    
                    if(ItemID.equals("40401007"))
                    {
                       int halt=0; 
                    }
                    
                    Location=clsItem.getItemLocationID(EITLERPGLOBAL.gCompanyID,ItemID);
                    
                    clsStockInfo objStock=(new clsItemStock()).getOnHandQtyOn(EITLERPGLOBAL.gCompanyID,ItemID,StockDate);
                    StockQty=objStock.StockQty;
                    StockValue=(new clsItemStock()).getOnHandValueOn(EITLERPGLOBAL.gCompanyID,ItemID,StockDate);
                    
                    Continue=true;
                    
                    if(Double.parseDouble(txtValue.getText())!=0) {
                        if(StockValue>=Double.parseDouble(txtValue.getText())) {
                            
                        }
                        else {
                            Continue=false;
                        }
                    }
                    
                    if(Double.parseDouble(txtQty.getText())!=0) {
                        if(StockQty>=Double.parseDouble(txtQty.getText())) {
                            
                        }
                        else {
                            Continue=false;
                        }
                    }
                    
                    
                    
                    if(Continue) {
                        
                        
                        
                        //Find out the last Approved GRN of this item
                        stGRN=tmpConn.createStatement();
                        rsGRN=stGRN.executeQuery("SELECT D_INV_GRN_HEADER.GRN_NO,D_INV_GRN_DETAIL.SR_NO GRN_SR_NO,GRN_DATE,DEPT_ID,ITEM_ID,QTY,SUPP_ID,FOR_STORE,MIR_NO,MIR_SR_NO FROM D_INV_GRN_HEADER,D_INV_GRN_DETAIL WHERE D_INV_GRN_HEADER.COMPANY_ID=D_INV_GRN_DETAIL.COMPANY_ID AND D_INV_GRN_HEADER.GRN_NO=D_INV_GRN_DETAIL.GRN_NO AND D_INV_GRN_HEADER.GRN_TYPE=D_INV_GRN_DETAIL.GRN_TYPE AND D_INV_GRN_HEADER.COMPANY_ID="+EITLERPGLOBAL.gCompanyID+" AND D_INV_GRN_DETAIL.ITEM_ID='"+ItemID+"' ORDER BY GRN_DATE DESC ");
                        rsGRN.first();
                        
                        if(rsGRN.getRow()>0) {
                            InQty=0;
                            while(InQty<StockQty&&(!rsGRN.isAfterLast())) {
                                InQty+=rsGRN.getDouble("QTY");
                                
                                //======= Barcode Printing Code ========//
                                String MIRNo=rsGRN.getString("MIR_NO");
                                int MIRSrNo=rsGRN.getInt("MIR_SR_NO");
                                String GRNNo=rsGRN.getString("GRN_NO");
                                int GRNSrNo=rsGRN.getInt("GRN_SR_NO");
                                
                                int Type=1;
                                int DeptID=rsGRN.getInt("DEPT_ID");
                                
                                String ItemName=clsItem.getItemName(EITLERPGLOBAL.gCompanyID,ItemID).trim().replaceAll("\""," ");
                                
                                String ItemLine1="";
                                String ItemLine2="";
                                
                                if(ItemName.length()>18) {
                                    ItemLine1=ItemName.substring(0,18);
                                    if(ItemName.length()>36) {
                                        ItemLine2=ItemName.substring(19,36);
                                    }
                                    else {
                                        ItemLine2=ItemName.substring(19);
                                    }
                                }
                                else {
                                    ItemLine1=ItemName.trim();
                                    ItemLine2="";
                                }
                                
                                
                                String DeptName=clsDepartment.getDeptName(EITLERPGLOBAL.gCompanyID, DeptID);
                                
                                String tMIRNo=EITLERPGLOBAL.Replicate(" ", 7-MIRNo.trim().length())+MIRNo.trim();
                                String tMIRSrNo=EITLERPGLOBAL.Replicate(" ", 3-Integer.toString(MIRSrNo).trim().length())+ Integer.toString(MIRSrNo).trim();
                                String tType=Integer.toString(Type);
                                String tMIRDate=EITLERPGLOBAL.formatDate(rsGRN.getString("GRN_DATE"));
                                //String tBarCode=ItemID+tMIRNo+tMIRSrNo;
                                String tBarCode=ItemID.substring(0,8)+tMIRNo.substring(0,7);
                                
                                //double Qty=rsGRN.getDouble("QTY");
                                

                                objStock=(new clsItemStock()).getOnHandQtyOn(EITLERPGLOBAL.gCompanyID,ItemID,EITLERPGLOBAL.formatDateDB(txtDate.getText()));
                                double Qty=objStock.StockQty;
                                InQty=Qty;
                                int UnitID=clsItem.getItemUnit(EITLERPGLOBAL.gCompanyID,ItemID);
                                String UnitName=clsParameter.getParaDescription(EITLERPGLOBAL.gCompanyID,"UNIT",UnitID);
                                String SuppCode=rsGRN.getString("SUPP_ID");
                                String SuppName=clsSupplier.getSupplierName(EITLERPGLOBAL.gCompanyID,SuppCode).trim();
                                
                                
                                if(SuppName.length()>18) {
                                    SuppName=SuppName.substring(0,18);
                                }
                                
                                
                                //Print Single Barcode for single Item
                                if(LastCol==2) {
                                    //Add Escape Sequences
                                    aFile.write("OD");
                                    aFile.newLine();
                                    aFile.write("N");
                                    aFile.newLine();
                                    aFile.write("q816");
                                    aFile.newLine();
                                    aFile.write("Q400,24+0");
                                    aFile.newLine();
                                    aFile.write("S3");
                                    aFile.newLine();
                                    aFile.write("D8");
                                    aFile.newLine();
                                    aFile.write("ZT");
                                    aFile.newLine();
                                }
                                
                                if(LastCol==2) {
                                    aFile.write("A16,27,0,a,1,1,N,\"CODE :\"");
                                    aFile.newLine();
                                    aFile.write("A106,27,0,4,1,1,N,\""+ItemID+"\"");
                                    aFile.newLine();
                                    aFile.write("A16,67,0,a,1,1,N,\"DESC :\"");
                                    aFile.newLine();
                                    aFile.write("A106,67,0,a,1,1,N,\""+ItemLine1+"\"");
                                    aFile.newLine();
                                    aFile.write("A106,97,0,a,1,1,N,\""+ItemLine2+"\"");
                                    aFile.newLine();
                                    aFile.write("A16,136,0,a,1,1,N,\"SUPP  :\"");
                                    aFile.newLine();
                                    aFile.write("A106,136,0,a,1,1,N,\""+SuppName+"\"");
                                    aFile.newLine();
                                    aFile.write("A16,174,0,a,1,1,N,\"MIR   :\"");
                                    aFile.newLine();
                                    aFile.write("A106,174,0,4,1,1,N,\""+MIRNo+"\"");
                                    aFile.newLine();
                                    aFile.write("A264,172,0,a,1,1,N,\""+tMIRDate+"\"");
                                    aFile.newLine();
                                    aFile.write("A16,213,0,a,1,1,N,\"QTY.:\"");
                                    aFile.newLine();
                                    aFile.write("A106,213,0,4,1,1,N,\""+EITLERPGLOBAL.round(Qty,2)+"\"");
                                    aFile.newLine();
                                    aFile.write("A260,213,0,a,1,1,N,\""+UnitName+"\"");
                                    aFile.newLine();
                                    aFile.write("A16,256,0,a,1,1,N,\"LOC. :\"");
                                    aFile.newLine();
                                    aFile.write("A106,256,0,4,1,1,N,\""+Location+"\"");
                                    aFile.newLine();
                                    aFile.write("A270,256,0,a,1,1,N,\""+DeptName+"\"");
                                    aFile.newLine();
                                    
                                    //aFile.write("B55,292,0,1,2,2,41,B,\""+tBarCode+"\"");
                                    aFile.write("B25,292,0,1,2,2,41,B,\""+tBarCode+"\"");
                                    //?'B471,292,0,1,2,2,41,B,'+'"&mbar1"'
                                    aFile.newLine();
                                    aFile.newLine();
                                }
                                
                                if(LastCol==1) {
                                    aFile.write("A432,27,0,a,1,1,N,\"CODE :\"");
                                    aFile.newLine();
                                    aFile.write("A522,27,0,4,1,1,N,\""+ItemID+"\"");
                                    aFile.newLine();
                                    aFile.write("A432,67,0,a,1,1,N,\"DESC :\"");
                                    aFile.newLine();
                                    aFile.write("A522,67,0,a,1,1,N,\""+ItemLine1+"\"");
                                    aFile.newLine();
                                    aFile.write("A522,97,0,a,1,1,N,\""+ItemLine2+"\"");
                                    aFile.newLine();
                                    aFile.write("A432,136,0,a,1,1,N,\"SUPP  :\"");
                                    aFile.newLine();
                                    aFile.write("A522,136,0,a,1,1,N,\""+SuppName+"\"");
                                    aFile.newLine();
                                    aFile.write("A432,174,0,a,1,1,N,\"MIR   :\"");
                                    aFile.newLine();
                                    aFile.write("A522,174,0,4,1,1,N,\""+MIRNo+"\"");
                                    aFile.newLine();
                                    aFile.write("A680,172,0,a,1,1,N,\""+tMIRDate+"\"");
                                    aFile.newLine();
                                    aFile.write("A432,213,0,a,1,1,N,\"QTY.:\"");
                                    aFile.newLine();
                                    aFile.write("A522,213,0,4,1,1,N,\""+EITLERPGLOBAL.round(Qty,2)+"\"");
                                    aFile.newLine();
                                    aFile.write("A676,213,0,a,1,1,N,\""+UnitName+"\"");
                                    aFile.newLine();
                                    aFile.write("A432,256,0,a,1,1,N,\"LOC. :\"");
                                    aFile.newLine();
                                    aFile.write("A522,256,0,4,1,1,N,\""+Location+"\"");
                                    aFile.newLine();
                                    aFile.write("A680,256,0,a,1,1,N,\""+DeptName+"\"");
                                    aFile.newLine();
                                    aFile.write("B450,292,0,1,2,2,41,B,\""+tBarCode+"\"");
                                    aFile.newLine();
                                    aFile.newLine();
                                }
                                
                                
                                
                                if(LastCol==1) {
                                    aFile.write("P1");
                                    //aFile.newLine();
                                    //aFile.write(" ");
                                    aFile.newLine();
                                }
                                
                                if(LastCol==1) {
                                    LastCol=2;
                                }
                                else {
                                    LastCol=1;
                                }
                                //=====================================//
                                rsGRN.next();
                            }
                        }
                    }
                    
                    rsItem.next();
                }
                
                
                //Print the Barcode
                aFile.close();
                lblStatus.setText("File has been created");
                
                lblStatus.setText("Sent to Printer");
                
                EITLPrint.PrintTextFile("inbarcode.rpt");
                
                lblStatus.setText("Ready");
                
            }
            
            
            
            
        }
        catch(Exception e) {
            lblStatus.setText(e.getMessage());
        }
        
    }
    
    
}
