/*
 * frmRptInvoiceNotFound.java
 *
 * Created on February 4, 2010, 5:29 PM
 */

package EITLERP.Stores;
import EITLERP.*;
import EITLERP.Utils.*;
import java.sql.*;
import TReportWriter.*;
import javax.swing.*;
import EITLERP.Finance.*;
import java.util.*;
import EITLERP.Utils.SimpleDataProvider.*;
/**
 *
 * @author  Prathmesh Shah
 */
public class frmRptInvoiceNotFound extends javax.swing.JApplet {
    
    private TReportEngine objEngine=new TReportEngine();
    // private TReportWriter.SimpleDataProvider.TTable objData=new TReportWriter.SimpleDataProvider.TTable();
    
    /** Initializes the applet frmRptInvoiceNotFound */
    public void init() {
        setSize(300,165);
        initComponents();
        
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        txtFromDate = new javax.swing.JTextField();
        txtToDate = new javax.swing.JTextField();
        cmbOK = new javax.swing.JButton();
        jPanel1 = new javax.swing.JPanel();
        jLabel3 = new javax.swing.JLabel();

        getContentPane().setLayout(null);

        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel1.setText("MIR From Date :");
        getContentPane().add(jLabel1);
        jLabel1.setBounds(10, 40, 110, 15);

        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel2.setText("MIR Upto Date :");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(10, 60, 110, 15);

        getContentPane().add(txtFromDate);
        txtFromDate.setBounds(130, 40, 120, 19);

        getContentPane().add(txtToDate);
        txtToDate.setBounds(130, 60, 120, 19);

        cmbOK.setText("OK");
        cmbOK.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmbOKActionPerformed(evt);
            }
        });

        getContentPane().add(cmbOK);
        cmbOK.setBounds(110, 100, 70, 25);

        jPanel1.setLayout(null);

        jPanel1.setBackground(new java.awt.Color(51, 102, 255));
        jPanel1.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        jPanel1.setForeground(new java.awt.Color(255, 255, 255));
        jPanel1.setFont(new java.awt.Font("Dialog", 1, 12));
        jPanel1.setName("Invoice Not Found");
        jLabel3.setForeground(new java.awt.Color(255, 255, 255));
        jLabel3.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel3.setText(" Invoice No. Not Found...");
        jPanel1.add(jLabel3);
        jLabel3.setBounds(0, 0, 290, 20);

        getContentPane().add(jPanel1);
        jPanel1.setBounds(5, 5, 280, 20);

    }//GEN-END:initComponents
    
    private void cmbOKActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmbOKActionPerformed
        // TODO add your handling code here:
        try{
            String MirNo, MirDate, SupplierCode, SupplierName,InvoiceNo, InvoiceDate;
            
            TReportWriter.SimpleDataProvider.TRow objRow;
            TReportWriter.SimpleDataProvider.TTable objReportData=new TReportWriter.SimpleDataProvider.TTable();
            
            objReportData.AddColumn("MIR_NO");
            objReportData.AddColumn("MIR_DATE");
            objReportData.AddColumn("PARTY_CODE");
            objReportData.AddColumn("PARTY_NAME");
            objReportData.AddColumn("INVOICE_NO");
            objReportData.AddColumn("INVOICE_DATE");

            
            TReportWriter.SimpleDataProvider.TRow objOpeningRow=objReportData.newRow();
            
            objOpeningRow.setValue("MIR_NO","");
            objOpeningRow.setValue("MIR_DATE","0000-00-00");
            objOpeningRow.setValue("PARTY_CODE","");
            objOpeningRow.setValue("PARTY_NAME","");
            objOpeningRow.setValue("INVOICE_NO","");
            objOpeningRow.setValue("INVOICE_DATE","0000-00-00");

            
            String Qry, GrnNo;
            
            ResultSet rsTmp=null, rsTmp1=null;
            
            Qry = "SELECT MIR_NO, MIR_DATE, A.SUPP_ID, B.SUPP_NAME, A.INVOICE_NO, A.INVOICE_DATE FROM D_INV_MIR_HEADER A, D_COM_SUPP_MASTER B WHERE A.SUPP_ID = B.SUPPLIER_CODE AND A.CANCELLED= 0 " +
            "AND (INVOICE_NO=0 OR INVOICE_NO='' OR INVOICE_NO IS NULL OR INVOICE_NO = '-') " +
            "AND MIR_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' " +
            "AND MIR_DATE<='"+ EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ";
            //System.out.println(Qry);
            rsTmp = data.getResult(Qry, EITLERPGLOBAL.DatabaseURL);
            rsTmp.first();
            
            if (rsTmp.getRow()>0) {
                while (!rsTmp.isAfterLast()){
                    try{
                        MirNo= rsTmp.getString("MIR_NO");
                        MirDate= EITLERPGLOBAL.formatDate(rsTmp.getString("MIR_DATE"));
                        
                        SupplierCode = rsTmp.getString("SUPP_ID");
                        SupplierName = rsTmp.getString("SUPP_NAME");
                        InvoiceNo = rsTmp.getString("INVOICE_NO");
                        InvoiceDate = EITLERPGLOBAL.formatDate(rsTmp.getString("INVOICE_DATE"));
                        Qry="SELECT COUNT(*) AS NOS_REC FROM  D_INV_GRN_HEADER A , D_INV_GRN_DETAIL B WHERE A.GRN_NO =B.GRN_NO AND A.CANCELLED=0 "+
                        "AND B.MIR_NO='"+MirNo+"'" ;

                        ResultSet rsTmp2 = data.getResult(Qry, EITLERPGLOBAL.DatabaseURL);
                        rsTmp2.first();
                        if(rsTmp2.getInt("NOS_REC") <= 0) {
                            //System.out.println(MirNo+" "+MirDate);
                            objRow=objReportData.newRow();
                            objRow.setValue("MIR_NO", MirNo);
                            objRow.setValue("MIR_DATE", MirDate);
                            objRow.setValue("PARTY_CODE", SupplierCode);
                            objRow.setValue("PARTY_NAME", SupplierName);
                            objRow.setValue("INVOICE_NO", InvoiceNo);
                            objRow.setValue("INVOICE_DATE", InvoiceDate);
                            objReportData.AddRow(objRow);
                        }
                        
                        
                        rsTmp.next();
                    }
                    catch(Exception e) {
                        e.printStackTrace();
                    }
                }
                
            }
            HashMap Parameters = new HashMap();
            Parameters.put("FROM_DATE", txtFromDate.getText());
            Parameters.put("TO_DATE", txtToDate.getText());
            Parameters.put("SYS_DATE", EITLERPGLOBAL.getCurrentDate());
            
            objEngine.PreviewReport("http://"+EITLERPGLOBAL.HostIP+"/EITLERP/Reports/rptInvoiceNotFound.rpt",Parameters,objReportData);
        }
        catch(Exception e){
            e.printStackTrace();
        }
        //System.out.println("End of program..");
    }//GEN-LAST:event_cmbOKActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton cmbOK;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JTextField txtFromDate;
    private javax.swing.JTextField txtToDate;
    // End of variables declaration//GEN-END:variables
    
}
