/*
 * frmGRNFind.java
 *
 * Created on May 15, 2004, 1:35 PM
 */

package EITLERP.Finance;

/**
 *
 * @author  nrpithva
 */

/*<APPLET CODE=frmGRNFind.class HEIGHT=405 WIDTH=565></APPLET>*/

import javax.swing.*;
import java.awt.*;
import java.util.*;
import java.sql.*;
import EITLERP.*;
import EITLERP.Finance.*;


public class frmDeleteInvoiceSJ extends javax.swing.JApplet {
    
    
    public String LastError="";
    private ResultSet rsInvoice = null;
    
    private Connection Conn;
    private Statement Stmt;
    
    
    /** Initializes the applet frmGRNFind */
    public void init() {
        System.gc();
        setSize(565,300);
        initComponents();
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jLabel1 = new javax.swing.JLabel();
        cmdDelete = new javax.swing.JButton();
        cmdClear = new javax.swing.JButton();
        jPanel1 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        txtFromDate = new javax.swing.JTextField();
        jLabel14 = new javax.swing.JLabel();
        txtToDate = new javax.swing.JTextField();

        getContentPane().setLayout(null);

        jLabel1.setFont(new java.awt.Font("Arial", 1, 12));
        jLabel1.setText("Delete Invoice Detail");
        getContentPane().add(jLabel1);
        jLabel1.setBounds(6, 12, 310, 15);

        cmdDelete.setText("Delete");
        cmdDelete.setBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED));
        cmdDelete.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdDeleteActionPerformed(evt);
            }
        });

        getContentPane().add(cmdDelete);
        cmdDelete.setBounds(480, 70, 70, 25);

        cmdClear.setText("Clear");
        cmdClear.setBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED));
        cmdClear.setNextFocusableComponent(txtFromDate);
        cmdClear.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdClearActionPerformed(evt);
            }
        });

        getContentPane().add(cmdClear);
        cmdClear.setBounds(482, 110, 70, 25);

        jPanel1.setLayout(null);

        jPanel1.setBorder(new javax.swing.border.EtchedBorder(javax.swing.border.EtchedBorder.RAISED));
        jLabel2.setDisplayedMnemonic('G');
        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel2.setLabelFor(txtFromDate);
        jLabel2.setText("From Date");
        jPanel1.add(jLabel2);
        jLabel2.setBounds(30, 40, 110, 15);

        jPanel1.add(txtFromDate);
        txtFromDate.setBounds(150, 40, 132, 19);

        jLabel14.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel14.setText("To Date");
        jPanel1.add(jLabel14);
        jLabel14.setBounds(0, 90, 140, 15);

        jPanel1.add(txtToDate);
        txtToDate.setBounds(150, 90, 132, 19);

        getContentPane().add(jPanel1);
        jPanel1.setBounds(6, 39, 458, 160);

    }//GEN-END:initComponents
    
    private void cmdClearActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdClearActionPerformed
        // TODO add your handling code here:
        txtToDate.setText("");
        txtFromDate.setText("");
    }//GEN-LAST:event_cmdClearActionPerformed
    
    private void cmdDeleteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdDeleteActionPerformed
        // TODO add your handling code here:
        
        String Query="",ToDate = "",FromDate="";
        String dbURL = "",dbFinURL = "";
        dbURL = "jdbc:mysql://200.0.0.22799:3306/DINESHMILLS";
        dbFinURL = "jdbc:mysql://200.0.0.22799:3306/FINANCE";
        ToDate = EITLERPGLOBAL.formatDateDB(txtToDate.getText().trim());
        FromDate = EITLERPGLOBAL.formatDateDB(txtFromDate.getText().trim());
        /*Query="SELECT * FROM D_SAL_INVOICE_HEADER " +
        "WHERE INVOICE_DATE>='"+ FromDate +"' AND INVOICE_DATE<='"+ ToDate +"' " +
        "AND PAYMENT_TERM_CODE LIKE '9%' AND INVOICE_TYPE=3 ";*/
        /*Query="SELECT * FROM D_SAL_INVOICE_HEADER WHERE " +
        "INVOICE_NO IN ('002980') " + //'002779','002780','002781','002782',
        "AND INVOICE_DATE='2011-06-18' ORDER BY INVOICE_NO,INVOICE_DATE";*/
        /*Query="SELECT INVOICE_NO,INVOICE_DATE,PARTY_CODE,NET_AMOUNT FROM DINESHMILLS.D_SAL_INVOICE_HEADER " +
        "WHERE INVOICE_TYPE=1 AND APPROVED=1 AND CANCELLED=0 AND INVOICE_NO>='014751' " +
        "AND INVOICE_NO<='014803' AND INVOICE_DATE='2012-03-15' ORDER BY INVOICE_NO ";*/
        
        Query="SELECT INVOICE_NO,INVOICE_DATE,PARTY_CODE,NET_AMOUNT FROM DINESHMILLS.D_SAL_INVOICE_HEADER WHERE INVOICE_DATE>='2012-04-01' AND INVOICE_DATE<='2013-03-31' " +
        "AND INVOICE_TYPE=3 AND INVOICE_NO IN ('000171','B000172','B000173','B000174','B000175','B000176') ";
        
        rsInvoice = data.getResult(Query,dbURL);
        
        try {
            rsInvoice.first();
            if (rsInvoice.getRow() > 0) {
                int cnt = 0;
                String InvoiceNo = "";
                String InvoiceDate = "";
                while (! rsInvoice.isAfterLast()) {
                    cnt = cnt + 1;
                    InvoiceNo = rsInvoice.getString("INVOICE_NO");
                    InvoiceDate = rsInvoice.getString("INVOICE_DATE");
                    System.out.print("Count=" + cnt + "  Invoice No =" + InvoiceNo+ "  Invoice date =" + InvoiceDate);
                    
                    String VoucherNo="";
                    Query="SELECT VOUCHER_NO FROM D_FIN_VOUCHER_DETAIL " +
                    "WHERE INVOICE_NO='"+InvoiceNo+"' AND INVOICE_DATE='"+InvoiceDate+"' " +
                    "AND VOUCHER_NO LIKE 'SJ%' ";
                    VoucherNo = data.getStringValueFromDB(Query,dbFinURL);
                    System.out.println(" Voucher No = " + VoucherNo);
                    
                    Query = "DELETE FROM D_SAL_INVOICE_HEADER WHERE INVOICE_NO='" + InvoiceNo + "' AND INVOICE_DATE='"+InvoiceDate+"' ";
                    data.Execute(Query,dbURL);
                    
                    Query = "DELETE FROM D_SAL_INVOICE_DETAIL WHERE INVOICE_NO='" + InvoiceNo + "' AND INVOICE_DATE='"+InvoiceDate+"' ";
                    data.Execute(Query,dbURL);
                    
                    Query = "DELETE FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO='" + VoucherNo + "' ";
                    data.Execute(Query,dbFinURL);
                    
                    Query = "DELETE FROM D_FIN_VOUCHER_HEADER_H WHERE VOUCHER_NO='" + VoucherNo + "' ";
                    data.Execute(Query,dbFinURL);
                    
                    Query = "DELETE FROM D_FIN_VOUCHER_DETAIL WHERE VOUCHER_NO='" + VoucherNo + "' ";
                    data.Execute(Query,dbFinURL);
                    
                    Query = "DELETE FROM D_FIN_VOUCHER_DETAIL_H WHERE VOUCHER_NO='" + VoucherNo + "' ";
                    data.Execute(Query,dbFinURL);
                    
                    Query ="DELETE FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='" + VoucherNo + "' ";
                    data.Execute(Query,dbFinURL);
                    
                    Query ="DELETE FROM D_COM_DOC_DATA WHERE DOC_NO='" + VoucherNo + "' ";
                    data.Execute(Query,dbURL);
                    
                    rsInvoice.next();
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_cmdDeleteActionPerformed
    
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton cmdClear;
    private javax.swing.JButton cmdDelete;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JTextField txtFromDate;
    private javax.swing.JTextField txtToDate;
    // End of variables declaration//GEN-END:variables
    
    
    
}
