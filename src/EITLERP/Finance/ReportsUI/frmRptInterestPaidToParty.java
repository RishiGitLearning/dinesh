

package EITLERP.Finance.ReportsUI;


import EITLERP.*;
import EITLERP.Finance.*;
import EITLERP.Utils.*;
import EITLERP.Utils.SimpleDataProvider.*;
import javax.swing.*;
import java.awt.*;
import java.sql.*;
import java.net.*;
import java.util.*;
import java.text.*;
import TReportWriter.*;

public class frmRptInterestPaidToParty extends javax.swing.JApplet {
    
    private EITLComboModel cmbReceiptTypeModel;
    private EITLComboModel cmbReportTypeModel;
    private EITLComboModel cmbMonthModel;
    private TReportEngine objEngine=new TReportEngine();
    private TReportWriter.SimpleDataProvider.TTable objData=new TReportWriter.SimpleDataProvider.TTable();
    
    
    /** Initializes the applet frmRptGRNInfo */
    public void init() {
        setSize(424,264);
        initComponents();
        
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jPanel3 = new javax.swing.JPanel();
        jLabel6 = new javax.swing.JLabel();
        lblToDate = new javax.swing.JLabel();
        txtToDate = new javax.swing.JTextField();
        cmdPreview = new javax.swing.JButton();
        lblFromDate = new javax.swing.JLabel();
        txtFromDate = new javax.swing.JTextField();
        lblInterestMainCode = new javax.swing.JLabel();
        txtInterestMainCode = new javax.swing.JTextField();
        lblPartyCode = new javax.swing.JLabel();
        txtPartyCode = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();

        getContentPane().setLayout(null);

        jPanel3.setLayout(null);

        jPanel3.setBackground(new java.awt.Color(0, 153, 204));
        jPanel3.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        jLabel6.setText("INTEREST PAID TO PARTY");
        jPanel3.add(jLabel6);
        jLabel6.setBounds(9, 8, 350, 15);

        getContentPane().add(jPanel3);
        jPanel3.setBounds(0, 2, 800, 30);

        lblToDate.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblToDate.setText("To Date :");
        getContentPane().add(lblToDate);
        lblToDate.setBounds(220, 43, 60, 15);

        txtToDate.setColumns(10);
        getContentPane().add(txtToDate);
        txtToDate.setBounds(290, 40, 100, 20);

        cmdPreview.setText("Preview Report");
        cmdPreview.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdPreviewActionPerformed(evt);
            }
        });

        getContentPane().add(cmdPreview);
        cmdPreview.setBounds(100, 150, 130, 25);

        lblFromDate.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblFromDate.setText("From Date :");
        getContentPane().add(lblFromDate);
        lblFromDate.setBounds(10, 43, 73, 15);

        txtFromDate.setColumns(10);
        getContentPane().add(txtFromDate);
        txtFromDate.setBounds(90, 40, 100, 20);

        lblInterestMainCode.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblInterestMainCode.setText("Interest Main Code :");
        getContentPane().add(lblInterestMainCode);
        lblInterestMainCode.setBounds(12, 73, 128, 15);

        txtInterestMainCode.setColumns(10);
        getContentPane().add(txtInterestMainCode);
        txtInterestMainCode.setBounds(147, 69, 100, 20);

        lblPartyCode.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblPartyCode.setText("Party Code :");
        getContentPane().add(lblPartyCode);
        lblPartyCode.setBounds(17, 103, 79, 15);

        txtPartyCode.setColumns(10);
        getContentPane().add(txtPartyCode);
        txtPartyCode.setBounds(103, 100, 310, 20);

        jLabel1.setText("Insert PartyCode --> e.g. 123321,321123,112233,332211");
        getContentPane().add(jLabel1);
        jLabel1.setBounds(30, 130, 370, 15);

    }//GEN-END:initComponents
    
    private void cmdPreviewActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdPreviewActionPerformed
        // TODO add your handling code here:
        if ( ! Validate()) {
            return;
        }
        GenerateReport();
    }//GEN-LAST:event_cmdPreviewActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton cmdPreview;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JLabel lblFromDate;
    private javax.swing.JLabel lblInterestMainCode;
    private javax.swing.JLabel lblPartyCode;
    private javax.swing.JLabel lblToDate;
    private javax.swing.JTextField txtFromDate;
    private javax.swing.JTextField txtInterestMainCode;
    private javax.swing.JTextField txtPartyCode;
    private javax.swing.JTextField txtToDate;
    // End of variables declaration//GEN-END:variables
    
    private void GenerateReport() {
        
        
        try {
            String strSQL = "";
            String FromDate = txtFromDate.getText().trim();
            String ToDate = txtToDate.getText().trim();
            String InterestMainCode = txtInterestMainCode.getText().trim();
            String AllPartyCode = txtPartyCode.getText().trim();
            
            TReportWriter.SimpleDataProvider.TRow objRow;
            TReportWriter.SimpleDataProvider.TTable objReportData=new TReportWriter.SimpleDataProvider.TTable();
            objReportData.AddColumn("SR_NO");
            objReportData.AddColumn("PARTY_CODE");
            objReportData.AddColumn("PARTY_NAME");
            objReportData.AddColumn("INTEREST_MAIN_CODE");
            objReportData.AddColumn("GROSS_INTEREST");
            
            TReportWriter.SimpleDataProvider.TRow objOpeningRow=objReportData.newRow();
            objOpeningRow.setValue("SR_NO","");
            objOpeningRow.setValue("PARTY_CODE","");
            objOpeningRow.setValue("PARTY_NAME","");
            objOpeningRow.setValue("INTEREST_MAIN_CODE","");
            objOpeningRow.setValue("GROSS_INTEREST","");
            
            StringTokenizer Token = new StringTokenizer(AllPartyCode,",");
            int Counter=0;
            while(Token.hasMoreTokens()) {
                Counter++;
                String PartyCode = Token.nextToken(",");
                System.out.println(PartyCode);
                objRow=objReportData.newRow();
                String SQL = "SELECT SUM(B.AMOUNT) AS TOTAL FROM D_FIN_VOUCHER_HEADER A, D_FIN_VOUCHER_DETAIL B, D_FIN_VOUCHER_DETAIL C " +
                " WHERE A.VOUCHER_DATE>='"+EITLERPGLOBAL.formatDateDB(FromDate)+"' AND A.VOUCHER_DATE<='"+EITLERPGLOBAL.formatDateDB(ToDate)+"' AND A.VOUCHER_NO=.B.VOUCHER_NO AND A.VOUCHER_NO=C.VOUCHER_NO " +
                " AND B.VOUCHER_NO=C.VOUCHER_NO AND B.EFFECT='D' AND B.MAIN_ACCOUNT_CODE='"+InterestMainCode+"' AND B.SUB_ACCOUNT_CODE='' " +
                " AND C.EFFECT='C' AND C.SUB_ACCOUNT_CODE='"+PartyCode+"' AND C.MAIN_ACCOUNT_CODE<>''";
                double InterestAmount = data.getDoubleValueFromDB(SQL,FinanceGlobal.FinURL);
                SQL = "SELECT PARTY_NAME FROM D_FIN_PARTY_MASTER WHERE PARTY_CODE='"+PartyCode+"' ";
                String PartyName = data.getStringValueFromDB(SQL,FinanceGlobal.FinURL);
                
                objRow.setValue("SR_NO", Integer.toString(Counter));
                objRow.setValue("PARTY_CODE", PartyCode);
                objRow.setValue("PARTY_NAME", PartyName);
                objRow.setValue("INTEREST_MAIN_CODE", InterestMainCode);
                objRow.setValue("GROSS_INTEREST", Double.toString(InterestAmount));
                
                objReportData.AddRow(objRow);
            }
            
            HashMap Parameters=new HashMap();
            Parameters.put("FROM_DATE",FromDate);
            Parameters.put("TO_DATE",ToDate);
            Parameters.put("SYS_DATE",EITLERPGLOBAL.getCurrentDate());
            objEngine.PreviewReport("http://"+EITLERPGLOBAL.HostIP+"/EITLERP/Reports/finance/rptInterestPaidToParty.rpt",Parameters,objReportData);
        }
        catch(Exception e) {
            e.printStackTrace();
        }
    }
    
    private boolean Validate() {
        //Form level validations
        if(txtFromDate.getText().trim().equals("")) {
            JOptionPane.showMessageDialog(null,"Please Enter From Date.");
            return false;
        } else if(!EITLERPGLOBAL.isDate(txtFromDate.getText().trim())) {
            JOptionPane.showMessageDialog(null,"Please Enter valid From Date.");
            return false;
        }
        if(txtToDate.getText().trim().equals("")) {
            JOptionPane.showMessageDialog(null,"Please Enter To Date.");
            return false;
        } else if(!EITLERPGLOBAL.isDate(txtToDate.getText().trim())) {
            JOptionPane.showMessageDialog(null,"Please Enter valid To Date.");
            return false;
        }
        if(txtInterestMainCode.getText().trim().equals("")) {
            JOptionPane.showMessageDialog(null,"Please Enter Main Account Code.");
            return false;
        }
        if(txtPartyCode.getText().trim().equals("")) {
            JOptionPane.showMessageDialog(null,"Please Enter Party Code.");
            return false;
        }
        return true;
    }
}
