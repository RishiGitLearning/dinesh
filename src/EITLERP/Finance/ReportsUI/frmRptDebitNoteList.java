/*
 * frmpartyinfo.java
 *
 * Created on November 28, 2007, 12:12 PM
 */

package EITLERP.Finance.ReportsUI;

import javax.swing.*;
import EITLERP.* ;
import java.sql.*;
import EITLERP.Finance.*;
import java.util.*;
import TReportWriter.*;
import EITLERP.Sales.clsSalesInvoice;
/**
 *
 * @author  root
 */
public class frmRptDebitNoteList extends javax.swing.JApplet {
    
    /** Initializes the applet frmpartyinfo */
    
    private TReportEngine objEngine=new TReportEngine();
    private TReportWriter.SimpleDataProvider.TTable objData=new TReportWriter.SimpleDataProvider.TTable();
    
    //clsAccount ObjAccount = new clsAccount();
    //clsPartyInfo ObjParty ;
    //EITLTableModel TableModelM,TableModelD,TableModelV ;
    static String acname ;
    Object[][] ObjDate;
    
    
    public void init() {
        setSize(400,200);
        initComponents();
        //FormatMonthGrid();
        
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jPanel5 = new javax.swing.JPanel();
        jLabel4 = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        subcodetxt = new javax.swing.JTextField();
        cmdnextparty = new javax.swing.JButton();
        jLabel3 = new javax.swing.JLabel();
        txtFromDate = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        txtToDate = new javax.swing.JTextField();
        txtBookCode = new javax.swing.JTextField();
        lblBookCode = new javax.swing.JLabel();

        getContentPane().setLayout(null);

        addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                formMouseClicked(evt);
            }
        });

        jPanel5.setLayout(null);

        jPanel5.setBackground(new java.awt.Color(0, 153, 204));
        jPanel5.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        jLabel4.setText("DEBIT NOTE LIST");
        jPanel5.add(jLabel4);
        jLabel4.setBounds(9, 8, 280, 15);

        getContentPane().add(jPanel5);
        jPanel5.setBounds(-1, -1, 390, 30);

        jPanel1.setLayout(null);

        jPanel1.setBorder(new javax.swing.border.EtchedBorder());
        subcodetxt.setColumns(15);
        subcodetxt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                subcodetxtActionPerformed(evt);
            }
        });
        subcodetxt.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                subcodetxtFocusLost(evt);
            }
        });
        subcodetxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                subcodetxtKeyPressed(evt);
            }
        });

        jPanel1.add(subcodetxt);
        subcodetxt.setBounds(290, 180, 100, 20);

        cmdnextparty.setText("Show");
        cmdnextparty.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdnextpartyActionPerformed(evt);
            }
        });

        jPanel1.add(cmdnextparty);
        cmdnextparty.setBounds(240, 60, 88, 25);

        jLabel3.setText("From Date :");
        jPanel1.add(jLabel3);
        jLabel3.setBounds(10, 10, 80, 15);

        txtFromDate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtFromDateActionPerformed(evt);
            }
        });

        jPanel1.add(txtFromDate);
        txtFromDate.setBounds(90, 10, 100, 19);

        jLabel5.setText("To Date :");
        jPanel1.add(jLabel5);
        jLabel5.setBounds(200, 10, 60, 15);

        jPanel1.add(txtToDate);
        txtToDate.setBounds(260, 10, 100, 19);

        jPanel1.add(txtBookCode);
        txtBookCode.setBounds(90, 40, 100, 19);

        lblBookCode.setText("Book Code :");
        jPanel1.add(lblBookCode);
        lblBookCode.setBounds(10, 40, 80, 15);

        getContentPane().add(jPanel1);
        jPanel1.setBounds(10, 40, 380, 100);

    }//GEN-END:initComponents
    
    private void cmdnextpartyActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdnextpartyActionPerformed
        if ( ! Validate()) {
            return;
        }
        //GenerateMonthGrid((new clsPartyInfo()).getMonthDetailCenvat(maincodetxt.getText().trim(),subcodetxt.getText().trim(),txtFromDate.getText().trim(),txtToDate.getText().trim(),true));
        GenerateReport();
    }//GEN-LAST:event_cmdnextpartyActionPerformed
    
    private void txtFromDateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtFromDateActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtFromDateActionPerformed
    
    private void subcodetxtActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_subcodetxtActionPerformed
        
    }//GEN-LAST:event_subcodetxtActionPerformed
    
    private void subcodetxtFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_subcodetxtFocusLost
        // TODO add your handling code here:
        
    }//GEN-LAST:event_subcodetxtFocusLost
    
    private void subcodetxtKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_subcodetxtKeyPressed
        // TODO add your handling code here:
        
    }//GEN-LAST:event_subcodetxtKeyPressed
    
    private void formMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseClicked
        
    }//GEN-LAST:event_formMouseClicked
    
    public void GenerateReport(){
        
        try{
            
            
            TReportWriter.SimpleDataProvider.TRow objRow;
            TReportWriter.SimpleDataProvider.TTable objReportData=new TReportWriter.SimpleDataProvider.TTable();
            
            objReportData.AddColumn("SR_NO");
            objReportData.AddColumn("DEBITNOTE_NO");
            objReportData.AddColumn("DEBITNOTE_DATE");
            objReportData.AddColumn("AMOUNT");
            objReportData.AddColumn("LINK");
            //objReportData.AddColumn("CENVAT_UTILISED");
            //objReportData.AddColumn("CLOSING_BALANCE");
            
            
            TReportWriter.SimpleDataProvider.TRow objOpeningRow=objReportData.newRow();
            
            objOpeningRow.setValue("SR_NO","");
            objOpeningRow.setValue("DEBITNOTE_NO","");
            objOpeningRow.setValue("DEBITNOTE_DATE","0000-00-00");
            objOpeningRow.setValue("AMOUNT","");
            objOpeningRow.setValue("LINK","");
            //objOpeningRow.setValue("CENVAT_UTILISED","");
            //objOpeningRow.setValue("CLOSING_BALANCE","");
            if(txtBookCode.getText().trim().equals("")) {
                JOptionPane.showMessageDialog(null,"Enter Book Code...");
                return;
            }
            String Qry="SELECT DISTINCT A.DEBITNOTE_VOUCHER_NO,B.VOUCHER_DATE,A.DEBIT_NOTE_AMOUNT,A.INVOICE_NO,A.INVOICE_DATE,B.LEGACY_NO "+
            "FROM D_FIN_DEBITNOTE_RECEIPT_MAPPING A,D_FIN_VOUCHER_HEADER B,D_FIN_VOUCHER_DETAIL C "+
            "WHERE A.COMPANY_ID = '" + EITLERPGLOBAL.gCompanyID + "' AND A.DEBITNOTE_VOUCHER_NO = B.VOUCHER_NO "+
            "AND B.VOUCHER_NO = C.VOUCHER_NO AND C.EFFECT='D' AND B.BOOK_CODE='"+txtBookCode.getText().trim()+"' "+
            "AND B.VOUCHER_DATE >= '" + EITLERPGLOBAL.formatDateDB(txtFromDate.getText().trim()) + "' AND B.VOUCHER_DATE <= '" + EITLERPGLOBAL.formatDateDB(txtToDate.getText().trim()) + "' "+
            "ORDER BY A.DEBITNOTE_VOUCHER_NO";
            
            ResultSet rsDebit = data.getResult(Qry,FinanceGlobal.FinURL);
            int cnt=1;
            String VoucherNo="";
            if(rsDebit.getRow()>0) {
                VoucherNo = rsDebit.getString("DEBITNOTE_VOUCHER_NO");
                while(!rsDebit.isAfterLast()) {
                    
                    objRow=objReportData.newRow();

                    if(VoucherNo.equals(rsDebit.getString("DEBITNOTE_VOUCHER_NO")))
                    {
                        
                    }
                    else
                    {
                        cnt++;
                    }
                    VoucherNo = rsDebit.getString("DEBITNOTE_VOUCHER_NO");
                    
                    objRow.setValue("SR_NO",String.valueOf(cnt));
                    objRow.setValue("DEBITNOTE_NO",rsDebit.getString("DEBITNOTE_VOUCHER_NO"));
                    objRow.setValue("DEBITNOTE_DATE",EITLERPGLOBAL.formatDate(rsDebit.getString("VOUCHER_DATE")));
                    objRow.setValue("AMOUNT",rsDebit.getString("DEBIT_NOTE_AMOUNT"));
                    objRow.setValue("INVOICE_NO",rsDebit.getString("INVOICE_NO"));
                    objRow.setValue("INVOICE_DATE",EITLERPGLOBAL.formatDate(rsDebit.getString("INVOICE_DATE")));
                    objRow.setValue("LINK",clsSalesInvoice.getAgentAlphaSrNo(rsDebit.getString("INVOICE_NO"),rsDebit.getString("INVOICE_DATE")));
                    objRow.setValue("LEGACY_NO",rsDebit.getString("LEGACY_NO"));
                    objReportData.AddRow(objRow);
                    
                    
                    
                    rsDebit.next();
                }
            }
            
            HashMap Parameters=new HashMap();
            Parameters.put("FROM_DATE",txtFromDate.getText().trim());
            Parameters.put("TO_DATE",txtToDate.getText().trim());
            Parameters.put("SYS_DATE",EITLERPGLOBAL.getCurrentDate());
            objEngine.PreviewReport("http://"+EITLERPGLOBAL.HostIP+"/EITLERP/Reports/finance/rptAccountDebitNoteList.rpt",Parameters,objReportData);
        }catch(Exception e) {
            e.printStackTrace();
        }
    }
    
    
    private boolean Validate() {
        //Form level validations
        
        if(txtFromDate.getText().trim().equals("")) {
            JOptionPane.showMessageDialog(null,"Please Enter from Date");
            return false;
        } else if(!EITLERPGLOBAL.isDate(txtFromDate.getText())) {
            JOptionPane.showMessageDialog(null,"Invalid From Date in DD/MM/YYYY format.");
            return false;
        }
        
        if(txtToDate.getText().trim().equals("")) {
            JOptionPane.showMessageDialog(null,"Please Enter To Date");
            return false;
        } else if(!EITLERPGLOBAL.isDate(txtToDate.getText())) {
            JOptionPane.showMessageDialog(null,"Invalid To Date in DD/MM/YYYY format.");
            return false;
        }
        
        
        return true;
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton cmdnextparty;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JLabel lblBookCode;
    private javax.swing.JTextField subcodetxt;
    private javax.swing.JTextField txtBookCode;
    private javax.swing.JTextField txtFromDate;
    private javax.swing.JTextField txtToDate;
    // End of variables declaration//GEN-END:variables
    
}
