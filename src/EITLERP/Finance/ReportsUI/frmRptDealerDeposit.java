/*
 * frmRptGRNInfo.java
 *
 * Created on April 16, 2008, 12:01 PM
 */

package EITLERP.Finance.ReportsUI;

/**
 *
 * @author  root
 */
import EITLERP.*;
import EITLERP.Finance.*;
import EITLERP.Utils.*;
import EITLERP.Utils.SimpleDataProvider.*;
import javax.swing.*;
import java.awt.*;
import java.sql.*;
import java.net.*;
import java.util.*;
import TReportWriter.*;

public class frmRptDealerDeposit extends javax.swing.JApplet {
    
    
    private TReportEngine objEngine=new TReportEngine();
    private TReportWriter.SimpleDataProvider.TTable objData=new TReportWriter.SimpleDataProvider.TTable();
    
    
    /** Initializes the applet frmRptGRNInfo */
    public void init() {
        setSize(400,210);
        initComponents();
        
        
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        buttonGroup1 = new javax.swing.ButtonGroup();
        jPanel3 = new javax.swing.JPanel();
        lblInfo = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        txtAsOnDate = new javax.swing.JTextField();
        cmdPreview = new javax.swing.JButton();
        jPanel4 = new javax.swing.JPanel();
        jLabel8 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        txtPartyCode = new javax.swing.JTextField();
        lblPartyName = new javax.swing.JLabel();
        lblMainCode = new javax.swing.JLabel();
        txtMainCode = new javax.swing.JTextField();
        lblMainCodeName = new javax.swing.JLabel();

        getContentPane().setLayout(null);

        addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                formMouseClicked(evt);
            }
        });

        jPanel3.setLayout(null);

        jPanel3.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        jPanel3.add(lblInfo);
        lblInfo.setBounds(0, 2, 400, 20);

        getContentPane().add(jPanel3);
        jPanel3.setBounds(0, 180, 400, 30);

        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel2.setText("As On Date:");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(0, 60, 90, 20);

        txtAsOnDate.setColumns(10);
        txtAsOnDate.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtAsOnDateFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtAsOnDateFocusLost(evt);
            }
        });

        getContentPane().add(txtAsOnDate);
        txtAsOnDate.setBounds(100, 60, 90, 19);

        cmdPreview.setText("Preview Report");
        cmdPreview.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdPreviewActionPerformed(evt);
            }
        });

        getContentPane().add(cmdPreview);
        cmdPreview.setBounds(120, 150, 130, 25);

        jPanel4.setLayout(null);

        jPanel4.setBackground(new java.awt.Color(0, 153, 204));
        jPanel4.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        jLabel8.setText("LIVE DEALER DEPOSIT ");
        jPanel4.add(jLabel8);
        jLabel8.setBounds(10, 10, 290, 20);

        getContentPane().add(jPanel4);
        jPanel4.setBounds(0, 0, 400, 40);

        jLabel3.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel3.setText("Party Code:");
        getContentPane().add(jLabel3);
        jLabel3.setBounds(0, 120, 90, 20);

        txtPartyCode.setColumns(10);
        txtPartyCode.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtPartyCodeFocusLost(evt);
            }
        });
        txtPartyCode.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtPartyCodeKeyPressed(evt);
            }
        });

        getContentPane().add(txtPartyCode);
        txtPartyCode.setBounds(100, 120, 90, 19);

        lblPartyName.setText("...");
        getContentPane().add(lblPartyName);
        lblPartyName.setBounds(200, 120, 190, 20);

        lblMainCode.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblMainCode.setText("Main Code:");
        getContentPane().add(lblMainCode);
        lblMainCode.setBounds(0, 90, 90, 20);

        txtMainCode.setColumns(10);
        txtMainCode.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtMainCodeFocusLost(evt);
            }
        });

        getContentPane().add(txtMainCode);
        txtMainCode.setBounds(100, 90, 90, 19);

        lblMainCodeName.setText("...");
        getContentPane().add(lblMainCodeName);
        lblMainCodeName.setBounds(200, 90, 190, 20);

    }//GEN-END:initComponents

    private void txtMainCodeFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtMainCodeFocusLost
        // TODO add your handling code here:
        if(!txtMainCode.getText().trim().equals("")) {
            lblMainCodeName.setText(clsAccount.getAccountName(txtMainCode.getText().trim(), ""));
        }
    }//GEN-LAST:event_txtMainCodeFocusLost
    
    private void txtPartyCodeFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtPartyCodeFocusLost
        // TODO add your handling code here:
        if(!txtPartyCode.getText().trim().equals("")) {
            lblPartyName.setText(clsAccount.getAccountName(txtMainCode.getText().trim(), txtPartyCode.getText().trim()));
        }
    }//GEN-LAST:event_txtPartyCodeFocusLost
    
    private void txtPartyCodeKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtPartyCodeKeyPressed
        // TODO add your handling code here:
        if(evt.getKeyCode()==112) {
            LOV aList=new LOV();
            
            aList.SQL="SELECT PARTY_CODE,APPLICANT_NAME FROM D_FD_SALES_DEPOSIT_MASTER WHERE  APPROVED=1 ORDER BY PARTY_CODE";
            aList.ReturnCol=1;
            aList.ShowReturnCol=true;
            aList.DefaultSearchOn=2;
            aList.UseSpecifiedConn=true;
            aList.dbURL=FinanceGlobal.FinURL;
            
            if(aList.ShowLOV()) {
                txtPartyCode.setText(aList.ReturnVal);
                String Str = "SELECT  APPLICANT_NAME FROM D_FD_SALES_DEPOSIT_MASTER WHERE PARTY_CODE ='" + txtPartyCode.getText() + "' ";
                lblPartyName.setText(data.getStringValueFromDB(Str,FinanceGlobal.FinURL));
            }
            
        }
        
    }//GEN-LAST:event_txtPartyCodeKeyPressed
    
    private void txtAsOnDateFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtAsOnDateFocusLost
        // TODO add your handling code here:
        lblInfo.setText("");
    }//GEN-LAST:event_txtAsOnDateFocusLost
    
    private void txtAsOnDateFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtAsOnDateFocusGained
        // TODO add your handling code here:
        lblInfo.setText("Please Enter the As On Date");
    }//GEN-LAST:event_txtAsOnDateFocusGained
    
    private void formMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_formMouseClicked
    
    private void cmdPreviewActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdPreviewActionPerformed
        // TODO add your handling code here:
        if ( ! Validate()) {
            return;
        }
        
        GenerateReport();
    }//GEN-LAST:event_cmdPreviewActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.JButton cmdPreview;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JLabel lblInfo;
    private javax.swing.JLabel lblMainCode;
    private javax.swing.JLabel lblMainCodeName;
    private javax.swing.JLabel lblPartyName;
    private javax.swing.JTextField txtAsOnDate;
    private javax.swing.JTextField txtMainCode;
    private javax.swing.JTextField txtPartyCode;
    // End of variables declaration//GEN-END:variables
    
    private void GenerateReport() {
        try {
            TReportWriter.SimpleDataProvider.TRow objRow;
            TReportWriter.SimpleDataProvider.TTable objReportData=new TReportWriter.SimpleDataProvider.TTable();
            
            objReportData.AddColumn("SR_NO");
            objReportData.AddColumn("RECEIPT_NO");
            objReportData.AddColumn("RECEIPT_DATE");
            objReportData.AddColumn("PARTY_CODE");
            objReportData.AddColumn("PARTY_NAME");
            objReportData.AddColumn("STATION");
            objReportData.AddColumn("AMOUNT");
            
            TReportWriter.SimpleDataProvider.TRow objOpeningRow=objReportData.newRow();
            objOpeningRow.setValue("SR_NO","");
            objOpeningRow.setValue("RECEIPT_NO","");
            objOpeningRow.setValue("RECEIPT_DATE","0000-00-00");
            objOpeningRow.setValue("PARTY_CODE","");
            objOpeningRow.setValue("PARTY_NAME","");
            objOpeningRow.setValue("STATION","");
            objOpeningRow.setValue("AMOUNT","");
            
            String dbUrl= FinanceGlobal.FinURL;
            String Param="";
            if(!txtPartyCode.getText().trim().equals("")) {
                Param= " AND PARTY_CODE='" + txtPartyCode.getText().trim() + "' ";
            }
            
            String Param1="";
            if(!txtMainCode.getText().trim().equals("")) {
                Param1= " AND MAIN_ACCOUNT_CODE='" + txtMainCode.getText().trim() + "' ";
            }
            String strSQL="SELECT * "+
            "FROM D_FD_SALES_DEPOSIT_MASTER WHERE (REFUND_DATE > '" + EITLERPGLOBAL.formatDateDB(txtAsOnDate.getText().trim()) + "'  " +
            "OR REFUND_DATE = '0000-00-00') AND EFFECTIVE_DATE <= '" + EITLERPGLOBAL.formatDateDB(txtAsOnDate.getText().trim()) + "' AND DEPOSIT_STATUS=0 " +
            "" + Param + Param1 +
            " ORDER BY PARTY_CODE,RECEIPT_DATE ";
            
            ResultSet rsReceipt=data.getResult(strSQL,dbUrl);
            
            rsReceipt.first();
            
            int Counter = 0;
            //ResultSet rsparty=null;
            if(rsReceipt.getRow()>0) {
                while(!rsReceipt.isAfterLast()) {
                    Counter ++;
                    objRow=objReportData.newRow();
                    
                    objRow.setValue("SR_NO",Integer.toString(Counter));
                    objRow.setValue("RECEIPT_NO",UtilFunctions.getString(rsReceipt,"RECEIPT_NO",""));
                    objRow.setValue("RECEIPT_DATE",EITLERPGLOBAL.formatDate(UtilFunctions.getString(rsReceipt,"RECEIPT_DATE","0000-00-00")));
                    objRow.setValue("PARTY_CODE",UtilFunctions.getString(rsReceipt,"PARTY_CODE",""));
                    objRow.setValue("PARTY_NAME",UtilFunctions.getString(rsReceipt,"APPLICANT_NAME",""));
                    
                    //strSQL="SELECT PARTY_NAME,CITY "+
                    //"FROM D_FIN_PARTY_MASTER WHERE PARTY_CODE ='" + UtilFunctions.getString(rsReceipt,"PARTY_CODE","") + "'  ";
                    //rsparty = data.getResult(strSQL,dbUrl);
                    
                    objRow.setValue("STATION",UtilFunctions.getString(rsReceipt,"CITY",""));
                    
                    
                    objRow.setValue("AMOUNT",UtilFunctions.getString(rsReceipt,"AMOUNT",""));
                    objReportData.AddRow(objRow);
                    rsReceipt.next();
                    
                }
            }
            
            int Comp_ID = EITLERPGLOBAL.gCompanyID;
            HashMap Parameters=new HashMap();
            String sys_Date = EITLERPGLOBAL.getCurrentDate();
            Parameters.put("AS_ON_DATE",txtAsOnDate.getText().trim());
            Parameters.put("SYS_DATE",sys_Date);
            
            
            objEngine.PreviewReport("http://"+EITLERPGLOBAL.HostIP+"/EITLERP/Reports/finance/rptDealerDeposit.rpt",Parameters,objReportData);
            
            
        }
        catch(Exception e) {
            e.printStackTrace();
        }
    }
    
    private boolean Validate() {
        //Form level validations
        
        if(txtAsOnDate.getText().trim().equals("")) {
            JOptionPane.showMessageDialog(null,"Please Enter Date");
            return false;
        } else if(!EITLERPGLOBAL.isDate(txtAsOnDate.getText())) {
            JOptionPane.showMessageDialog(null,"Invalid From Date in DD/MM/YYYY format.");
            return false;
        }
        return true;
    }
    
}
