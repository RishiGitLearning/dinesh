/*
 * frmPaymentDetails.java
 *
 * Created on August 17, 2007, 3:58 PM
 */

package EITLERP.Finance.ReportsUI;

/**
 *
 * @author  root
 */
import javax.swing.*;
import java.awt.*;
import EITLERP.*;
import java.util.*;
import javax.swing.table.*;
import javax.swing.event.*;
import javax.swing.text.*;
import java.awt.event.*;
import java.net.*;
import EITLERP.Utils.*;
import java.io.*;
import EITLERP.Purchase.*;
import EITLERP.Stores.*;
import EITLERP.Finance.*;
import java.sql.*;

public class frmRptAdvancePayment extends javax.swing.JApplet {
    
    private EITLTableModel DataModel=new EITLTableModel();
    private JDialog aDialog;
    public String PartyCode="";
    public String PONo="";
    private EITLComboModel cmbCompanyModel=new EITLComboModel();

    
    /** Initializes the applet frmPaymentDetails */
    public void init() {
        setSize(578,398);
        initComponents();
        GenerateCombo();
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        lblTitle = new javax.swing.JLabel();
        jLabel15 = new javax.swing.JLabel();
        txtPartyCode = new javax.swing.JTextField();
        cmdShow = new javax.swing.JButton();
        txtPartyName = new javax.swing.JLabel();
        jPanel4 = new javax.swing.JPanel();
        jScrollPane5 = new javax.swing.JScrollPane();
        TablePayment = new javax.swing.JTable();
        jLabel17 = new javax.swing.JLabel();
        txtPONo = new javax.swing.JTextField();
        cmdOpenVoucher = new javax.swing.JButton();
        cmdShowPO = new javax.swing.JButton();
        cmdClose = new javax.swing.JButton();
        jLabel21 = new javax.swing.JLabel();
        cmbCompany = new javax.swing.JComboBox();

        getContentPane().setLayout(null);

        addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                formMouseClicked(evt);
            }
        });

        lblTitle.setBackground(new java.awt.Color(0, 102, 153));
        lblTitle.setForeground(java.awt.Color.white);
        lblTitle.setText(" PARTY ADVANCE PAYMENT DETAILS");
        lblTitle.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        lblTitle.setOpaque(true);
        getContentPane().add(lblTitle);
        lblTitle.setBounds(1, 2, 666, 25);

        jLabel15.setText("Party Code");
        getContentPane().add(jLabel15);
        jLabel15.setBounds(26, 42, 80, 15);

        txtPartyCode.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtPartyCodeFocusLost(evt);
            }
        });
        txtPartyCode.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtPartyCodeKeyPressed(evt);
            }
        });

        getContentPane().add(txtPartyCode);
        txtPartyCode.setBounds(100, 40, 110, 19);

        cmdShow.setText("Show");
        cmdShow.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdShowActionPerformed(evt);
            }
        });

        getContentPane().add(cmdShow);
        cmdShow.setBounds(219, 39, 80, 20);

        txtPartyName.setText("...");
        getContentPane().add(txtPartyName);
        txtPartyName.setBounds(102, 65, 370, 15);

        jPanel4.setLayout(null);

        jPanel4.setBorder(new javax.swing.border.EtchedBorder());
        TablePayment.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jScrollPane5.setViewportView(TablePayment);

        jPanel4.add(jScrollPane5);
        jScrollPane5.setBounds(5, 5, 510, 170);

        getContentPane().add(jPanel4);
        jPanel4.setBounds(7, 152, 530, 190);

        jLabel17.setText("PO No.");
        getContentPane().add(jLabel17);
        jLabel17.setBounds(43, 93, 50, 15);

        getContentPane().add(txtPONo);
        txtPONo.setBounds(99, 90, 110, 19);

        cmdOpenVoucher.setText("Open Voucher");
        cmdOpenVoucher.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdOpenVoucherActionPerformed(evt);
            }
        });

        getContentPane().add(cmdOpenVoucher);
        cmdOpenVoucher.setBounds(11, 352, 130, 25);

        cmdShowPO.setText("...");
        cmdShowPO.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdShowPOActionPerformed(evt);
            }
        });

        getContentPane().add(cmdShowPO);
        cmdShowPO.setBounds(213, 90, 30, 20);

        cmdClose.setText("Close");
        cmdClose.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdCloseActionPerformed(evt);
            }
        });

        getContentPane().add(cmdClose);
        cmdClose.setBounds(406, 347, 130, 25);

        jLabel21.setText("PO Company ");
        getContentPane().add(jLabel21);
        jLabel21.setBounds(7, 125, 90, 15);

        getContentPane().add(cmbCompany);
        cmbCompany.setBounds(98, 123, 260, 20);

    }//GEN-END:initComponents
    
    private void formMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseClicked
        // TODO add your handling code here:
        
    }//GEN-LAST:event_formMouseClicked
    
    private void cmdCloseActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdCloseActionPerformed
        // TODO add your handling code here:
        try {
            ((JFrame)getParent().getParent().getParent().getParent()).dispose();
        }
        catch(Exception e) {
            
        }
        
        try {
            aDialog.dispose();
        }
        catch(Exception e) {
            
        }
        
        
    }//GEN-LAST:event_cmdCloseActionPerformed
    
    private void cmdOpenVoucherActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdOpenVoucherActionPerformed
        // TODO add your handling code here:
        try {
            if(TablePayment.getSelectedRow()>=0) {
                
                String DocNo=DataModel.getValueByVariable("VOUCHER_NO", TablePayment.getSelectedRow());
                AppletFrame aFrame=new AppletFrame("Voucher");
                aFrame.startAppletEx("EITLERP.Finance.frmVoucher","Voucher");
                frmVoucher ObjDoc=(frmVoucher) aFrame.ObjApplet;
                int CompanyID=UtilFunctions.CInt(DataModel.getValueByVariable("COMPANY_ID", TablePayment.getSelectedRow()));
                ObjDoc.FindEx(CompanyID,DocNo);
            }
        }
        catch(Exception e) {
            
        }
        
    }//GEN-LAST:event_cmdOpenVoucherActionPerformed
    
    private void cmdShowPOActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdShowPOActionPerformed
        // TODO add your handling code here:
        try {
            if(!txtPONo.getText().trim().equals("")) {
                String DocNo=txtPONo.getText();
                int POType=clsPOGen.getPOType(EITLERPGLOBAL.gCompanyID,DocNo);
                AppletFrame aFrame=new AppletFrame("Purchase Order");
                aFrame.startAppletEx("EITLERP.Purchase.frmPOGen","Purchase Order");
                frmPOGen ObjDoc=(frmPOGen) aFrame.ObjApplet;
                ObjDoc.POType=POType;
                ObjDoc.FindEx((int)EITLERPGLOBAL.gCompanyID,DocNo);
            }
            
        }
        catch(Exception e) {
            
        }
        
    }//GEN-LAST:event_cmdShowPOActionPerformed
    
    private void txtPartyCodeFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtPartyCodeFocusLost
        // TODO add your handling code here:
        txtPartyName.setText(clsPartyMaster.getAccountName("",txtPartyCode.getText()));
    }//GEN-LAST:event_txtPartyCodeFocusLost
    
    private void txtPartyCodeKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtPartyCodeKeyPressed
        // TODO add your handling code here:
        if(evt.getKeyCode()==112) {
            LOV aList=new LOV();
            
            aList.SQL="SELECT PARTY_CODE,PARTY_NAME FROM D_FIN_PARTY_MASTER WHERE APPROVED=1 ORDER BY PARTY_NAME";
            aList.ReturnCol=1;
            aList.ShowReturnCol=true;
            aList.DefaultSearchOn=2;
            aList.UseSpecifiedConn=true;
            aList.dbURL=FinanceGlobal.FinURL;
            
            if(aList.ShowLOV()) {
                txtPartyCode.setText(aList.ReturnVal);
                txtPartyName.setText(clsPartyMaster.getAccountName("",txtPartyCode.getText()));
            }
            
        }
    }//GEN-LAST:event_txtPartyCodeKeyPressed
    
    private void cmdShowActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdShowActionPerformed
        // TODO add your handling code here:
        GenerateGrid();
    }//GEN-LAST:event_cmdShowActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTable TablePayment;
    private javax.swing.JComboBox cmbCompany;
    private javax.swing.JButton cmdClose;
    private javax.swing.JButton cmdOpenVoucher;
    private javax.swing.JButton cmdShow;
    private javax.swing.JButton cmdShowPO;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel17;
    private javax.swing.JLabel jLabel21;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JScrollPane jScrollPane5;
    private javax.swing.JLabel lblTitle;
    private javax.swing.JTextField txtPONo;
    private javax.swing.JTextField txtPartyCode;
    private javax.swing.JLabel txtPartyName;
    // End of variables declaration//GEN-END:variables
    
    private void FormatGrid() {
        try {
            
            DataModel=new EITLTableModel();
            TablePayment.removeAll();
            
            TablePayment.setModel(DataModel);
            TableColumnModel ColModel=TablePayment.getColumnModel();
            TablePayment.setAutoResizeMode(JTable.AUTO_RESIZE_OFF);
            
            DataModel.addColumn("Sr."); //0 - Read Only
            DataModel.addColumn("Voucher No."); //1
            DataModel.addColumn("Voucher Date"); //2 //Read Only
            DataModel.addColumn("Amount"); //3
            DataModel.addColumn("Description");//4
            DataModel.addColumn("Company Name");//4
            DataModel.addColumn("Company ID");//4
            
            DataModel.SetVariable(0,"SR_NO"); //0 - Read Only
            DataModel.SetVariable(1,"VOUCHER_NO"); //1
            DataModel.SetVariable(2,"VOUCHER_DATE"); //2 //Read Only
            DataModel.SetVariable(3,"AMOUNT"); //2 //Read Only
            DataModel.SetVariable(4,"DESCRIPTION"); //2 //Read Only
            DataModel.SetVariable(5,"COMPANY_NAME"); //2 //Read Only
            DataModel.SetVariable(6,"COMPANY_ID"); //2 //Read Only
            
            DataModel.TableReadOnly(true);
        }
        catch(Exception e) {
            
        }
    }
    
    private void GenerateGrid() {
        try {
            HashMap List=new HashMap();
            
            FormatGrid();
            
            List=clsAccount.getAdvancePaymentDetails(EITLERPGLOBAL.gCompanyID, txtPartyCode.getText(), txtPONo.getText());
            
            for(int i=1;i<=List.size();i++) {
                clsVoucher objItem=(clsVoucher)List.get(Integer.toString(i));
                
                Object[] rowData=new Object[7];
                rowData[0]=Integer.toString(i);
                rowData[1]=objItem.getAttribute("VOUCHER_NO").getString();
                rowData[2]=objItem.getAttribute("VOUCHER_DATE").getString();
                rowData[3]=Double.toString(objItem.getAttribute("AMOUNT").getDouble());
                rowData[4]=objItem.getAttribute("VOUCHER_NO").getString();
                rowData[5]=clsCompany.getCityName(objItem.getAttribute("COMPANY_ID").getInt());
                rowData[6]=Integer.toString(objItem.getAttribute("COMPANY_ID").getInt());
                
                DataModel.addRow(rowData);
            }
            
        }
        catch(Exception e) {
            
        }
    }
    
    private Frame findParentFrame(JApplet pApplet) {
        Container c = (Container) pApplet;
        while(c != null) {
            if (c instanceof Frame)
                return (Frame)c;
            
            c = c.getParent();
        }
        return (Frame)null;
    }
    
    
    public void ShowDialog() {
        try {
            setSize(578,398);
            
            Frame f=findParentFrame(this);
            
            initComponents();
            txtPartyCode.setText(this.PartyCode);
            txtPartyName.setText(clsPartyMaster.getAccountName("",txtPartyCode.getText()));
            txtPONo.setText(this.PONo);
            
            GenerateGrid();
            
            aDialog=new JDialog(f,"Advance Payment Details",true);
            
            aDialog.getContentPane().add("Center",this);
            Dimension appletSize = this.getSize();
            aDialog.setSize(appletSize);
            aDialog.setResizable(false);
            
            //Place it to center of the screen
            Dimension screenSize=Toolkit.getDefaultToolkit().getScreenSize();
            aDialog.setLocation((int)(screenSize.width-appletSize.getWidth())/2,(int)(screenSize.height-appletSize.getHeight())/2);
            
            aDialog.setDefaultCloseOperation(javax.swing.JDialog.DISPOSE_ON_CLOSE);
            aDialog.show();
        }
        catch(Exception e) {
        }
    }

    
    private void GenerateCombo()
    {
      try
      {
         HashMap List=clsCompany.getList("");
         
         cmbCompanyModel=new EITLComboModel();
         cmbCompany.removeAllItems();
         cmbCompany.setModel(cmbCompanyModel);
         
         for(int i=1;i<=List.size();i++)
         {
           clsCompany objCompany=(clsCompany)List.get(Integer.toString(i));
           
           ComboData objData=new ComboData();
           objData.Code=objCompany.getAttribute("COMPANY_ID").getInt();
           objData.Text=objCompany.getAttribute("COMPANY_NAME").getString();
           
           cmbCompanyModel.addElement(objData);
         }
      }
      catch(Exception e)
      {
          
      }
    }
    
}
