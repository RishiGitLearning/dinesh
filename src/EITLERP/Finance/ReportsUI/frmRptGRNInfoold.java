/*
 * frmRptGRNInfo.java
 *
 * Created on April 16, 2008, 12:01 PM
 */

package EITLERP.Finance.ReportsUI;

/**
 *
 * @author  root
 */
import EITLERP.*;
import EITLERP.Finance.*;
import EITLERP.Utils.*;
import EITLERP.Utils.SimpleDataProvider.*;
import javax.swing.*;
import java.awt.*;
import java.sql.*;
import java.net.*;
import TReportWriter.*;
import java.util.*;

public class frmRptGRNInfoold extends javax.swing.JApplet {
    
    private TReportEngine objEngine=new TReportEngine();
    private EITLComboModel cmbItemTypeModel=new EITLComboModel();
    int GRNType =0;
    /** Initializes the applet frmRptGRNInfo */
    public void init() {
        setSize(404,248);
        initComponents();
        lblStatus.setVisible(false);
        Bar.setVisible(false);
        GenerateCombo();
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jPanel3 = new javax.swing.JPanel();
        jLabel6 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        txtFromDate = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        txtToDate = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        cmdPreview = new javax.swing.JButton();
        lblStatus = new javax.swing.JLabel();
        Bar = new javax.swing.JProgressBar();
        jCheckBox1 = new javax.swing.JCheckBox();
        cmbItemType = new javax.swing.JComboBox();
        jLabel10 = new javax.swing.JLabel();

        getContentPane().setLayout(null);

        addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                formMouseClicked(evt);
            }
        });

        jPanel3.setLayout(null);

        jPanel3.setBackground(new java.awt.Color(0, 153, 204));
        jPanel3.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        jLabel6.setText("GRN - PJV Link Report");
        jPanel3.add(jLabel6);
        jLabel6.setBounds(9, 8, 230, 15);

        getContentPane().add(jPanel3);
        jPanel3.setBounds(1, 2, 800, 30);

        jLabel2.setFont(new java.awt.Font("Dialog", 0, 10));
        jLabel2.setText("From Date:");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(10, 100, 60, 20);

        txtFromDate.setColumns(10);
        getContentPane().add(txtFromDate);
        txtFromDate.setBounds(70, 100, 90, 19);

        jLabel3.setFont(new java.awt.Font("Dialog", 0, 10));
        jLabel3.setText("To");
        getContentPane().add(jLabel3);
        jLabel3.setBounds(170, 100, 20, 20);

        txtToDate.setColumns(10);
        getContentPane().add(txtToDate);
        txtToDate.setBounds(200, 100, 90, 20);

        jLabel1.setText("GRN Period");
        getContentPane().add(jLabel1);
        jLabel1.setBounds(10, 80, 90, 15);

        cmdPreview.setText("Preview");
        cmdPreview.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdPreviewActionPerformed(evt);
            }
        });

        getContentPane().add(cmdPreview);
        cmdPreview.setBounds(280, 180, 88, 25);

        lblStatus.setText("...");
        getContentPane().add(lblStatus);
        lblStatus.setBounds(10, 170, 160, 15);

        Bar.setStringPainted(true);
        getContentPane().add(Bar);
        Bar.setBounds(10, 190, 180, 20);

        jCheckBox1.setText("Display list of only stores/spares GRN");
        getContentPane().add(jCheckBox1);
        jCheckBox1.setBounds(10, 130, 290, 23);

        cmbItemType.setAutoscrolls(true);
        getContentPane().add(cmbItemType);
        cmbItemType.setBounds(85, 42, 190, 24);

        jLabel10.setText("Item Type");
        getContentPane().add(jLabel10);
        jLabel10.setBounds(10, 50, 80, 15);

    }//GEN-END:initComponents
    
    private void formMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_formMouseClicked
    
    private void cmdPreviewActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdPreviewActionPerformed
        // TODO add your handling code here:
        GRNType=EITLERPGLOBAL.getComboCode(cmbItemType);
        
        GenerateReport();
    }//GEN-LAST:event_cmdPreviewActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JProgressBar Bar;
    private javax.swing.JComboBox cmbItemType;
    private javax.swing.JButton cmdPreview;
    private javax.swing.JCheckBox jCheckBox1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JLabel lblStatus;
    private javax.swing.JTextField txtFromDate;
    private javax.swing.JTextField txtToDate;
    // End of variables declaration//GEN-END:variables
    
    private void GenerateCombo() {
        try {
            
            cmbItemTypeModel=new EITLComboModel();
            cmbItemType.removeAll();
            cmbItemType.setModel(cmbItemTypeModel);
            
            ComboData objData=new ComboData();
            objData.Code=1;
            objData.Text="General";
            
            cmbItemTypeModel.addElement(objData);
            
            objData=new ComboData();
            objData.Code=2;
            objData.Text="Raw Material";
            
            cmbItemTypeModel.addElement(objData);
            
            objData=new ComboData();
            objData.Code=3;
            objData.Text="Job Work";
            
            cmbItemTypeModel.addElement(objData);
            
            
        }
        catch(Exception e) {
            
        }
    }
    
    private void GenerateReport() {
        
        new Thread() {
            
            public void run() {
                
                try {
                    double sumVouValue = 0.0;
                    double sumGRNValue = 0.0;
                    double sumGRNCenvateAmt = 0.0;
                    double sumVouCenvateAmt = 0.0;
                    
                    String NewGRNNo = "", GRN_No="";
                    
                    TReportWriter.SimpleDataProvider.TTable objData=new TReportWriter.SimpleDataProvider.TTable();
                    
                    objData.AddColumn("DOCUMENT_TYPE");
                    objData.AddColumn("GRN_NO");
                    objData.AddColumn("GRN_DATE");
                    objData.AddColumn("GRN_VALUE");
                    objData.AddColumn("GRN_STORES_VALUE");
                    objData.AddColumn("GRN_SPARES_VALUE");
                    objData.AddColumn("GRN_CENVATE_AMT");
                    objData.AddColumn("GRN_NET_AMT");
                    objData.AddColumn("SUPPLIER_CODE");
                    objData.AddColumn("SUPPLIER_NAME");
                    objData.AddColumn("VOUCHER_NO");
                    objData.AddColumn("VOUCHER_DATE");
                    objData.AddColumn("VOUCHER_VALUE");
                    objData.AddColumn("VOUCHER_STORES_VALUE");
                    objData.AddColumn("VOUCHER_SPARES_VALUE");
                    objData.AddColumn("VOUCHER_DIFFERENCE");
                    objData.AddColumn("VOUCHER_CENVATE_AMT");
                    objData.AddColumn("VOUCHER_NET_AMT");
                    objData.AddColumn("DIFFERENCE");
                    
                    objData.AddColumn("PO_NO");
                    
                    String FromDate=EITLERPGLOBAL.formatDateDB(txtFromDate.getText());
                    String ToDate=EITLERPGLOBAL.formatDateDB(txtToDate.getText());
                    
                    int Max=0;
                    int Counter=0;
                    lblStatus.setVisible(true);
                    Bar.setVisible(true);
                    ResultSet rsTmp;
                    if(GRNType == 1) {
                        
                        //************************************ GRN GENERAL *************************************//
                        //--------------------------------------------------------------------------------------//
                        
                        Max=data.getIntValueFromDB("SELECT COUNT(*) AS THE_COUNT FROM D_INV_GRN_HEADER WHERE GRN_TYPE=1 AND GRN_DATE>='"+FromDate+"' AND GRN_DATE<='"+ToDate+"' AND APPROVED=1 AND CANCELLED=0  ");
                        Bar.setMaximum(Max);
                        Bar.setMinimum(0);
                        Counter=0;
                        
                        rsTmp=data.getResult("SELECT * FROM D_INV_GRN_HEADER WHERE GRN_TYPE=1 AND GRN_DATE>='"+FromDate+"' AND GRN_DATE<='"+ToDate+"'  AND APPROVED=1 AND CANCELLED=0 ");
                        rsTmp.first();
                        
                        System.out.println("GRN Gen.");
                        
                        if(rsTmp.getRow()>0) {
                            while(!rsTmp.isAfterLast()) {
                                GRN_No=rsTmp.getString("GRN_NO");
                                Counter++;
                                Bar.setValue(Counter);
                                
                                String GRNNo=rsTmp.getString("GRN_NO");
                                String GRNDate=EITLERPGLOBAL.formatDate(rsTmp.getString("GRN_DATE"));
                                String SupplierCode=rsTmp.getString("SUPP_ID");
                                String SupplierName=clsSupplier.getSupplierName(EITLERPGLOBAL.gCompanyID,SupplierCode);
                                String strStoresGRNQuery="";
                                String strSparesGRNQuery="";
                                
                                if(EITLERPGLOBAL.gCompanyID==2) {
                                    strStoresGRNQuery="SELECT ROUND(SUM(LANDED_RATE*QTY),2) AS GRN_VALUE FROM D_INV_GRN_DETAIL WHERE GRN_NO='"+GRNNo+"' AND (ITEM_ID LIKE '1%' OR ITEM_ID LIKE '2%' OR ITEM_ID LIKE '3%' OR ITEM_ID LIKE '5%' OR ITEM_ID LIKE '6%' OR ITEM_ID LIKE '7%' OR ITEM_ID LIKE '8%' OR ITEM_ID LIKE '90%' OR ITEM_ID LIKE '95%' OR ITEM_ID LIKE '91%' OR ITEM_ID LIKE '92%' OR ITEM_ID LIKE '93%'  OR ITEM_ID LIKE '96%' OR ITEM_ID LIKE '99%'  OR ITEM_ID LIKE '97%'  OR ITEM_ID LIKE '98%') ";
                                    strSparesGRNQuery="SELECT ROUND(SUM(LANDED_RATE*QTY),2) AS GRN_VALUE FROM D_INV_GRN_DETAIL WHERE GRN_NO='"+GRNNo+"' AND (ITEM_ID LIKE '4%' OR ITEM_ID LIKE '94%') ";
                                }
                                
                                if(EITLERPGLOBAL.gCompanyID==3) {
                                    strStoresGRNQuery="SELECT ROUND(SUM(LANDED_RATE*QTY),2) AS GRN_VALUE FROM D_INV_GRN_DETAIL WHERE GRN_NO='"+GRNNo+"' AND (ITEM_ID LIKE '10%' OR ITEM_ID LIKE '20%' OR ITEM_ID LIKE '30%' OR ITEM_ID LIKE '40%' OR ITEM_ID LIKE '50%' OR ITEM_ID LIKE '60%' OR ITEM_ID LIKE '70%' OR ITEM_ID LIKE '95%' OR ITEM_ID LIKE '96%')";
                                    strSparesGRNQuery="SELECT ROUND(SUM(LANDED_RATE*QTY),2) AS GRN_VALUE FROM D_INV_GRN_DETAIL WHERE GRN_NO='"+GRNNo+"' AND (ITEM_ID LIKE '98%' OR ITEM_ID LIKE '80%' OR ITEM_ID LIKE '81%' )";
                                }
                                
                                double StoresGRNValue=data.getDoubleValueFromDB(strStoresGRNQuery);
                                double SparesGRNValue=data.getDoubleValueFromDB(strSparesGRNQuery);
                                double GRNValue=StoresGRNValue+SparesGRNValue;
                                double GRNCenvateValue = data.getDoubleValueFromDB("SELECT ROUND(SUM(COLUMN_8_AMT),2) FROM D_INV_GRN_DETAIL WHERE GRN_NO='"+GRNNo+"' ");
                                GRNValue = GRNValue + GRNCenvateValue;
                                if(GRNValue>=0) {
                                    
                                    int RowCounter=0;
                                    lblStatus.setText("GRN "+GRNNo);
                                    
                                    ResultSet rsVoucher=data.getResult("SELECT DISTINCT(A.VOUCHER_NO),A.VOUCHER_DATE FROM D_FIN_VOUCHER_HEADER A,D_FIN_VOUCHER_DETAIL B WHERE A.VOUCHER_NO=B.VOUCHER_NO AND A.COMPANY_ID=B.COMPANY_ID AND A.VOUCHER_TYPE=1 AND A.REJECTED=0 AND B.MODULE_ID=7 AND A.CANCELLED=0 AND B.GRN_NO='"+GRNNo+"' AND A.COMPANY_ID="+EITLERPGLOBAL.gCompanyID,FinanceGlobal.FinURL);
                                    
                                    rsVoucher.first();
                                    if(rsVoucher.getRow()>0) {
                                        while(!rsVoucher.isAfterLast()) {
                                            
                                            RowCounter++;
                                            
                                            String VoucherNo=rsVoucher.getString("VOUCHER_NO");
                                            String VoucherDate=EITLERPGLOBAL.formatDate(rsVoucher.getString("VOUCHER_DATE"));
                                            
                                            double VoucherValue=data.getDoubleValueFromDB("SELECT SUM(AMOUNT) FROM D_FIN_VOUCHER_DETAIL WHERE EFFECT='D' AND VOUCHER_NO='"+VoucherNo+"'",FinanceGlobal.FinURL);
                                            double StoresValue=data.getDoubleValueFromDB("SELECT SUM(AMOUNT) FROM D_FIN_VOUCHER_DETAIL WHERE EFFECT='D' AND (MAIN_ACCOUNT_CODE LIKE '405021%' OR MAIN_ACCOUNT_CODE LIKE '411024%' OR MAIN_ACCOUNT_CODE LIKE '411127%' ) AND VOUCHER_NO='"+VoucherNo+"'",FinanceGlobal.FinURL);
                                            double SparesValue=data.getDoubleValueFromDB("SELECT SUM(AMOUNT) FROM D_FIN_VOUCHER_DETAIL WHERE EFFECT='D' AND (MAIN_ACCOUNT_CODE LIKE '421014%' OR MAIN_ACCOUNT_CODE LIKE '421038%' OR MAIN_ACCOUNT_CODE LIKE'450203%' OR MAIN_ACCOUNT_CODE LIKE '450605%' ) AND VOUCHER_NO='"+VoucherNo+"'",FinanceGlobal.FinURL);
                                            double DiffValue=VoucherValue-(StoresValue+SparesValue);
                                            
                                            int Approved=data.getIntValueFromDB("SELECT APPROVED FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO='"+VoucherNo+"'",FinanceGlobal.FinURL);
                                            if(Approved==0) {
                                                VoucherValue=0;
                                                StoresValue=0;
                                                SparesValue=0;
                                                DiffValue=0;
                                            }
                                            
                                            String PONo=data.getStringValueFromDB("SELECT B.PO_NO FROM D_INV_GRN_DETAIL A,D_INV_MIR_DETAIL B WHERE A.MIR_NO=B.MIR_NO AND A.MIR_SR_NO=B.SR_NO AND A.MIR_NO<>''  AND A.GRN_NO='"+GRNNo+"'");
                                            //if (GRNValue > 100000) {
                                                TReportWriter.SimpleDataProvider.TRow objRow=new TReportWriter.SimpleDataProvider.TRow();
                                                objRow.setValue("DOCUMENT_TYPE", "GRN Gen");

                                                double GRN_Cenvate_Amt=0,GRN_Net_Amt=0;

                                                if(RowCounter>1) {
                                                    objRow.setValue("GRN_NO","");
                                                    objRow.setValue("GRN_DATE","0000-00-00");
                                                    objRow.setValue("GRN_VALUE","0");
                                                    objRow.setValue("GRN_STORES_VALUE","0");
                                                    objRow.setValue("GRN_SPARES_VALUE","0");
                                                    objRow.setValue("SUPPLIER_CODE","");
                                                    objRow.setValue("SUPPLIER_NAME","");

                                                    GRN_Cenvate_Amt=0;
                                                    GRN_Net_Amt=0;

                                                    objRow.setValue("GRN_CENVATE_AMT",Double.toString(GRN_Cenvate_Amt));
                                                    objRow.setValue("GRN_NET_AMT",Double.toString(GRN_Net_Amt));
                                                }
                                                else {
                                                    objRow.setValue("GRN_NO",GRNNo);
                                                    objRow.setValue("GRN_DATE",GRNDate);
                                                    objRow.setValue("GRN_VALUE",Double.toString(GRNValue));
                                                    objRow.setValue("GRN_STORES_VALUE",Double.toString(StoresGRNValue));
                                                    objRow.setValue("GRN_SPARES_VALUE",Double.toString(SparesGRNValue));
                                                    objRow.setValue("SUPPLIER_CODE",SupplierCode);
                                                    objRow.setValue("SUPPLIER_NAME",SupplierName);

                                                    GRN_Cenvate_Amt=GRNCenvateValue;
                                                    GRN_Net_Amt=GRNValue - GRN_Cenvate_Amt;

                                                    objRow.setValue("GRN_CENVATE_AMT",Double.toString(GRN_Cenvate_Amt));
                                                    objRow.setValue("GRN_NET_AMT",Double.toString(GRN_Net_Amt));

                                                    if (! NewGRNNo.trim().equals(GRN_No.trim())) {
                                                        sumGRNValue += GRNValue;
                                                        sumGRNCenvateAmt += GRN_Cenvate_Amt;
                                                    }
                                                    NewGRNNo = GRN_No;
                                                }

                                                objRow.setValue("VOUCHER_NO",VoucherNo);
                                                objRow.setValue("VOUCHER_DATE",VoucherDate);
                                                objRow.setValue("VOUCHER_VALUE",Double.toString(VoucherValue));
                                                objRow.setValue("VOUCHER_STORES_VALUE",Double.toString(StoresValue));
                                                objRow.setValue("VOUCHER_SPARES_VALUE",Double.toString(SparesValue));
                                                objRow.setValue("VOUCHER_DIFFERENCE",Double.toString(DiffValue));
                                                objRow.setValue("PO_NO",PONo);
                                                sumVouValue += VoucherValue;

                                                double Vou_Cenvate_Amt=0,Vou_Net_Amt=0,Difference=0;
                                                String str="";
                                                str = "SELECT SUM(AMOUNT) FROM  D_FIN_VOUCHER_DETAIL WHERE VOUCHER_NO = '"+ VoucherNo +"' " +
                                                " AND MAIN_ACCOUNT_CODE IN ('421014','405021','421038','201193') AND EFFECT='C' GROUP BY VOUCHER_NO";
                                                Vou_Cenvate_Amt = data.getDoubleValueFromDB(str,FinanceGlobal.FinURL);
                                                Vou_Net_Amt = VoucherValue - Vou_Cenvate_Amt;

                                                objRow.setValue("VOUCHER_CENVATE_AMT", Double.toString(Vou_Cenvate_Amt));
                                                objRow.setValue("VOUCHER_NET_AMT",Double.toString(Vou_Net_Amt));

                                                Difference = GRN_Net_Amt - Vou_Net_Amt;
                                                objRow.setValue("DIFFERENCE", Double.toString(Difference));

                                                sumVouCenvateAmt += Vou_Cenvate_Amt;

                                                objData.AddRow(objRow);
                                            //}
                                            rsVoucher.next();
                                        }
                                        
                                    }
                                    else {
                                        
                                        
                                        System.out.println(GRNNo);
                                        
                                        String PONo=data.getStringValueFromDB("SELECT B.PO_NO FROM D_INV_GRN_DETAIL A,D_INV_MIR_DETAIL B WHERE A.MIR_NO=B.MIR_NO AND A.MIR_SR_NO=B.SR_NO AND A.MIR_NO<>''  AND A.GRN_NO='"+GRNNo+"'");
                                        //if (GRNValue > 100000) {
                                        TReportWriter.SimpleDataProvider.TRow objRow=new TReportWriter.SimpleDataProvider.TRow();
                                        objRow.setValue("DOCUMENT_TYPE", "GRN Gen");
                                        objRow.setValue("GRN_NO",GRNNo);
                                        objRow.setValue("GRN_DATE",GRNDate);
                                        objRow.setValue("GRN_VALUE",Double.toString(GRNValue));
                                        objRow.setValue("GRN_STORES_VALUE",Double.toString(StoresGRNValue));
                                        objRow.setValue("GRN_SPARES_VALUE",Double.toString(SparesGRNValue));
                                        
                                        double GRN_Cenvate_Amt=0,GRN_Net_Amt=0;
                                        
                                        GRN_Cenvate_Amt=GRNCenvateValue;
                                        GRN_Net_Amt=GRNValue - GRN_Cenvate_Amt;
                                        
                                        objRow.setValue("GRN_CENVATE_AMT",Double.toString(GRN_Cenvate_Amt));
                                        objRow.setValue("GRN_NET_AMT",Double.toString(GRN_Net_Amt));
                                        
                                        
                                        objRow.setValue("SUPPLIER_CODE",SupplierCode);
                                        objRow.setValue("SUPPLIER_NAME",SupplierName);
                                        objRow.setValue("VOUCHER_NO","");
                                        objRow.setValue("VOUCHER_DATE","0000-00-00");
                                        objRow.setValue("VOUCHER_VALUE","0");
                                        objRow.setValue("VOUCHER_STORES_VALUE","0");
                                        objRow.setValue("VOUCHER_SPARES_VALUE","0");
                                        objRow.setValue("VOUCHER_DIFFERENCE","0");
                                        
                                        double Vou_Cenvate_Amt=0,Vou_Net_Amt=0,Difference=0;
                                        
                                        Vou_Cenvate_Amt = 0;
                                        Vou_Net_Amt = 0 - Vou_Cenvate_Amt;
                                        
                                        objRow.setValue("VOUCHER_CENVATE_AMT", Double.toString(Vou_Cenvate_Amt));
                                        objRow.setValue("VOUCHER_NET_AMT",Double.toString(Vou_Net_Amt));
                                        
                                        Difference = GRN_Net_Amt - Vou_Net_Amt;
                                        objRow.setValue("DIFFERENCE", Double.toString(Difference));
                                        
                                        
                                        if (! NewGRNNo.trim().equals(GRN_No.trim())) {
                                            sumGRNValue += GRNValue;
                                            sumGRNCenvateAmt += GRN_Cenvate_Amt;
                                        }
                                        NewGRNNo = GRN_No;
                                        
                                        if(rsTmp.getInt("PAYMENT_TYPE")==1) //Cash GRN
                                        {
                                            objRow.setValue("VOUCHER_NO","CASH VOUCHER");
                                            objRow.setValue("VOUCHER_DATE","0000-00-00");
                                            objRow.setValue("VOUCHER_VALUE",Double.toString(GRNValue));
                                            objRow.setValue("VOUCHER_STORES_VALUE",Double.toString(StoresGRNValue));
                                            objRow.setValue("VOUCHER_SPARES_VALUE",Double.toString(SparesGRNValue));
                                            objRow.setValue("VOUCHER_DIFFERENCE","0");
                                            sumVouValue += GRNValue;
                                            
                                            Vou_Cenvate_Amt = 0;
                                            Vou_Net_Amt = 0;
                                            Difference = 0;
                                            
                                            Vou_Net_Amt = GRNValue -Vou_Cenvate_Amt;
                                            
                                            objRow.setValue("VOUCHER_CENVATE_AMT", Double.toString(Vou_Cenvate_Amt));
                                            objRow.setValue("VOUCHER_NET_AMT",Double.toString(Vou_Net_Amt));
                                            
                                            Difference = GRN_Net_Amt - Vou_Net_Amt;
                                            objRow.setValue("DIFFERENCE", Double.toString(Difference));
                                            
                                            sumVouCenvateAmt += Vou_Cenvate_Amt;
                                        }
                                        else {
                                            
                                            if(SupplierCode.equals("888888")||SupplierCode.equals("999999")) //Cash GRN
                                            {
                                                objRow.setValue("VOUCHER_NO","STOCK TRANSFER");
                                                objRow.setValue("VOUCHER_DATE","0000-00-00");
                                                objRow.setValue("VOUCHER_VALUE",Double.toString(GRNValue));
                                                objRow.setValue("VOUCHER_STORES_VALUE",Double.toString(StoresGRNValue));
                                                objRow.setValue("VOUCHER_SPARES_VALUE",Double.toString(SparesGRNValue));
                                                objRow.setValue("VOUCHER_DIFFERENCE","0");
                                                sumVouValue += GRNValue;
                                                
                                                Vou_Cenvate_Amt = 0;
                                                Vou_Net_Amt = 0;
                                                Difference = 0;
                                                
                                                Vou_Net_Amt = GRNValue -Vou_Cenvate_Amt;
                                                
                                                objRow.setValue("VOUCHER_CENVATE_AMT", Double.toString(Vou_Cenvate_Amt));
                                                objRow.setValue("VOUCHER_NET_AMT",Double.toString(Vou_Net_Amt));
                                                
                                                Difference = GRN_Net_Amt - Vou_Net_Amt;
                                                objRow.setValue("DIFFERENCE", Double.toString(Difference));
                                                
                                                sumVouCenvateAmt += Vou_Cenvate_Amt;
                                            }
                                        }
                                        objRow.setValue("PO_NO",PONo);
                                        
                                        objData.AddRow(objRow);
                                       // }
                                    }
                                }
                                
                                rsTmp.next();
                            }
                        }
                    }
                    //================================== END OF GRN GENERAL ===================================//
                    
                    
                    if(GRNType ==2) {
                        //************************************ GRN RAW MATERIAL *************************************//
                        //--------------------------------------------------------------------------------------//
                        Max=data.getIntValueFromDB("SELECT COUNT(*) FROM D_INV_GRN_HEADER WHERE GRN_TYPE=2 AND GRN_DATE>='"+FromDate+"' AND GRN_DATE<='"+ToDate+"' AND PAYMENT_TYPE=0 AND CANCELLED=0  AND SUPP_ID<>'888888' AND SUPP_ID<>'999999' ");
                        Bar.setMaximum(Max);
                        Bar.setMinimum(0);
                        Counter=0;
                        
                        System.out.println("GRN Raw Material");
                        rsTmp=data.getResult("SELECT * FROM D_INV_GRN_HEADER WHERE GRN_TYPE=2 AND GRN_DATE>='"+FromDate+"' AND GRN_DATE<='"+ToDate+"'  AND PAYMENT_TYPE=0  AND CANCELLED=0  AND SUPP_ID<>'888888' AND SUPP_ID<>'999999' ");
                        rsTmp.first();
                        NewGRNNo = "";
                        GRN_No = "";
                        if(rsTmp.getRow()>0) {
                            while(!rsTmp.isAfterLast()) {
                                GRN_No = rsTmp.getString("GRN_NO");
                                
                                Counter++;
                                Bar.setValue(Counter);
                                
                                String GRNNo=rsTmp.getString("GRN_NO");
                                String GRNDate=EITLERPGLOBAL.formatDate(rsTmp.getString("GRN_DATE"));
                                String SupplierCode=rsTmp.getString("SUPP_ID");
                                String SupplierName=clsSupplier.getSupplierName(EITLERPGLOBAL.gCompanyID,SupplierCode);
                                double GRNValue=data.getDoubleValueFromDB("SELECT ROUND(SUM(LANDED_RATE*QTY),2) AS GRN_VALUE FROM D_INV_GRN_DETAIL WHERE GRN_NO='"+GRNNo+"'");
                                double GRNCenvateValue = data.getDoubleValueFromDB("SELECT ROUND(SUM(COLUMN_8_AMT),2) FROM D_INV_GRN_DETAIL WHERE GRN_NO='"+GRNNo+"' ");
                                GRNValue = GRNValue + GRNCenvateValue;
                                String PONo=data.getStringValueFromDB("SELECT B.PO_NO FROM D_INV_GRN_DETAIL A,D_INV_MIR_DETAIL B WHERE A.MIR_NO=B.MIR_NO AND A.MIR_SR_NO=B.SR_NO AND A.MIR_NO<>''  AND A.GRN_NO='"+GRNNo+"'");
                                if(GRNValue>0) {
                                    lblStatus.setText("GRN "+GRNNo);
                                    
                                    ResultSet rsVoucher=data.getResult("SELECT DISTINCT(A.VOUCHER_NO),A.VOUCHER_DATE FROM D_FIN_VOUCHER_HEADER A,D_FIN_VOUCHER_DETAIL B WHERE A.VOUCHER_NO=B.VOUCHER_NO AND A.COMPANY_ID=B.COMPANY_ID AND A.APPROVED=1 AND A.REJECTED=0 AND A.CANCELLED=0 AND A.VOUCHER_TYPE=1 AND B.MODULE_ID=8 AND B.GRN_NO='"+GRNNo+"' AND A.COMPANY_ID="+EITLERPGLOBAL.gCompanyID,FinanceGlobal.FinURL);
                                    rsVoucher.first();
                                    if(rsVoucher.getRow()>0) {
                                        while(!rsVoucher.isAfterLast()) {
                                            String VoucherNo=rsVoucher.getString("VOUCHER_NO");
                                            String VoucherDate=EITLERPGLOBAL.formatDate(rsVoucher.getString("VOUCHER_DATE"));
                                            
                                            double VoucherValue=data.getDoubleValueFromDB("SELECT SUM(AMOUNT) FROM D_FIN_VOUCHER_DETAIL WHERE EFFECT='C' AND MAIN_ACCOUNT_CODE<>'' AND SUB_ACCOUNT_CODE<>'' AND VOUCHER_NO='"+VoucherNo+"'",FinanceGlobal.FinURL);
                                            if (VoucherValue==0) {
                                                VoucherValue=data.getDoubleValueFromDB("SELECT SUM(AMOUNT) FROM D_FIN_VOUCHER_DETAIL WHERE EFFECT='C' AND MAIN_ACCOUNT_CODE<>'' AND MAIN_ACCOUNT_CODE IN ('210080','231321')  AND VOUCHER_NO='"+VoucherNo+"'",FinanceGlobal.FinURL);
                                            }
                                            TReportWriter.SimpleDataProvider.TRow objRow=new TReportWriter.SimpleDataProvider.TRow();
                                            objRow.setValue("DOCUMENT_TYPE", "GRN RM");
                                            objRow.setValue("GRN_NO",GRNNo);
                                            objRow.setValue("GRN_DATE",GRNDate);
                                            objRow.setValue("GRN_VALUE",Double.toString(GRNValue));
                                            
                                            double GRN_Cenvate_Amt=0,GRN_Net_Amt=0;
                                            
                                            GRN_Cenvate_Amt=GRNCenvateValue;
                                            GRN_Net_Amt=GRNValue - GRN_Cenvate_Amt;
                                            
                                            objRow.setValue("GRN_CENVATE_AMT",Double.toString(GRN_Cenvate_Amt));
                                            objRow.setValue("GRN_NET_AMT",Double.toString(GRN_Net_Amt));
                                            
                                            objRow.setValue("SUPPLIER_CODE",SupplierCode);
                                            objRow.setValue("SUPPLIER_NAME",SupplierName);
                                            objRow.setValue("VOUCHER_NO",VoucherNo);
                                            objRow.setValue("VOUCHER_DATE",VoucherDate);
                                            objRow.setValue("VOUCHER_VALUE",Double.toString(VoucherValue));
                                            
                                            double Vou_Cenvate_Amt=0,Vou_Net_Amt=0,Difference=0;
                                            String str="";
                                            str = "SELECT SUM(AMOUNT) FROM  D_FIN_VOUCHER_DETAIL WHERE VOUCHER_NO = '"+ VoucherNo +"' " +
                                            " AND MAIN_ACCOUNT_CODE IN ('403036') AND EFFECT='C' GROUP BY VOUCHER_NO";
                                            Vou_Cenvate_Amt = data.getDoubleValueFromDB(str,FinanceGlobal.FinURL);
                                            Vou_Net_Amt = VoucherValue - Vou_Cenvate_Amt;
                                            
                                            objRow.setValue("VOUCHER_CENVATE_AMT", Double.toString(Vou_Cenvate_Amt));
                                            objRow.setValue("VOUCHER_NET_AMT",Double.toString(Vou_Net_Amt));
                                            
                                            Difference = GRN_Net_Amt - Vou_Net_Amt;
                                            objRow.setValue("DIFFERENCE", Double.toString(Difference));
                                            
                                            
                                            sumVouValue += VoucherValue;
                                            sumVouCenvateAmt += Vou_Cenvate_Amt;
                                            if (! NewGRNNo.trim().equals(GRN_No.trim())) {
                                                sumGRNValue += GRNValue;
                                                sumGRNCenvateAmt += GRN_Cenvate_Amt;
                                            }
                                            NewGRNNo = GRN_No;
                                            objRow.setValue("PO_NO",PONo);
                                            objData.AddRow(objRow);
                                            rsVoucher.next();
                                        }
                                    }
                                    else {
                                        
                                        System.out.println(GRNNo);
                                        
                                        TReportWriter.SimpleDataProvider.TRow objRow=new TReportWriter.SimpleDataProvider.TRow();
                                        objRow.setValue("DOCUMENT_TYPE", "GRN RM");
                                        objRow.setValue("GRN_NO",GRNNo);
                                        objRow.setValue("GRN_DATE",GRNDate);
                                        objRow.setValue("GRN_VALUE",Double.toString(GRNValue));
                                        double GRN_Cenvate_Amt=0,GRN_Net_Amt=0;
                                        
                                        GRN_Cenvate_Amt=GRNCenvateValue;
                                        GRN_Net_Amt=GRNValue - GRN_Cenvate_Amt;
                                        
                                        objRow.setValue("GRN_CENVATE_AMT",Double.toString(GRN_Cenvate_Amt));
                                        objRow.setValue("GRN_NET_AMT",Double.toString(GRN_Net_Amt));
                                        
                                        objRow.setValue("SUPPLIER_CODE",SupplierCode);
                                        objRow.setValue("SUPPLIER_NAME",SupplierName);
                                        objRow.setValue("VOUCHER_NO","");
                                        objRow.setValue("VOUCHER_DATE","0000-00-00");
                                        objRow.setValue("VOUCHER_VALUE","0");
                                        
                                        double Vou_Cenvate_Amt=0,Vou_Net_Amt=0,Difference=0;
                                        Vou_Cenvate_Amt = 0;
                                        Vou_Net_Amt = 0 - Vou_Cenvate_Amt;
                                        
                                        objRow.setValue("VOUCHER_CENVATE_AMT", Double.toString(Vou_Cenvate_Amt));
                                        objRow.setValue("VOUCHER_NET_AMT",Double.toString(Vou_Net_Amt));
                                        
                                        Difference = GRN_Net_Amt - Vou_Net_Amt;
                                        objRow.setValue("DIFFERENCE", Double.toString(Difference));
                                        
                                        
                                        if (! NewGRNNo.trim().equals(GRN_No.trim())) {
                                            sumGRNValue += GRNValue;
                                            sumGRNCenvateAmt += GRN_Cenvate_Amt;
                                        }
                                        NewGRNNo = GRN_No;
                                        objRow.setValue("PO_NO",PONo);
                                        objData.AddRow(objRow);
                                    }
                                }
                                
                                rsTmp.next();
                            }
                        }
                    }
                    //================================== END OF GRN RAW MATERIAL ===================================//
                    
                    if (GRNType == 3) {
                        //************************************ JOB WORK *************************************//
                        //--------------------------------------------------------------------------------------//
                        Max=data.getIntValueFromDB("SELECT COUNT(*) FROM D_INV_JOB_HEADER WHERE JOB_DATE>='"+FromDate+"' AND JOB_DATE<='"+ToDate+"'  AND PAYMENT_TYPE=0  AND APPROVED=1 AND CANCELLED=0");
                        Bar.setMaximum(Max);
                        Bar.setMinimum(0);
                        Counter=0;
                        
                        System.out.println("Jobwork");
                        
                        rsTmp=data.getResult("SELECT * FROM D_INV_JOB_HEADER WHERE JOB_DATE>='"+FromDate+"' AND JOB_DATE<='"+ToDate+"'  AND PAYMENT_TYPE=0  AND APPROVED=1 AND CANCELLED=0");
                        rsTmp.first();
                        
                        if(rsTmp.getRow()>0) {
                            while(!rsTmp.isAfterLast()) {
                                GRN_No=rsTmp.getString("JOB_NO");
                                Counter++;
                                Bar.setValue(Counter);
                                
                                String GRNNo=rsTmp.getString("JOB_NO");
                                String GRNDate=EITLERPGLOBAL.formatDate(rsTmp.getString("JOB_DATE"));
                                String SupplierCode=rsTmp.getString("SUPP_ID");
                                String SupplierName=clsSupplier.getSupplierName(EITLERPGLOBAL.gCompanyID,SupplierCode);
                                double GRNValue=data.getDoubleValueFromDB("SELECT ROUND(SUM(LANDED_RATE*QTY),2) AS GRN_VALUE FROM D_INV_JOB_DETAIL WHERE JOB_NO='"+GRNNo+"'");
                                double GRNCenvateValue = data.getDoubleValueFromDB("SELECT ROUND(SUM(COLUMN_7_AMT),2) FROM D_INV_JOB_DETAIL WHERE JOB_NO='"+GRNNo+"' ");
                                GRNValue = GRNValue + GRNCenvateValue;
                                lblStatus.setText("Jobwork "+GRNNo);
                                
                                if(GRNValue>0) {
                                    ResultSet rsVoucher=data.getResult("SELECT DISTINCT(A.VOUCHER_NO),A.VOUCHER_DATE FROM D_FIN_VOUCHER_HEADER A,D_FIN_VOUCHER_DETAIL B WHERE A.VOUCHER_NO=B.VOUCHER_NO AND A.COMPANY_ID=B.COMPANY_ID AND A.VOUCHER_TYPE=1 AND A.APPROVED=1 AND A.REJECTED=0 AND A.CANCELLED=0 AND B.MODULE_ID=48 AND B.GRN_NO='"+GRNNo+"' AND A.COMPANY_ID="+EITLERPGLOBAL.gCompanyID,FinanceGlobal.FinURL);
                                    rsVoucher.first();
                                    if(rsVoucher.getRow()>0) {
                                        while(!rsVoucher.isAfterLast()) {
                                            String VoucherNo=rsVoucher.getString("VOUCHER_NO");
                                            String VoucherDate=EITLERPGLOBAL.formatDate(rsVoucher.getString("VOUCHER_DATE"));
                                            double VoucherValue=data.getDoubleValueFromDB("SELECT SUM(AMOUNT) FROM D_FIN_VOUCHER_DETAIL WHERE EFFECT='D' AND VOUCHER_NO='"+VoucherNo+"'",FinanceGlobal.FinURL);
                                            
                                            TReportWriter.SimpleDataProvider.TRow objRow=new TReportWriter.SimpleDataProvider.TRow();
                                            objRow.setValue("DOCUMENT_TYPE", "Jobwork");
                                            objRow.setValue("GRN_NO",GRNNo);
                                            objRow.setValue("GRN_DATE",GRNDate);
                                            objRow.setValue("GRN_VALUE",Double.toString(GRNValue));
                                            
                                            double GRN_Cenvate_Amt=0,GRN_Net_Amt=0;
                                            
                                            GRN_Cenvate_Amt=GRNCenvateValue;
                                            GRN_Net_Amt=GRNValue - GRN_Cenvate_Amt;
                                            
                                            objRow.setValue("GRN_CENVATE_AMT",Double.toString(GRN_Cenvate_Amt));
                                            objRow.setValue("GRN_NET_AMT",Double.toString(GRN_Net_Amt));
                                            
                                            objRow.setValue("SUPPLIER_CODE",SupplierCode);
                                            objRow.setValue("SUPPLIER_NAME",SupplierName);
                                            objRow.setValue("VOUCHER_NO",VoucherNo);
                                            objRow.setValue("VOUCHER_DATE",VoucherDate);
                                            objRow.setValue("VOUCHER_VALUE",Double.toString(VoucherValue));
                                            
                                            double Vou_Cenvate_Amt=0,Vou_Net_Amt=0,Difference=0;
                                            String str="";
                                            str = "SELECT SUM(AMOUNT) FROM  D_FIN_VOUCHER_DETAIL WHERE VOUCHER_NO = '"+ VoucherNo +"' " +
                                            " AND MAIN_ACCOUNT_CODE IN ('421014','405021','421038','201193') AND EFFECT='C' GROUP BY VOUCHER_NO";
                                            Vou_Cenvate_Amt = data.getDoubleValueFromDB(str,FinanceGlobal.FinURL);
                                            Vou_Net_Amt = VoucherValue - Vou_Cenvate_Amt;
                                            
                                            objRow.setValue("VOUCHER_CENVATE_AMT", Double.toString(Vou_Cenvate_Amt));
                                            objRow.setValue("VOUCHER_NET_AMT",Double.toString(Vou_Net_Amt));
                                            
                                            Difference = GRN_Net_Amt - Vou_Net_Amt;
                                            objRow.setValue("DIFFERENCE", Double.toString(Difference));
                                            
                                            sumVouValue += VoucherValue;
                                            sumVouCenvateAmt += Vou_Cenvate_Amt;
                                            if (! NewGRNNo.trim().equals(GRN_No.trim())) {
                                                sumGRNValue += GRNValue;
                                                sumGRNCenvateAmt += GRN_Cenvate_Amt;
                                            }
                                            NewGRNNo = GRN_No;
                                            
                                            objData.AddRow(objRow);
                                            
                                            rsVoucher.next();
                                        }
                                    }
                                    else {
                                        
                                        System.out.println(GRNNo);
                                        
                                        TReportWriter.SimpleDataProvider.TRow objRow=new TReportWriter.SimpleDataProvider.TRow();
                                        objRow.setValue("DOCUMENT_TYPE", "Jobwork");
                                        objRow.setValue("GRN_NO",GRNNo);
                                        objRow.setValue("GRN_DATE",GRNDate);
                                        objRow.setValue("GRN_VALUE",Double.toString(GRNValue));
                                        
                                        double GRN_Cenvate_Amt=0,GRN_Net_Amt=0;
                                        
                                        GRN_Cenvate_Amt=GRNCenvateValue;
                                        GRN_Net_Amt=GRNValue - GRN_Cenvate_Amt;
                                        
                                        objRow.setValue("GRN_CENVATE_AMT",Double.toString(GRN_Cenvate_Amt));
                                        objRow.setValue("GRN_NET_AMT",Double.toString(GRN_Net_Amt));
                                        
                                        objRow.setValue("SUPPLIER_CODE",SupplierCode);
                                        objRow.setValue("SUPPLIER_NAME",SupplierName);
                                        objRow.setValue("VOUCHER_NO","");
                                        objRow.setValue("VOUCHER_DATE","0000-00-00");
                                        objRow.setValue("VOUCHER_VALUE","0");
                                        
                                        double Vou_Cenvate_Amt=0,Vou_Net_Amt=0,Difference=0;
                                        Vou_Cenvate_Amt = 0;
                                        Vou_Net_Amt = 0 - Vou_Cenvate_Amt;
                                        
                                        objRow.setValue("VOUCHER_CENVATE_AMT", Double.toString(Vou_Cenvate_Amt));
                                        objRow.setValue("VOUCHER_NET_AMT",Double.toString(Vou_Net_Amt));
                                        
                                        Difference = GRN_Net_Amt - Vou_Net_Amt;
                                        objRow.setValue("DIFFERENCE", Double.toString(Difference));
                                        
                                        if (! NewGRNNo.trim().equals(GRN_No.trim())) {
                                            sumGRNValue += GRNValue;
                                            sumGRNCenvateAmt += GRN_Cenvate_Amt;
                                        }
                                        NewGRNNo = GRN_No;
                                        
                                        objData.AddRow(objRow);
                                    }
                                }
                                rsTmp.next();
                            }
                        }
                    }
                    //================================== END OF JOB WORK ===================================//
                    
                    
                    lblStatus.setVisible(false);
                    Bar.setVisible(false);
                    
                    HashMap Parameters=new HashMap();
                    Parameters.put("FROM_DATE", txtFromDate.getText());
                    Parameters.put("TO_DATE", txtToDate.getText());
                    Parameters.put("S_VOUCHER_VALUE", Double.toString(EITLERPGLOBAL.round(sumVouValue,2)));
                    Parameters.put("S_GRN_VALUE",Double.toString(EITLERPGLOBAL.round(sumGRNValue,2)));
                    Parameters.put("S_GRN_CENVATE_AMT",Double.toString(EITLERPGLOBAL.round(sumGRNCenvateAmt,2)));
                    Parameters.put("S_VOU_CENVATE_AMT",Double.toString(EITLERPGLOBAL.round(sumVouCenvateAmt,2)));
                    //System.out.println("sumVouValue="+sumVouValue);
                    //System.out.println("sumGRNValue="+sumGRNValue);
                    
                    objEngine.PreviewReport("http://"+EITLERPGLOBAL.HostIP+"/EITLERP/Reports/finance/GRNPJVLink1.rpt",Parameters , objData);
                    
                }
                catch(Exception e) {
                    lblStatus.setVisible(false);
                    Bar.setVisible(false);
                    
                    e.printStackTrace();
                }
            };
        }.start();
        
    }
}
