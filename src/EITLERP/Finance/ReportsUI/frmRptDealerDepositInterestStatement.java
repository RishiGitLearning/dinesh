/*
 * frmRptGRNInfo.java
 *
 * Created on April 16, 2008, 12:01 PM
 */

package EITLERP.Finance.ReportsUI;

/**
 *
 * @author  root
 */
import EITLERP.*;
import EITLERP.Finance.*;
import EITLERP.Utils.*;
import EITLERP.Utils.SimpleDataProvider.*;
import javax.swing.*;
import java.awt.*;
import java.sql.*;
import java.net.*;
import java.util.*;
import TReportWriter.*;

public class frmRptDealerDepositInterestStatement extends javax.swing.JApplet {
    
    
    private TReportEngine objEngine=new TReportEngine();
    private TReportWriter.SimpleDataProvider.TTable objData=new TReportWriter.SimpleDataProvider.TTable();
    
    
    /** Initializes the applet frmRptGRNInfo */
    public void init() {
        setSize(400,210);
        initComponents();
        
        
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        buttonGroup1 = new javax.swing.ButtonGroup();
        jPanel3 = new javax.swing.JPanel();
        lblInfo = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        txtAsOnDate = new javax.swing.JTextField();
        cmdPreview = new javax.swing.JButton();
        jPanel4 = new javax.swing.JPanel();
        jLabel8 = new javax.swing.JLabel();
        jrbDD = new javax.swing.JRadioButton();
        jrbND = new javax.swing.JRadioButton();
        jrbSL = new javax.swing.JRadioButton();

        getContentPane().setLayout(null);

        addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                formMouseClicked(evt);
            }
        });

        jPanel3.setLayout(null);

        jPanel3.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        jPanel3.add(lblInfo);
        lblInfo.setBounds(0, 2, 400, 20);

        getContentPane().add(jPanel3);
        jPanel3.setBounds(0, 180, 400, 30);

        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel2.setText("As On Date:");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(20, 70, 90, 20);

        txtAsOnDate.setColumns(10);
        txtAsOnDate.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtAsOnDateFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtAsOnDateFocusLost(evt);
            }
        });

        getContentPane().add(txtAsOnDate);
        txtAsOnDate.setBounds(120, 70, 150, 19);

        cmdPreview.setText("Preview Report");
        cmdPreview.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdPreviewActionPerformed(evt);
            }
        });

        getContentPane().add(cmdPreview);
        cmdPreview.setBounds(120, 130, 130, 25);

        jPanel4.setLayout(null);

        jPanel4.setBackground(new java.awt.Color(0, 153, 204));
        jPanel4.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        jLabel8.setText("DEALER DEPOSIT INTEREST STATEMENT");
        jPanel4.add(jLabel8);
        jLabel8.setBounds(10, 10, 290, 20);

        getContentPane().add(jPanel4);
        jPanel4.setBounds(0, 0, 400, 40);

        jrbDD.setSelected(true);
        jrbDD.setText("DD");
        buttonGroup1.add(jrbDD);
        getContentPane().add(jrbDD);
        jrbDD.setBounds(120, 100, 45, 23);

        jrbND.setText("ND");
        buttonGroup1.add(jrbND);
        getContentPane().add(jrbND);
        jrbND.setBounds(180, 100, 50, 23);

        jrbSL.setText("SL");
        buttonGroup1.add(jrbSL);
        getContentPane().add(jrbSL);
        jrbSL.setBounds(240, 100, 40, 23);

    }//GEN-END:initComponents
    
    private void txtAsOnDateFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtAsOnDateFocusLost
        // TODO add your handling code here:
        lblInfo.setText("");
    }//GEN-LAST:event_txtAsOnDateFocusLost
    
    private void txtAsOnDateFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtAsOnDateFocusGained
        // TODO add your handling code here:
        lblInfo.setText("Please Enter the As On Date");
    }//GEN-LAST:event_txtAsOnDateFocusGained
    
    private void formMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_formMouseClicked
    
    private void cmdPreviewActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdPreviewActionPerformed
        // TODO add your handling code here:
        if ( ! Validate()) {
            return;
        }
        
        GenerateReport();
    }//GEN-LAST:event_cmdPreviewActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.JButton cmdPreview;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JRadioButton jrbDD;
    private javax.swing.JRadioButton jrbND;
    private javax.swing.JRadioButton jrbSL;
    private javax.swing.JLabel lblInfo;
    private javax.swing.JTextField txtAsOnDate;
    // End of variables declaration//GEN-END:variables
    
    private void GenerateReport() {
        try {
            TReportWriter.SimpleDataProvider.TRow objRow;
            TReportWriter.SimpleDataProvider.TTable objReportData=new TReportWriter.SimpleDataProvider.TTable();
            
            objReportData.AddColumn("SR_NO");
            objReportData.AddColumn("TYPE");
            objReportData.AddColumn("RECEIPT_NO");
            objReportData.AddColumn("PARTY_CODE");
            objReportData.AddColumn("PARTY_NAME");
            objReportData.AddColumn("STATION");
            objReportData.AddColumn("EFFECTIVE_DATE");
            objReportData.AddColumn("DAYS");
            objReportData.AddColumn("AMOUNT");
            objReportData.AddColumn("GROSS_INTEREST");
            objReportData.AddColumn("TDS_AMOUNT");
            objReportData.AddColumn("NET_AMOUNT");
            objReportData.AddColumn("REMARK");
            objReportData.AddColumn("WARRANT_NO");
            objReportData.AddColumn("INTEREST_MAIN_CODE");
            
            
            
            TReportWriter.SimpleDataProvider.TRow objOpeningRow=objReportData.newRow();
            objOpeningRow.setValue("SR_NO","");
            objOpeningRow.setValue("TYPE","");
            objOpeningRow.setValue("RECEIPT_NO","");
            objOpeningRow.setValue("PARTY_CODE","");
            objOpeningRow.setValue("PARTY_NAME","");
            objOpeningRow.setValue("STATION","");
            objOpeningRow.setValue("EFFECTIVE_DATE","0000-00-00");
            objOpeningRow.setValue("DAYS","");
            objOpeningRow.setValue("AMOUNT","");
            objOpeningRow.setValue("GROSS_INTEREST","");
            objOpeningRow.setValue("TDS_AMOUNT","");
            objOpeningRow.setValue("NET_AMOUNT","");
            objOpeningRow.setValue("REMARK","");
            objOpeningRow.setValue("WARRANT_NO","");
            objOpeningRow.setValue("INTEREST_MAIN_CODE","");
            
            String dbUrl= FinanceGlobal.FinURL;
            String strSQL = "SELECT DOC_NO FROM D_FD_SALES_INTEREST_HEADER WHERE EFFECTIVE_DATE <= '" + EITLERPGLOBAL.formatDateDB(txtAsOnDate.getText().trim()) + "' ORDER BY EFFECTIVE_DATE DESC";
            String Doc_No = data.getStringValueFromDB(strSQL,dbUrl);
            
            strSQL = "SELECT DOC_DATE FROM D_FD_SALES_INTEREST_HEADER WHERE EFFECTIVE_DATE <= '" + EITLERPGLOBAL.formatDateDB(txtAsOnDate.getText().trim()) + "' ORDER BY EFFECTIVE_DATE DESC";
            String Doc_Date = data.getStringValueFromDB(strSQL,dbUrl);
            String main_code="";
            
            if(jrbDD.isSelected()) {
                main_code="133155";
            }
            else if(jrbND.isSelected()) {
                main_code="133203";
            }
            else if(jrbSL.isSelected()) {
                main_code="133162";
            }
            strSQL="SELECT A.RECEIPT_NO,A.PARTY_CODE,C.EFFECTIVE_DATE, "+
            "C.AMOUNT,A.GROSS_INTEREST,A.TDS_AMOUNT,A.NET_INTEREST,A.INTEREST_MAIN_CODE "+
            "FROM D_FD_SALES_INTEREST_DETAIL A,D_FD_SALES_DEPOSIT_MASTER C "+
            "WHERE DOC_NO = '" + Doc_No + "' AND A.RECEIPT_NO = C.RECEIPT_NO AND A.INTEREST_MAIN_CODE = '" + main_code + "' "+
            "ORDER BY A.PARTY_CODE ";
            
            ResultSet rsTmp=data.getResult(strSQL,dbUrl);
            ResultSet rsparty;
            rsTmp.first();
            
            int Counter = 0;
            String type="",party_name="",station="",Effective_date="";
            if(rsTmp.getRow()>0) {
                while(!rsTmp.isAfterLast()) {
                    Counter ++;
                    objRow=objReportData.newRow();
                    
                    if(UtilFunctions.getString(rsTmp,"INTEREST_MAIN_CODE","").equals("133155")) {
                        type="DD";
                    }
                    else if(UtilFunctions.getString(rsTmp,"INTEREST_MAIN_CODE","").equals("133203")) {
                        type="ND";
                    }
                    else if(UtilFunctions.getString(rsTmp,"INTEREST_MAIN_CODE","").equals("133162")) {
                        type="SL";
                    }
                    
                    objRow.setValue("SR_NO",Integer.toString(Counter));
                    objRow.setValue("TYPE",type);
                    objRow.setValue("RECEIPT_NO",UtilFunctions.getString(rsTmp,"RECEIPT_NO",""));
                    objRow.setValue("PARTY_CODE",UtilFunctions.getString(rsTmp,"PARTY_CODE",""));
                    
                    strSQL="SELECT PARTY_NAME,CITY "+
                    "FROM D_FIN_PARTY_MASTER WHERE PARTY_CODE ='" + UtilFunctions.getString(rsTmp,"PARTY_CODE","") + "' AND MAIN_ACCOUNT_CODE='" + UtilFunctions.getString(rsTmp,"INTEREST_MAIN_CODE","") + "' ";
                    rsparty = data.getResult(strSQL,dbUrl);
                    
                    //System.out.println(rsTmp.getString("PARTY_CODE")+rsparty.getString("PARTY_NAME"));
                    objRow.setValue("PARTY_NAME",UtilFunctions.getString(rsparty,"PARTY_NAME",""));
                    
                    objRow.setValue("STATION",UtilFunctions.getString(rsparty,"CITY",""));
                    
                    objRow.setValue("EFFECTIVE_DATE",EITLERPGLOBAL.formatDate(UtilFunctions.getString(rsTmp,"EFFECTIVE_DATE","0000-00-00")));
                    
                    Effective_date= EITLERPGLOBAL.formatDate(UtilFunctions.getString(rsTmp,"EFFECTIVE_DATE","0000-00-00"));
                    
                    String from_date = "01/04/" + String.valueOf(Integer.parseInt(txtAsOnDate.getText().trim().substring(6))-1);
                    if(EITLERPGLOBAL.compareDate(Effective_date,from_date) == -1) {
                        objRow.setValue("DAYS",String.valueOf(EITLERPGLOBAL.getDayDifference(from_date,txtAsOnDate.getText().trim(),"dd/MM/yyyy")+1));
                    }
                    else {
                        try{
                            objRow.setValue("DAYS",String.valueOf(EITLERPGLOBAL.getDayDifference(Effective_date,txtAsOnDate.getText().trim(),"dd/MM/yyyy")+1));
                        }
                        catch(Exception e)
                        {
                            objRow.setValue("DAYS","");
                        }
                        
                    }
                    objRow.setValue("AMOUNT",UtilFunctions.getString(rsTmp,"AMOUNT",""));
                    objRow.setValue("GROSS_INTEREST",UtilFunctions.getString(rsTmp,"GROSS_INTEREST",""));
                    objRow.setValue("TDS_AMOUNT",UtilFunctions.getString(rsTmp,"TDS_AMOUNT",""));
                    objRow.setValue("NET_AMOUNT",UtilFunctions.getString(rsTmp,"NET_INTEREST",""));
                    objRow.setValue("REMARK","");
                    objRow.setValue("WARRANT_NO","");
                    objRow.setValue("INTEREST_MAIN_CODE",UtilFunctions.getString(rsTmp,"INTEREST_MAIN_CODE",""));
                    
                    objReportData.AddRow(objRow);
                    
                    rsTmp.next();
                }
            }
            
            int Comp_ID = EITLERPGLOBAL.gCompanyID;
            HashMap Parameters=new HashMap();
            
            Parameters.put("AS_ON_DATE",EITLERPGLOBAL.formatDate(Doc_Date));
            Parameters.put("SYS_DATE",EITLERPGLOBAL.getCurrentDate());
            
            
            objEngine.PreviewReport("http://"+EITLERPGLOBAL.HostIP+"/EITLERP/Reports/finance/rptDealerDepositInterestStatement.rpt",Parameters,objReportData);
            
            
        }
        catch(Exception e) {
            e.printStackTrace();
        }
    }
    
    private boolean Validate() {
        //Form level validations
        
        if(txtAsOnDate.getText().trim().equals("")) {
            JOptionPane.showMessageDialog(null,"Please Enter Date");
            return false;
        } else if(!EITLERPGLOBAL.isDate(txtAsOnDate.getText())) {
            JOptionPane.showMessageDialog(null,"Invalid From Date in DD/MM/YYYY format.");
            return false;
        }
        return true;
    }
    
}
