/*
 * frmVoucherDateUpdation.java
 *
 * Created on January 20, 2008, 4:00 PM
 */

package EITLERP.Finance.ReportsUI;

/**
 *
 * @author  root
 *
 * Modified by vivek on 01/04/2014 due to code change issue on each financial year begining.
 * 
 */
import javax.swing.*;
import java.awt.*;
import java.util.*;
import java.net.*;
import java.sql.*;
import EITLERP.*;
import EITLERP.Finance.*;

public class frmVoucherDateUpdation extends javax.swing.JApplet {
    /** Initializes the applet frmVoucherDateUpdation */
    public void init() {
        setSize(424,200);
        initComponents();
        
        lblAdminNote.setVisible(false); //new code by vivek on 01/04/2014.
        txtVoucherDate.setText("31/03/"+EITLERPGLOBAL.getCurrentFinYear()); //new code by vivek on 01/04/2014
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        lblTitle = new javax.swing.JLabel();
        lblVoucherFrom = new javax.swing.JLabel();
        txtVoucherNoFrom = new javax.swing.JTextField();
        txtVoucherNoTo = new javax.swing.JTextField();
        lblVoucherTo = new javax.swing.JLabel();
        lblVoucherDate = new javax.swing.JLabel();
        txtVoucherDate = new javax.swing.JTextField();
        cmdUpdate = new javax.swing.JButton();
        cmdExit = new javax.swing.JButton();
        lblAdminNote = new javax.swing.JLabel();

        getContentPane().setLayout(null);

        lblTitle.setBackground(new java.awt.Color(0, 102, 153));
        lblTitle.setForeground(java.awt.Color.white);
        lblTitle.setText(" VOUCHER DATE UPDATION FOR MARCH CLOSING ONLY");
        lblTitle.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        lblTitle.setOpaque(true);
        getContentPane().add(lblTitle);
        lblTitle.setBounds(5, 1, 390, 25);

        lblVoucherFrom.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblVoucherFrom.setText("Voucher No. From :");
        getContentPane().add(lblVoucherFrom);
        lblVoucherFrom.setBounds(5, 40, 120, 15);

        getContentPane().add(txtVoucherNoFrom);
        txtVoucherNoFrom.setBounds(130, 39, 110, 19);

        getContentPane().add(txtVoucherNoTo);
        txtVoucherNoTo.setBounds(275, 40, 110, 19);

        lblVoucherTo.setText("To :");
        getContentPane().add(lblVoucherTo);
        lblVoucherTo.setBounds(245, 41, 25, 15);

        lblVoucherDate.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        lblVoucherDate.setText("Date To Be Post :");
        getContentPane().add(lblVoucherDate);
        lblVoucherDate.setBounds(5, 73, 120, 15);

        txtVoucherDate.setEditable(false);
        txtVoucherDate.setText("31/03/2103");
        getContentPane().add(txtVoucherDate);
        txtVoucherDate.setBounds(130, 70, 110, 19);

        cmdUpdate.setText("Update");
        cmdUpdate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdUpdateActionPerformed(evt);
            }
        });

        getContentPane().add(cmdUpdate);
        cmdUpdate.setBounds(70, 100, 80, 25);

        cmdExit.setText("Exit");
        cmdExit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdExitActionPerformed(evt);
            }
        });

        getContentPane().add(cmdExit);
        cmdExit.setBounds(160, 100, 80, 25);

        lblAdminNote.setText("<html> <font color=RED> Administrator has to change Hard coded date to be post  <br> for new F.A. year when change and in validations of this form</font></html>");
        getContentPane().add(lblAdminNote);
        lblAdminNote.setBounds(10, 135, 380, 50);

    }//GEN-END:initComponents
    
    private void cmdExitActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdExitActionPerformed
        // TODO add your handling code here:
        try {
            ((JFrame)getParent().getParent().getParent().getParent()).dispose();
        }
        catch(Exception e) {
        }
    }//GEN-LAST:event_cmdExitActionPerformed
    
    private void cmdUpdateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdUpdateActionPerformed
        // TODO add your handling code here:
        try {
            String strCondition="",strSQL="";
            String VoucherDate = EITLERPGLOBAL.formatDateDB(txtVoucherDate.getText().trim());
            if(txtVoucherNoFrom.getText().trim().equals("")) {
                JOptionPane.showMessageDialog(this,"Please enter from voucher no.");
                return;
            }
            
            if(txtVoucherNoTo.getText().trim().equals("")) {
                JOptionPane.showMessageDialog(this,"Please enter to voucher no.");
                return;
            }
            
            if(!txtVoucherNoFrom.getText().trim().equals("")) {
                strCondition+="AND A.VOUCHER_NO>='"+txtVoucherNoFrom.getText()+"' ";
            }
            
            if(!txtVoucherNoTo.getText().trim().equals("")) {
                strCondition+="AND A.VOUCHER_NO<='"+txtVoucherNoTo.getText()+"' ";
            }
            
            strSQL="SELECT DISTINCT(A.VOUCHER_NO) AS VOUCHER_NO FROM D_FIN_VOUCHER_HEADER A,D_FIN_VOUCHER_DETAIL B WHERE A.VOUCHER_NO=B.VOUCHER_NO " +
            "AND A.COMPANY_ID=B.COMPANY_ID "+strCondition+" AND A.APPROVED=1 AND A.CANCELLED=0 ORDER BY A.VOUCHER_NO"; //AND A.APPROVED=0
            System.out.println(strSQL);
            ResultSet rsTmp=data.getResult(strSQL,FinanceGlobal.FinURL);
            rsTmp.first();
            boolean Found =false;
            if(rsTmp.getRow()>0) {
                while(!rsTmp.isAfterLast()) {
                    String VoucherNo=rsTmp.getString("VOUCHER_NO");
                    String Qry = "SELECT * FROM D_FIN_VOUCHER_HEADER WHERE (VOUCHER_TYPE IN ("+FinanceGlobal.TYPE_PAYMENT+","+FinanceGlobal.TYPE_PAYMENT_2+","+FinanceGlobal.TYPE_PJV +")  OR (VOUCHER_TYPE IN (9) AND SUBSTRING(VOUCHER_NO,1,2)='PY')) " +
                    "AND VOUCHER_NO='"+ VoucherNo +"' AND APPROVED=1 " +
                    //"AND CANCELLED=0 AND VOUCHER_DATE>='2011-04-01' AND SUBSTRING(VOUCHER_NO,3,2)<>'10' "; change as per Mr.chokshi's Updation dated on 04/04/2011
                    // "AND CANCELLED=0 AND SUBSTRING(VOUCHER_NO,3,2)='11' AND VOUCHER_DATE>='2012-04-01'";
                    // "AND CANCELLED=0 AND SUBSTRING(VOUCHER_NO,3,2)='12' AND VOUCHER_DATE >='2013-04-01'";
                    
                    //"AND CANCELLED=0 AND SUBSTRING(VOUCHER_NO,3,2)='13' AND VOUCHER_DATE >='2014-04-01'"; //old code by vivek on 01/04/2014
                    
                    //new line of code by vivek on 01/04/2014
                    "AND CANCELLED=0 AND SUBSTRING(VOUCHER_NO,3,2)='"+Integer.toString(EITLERPGLOBAL.getCurrentFinYear()-1).substring(2,4)+"' AND VOUCHER_DATE >='"+EITLERPGLOBAL.getCurrentFinYear()+"-04-01'";
                    System.out.println(Qry);
                    if(!data.IsRecordExist(Qry,FinanceGlobal.FinURL)) {
                        String Msg = "Please check voucher no. ("+VoucherNo+"). " +
                        "It may have one of following problem. " +
                        "\n 1. It is not final approved document. " +
                        
                        //"\n 2. It is having date less then 01/04/2014." + //commented by vivek on 01/04/2014
                        //"\n 3. It is created in 2014-2015 F.A. year. " + //commented by vivek on 01/04/2014
                        
                        "\n 2. It is having date less then 01/04/"+EITLERPGLOBAL.getCurrentFinYear()+"." + //new code by vivek on 01/04/2014
                        "\n 3. It is created in "+EITLERPGLOBAL.getCurrentFinYear()+"-"+(EITLERPGLOBAL.getCurrentFinYear()+1)+" F.A. year. " + //new code by vivek on 01/04/2014
                        
                        "\n 4. It is not Purchase Journal Voucher/Payment Voucher.";
                        JOptionPane.showMessageDialog(this,Msg);
                        Found =true;
                        return;
                    }
                    rsTmp.next();
                }
            } else {
                JOptionPane.showMessageDialog(this,"No record found.");
                return;
            }
            
            if(Found) {
                return;
            }
            
            rsTmp.first();
            
            if(rsTmp.getRow()>0) {
                while(!rsTmp.isAfterLast()) {
                    String VoucherNo=rsTmp.getString("VOUCHER_NO");
                    data.Execute("UPDATE D_FIN_VOUCHER_HEADER SET VOUCHER_DATE='"+VoucherDate+"', LEGACY_DATE='"+VoucherDate+"' WHERE VOUCHER_NO='"+VoucherNo+"' ",FinanceGlobal.FinURL);
                    rsTmp.next();
                }
            }
        } catch(Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_cmdUpdateActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton cmdExit;
    private javax.swing.JButton cmdUpdate;
    private javax.swing.JLabel lblAdminNote;
    private javax.swing.JLabel lblTitle;
    private javax.swing.JLabel lblVoucherDate;
    private javax.swing.JLabel lblVoucherFrom;
    private javax.swing.JLabel lblVoucherTo;
    private javax.swing.JTextField txtVoucherDate;
    private javax.swing.JTextField txtVoucherNoFrom;
    private javax.swing.JTextField txtVoucherNoTo;
    // End of variables declaration//GEN-END:variables
    
}
