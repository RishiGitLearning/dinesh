/*
 * frmRptDeptWiseComparison.java
 *
 * Created on March 20, 2010, 2:36 PM
 */

package EITLERP.Finance.ReportsUI;

import EITLERP.*;
import java.sql.*;
import EITLERP.Utils.*;
import EITLERP.Utils.SimpleDataProvider.*;
import TReportWriter.*;
import java.util.*;
import javax.swing.*;
import EITLERP.Finance.*;
import java.math.BigDecimal;
/**
 *
 * @author  root
 */
public class frmRptFASAnnualReportIT extends javax.swing.JApplet {
    
    private EITLComboModel cmbFirstYearModel=new EITLComboModel();
    
    
    private TReportEngine objEngine=new TReportEngine();
    private TReportWriter.SimpleDataProvider.TTable objData=new TReportWriter.SimpleDataProvider.TTable();
    
    /** Initializes the applet frmRptDeptWiseComparison */
    public void init() {
        setSize(400,200);
        initComponents();
        GenerateCombo();
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        cmbFirstYear = new javax.swing.JComboBox();
        jLabel2 = new javax.swing.JLabel();
        cmdpreview = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();

        getContentPane().setLayout(null);

        getContentPane().add(cmbFirstYear);
        cmbFirstYear.setBounds(110, 50, 160, 25);

        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel2.setText("Select Year :");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(10, 50, 90, 25);

        cmdpreview.setText("Preview");
        cmdpreview.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdpreviewActionPerformed(evt);
            }
        });

        getContentPane().add(cmdpreview);
        cmdpreview.setBounds(170, 110, 82, 25);

        jLabel1.setBackground(new java.awt.Color(0, 51, 255));
        jLabel1.setForeground(new java.awt.Color(255, 255, 255));
        jLabel1.setText("Fixed Asset Addition Report");
        jLabel1.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        jLabel1.setOpaque(true);
        getContentPane().add(jLabel1);
        jLabel1.setBounds(0, 0, 400, 27);

    }//GEN-END:initComponents
    
    private void cmdpreviewActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdpreviewActionPerformed
        // TODO add your handling code here:
        GenerateReport();
    }//GEN-LAST:event_cmdpreviewActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JComboBox cmbFirstYear;
    private javax.swing.JButton cmdpreview;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    // End of variables declaration//GEN-END:variables
    private void GenerateReport() {
        
        try {
            TReportWriter.SimpleDataProvider.TRow objRow;
            TReportWriter.SimpleDataProvider.TTable objReportData=new TReportWriter.SimpleDataProvider.TTable();
            String Condition = "";
            
            if(EITLERPGLOBAL.getComboCode(cmbFirstYear)==0) {
                JOptionPane.showMessageDialog(null,"Please Select The Year");
                
                return;
            }
            objReportData.AddColumn("COMPANY_ID");
            objReportData.AddColumn("SR_NO");
            objReportData.AddColumn("MAIN_ACCOUNT_CODE");
            objReportData.AddColumn("ACCOUNT_NAME");
            objReportData.AddColumn("ASSET_NO");
            objReportData.AddColumn("ASSET_DATE");
            objReportData.AddColumn("ITEM_ID");
            objReportData.AddColumn("ITEM_DESC");
            objReportData.AddColumn("VOUCHER_NO");
            objReportData.AddColumn("VOUCHER_DATE");
            objReportData.AddColumn("GRN_NO");
            objReportData.AddColumn("GRN_DATE");
            objReportData.AddColumn("AMOUNT");
            objReportData.AddColumn("FROM_DATE");
            objReportData.AddColumn("TO_DATE");
            objReportData.AddColumn("MONTHS");
            objReportData.AddColumn("DEPRN_PER");
            objReportData.AddColumn("DEPRN_AMOUNT");
            objReportData.AddColumn("REMARKS");
            
            
            TReportWriter.SimpleDataProvider.TRow objOpeningRow=objReportData.newRow();
            
            
            objOpeningRow.setValue("COMPANY_ID","");
            objOpeningRow.setValue("SR_NO","");
            objOpeningRow.setValue("MAIN_ACCOUNT_CODE","");
            objOpeningRow.setValue("ACCOUNT_NAME","");
            objOpeningRow.setValue("ASSET_NO","");
            objOpeningRow.setValue("ASSET_DATE","0000-00-00");
            objOpeningRow.setValue("ITEM_ID","");
            objOpeningRow.setValue("ITEM_DESC","");
            objOpeningRow.setValue("VOUCHER_NO","");
            objOpeningRow.setValue("VOUCHER_DATE","0000-00-00");
            objOpeningRow.setValue("GRN_NO","");
            objOpeningRow.setValue("GRN_DATE","0000-00-00");
            objOpeningRow.setValue("AMOUNT","");
            objOpeningRow.setValue("FROM_DATE","0000-00-00");
            objOpeningRow.setValue("TO_DATE","0000-00-00");
            objOpeningRow.setValue("MONTHS","");
            objOpeningRow.setValue("DEPRN_PER","");
            objOpeningRow.setValue("DEPRN_AMOUNT","");
            objOpeningRow.setValue("REMARKS","");
            //            objOpeningRow.setValue("TOTAL","");
            
            String Year = String.valueOf(EITLERPGLOBAL.getComboCode(cmbFirstYear));
            
            //2052006
            String FromDate=Year.substring(0,4)+"-04-01";
            String ToDate=Year.substring(4)+"-03-31";
            //String FromDate="2004-04-01";
            //String ToDate="2005-03-31";
            
            String strQry="SELECT DISTINCT MAIN_ACCOUNT_CODE FROM D_FAS_MASTER_HEADER "+
            "WHERE ( ASSET_DATE >='" + FromDate + "' AND ASSET_DATE<='" + ToDate + "')  " +
            "AND APPROVED = 0 AND CANCELLED = 0 "+
            "UNION "+
            "SELECT DISTINCT A.MAIN_ACCOUNT_CODE "+
            "FROM D_FAS_MASTER_HEADER A,D_FAS_MASTER_DETAIL_EX C "+
            "WHERE A.ASSET_NO = C.ASSET_NO  "+
            "AND A.APPROVED = 0 AND A.CANCELLED = 0 "+
            "AND C.TYPE = 2 AND C.DEPRECIATION_FROM_DATE >='" + FromDate + "'  AND C.DEPRECIATION_TO_DATE<='" + ToDate + "'  ";
            
            System.out.println(strQry);
            
            
            
            
            ResultSet rsMainAccountCode = data.getResult(strQry,FinanceGlobal.FinURL);
            rsMainAccountCode.first();
            int cnt=0;
            if(rsMainAccountCode.getRow()>0) {
                
                while(!rsMainAccountCode.isAfterLast()) {
                    
                    
                    strQry="SELECT SUM(C.OPENING_BALANCE) "+
                    "FROM D_FAS_MASTER_HEADER A,D_FAS_MASTER_DETAIL B,D_FAS_MASTER_DETAIL_EX C "+
                    "WHERE A.COMPANY_ID = '" + EITLERPGLOBAL.gCompanyID + "' AND A.ASSET_NO = B.ASSET_NO AND A.ASSET_NO = C.ASSET_NO AND B.SR_NO = C.SR_NO "+
                    "AND A.APPROVED = 0 AND A.CANCELLED = 0 AND A.MAIN_ACCOUNT_CODE = '" + rsMainAccountCode.getString("MAIN_ACCOUNT_CODE") + "' "+
                    "AND C.TYPE = 2 AND C.DEPRECIATION_FROM_DATE >='" + FromDate + "' AND C.DEPRECIATION_TO_DATE<='" + ToDate + "' ";
                    
                    BigDecimal OpeningValue = new BigDecimal(data.getDoubleValueFromDB(strQry,FinanceGlobal.FinURL));
                    
                    strQry="SELECT SUM(B.AMOUNT) "+
                    "FROM D_FAS_SALE_HEADER A,D_FAS_SALE_DETAIL B,D_FAS_MASTER_HEADER C "+
                    "WHERE A.APPROVED =1 AND A.CANCELLED = 0 AND A.COMPANY_ID = '" + EITLERPGLOBAL.gCompanyID + "' AND A.SALE_NO = B.SALE_NO AND A.DOC_DATE >='" + FromDate + "' AND A.DOC_DATE <='" + ToDate + "' "+
                    "AND B.ASSET_NO = C.ASSET_NO AND C.MAIN_ACCOUNT_CODE = '" + rsMainAccountCode.getString("MAIN_ACCOUNT_CODE") + "' "+
                    "ORDER BY C.MAIN_ACCOUNT_CODE,B.ITEM_ID";
                    
                    BigDecimal SaleValue = new BigDecimal(data.getDoubleValueFromDB(strQry,FinanceGlobal.FinURL));
                    
                    BigDecimal NetBlock = new BigDecimal(OpeningValue.doubleValue() - SaleValue.doubleValue());
                    
                    strQry="SELECT  SUM(B.AMOUNT) FROM D_FAS_MASTER_HEADER A, D_FAS_MASTER_DETAIL B "+
                    "WHERE A.ASSET_NO = B.ASSET_NO  AND A.APPROVED = 0 AND A.CANCELLED = 0 AND A.MAIN_ACCOUNT_CODE = '" + rsMainAccountCode.getString("MAIN_ACCOUNT_CODE") + "' "+
                    "AND A.COMPANY_ID ='" + EITLERPGLOBAL.gCompanyID + "' AND A.ASSET_DATE>='" + FromDate + "' AND A.ASSET_DATE<= DATE_ADD(LAST_DAY('" + FromDate + "'),INTERVAL 6 MONTH) ";
                    
                    BigDecimal AdditionFirst = new BigDecimal(data.getDoubleValueFromDB(strQry,FinanceGlobal.FinURL));
                    
                    strQry="SELECT  SUM(B.AMOUNT) FROM D_FAS_MASTER_HEADER A, D_FAS_MASTER_DETAIL B "+
                    "WHERE A.ASSET_NO = B.ASSET_NO  AND A.APPROVED = 0 AND A.CANCELLED = 0 AND A.MAIN_ACCOUNT_CODE = '" + rsMainAccountCode.getString("MAIN_ACCOUNT_CODE") + "' "+
                    "AND A.COMPANY_ID ='" + EITLERPGLOBAL.gCompanyID + "' AND A.ASSET_DATE> DATE_ADD(LAST_DAY('" + FromDate + "'),INTERVAL 6 MONTH) AND A.ASSET_DATE<= '" + ToDate + "' ";
                    
                    BigDecimal AdditionSecond = new BigDecimal(data.getDoubleValueFromDB(strQry,FinanceGlobal.FinURL));
                    
                    
                    BigDecimal TotalBlock = new BigDecimal(NetBlock.doubleValue() + AdditionFirst.doubleValue() +AdditionSecond.doubleValue());
                    
                    System.out.println("Main AccountCode = " + rsMainAccountCode.getString("MAIN_ACCOUNT_CODE") + " Opening: " + OpeningValue + " Sale Value:" + SaleValue + " Net Block: " + NetBlock );
                    System.out.println("Addition First=" + AdditionFirst +" Second= " + AdditionSecond + " TotalBlock=" + TotalBlock );
                    rsMainAccountCode.next();
                }
            }
            HashMap Parameters=new HashMap();
            if(EITLERPGLOBAL.gCompanyID==2) {
                Parameters.put("CITY","BARODA");
            }
            else {
                Parameters.put("CITY","ANKLESHWAR");
            }
            
            Parameters.put("COMPANY_ID",Integer.toString(EITLERPGLOBAL.gCompanyID));
            Parameters.put("SYS_DATE",EITLERPGLOBAL.getCurrentDate());
            Parameters.put("YEAR",Year.substring(0,4)+"-"+Year.substring(4));
            Parameters.put("SYS_DATE",EITLERPGLOBAL.getCurrentDate());
            
            //Parameters.put("FIRSTYEAR1",FirstYear1.substring(2));
            //Parameters.put("FIRSTYEAR2",FirstYear2.substring(2));
            //Parameters.put("SECONDYEAR1",SecondYear1.substring(2));
            //            Parameters.put("SECONDYEAR2",SecondYear2.substring(2));
            
            
            
            //objEngine.PreviewReport("http://"+EITLERPGLOBAL.HostIP+"/EITLERP/Reports/finance/rptFASAddition.rpt",Parameters,objReportData);
            
        }catch(Exception e) {
            e.printStackTrace();
        }
        
        //System.out.println("");
    }
    
    private void GenerateCombo() {
        
        cmbFirstYearModel=new EITLComboModel();
        cmbFirstYear.removeAll();
        cmbFirstYear.setModel(cmbFirstYearModel);
        
        
        
        
        
        
        String Qry = "SELECT YEAR_FROM,YEAR_TO FROM D_COM_FIN_YEAR WHERE COMPANY_ID = " + EITLERPGLOBAL.gCompanyID + " ";
        try{
            ComboData objData;
            objData=new ComboData();
            objData.Code=0;
            objData.Text="-Please Select Year-";
            cmbFirstYearModel.addElement(objData);
            
            ResultSet rs = data.getResult(Qry);
            
            while(rs.next()) {
                objData=new ComboData();
                objData.Code=Long.parseLong(rs.getString("YEAR_FROM")+rs.getString("YEAR_TO"));
                objData.Text=rs.getString("YEAR_FROM")+"-"+rs.getString("YEAR_TO");
                cmbFirstYearModel.addElement(objData);
                
                
            }
        }
        catch(Exception e) {
            
        }
    }
}
