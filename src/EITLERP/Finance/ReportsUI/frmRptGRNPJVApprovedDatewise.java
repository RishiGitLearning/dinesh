/*
 * frmGRNPJVApprovedDAtewise.java
 *
 * Created on July 13, 2005, 10:47 AM
 */

package EITLERP.Finance.ReportsUI;

import EITLERP.*;
import EITLERP.Stores.*;
import EITLERP.Purchase.*;
import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.util.*;
import java.sql.*;
import java.net.*;
import java.text.DecimalFormat;
import EITLERP.Finance.*;
import TReportWriter.*;
import java.io.File;

/**
 *
 * @author  root
 */
public class frmRptGRNPJVApprovedDatewise extends javax.swing.JApplet {
    
    private EITLTableModel DataModelI=new EITLTableModel();
    DecimalFormat dFormat=new DecimalFormat("###0.00");
    
    private EITLComboModel cmbDeptModel=new EITLComboModel();
    private EITLComboModel cmbApprovalModel=new EITLComboModel();
    public clsExcelExporter export = new clsExcelExporter();
    
    /** Initializes the applet frmIndentsInfo */
    public void init() {
        setSize(1000, 650);
        initComponents();
        GenerateCombo();
        FormatGridI();
        
        
        //EITLERPGLOBAL.setComboIndex(cmbBuyer,EITLERPGLOBAL.gUserID);

    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        ExporttoExcelFileChooser = new javax.swing.JFileChooser();
        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel2 = new javax.swing.JPanel();
        cmdShowI = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        TableI = new javax.swing.JTable();
        jButton1 = new javax.swing.JButton();
        txtFromDate = new javax.swing.JTextField();
        txtToDate = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();

        addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                formMouseClicked(evt);
            }
        });
        getContentPane().setLayout(null);

        jPanel1.setBackground(new java.awt.Color(0, 102, 255));
        jPanel1.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        jPanel1.setMinimumSize(new java.awt.Dimension(1000, 29));
        jPanel1.setLayout(null);

        jLabel1.setForeground(new java.awt.Color(255, 255, 255));
        jLabel1.setText("GRN PJV Approved Datewise");
        jPanel1.add(jLabel1);
        jLabel1.setBounds(2, 4, 410, 20);

        getContentPane().add(jPanel1);
        jPanel1.setBounds(2, 2, 990, 29);

        jTabbedPane1.setAutoscrolls(true);
        jTabbedPane1.setDebugGraphicsOptions(javax.swing.DebugGraphics.NONE_OPTION);

        jPanel2.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel2.setLayout(null);

        cmdShowI.setText("Show List");
        cmdShowI.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdShowIActionPerformed(evt);
            }
        });
        jPanel2.add(cmdShowI);
        cmdShowI.setBounds(810, 10, 118, 27);

        TableI.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        TableI.setAutoResizeMode(javax.swing.JTable.AUTO_RESIZE_LAST_COLUMN);
        jScrollPane1.setViewportView(TableI);

        jPanel2.add(jScrollPane1);
        jScrollPane1.setBounds(9, 48, 920, 320);

        jButton1.setText("Export to Excel");
        jButton1.setMargin(new java.awt.Insets(2, 2, 2, 2));
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        jPanel2.add(jButton1);
        jButton1.setBounds(490, 390, 120, 31);

        jTabbedPane1.addTab("Information", jPanel2);

        getContentPane().add(jTabbedPane1);
        jTabbedPane1.setBounds(6, 79, 960, 570);
        jTabbedPane1.getAccessibleContext().setAccessibleName("Pending Order Form");

        getContentPane().add(txtFromDate);
        txtFromDate.setBounds(170, 40, 100, 20);
        getContentPane().add(txtToDate);
        txtToDate.setBounds(310, 40, 100, 20);

        jLabel4.setText("From Date");
        getContentPane().add(jLabel4);
        jLabel4.setBounds(80, 40, 80, 20);

        jLabel5.setText("To");
        getContentPane().add(jLabel5);
        jLabel5.setBounds(280, 40, 20, 20);
    }// </editor-fold>//GEN-END:initComponents

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
         try{
        File file;        
        ExporttoExcelFileChooser.setDialogTitle("Enter Excel File Name");
        ExporttoExcelFileChooser.setFileSelectionMode(JFileChooser.APPROVE_OPTION);
        int returnVal = ExporttoExcelFileChooser.showSaveDialog(frmRptGRNPJVApprovedDatewise.this);
        if ( returnVal == JFileChooser.APPROVE_OPTION) {
            file = ExporttoExcelFileChooser.getSelectedFile();
            export.fillData(TableI,new File(file+".xls"));
            JOptionPane.showMessageDialog(null," Excel File Saved at : "+ file+".xls","Message",JOptionPane.INFORMATION_MESSAGE);
        }   
        }
        catch(Exception ex)
        {
            ex.printStackTrace();
        }
    }//GEN-LAST:event_jButton1ActionPerformed
                    
       
    private void formMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseClicked
        // TODO add your handling code here:
        
    }//GEN-LAST:event_formMouseClicked
        
    private void cmdShowIActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdShowIActionPerformed
        // TODO add your handling code here:
        //PRODUCTION PROCESS SHOW LIST
        GenerateInformation();
    }//GEN-LAST:event_cmdShowIActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JFileChooser ExporttoExcelFileChooser;
    private javax.swing.JTable TableI;
    private javax.swing.JButton cmdShowI;
    private javax.swing.JButton jButton1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JTextField txtFromDate;
    private javax.swing.JTextField txtToDate;
    // End of variables declaration//GEN-END:variables
    
    
    private void GenerateCombo() {
        
        
    }
    
    
    private void FormatGridI() {
        DataModelI=new EITLTableModel();
        TableI.removeAll();
        TableI.setModel(DataModelI);
        
        TableI.setAutoResizeMode(TableI.AUTO_RESIZE_OFF);
        
        DataModelI.addColumn("Sr.");
        DataModelI.addColumn("PO No");
        DataModelI.addColumn("GRN No");
        DataModelI.addColumn("GRN Date");        
        DataModelI.addColumn("GRN Approved Date");
        DataModelI.addColumn("Supp Code");        
        DataModelI.addColumn("Supp Name");
        DataModelI.addColumn("Voucher No");        
        DataModelI.addColumn("Voucher Approved Date");       
        DataModelI.addColumn("Main Code");       
        
        
        DataModelI.TableReadOnly(true);
    }
    
    
    
    private void GenerateInformation() {
        String SelUserID="";
        String strSQL="";
        try{
            FormatGridI(); //clear existing content of table
            //SelUserID = txtpartycode.getText().toString();
            ResultSet rsTmp;
            //rsTmp=data.getResult("SELECT PIECE_NO FROM FELT_ORDER_MASTER WHERE PARTY_CD="+SelUserID+"");
            strSQL="";             
            strSQL += "SELECT COALESCE(PO_NO,'') AS PO_NO,GRN_NO,GRN_DATE,GRN_APPROVEDDATE,SUPP_ID,SUPP_NAME,COALESCE(VOUCHER_NO,'') AS VOUCHER_NO,COALESCE(VC_APPROVED_DATE,'') AS VC_APPROVED_DATE,MAIN_ACCOUNT_CODE FROM "
                    + "(SELECT A.*,B.* FROM "
                    + "(SELECT GRN_NO,GRN_DATE,SUPP_ID,APPROVED_DATE GRN_APPROVEDDATE FROM DINESHMILLS.D_INV_GRN_HEADER WHERE APPROVED_DATE BETWEEN '"+EITLERPGLOBAL.formatDateDB((txtFromDate.getText().trim()))+"' AND '"+EITLERPGLOBAL.formatDateDB((txtToDate.getText().trim()))+"' AND GRN_NO LIKE 'R______' ORDER BY APPROVED_DATE) A "
                    + "LEFT JOIN "
                    + "(SELECT GRN_NO AS VC_GRN_NO,GRN_DATE AS VC_GRN_DATE,D.VOUCHER_NO,H.VOUCHER_DATE,APPROVED_DATE AS VC_APPROVED_DATE,EFFECT,PO_NO,MAIN_ACCOUNT_CODE FROM FINANCE.D_FIN_VOUCHER_HEADER H, FINANCE.D_FIN_VOUCHER_DETAIL D "
                    //+ "WHERE H.VOUCHER_NO=D.VOUCHER_NO AND H.APPROVED=1 AND H.CANCELLED=0 AND GRN_NO LIKE 'R______' AND H.VOUCHER_NO LIKE 'PJ%' AND MAIN_ACCOUNT_CODE='403036' ORDER BY GRN_NO,VOUCHER_NO) B "
                    + "WHERE H.VOUCHER_NO=D.VOUCHER_NO AND H.CANCELLED=0 AND GRN_NO LIKE 'R______' AND H.VOUCHER_NO LIKE 'PJ%' AND MAIN_ACCOUNT_CODE IN ('403036','405021') ORDER BY GRN_NO,VOUCHER_NO) B "
                    + "ON A.GRN_NO=B.VC_GRN_NO AND A.GRN_DATE=B.VC_GRN_DATE GROUP BY VOUCHER_NO ORDER BY A.GRN_NO,VOUCHER_NO) C "
                    + "LEFT JOIN "
                    + "(SELECT SUPPLIER_CODE,SUPP_NAME FROM DINESHMILLS.D_COM_SUPP_MASTER ) D "
                    + "ON C.SUPP_ID=D.SUPPLIER_CODE ORDER BY VC_APPROVED_DATE";
            
                    
            System.out.println(strSQL);
            rsTmp=data.getResult(strSQL);
            rsTmp.first();
            if(rsTmp.getRow()>0) {
                int cnt=0;
                while(!rsTmp.isAfterLast()) {
                    cnt++;
                    
                    Object[] rowData=new Object[28];
                    rowData[0]=Integer.toString(cnt);
                    rowData[1]=rsTmp.getString("PO_NO");
                    rowData[2]=rsTmp.getString("GRN_NO");
                    rowData[3]=EITLERPGLOBAL.formatDate(rsTmp.getString("GRN_DATE"));
                    rowData[4]=EITLERPGLOBAL.formatDate(rsTmp.getString("GRN_APPROVEDDATE"));                    
                    rowData[5]=rsTmp.getString("SUPP_ID");                    
                    rowData[6]=rsTmp.getString("SUPP_NAME");
                    rowData[7]=rsTmp.getString("VOUCHER_NO");
                    rowData[8]=EITLERPGLOBAL.formatDate(rsTmp.getString("VC_APPROVED_DATE"));                    
                    rowData[9]=rsTmp.getString("MAIN_ACCOUNT_CODE");
                    
                    DataModelI.addRow(rowData);
                    //   System.out.println("rsTmp.getString('PIECE_NO')");
                    rsTmp.next();
                }
            }
        }
        catch(Exception e){
            e.printStackTrace();
            JOptionPane.showMessageDialog(null,e.getMessage());
        }
        
    }
    
    
    
}

