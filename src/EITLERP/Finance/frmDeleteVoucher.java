/*
 * frmGRNFind.java
 *
 * Created on May 15, 2004, 1:35 PM
 */

package EITLERP.Finance;

/**
 *
 * @author  nrpithva
 */

/*<APPLET CODE=frmGRNFind.class HEIGHT=405 WIDTH=565></APPLET>*/

import javax.swing.*;
import java.awt.*;
import java.util.*;
import java.sql.*;
import EITLERP.*;
import EITLERP.Finance.*;


public class frmDeleteVoucher extends javax.swing.JApplet {
    
    
    public String LastError="";
    private ResultSet rsVoucher = null;
    
    private Connection Conn;
    private Statement Stmt;
    
    
    /** Initializes the applet frmGRNFind */
    public void init() {
        System.gc();
        setSize(565,300);
        initComponents();
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jLabel1 = new javax.swing.JLabel();
        cmdDelete = new javax.swing.JButton();
        cmdClear = new javax.swing.JButton();
        jPanel1 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        txtVoucherNoLike = new javax.swing.JTextField();
        jLabel14 = new javax.swing.JLabel();
        txtToDate = new javax.swing.JTextField();
        jLabel15 = new javax.swing.JLabel();
        txtFromDate = new javax.swing.JTextField();
        jLabel16 = new javax.swing.JLabel();
        txtBookCode = new javax.swing.JTextField();
        jLabel17 = new javax.swing.JLabel();
        txtMainCode = new javax.swing.JTextField();

        getContentPane().setLayout(null);

        addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                formMouseClicked(evt);
            }
        });

        jLabel1.setFont(new java.awt.Font("Arial", 1, 12));
        jLabel1.setText("Delete Voucher Detail");
        getContentPane().add(jLabel1);
        jLabel1.setBounds(6, 12, 310, 15);

        cmdDelete.setText("Delete");
        cmdDelete.setBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED));
        cmdDelete.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdDeleteActionPerformed(evt);
            }
        });

        getContentPane().add(cmdDelete);
        cmdDelete.setBounds(480, 70, 70, 25);

        cmdClear.setText("Clear");
        cmdClear.setBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED));
        cmdClear.setNextFocusableComponent(txtVoucherNoLike);
        cmdClear.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdClearActionPerformed(evt);
            }
        });

        getContentPane().add(cmdClear);
        cmdClear.setBounds(482, 110, 70, 25);

        jPanel1.setLayout(null);

        jPanel1.setBorder(new javax.swing.border.EtchedBorder(javax.swing.border.EtchedBorder.RAISED));
        jLabel2.setDisplayedMnemonic('G');
        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel2.setLabelFor(txtVoucherNoLike);
        jLabel2.setText("Vocuher No Start with");
        jPanel1.add(jLabel2);
        jLabel2.setBounds(0, 10, 140, 15);

        jPanel1.add(txtVoucherNoLike);
        txtVoucherNoLike.setBounds(150, 10, 132, 19);

        jLabel14.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel14.setText("To Date");
        jPanel1.add(jLabel14);
        jLabel14.setBounds(0, 130, 140, 15);

        jPanel1.add(txtToDate);
        txtToDate.setBounds(150, 130, 132, 19);

        jLabel15.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel15.setText("From Date");
        jPanel1.add(jLabel15);
        jLabel15.setBounds(0, 100, 140, 15);

        jPanel1.add(txtFromDate);
        txtFromDate.setBounds(150, 100, 132, 19);

        jLabel16.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel16.setText("Book Code");
        jPanel1.add(jLabel16);
        jLabel16.setBounds(0, 70, 140, 15);

        jPanel1.add(txtBookCode);
        txtBookCode.setBounds(150, 70, 132, 19);

        jLabel17.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel17.setText("Main Code");
        jPanel1.add(jLabel17);
        jLabel17.setBounds(0, 40, 140, 15);

        jPanel1.add(txtMainCode);
        txtMainCode.setBounds(150, 40, 132, 19);

        getContentPane().add(jPanel1);
        jPanel1.setBounds(6, 39, 458, 160);

    }//GEN-END:initComponents
    
    private void formMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseClicked
        // TODO add your handling code here:
        
    }//GEN-LAST:event_formMouseClicked
    
    private void cmdClearActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdClearActionPerformed
        // TODO add your handling code here:
        txtToDate.setText("");
        txtVoucherNoLike.setText("");
        txtFromDate.setText("");
        txtBookCode.setText("");
    }//GEN-LAST:event_cmdClearActionPerformed
    
    private void cmdDeleteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdDeleteActionPerformed
        // TODO add your handling code here:
        
        String Query="",ToDate = "",FromDate="";
        String URL = "",Condition="";
        URL = "jdbc:mysql://200.0.0.22799:3306/FINANCE";
        FromDate = EITLERPGLOBAL.formatDateDB(txtFromDate.getText().trim());
        ToDate = EITLERPGLOBAL.formatDateDB(txtToDate.getText().trim());
        String dbURL = "";
        //Condition = " AND A.CREATED_DATE='2008-02-05' ";
        if (!txtVoucherNoLike.getText().trim().equals("")) {
            Condition += " AND  A.VOUCHER_NO LIKE '"+ txtVoucherNoLike.getText().trim() +"%' ";
        }
        if (!txtFromDate.getText().trim().equals("")) {
            Condition += " AND A.VOUCHER_DATE >= '"+ FromDate +"' ";
        }
        if (!txtToDate.getText().trim().equals("")) {
            Condition += " AND A.VOUCHER_DATE <= '"+ ToDate +"' ";
        }
        if (!txtBookCode.getText().trim().equals("")) {
            Condition += " AND A.BOOK_CODE ='"+txtBookCode.getText().trim()+"' ";
        }
        if (!txtMainCode.getText().trim().equals("")) {
            Condition += " AND B.MAIN_ACCOUNT_CODE ='"+txtMainCode.getText().trim()+"' ";
        }
        
        /*Query="SELECT DISTINCT A.VOUCHER_NO  FROM  D_FIN_VOUCHER_HEADER A, D_FIN_VOUCHER_DETAIL B "+
            " WHERE A.VOUCHER_NO =B.VOUCHER_NO "+ Condition + " ORDER BY A.VOUCHER_DATE, A.VOUCHER_NO ";*/
        
        /*Query="SELECT DISTINCT A.VOUCHER_NO FROM D_FIN_VOUCHER_HEADER A,D_FIN_VOUCHER_DETAIL B " +
        "WHERE A.VOUCHER_NO=B.VOUCHER_NO AND A.BOOK_CODE=22 AND A.VOUCHER_DATE='2010-03-31' AND A.APPROVED=1 AND A.CANCELLED=0 " +
        "AND A.VOUCHER_NO LIKE 'JV%' AND B.GRN_NO='000004' AND B.MODULE_ID=85 AND B.MAIN_ACCOUNT_CODE='115160' AND B.SUB_ACCOUNT_CODE='081031' AND B.AMOUNT='973' ";*/
        
        /*Query="SELECT A.VOUCHER_NO FROM D_FIN_VOUCHER_HEADER A, D_FIN_VOUCHER_DETAIL B " +
        "WHERE A.VOUCHER_NO=B.VOUCHER_NO AND B.MAIN_ACCOUNT_CODE='210027' AND A.APPROVED_DATE=CURDATE() " +
        "AND A.CHANGED_DATE=CURDATE() AND A.VOUCHER_NO LIKE 'OP%' ";*/
        
        Query="SELECT * FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO LIKE 'M%' AND VOUCHER_TYPE=3 AND VOUCHER_DATE>='2011-10-01' " +
        "AND VOUCHER_DATE<='2011-11-15' AND APPROVED=1 AND CANCELLED=0 ORDER BY VOUCHER_DATE ";
        
        rsVoucher = data.getResult(Query,FinanceGlobal.FinURL);
        
        try {
            rsVoucher.first();
            if (rsVoucher.getRow() > 0) {
                rsVoucher.first();
                int cnt = 0;
                String VoucherNo = "";
                while (! rsVoucher.isAfterLast()) {
                    cnt = cnt + 1;
                    VoucherNo = rsVoucher.getString("VOUCHER_NO");
                    int CompanyID = data.getIntValueFromDB("SELECT COMPANY_ID FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO='"+VoucherNo+"' ",FinanceGlobal.FinURL);
                    String VoucherDate = data.getStringValueFromDB("SELECT VOUCHER_DATE FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO='"+VoucherNo+"' ",FinanceGlobal.FinURL);
                    System.out.println("count=" + cnt + "  Voucher No =" + VoucherNo + " Voucher Date = " + VoucherDate);
                    
                    if(CompanyID == 2) {
                        dbURL = "jdbc:mysql://200.0.0.227:3306/DINESHMILLS";
                    }
                    /*if(CompanyID == 3) {
                        dbURL = "jdbc:mysql://200.0.0.227:3306/DINESHMILLSA";
                    }*/
                    
                    Query ="DELETE FROM D_COM_DOC_DATA WHERE DOC_NO='" + VoucherNo + "' ";
                    //System.out.println(Query);
                    data.Execute(Query,clsFinYear.getDBURL(CompanyID,2011));
                    
                    Query ="DELETE FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='" + VoucherNo + "' AND COMPANY_ID=2";
                    //System.out.println(Query);
                    data.Execute(Query,FinanceGlobal.FinURL);
                    
                    Query = "DELETE FROM D_FIN_VOUCHER_DETAIL_H WHERE VOUCHER_NO='" + VoucherNo + "' AND COMPANY_ID=2";
                    //System.out.println(Query);
                    data.Execute(Query,URL);
                    
                    Query = "DELETE FROM D_FIN_VOUCHER_DETAIL WHERE VOUCHER_NO='" + VoucherNo + "' AND COMPANY_ID=2";
                    //System.out.println(Query);
                    data.Execute(Query,FinanceGlobal.FinURL);
                    
                    Query = "DELETE FROM D_FIN_VOUCHER_HEADER_H WHERE VOUCHER_NO='" + VoucherNo + "' AND COMPANY_ID=2";
                    //System.out.println(Query);
                    data.Execute(Query,URL);
                    
                    Query = "DELETE FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO='" + VoucherNo + "' AND COMPANY_ID=2";
                    //System.out.println(Query);
                    data.Execute(Query,FinanceGlobal.FinURL);
                    
                    rsVoucher.next();
                }
            }
        }
        catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_cmdDeleteActionPerformed
    
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton cmdClear;
    private javax.swing.JButton cmdDelete;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel17;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JTextField txtBookCode;
    private javax.swing.JTextField txtFromDate;
    private javax.swing.JTextField txtMainCode;
    private javax.swing.JTextField txtToDate;
    private javax.swing.JTextField txtVoucherNoLike;
    // End of variables declaration//GEN-END:variables
    
    
    
}
