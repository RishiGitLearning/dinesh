/*
 * Import.java
 *
 * Created on August 12, 2007, 3:17 PM
 */

package EITLERP.Finance;

/**
 *
 * @author  root
 */
import java.sql.*;
import java.util.*;
import java.io.*;
import EITLERP.*;
import EITLERP.Stores.*;
import TReportWriter.*;
import TReportWriter.SimpleDataProvider.*;
import EITLERP.Sales.*;


public class ImportNew extends javax.swing.JApplet {
    
    public String CloneURL="jdbc:mysql://200.0.0.227:3306/DINESHMILLS";
    /** Initializes the applet Import */
    public void init() {
        setSize(300,200);
        initComponents();
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        cmdtempadj = new javax.swing.JButton();
        txtPartyCode = new javax.swing.JTextField();
        txtAmount = new javax.swing.JTextField();
        txtVoucherNo = new javax.swing.JTextField();
        txtSrNo = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();

        getContentPane().setLayout(null);

        cmdtempadj.setText("temp_adj");
        cmdtempadj.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdtempadjActionPerformed(evt);
            }
        });

        getContentPane().add(cmdtempadj);
        cmdtempadj.setBounds(110, 110, 170, 25);

        txtPartyCode.setNextFocusableComponent(txtVoucherNo);
        getContentPane().add(txtPartyCode);
        txtPartyCode.setBounds(260, 20, 90, 19);

        getContentPane().add(txtAmount);
        txtAmount.setBounds(60, 80, 350, 19);

        txtVoucherNo.setNextFocusableComponent(txtAmount);
        getContentPane().add(txtVoucherNo);
        txtVoucherNo.setBounds(60, 50, 130, 19);

        txtSrNo.setNextFocusableComponent(txtPartyCode);
        getContentPane().add(txtSrNo);
        txtSrNo.setBounds(60, 20, 130, 19);

        jLabel1.setText("sr no :");
        getContentPane().add(jLabel1);
        jLabel1.setBounds(10, 20, 39, 15);

        jLabel2.setText("v no :");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(10, 50, 34, 15);

        jLabel3.setText("Amt :");
        getContentPane().add(jLabel3);
        jLabel3.setBounds(10, 80, 45, 15);

        jLabel4.setText("p code :");
        getContentPane().add(jLabel4);
        jLabel4.setBounds(200, 20, 50, 15);

    }//GEN-END:initComponents
    
    private void cmdtempadjActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdtempadjActionPerformed
        // TODO add your handling code here:
        try {
            int SrNo = Integer.parseInt(txtSrNo.getText().trim());
            String PartyCode = txtPartyCode.getText().trim();
            String VoucherNo = txtVoucherNo.getText().trim();
            String VoucherDate = data.getStringValueFromDB("SELECT VOUCHER_DATE FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO='"+VoucherNo+"' ",FinanceGlobal.FinURL);
            String BookCode = data.getStringValueFromDB("SELECT BOOK_CODE FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO='"+VoucherNo+"' ",FinanceGlobal.FinURL);
            StringTokenizer st = new StringTokenizer(txtAmount.getText().trim(),",");
            double Amount = 0;
            double OSAmount = data.getDoubleValueFromDB("SELECT AMOUNT FROM D_FIN_DR_OPENING_OUTSTANDING_DETAIL WHERE ENTRY_NO=1 AND INVOICE_TYPE=2 AND SR_NO="+SrNo ,FinanceGlobal.FinURL);
            int i=1;
            while(i<=st.countTokens()) {
                Amount = Double.parseDouble(st.nextToken());
                System.out.println(Amount);
                
                ResultSet rsOSData = data.getResult("SELECT * FROM D_FIN_DR_OPENING_OUTSTANDING_DETAIL WHERE ENTRY_NO=1 AND INVOICE_TYPE=2 AND SR_NO="+SrNo ,FinanceGlobal.FinURL);
                Connection OSConn = data.getConn(FinanceGlobal.FinURL);
                Statement OSStmt = OSConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_UPDATABLE);
                ResultSet rsOPOSData=OSStmt.executeQuery("SELECT * FROM D_FIN_DR_OPENING_OUTSTANDING_DETAIL WHERE INVOICE_TYPE=2 AND ENTRY_NO=1 LIMIT 1");
                
                int MaxSrNo = data.getIntValueFromDB("SELECT MAX(SR_NO) FROM D_FIN_DR_OPENING_OUTSTANDING_DETAIL WHERE INVOICE_TYPE=2 AND ENTRY_NO=1",FinanceGlobal.FinURL)+1;
                rsOPOSData.moveToInsertRow();
                rsOPOSData.updateInt("COMPANY_ID",UtilFunctions.getInt(rsOSData,"COMPANY_ID",0));
                rsOPOSData.updateInt("ENTRY_NO",UtilFunctions.getInt(rsOSData,"ENTRY_NO",0));
                rsOPOSData.updateInt("SR_NO",MaxSrNo);
                rsOPOSData.updateInt("INVOICE_TYPE",UtilFunctions.getInt(rsOSData,"INVOICE_TYPE",0));
                rsOPOSData.updateString("MAIN_ACCOUNT_CODE",UtilFunctions.getString(rsOSData,"MAIN_ACCOUNT_CODE",""));
                rsOPOSData.updateString("SUB_ACCOUNT_CODE",UtilFunctions.getString(rsOSData,"SUB_ACCOUNT_CODE",""));
                rsOPOSData.updateString("BOOK_CODE",BookCode);
                rsOPOSData.updateString("CHARGE_CODE",UtilFunctions.getString(rsOSData,"CHARGE_CODE",""));
                rsOPOSData.updateString("INVOICE_NO",UtilFunctions.getString(rsOSData,"INVOICE_NO",""));
                rsOPOSData.updateString("INVOICE_DATE",UtilFunctions.getString(rsOSData,"INVOICE_DATE","0000-00-00"));
                rsOPOSData.updateString("LINK_NO",UtilFunctions.getString(rsOSData,"LINK_NO",""));
                rsOPOSData.updateString("VOUCHER_NO",VoucherNo);
                rsOPOSData.updateString("VOUCHER_DATE",VoucherDate);
                rsOPOSData.updateString("LEGACY_NO",UtilFunctions.getString(rsOSData,"LEGACY_NO",""));
                rsOPOSData.updateDouble("AMOUNT",Amount);
                rsOPOSData.updateString("EFFECT",UtilFunctions.getString(rsOSData,"EFFECT",""));
                rsOPOSData.updateString("C_BOOK_CODE",UtilFunctions.getString(rsOSData,"C_BOOK_CODE",""));
                rsOPOSData.updateString("BALE_NO",UtilFunctions.getString(rsOSData,"BALE_NO",""));
                rsOPOSData.updateString("LR_NO",UtilFunctions.getString(rsOSData,"LR_NO",""));
                rsOPOSData.updateString("OBC_NO",UtilFunctions.getString(rsOSData,"OBC_NO",""));
                rsOPOSData.updateBoolean("MATCHED",false);
                rsOPOSData.updateString("MATCHED_DATE","0000-00-00");
                rsOPOSData.updateString("CREATED_BY",UtilFunctions.getString(rsOSData,"CREATED_BY",""));
                rsOPOSData.updateString("CREATED_DATE",UtilFunctions.getString(rsOSData,"CREATED_DATE","0000-00-00"));
                rsOPOSData.updateBoolean("CHANGED",true);
                rsOPOSData.updateString("CHANGED_DATE",EITLERPGLOBAL.getCurrentDateDB());
                rsOPOSData.insertRow();
                OSAmount = EITLERPGLOBAL.round(OSAmount - Amount,2);
                i++;
            }
            data.Execute("UPDATE D_FIN_DR_OPENING_OUTSTANDING_DETAIL SET VOUCHER_NO='"+VoucherNo+"',VOUCHER_DATE='"+VoucherDate+"',BOOK_CODE='"+BookCode+"',AMOUNT="+OSAmount+",MATCHED=0,MATCHED_DATE='0000-00-00' WHERE INVOICE_TYPE=2 AND ENTRY_NO=1 AND SR_NO="+SrNo,FinanceGlobal.FinURL);
        } catch(Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_cmdtempadjActionPerformed
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton cmdtempadj;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JTextField txtAmount;
    private javax.swing.JTextField txtPartyCode;
    private javax.swing.JTextField txtSrNo;
    private javax.swing.JTextField txtVoucherNo;
    // End of variables declaration//GEN-END:variables
    
}
