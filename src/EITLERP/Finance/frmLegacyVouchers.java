/*
 * frmLegacyVouchers.java
 *
 * Created on August 23, 2008, 11:18 AM
 */

package EITLERP.Finance;

/**
 *
 * @author  root
 */

import EITLERP.*;
import java.sql.*;
import javax.swing.*;

public class frmLegacyVouchers extends javax.swing.JApplet {
    
    private EITLTableModel DataModel=new EITLTableModel();
    
    /** Initializes the applet frmLegacyVouchers */
    public void init() {
        setSize(571,474);
        initComponents();
        jPanel1.setVisible(false);
        jPanel2.setVisible(false);
        opgNone.setSelected(true);
        opgApproved.setSelected(true);
        opgUnapproved.setSelected(false);
        //txtBookCode.setText("70");
        //txtBookCode.setEnabled(false);
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        buttonGroup1 = new javax.swing.ButtonGroup();
        buttonGroup2 = new javax.swing.ButtonGroup();
        lblTitle = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        txtFromDate = new javax.swing.JTextField();
        txtToDate = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        Table = new javax.swing.JTable();
        jLabel4 = new javax.swing.JLabel();
        txtVoucherNo = new javax.swing.JTextField();
        cmdShowList = new javax.swing.JButton();
        cmdSave = new javax.swing.JButton();
        lblStatus = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        txtBookCode = new javax.swing.JTextField();
        lblBookName = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        opgCR = new javax.swing.JRadioButton();
        opgCS = new javax.swing.JRadioButton();
        opgNone = new javax.swing.JRadioButton();
        jPanel2 = new javax.swing.JPanel();
        opgApproved = new javax.swing.JRadioButton();
        opgUnapproved = new javax.swing.JRadioButton();

        getContentPane().setLayout(null);

        addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                formMouseClicked(evt);
            }
        });

        lblTitle.setBackground(new java.awt.Color(0, 102, 153));
        lblTitle.setForeground(java.awt.Color.white);
        lblTitle.setText(" ASSIGN LEGACY VOUCHER NO.");
        lblTitle.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));
        lblTitle.setOpaque(true);
        getContentPane().add(lblTitle);
        lblTitle.setBounds(0, 2, 666, 25);

        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel1.setText("From Date :");
        getContentPane().add(jLabel1);
        jLabel1.setBounds(5, 67, 85, 14);

        jLabel2.setText("Display voucher of period");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(6, 39, 180, 14);

        getContentPane().add(txtFromDate);
        txtFromDate.setBounds(95, 66, 100, 19);

        getContentPane().add(txtToDate);
        txtToDate.setBounds(263, 67, 100, 19);

        jLabel3.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel3.setText("To Date :");
        getContentPane().add(jLabel3);
        jLabel3.setBounds(200, 68, 60, 14);

        Table.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jScrollPane1.setViewportView(Table);

        getContentPane().add(jScrollPane1);
        jScrollPane1.setBounds(3, 174, 530, 240);

        jLabel4.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel4.setText("Voucher No. :");
        getContentPane().add(jLabel4);
        jLabel4.setBounds(5, 93, 85, 14);

        getContentPane().add(txtVoucherNo);
        txtVoucherNo.setBounds(95, 92, 160, 19);

        cmdShowList.setText("Show List");
        cmdShowList.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdShowListActionPerformed(evt);
            }
        });

        getContentPane().add(cmdShowList);
        cmdShowList.setBounds(420, 145, 110, 23);

        cmdSave.setText("Save");
        cmdSave.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmdSaveActionPerformed(evt);
            }
        });

        getContentPane().add(cmdSave);
        cmdSave.setBounds(442, 421, 90, 23);

        lblStatus.setForeground(new java.awt.Color(51, 153, 255));
        lblStatus.setText("Status");
        getContentPane().add(lblStatus);
        lblStatus.setBounds(6, 423, 280, 14);

        jLabel5.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel5.setText("Book Code :");
        getContentPane().add(jLabel5);
        jLabel5.setBounds(5, 118, 85, 14);

        txtBookCode.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtBookCodeFocusLost(evt);
            }
        });
        txtBookCode.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtBookCodeKeyPressed(evt);
            }
        });

        getContentPane().add(txtBookCode);
        txtBookCode.setBounds(95, 117, 100, 19);

        lblBookName.setText(".");
        getContentPane().add(lblBookName);
        lblBookName.setBounds(10, 144, 280, 14);

        jPanel1.setLayout(null);

        jPanel1.setBorder(new javax.swing.border.EtchedBorder());
        opgCR.setText(" CR");
        buttonGroup1.add(opgCR);
        jPanel1.add(opgCR);
        opgCR.setBounds(5, 5, 60, 15);

        opgCS.setText(" CS");
        buttonGroup1.add(opgCS);
        jPanel1.add(opgCS);
        opgCS.setBounds(70, 5, 60, 15);

        opgNone.setSelected(true);
        opgNone.setText(" None");
        buttonGroup1.add(opgNone);
        jPanel1.add(opgNone);
        opgNone.setBounds(140, 5, 60, 15);

        getContentPane().add(jPanel1);
        jPanel1.setBounds(260, 90, 220, 25);

        jPanel2.setLayout(null);

        jPanel2.setBorder(new javax.swing.border.EtchedBorder());
        opgApproved.setSelected(true);
        opgApproved.setText(" Approved");
        buttonGroup2.add(opgApproved);
        jPanel2.add(opgApproved);
        opgApproved.setBounds(5, 5, 100, 15);

        opgUnapproved.setText(" Unapproved");
        buttonGroup2.add(opgUnapproved);
        jPanel2.add(opgUnapproved);
        opgUnapproved.setBounds(110, 5, 100, 15);

        getContentPane().add(jPanel2);
        jPanel2.setBounds(260, 120, 220, 25);

    }//GEN-END:initComponents
    
    private void txtBookCodeFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtBookCodeFocusLost
        // TODO add your handling code here:
        lblBookName.setText(clsBook.getBookName(EITLERPGLOBAL.gCompanyID, txtBookCode.getText()));
        if(txtBookCode.getText().trim().equals("30")) {
            jPanel1.setVisible(true);
            jPanel2.setVisible(true);
            opgNone.setSelected(true);
            opgApproved.setSelected(true);
            opgUnapproved.setSelected(false);
        } else {
            jPanel1.setVisible(false);
            jPanel2.setVisible(false);
            opgNone.setSelected(true);
            opgApproved.setSelected(true);
            opgUnapproved.setSelected(false);
        }
    }//GEN-LAST:event_txtBookCodeFocusLost
    
    private void txtBookCodeKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtBookCodeKeyPressed
        // TODO add your handling code here:
        try {
            
            if(evt.getKeyCode()==112) {
                LOV aList=new LOV();
                
                aList.SQL="SELECT BOOK_CODE,BOOK_NAME FROM D_FIN_BOOK_MASTER ORDER BY BOOK_NAME";
                aList.ReturnCol=1;
                aList.ShowReturnCol=true;
                aList.DefaultSearchOn=2;
                aList.UseSpecifiedConn=true;
                aList.dbURL=FinanceGlobal.FinURL;
                
                if(aList.ShowLOV()) {
                    txtBookCode.setText(aList.ReturnVal);
                    lblBookName.setText(clsBook.getBookName(EITLERPGLOBAL.gCompanyID, txtBookCode.getText()));
                }
                
            }
            
        }
        catch(Exception e) {
            
        }
        
    }//GEN-LAST:event_txtBookCodeKeyPressed
    
    private void formMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseClicked
        // TODO add your handling code here:
        
    }//GEN-LAST:event_formMouseClicked
    
    private void cmdSaveActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdSaveActionPerformed
        // TODO add your handling code here:
        new Thread() {
            
            public void run() {
                
                try {
                    for(int i=0;i<Table.getRowCount();i++) {
                        String VoucherNo=DataModel.getValueByVariable("VOUCHER_NO", i);
                        
                        lblStatus.setText("Updating Voucher "+VoucherNo);
                        
                        String LegacyNo=DataModel.getValueByVariable("LEGACY_NO", i);
                        String LegacyDate=EITLERPGLOBAL.formatDateDB(DataModel.getValueByVariable("LEGACY_DATE", i));
                        String LinkNo=DataModel.getValueByVariable("LINK_NO", i);
                        
                        if((!LegacyNo.trim().equals(""))&&(LegacyDate.trim().equals(""))) {
                            JOptionPane.showMessageDialog(null,"Please enter valid date against legacy no. "+LegacyNo);
                            lblStatus.setText("Ready");
                            return;
                        }
                        // FOR OTHER BOOK CODES
                        data.Execute("UPDATE D_FIN_VOUCHER_HEADER SET LINK_NO='"+LinkNo+"',LEGACY_NO='"+LegacyNo+"',LEGACY_DATE='"+LegacyDate+"', CHANGED=1, CHANGED_DATE=CURDATE() WHERE VOUCHER_NO='"+VoucherNo+"'",FinanceGlobal.FinURL);
                        
                       //OR BOOK CODE 26 ONLY
                       /*data.Execute("UPDATE D_FIN_VOUCHER_HEADER SET LINK_NO='"+LinkNo+"',LEGACY_NO='"+LegacyNo+"',LEGACY_DATE='"+LegacyDate+"', " +
                        "CHANGED=1, CHANGED_DATE=CURDATE(), VOUCHER_DATE='"+LegacyDate+"' WHERE VOUCHER_NO='"+VoucherNo+"'",FinanceGlobal.FinURL);*/
                        
                    }
                    
                    lblStatus.setText("Ready");
                    
                }
                catch(Exception e) {
                    
                }
            };
        }.start();
    }//GEN-LAST:event_cmdSaveActionPerformed
    
    private void cmdShowListActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmdShowListActionPerformed
        // TODO add your handling code here:
        
        String FromDate = EITLERPGLOBAL.formatDateDB(txtFromDate.getText().trim());
        String ToDate = EITLERPGLOBAL.formatDateDB(txtToDate.getText().trim());
        /*if(java.sql.Date.valueOf(FromDate).before(java.sql.Date.valueOf("2009-04-01"))) {
            JOptionPane.showMessageDialog(this,"Wrong from Date...");
            return;
        }
        if(java.sql.Date.valueOf(ToDate).after(java.sql.Date.valueOf("2010-03-31"))) {
            JOptionPane.showMessageDialog(this,"Wrong To Date...");
            return;
        }*/
        new Thread() {
            
            public void run() {
                try {
                    String strSQL="SELECT VOUCHER_NO,VOUCHER_DATE,LEGACY_NO,LEGACY_DATE,LINK_NO FROM D_FIN_VOUCHER_HEADER  WHERE CANCELLED=0 "; // AND APPROVED=1 AND  VOUCHER_NO LIKE 'PY%' 
                    String strCondition="";
                    
                    if(opgApproved.isSelected()) {
                        strCondition+=" AND APPROVED=1 ";
                    }
                    
                    if(!txtFromDate.getText().trim().equals("")) {
                        strCondition+=" AND VOUCHER_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' ";
                    }
                    
                    if(!txtToDate.getText().trim().equals("")) {
                        strCondition+=" AND VOUCHER_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ";
                    }
                    
                    if(!txtVoucherNo.getText().trim().equals("")) {
                        strCondition+=" AND VOUCHER_NO='"+txtVoucherNo.getText()+"' ";
                    }
                    
                    if(!txtBookCode.getText().trim().equals("")) {
                        strCondition+=" AND BOOK_CODE='"+txtBookCode.getText()+"' ";
                    }
                    
                    if(opgCR.isSelected()) {
                        strCondition+=" AND (VOUCHER_NO LIKE 'CR%' OR VOUCHER_NO LIKE 'AR%') ";
                    }
                    
                    if(opgCS.isSelected()) {
                        strCondition+=" AND (VOUCHER_NO LIKE 'CS%' OR VOUCHER_NO LIKE 'CA%') ";
                    }
                    
                    strSQL+=strCondition;
                    strSQL+=" ORDER BY VOUCHER_DATE, VOUCHER_NO ";
                    
                    lblStatus.setText("Fetching Records ... ");
                    
                    
                    
                    ResultSet rsParty;
                    
                    ResultSet rsTmp=data.getResult(strSQL,FinanceGlobal.FinURL);
                    rsTmp.first();
                    
                    FormatGrid();
                    
                    if(rsTmp.getRow()>0) {
                        while(!rsTmp.isAfterLast()) {
                            
                            
                            Object[] rowData=new Object[1];
                            DataModel.addRow(rowData);
                            
                            int NewRow=Table.getRowCount()-1;
                            lblStatus.setText("Generating Table "+NewRow);
                            
                            String VoucherNo=UtilFunctions.getString(rsTmp,"VOUCHER_NO","");
                            String VoucherDate=EITLERPGLOBAL.formatDate(UtilFunctions.getString(rsTmp,"VOUCHER_DATE","0000-00-00"));
                            String LegacyNo=UtilFunctions.getString(rsTmp,"LEGACY_NO","");
                            String LegacyDate=EITLERPGLOBAL.formatDate(UtilFunctions.getString(rsTmp,"LEGACY_DATE","0000-00-00"));
                            String LinkNo=UtilFunctions.getString(rsTmp,"LINK_NO","");
                            
                            rsParty = data.getResult("SELECT MAIN_ACCOUNT_CODE, SUB_ACCOUNT_CODE, AMOUNT FROM D_FIN_VOUCHER_DETAIL WHERE COMPANY_ID ="+EITLERPGLOBAL.gCompanyID+" AND VOUCHER_NO ='"+VoucherNo+"' AND SUB_ACCOUNT_CODE <> ''" , FinanceGlobal.FinURL);
                            
                            rsParty.first();
                            if (rsParty.getRow()>0) {
                                String AccountName = clsAccount.getAccountName(rsParty.getString("MAIN_ACCOUNT_CODE"), rsParty.getString("SUB_ACCOUNT_CODE"));
                                DataModel.setValueByVariable("PARTY_NAME",AccountName,NewRow);
                                DataModel.setValueByVariable("AMOUNT",Double.toString(rsParty.getDouble("AMOUNT")),NewRow);
                            }
                            
                            DataModel.setValueByVariable("SR_NO",Integer.toString(NewRow+1), NewRow);
                            DataModel.setValueByVariable("VOUCHER_NO",VoucherNo,NewRow);
                            DataModel.setValueByVariable("VOUCHER_DATE",VoucherDate,NewRow);
                            
                            
                            DataModel.setValueByVariable("LEGACY_NO",LegacyNo,NewRow);
                            DataModel.setValueByVariable("LEGACY_DATE",LegacyDate,NewRow);
                            DataModel.setValueByVariable("LINK_NO",LinkNo,NewRow);
                            
                            rsTmp.next();
                        }
                    }
                    
                    lblStatus.setText("Ready ");
                    
                }
                catch(Exception e) {
                    lblStatus.setText("Ready ");
                }
            };
        }.start();
    }//GEN-LAST:event_cmdShowListActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTable Table;
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.ButtonGroup buttonGroup2;
    private javax.swing.JButton cmdSave;
    private javax.swing.JButton cmdShowList;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lblBookName;
    private javax.swing.JLabel lblStatus;
    private javax.swing.JLabel lblTitle;
    private javax.swing.JRadioButton opgApproved;
    private javax.swing.JRadioButton opgCR;
    private javax.swing.JRadioButton opgCS;
    private javax.swing.JRadioButton opgNone;
    private javax.swing.JRadioButton opgUnapproved;
    private javax.swing.JTextField txtBookCode;
    private javax.swing.JTextField txtFromDate;
    private javax.swing.JTextField txtToDate;
    private javax.swing.JTextField txtVoucherNo;
    // End of variables declaration//GEN-END:variables
    
    
    private void FormatGrid() {
        
        
        try {
            
            
            DataModel=new EITLTableModel();
            Table.removeAll();
            
            Table.setModel(DataModel);
            Table.setAutoResizeMode(JTable.AUTO_RESIZE_OFF);
            
            DataModel.addColumn("Sr."); //0 - Read Only
            DataModel.addColumn("Voucher No."); //1
            DataModel.addColumn("Date"); //2
            
            DataModel.addColumn("Party Name"); //3
            DataModel.addColumn("Amount"); //4
            
            DataModel.addColumn("Legacy No."); //5
            DataModel.addColumn("Date"); //6
            DataModel.addColumn("Link No."); //7
            
            DataModel.SetVariable(0,"SR_NO"); //0 - Read Only
            DataModel.SetVariable(1,"VOUCHER_NO"); //0 - Read Only
            DataModel.SetVariable(2,"VOUCHER_DATE"); //0 - Read Only
            
            DataModel.SetVariable(3,"PARTY_NAME"); //0 - Read Only
            DataModel.SetVariable(4,"AMOUNT"); //0 - Read Only
            
            DataModel.SetVariable(5,"LEGACY_NO"); //0 - Read Only
            DataModel.SetVariable(6,"LEGACY_DATE"); //1
            DataModel.SetVariable(7,"LINK_NO"); //1
            
            DataModel.TableReadOnly(false);
            DataModel.SetReadOnly(0);
            DataModel.SetReadOnly(1);
            
            DataModel.SetNumeric(0,true);
            
        }
        catch(Exception e) {
            
        }
        //Table formatting completed
    }
    
}
