/*
 * trexport.java
 *
 * Created on March 13, 2008, 10:55 AM
 */

//package Templates.Other;
package EITLERP.Finance;

/**
 *
 * @author  nitin
 */
import java.sql.*;
import java.util.*;
import java.io.*;
import EITLERP.*;
import EITLERP.Stores.*;
import TReportWriter.*;
import TReportWriter.SimpleDataProvider.*;
import java.awt.* ;
import javax.swing.* ;

public class frmtrexportprathOLD extends javax.swing.JApplet {
    
    /** Initializes the applet trexport */
    public void init() {
        initComponents();
        setSize(353,254);
    }
    
    /** This method is called from within the init() method to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jButton7 = new javax.swing.JButton();
        txtFromDate = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        txtToDate = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        txtFile = new javax.swing.JTextField();
        jButton8 = new javax.swing.JButton();
        jButton1 = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();
        cmbCashVoucher = new javax.swing.JButton();
        cmbCashVoucher1 = new javax.swing.JButton();

        getContentPane().setLayout(null);

        jButton7.setText("PJV");
        jButton7.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton7ActionPerformed(evt);
            }
        });
        jButton7.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jButton7MouseClicked(evt);
            }
        });

        getContentPane().add(jButton7);
        jButton7.setBounds(10, 260, 140, 30);

        txtFromDate.setColumns(15);
        getContentPane().add(txtFromDate);
        txtFromDate.setBounds(110, 30, 90, 19);

        jLabel4.setText("From Date :");
        getContentPane().add(jLabel4);
        jLabel4.setBounds(30, 30, 80, 20);

        jLabel3.setText("To Date :");
        getContentPane().add(jLabel3);
        jLabel3.setBounds(30, 70, 70, 20);

        txtToDate.setColumns(15);
        getContentPane().add(txtToDate);
        txtToDate.setBounds(110, 70, 90, 19);

        jLabel5.setText("Save File :");
        getContentPane().add(jLabel5);
        jLabel5.setBounds(20, 130, 70, 20);

        txtFile.setColumns(15);
        getContentPane().add(txtFile);
        txtFile.setBounds(90, 130, 200, 19);

        jButton8.setText("Export TR");
        jButton8.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton8ActionPerformed(evt);
            }
        });

        getContentPane().add(jButton8);
        jButton8.setBounds(290, 130, 30, 20);

        jButton1.setText("Export TR Type 2");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        getContentPane().add(jButton1);
        jButton1.setBounds(10, 210, 140, 30);

        jButton2.setText("Export TR Type 1");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });

        getContentPane().add(jButton2);
        jButton2.setBounds(10, 170, 140, 30);

        cmbCashVoucher.setText("Cash Voucher");
        cmbCashVoucher.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmbCashVoucherActionPerformed(evt);
            }
        });

        getContentPane().add(cmbCashVoucher);
        cmbCashVoucher.setBounds(170, 170, 140, 30);

        cmbCashVoucher1.setText("Bank Voucher");
        cmbCashVoucher1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmbCashVoucher1ActionPerformed(evt);
            }
        });

        getContentPane().add(cmbCashVoucher1);
        cmbCashVoucher1.setBounds(170, 220, 140, 30);

    }//GEN-END:initComponents
    
    private void cmbCashVoucher1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmbCashVoucher1ActionPerformed
        EITLERP.data.Execute("DELETE FROM TR_COBOL",FinanceGlobal.FinURL);
        BankVoucher();
        writeToFile(EITLERPGLOBAL.formatDateDB(txtFromDate.getText()),EITLERPGLOBAL.formatDateDB(txtToDate.getText()));
        
        // TODO add your handling code here:
    }//GEN-LAST:event_cmbCashVoucher1ActionPerformed
    
    private void cmbCashVoucherActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmbCashVoucherActionPerformed
        EITLERP.data.Execute("DELETE FROM TR_COBOL",FinanceGlobal.FinURL);
        CashVoucher();
        writeToFile(EITLERPGLOBAL.formatDateDB(txtFromDate.getText()),EITLERPGLOBAL.formatDateDB(txtToDate.getText()));
        
        // TODO add your handling code here:
    }//GEN-LAST:event_cmbCashVoucherActionPerformed
    
    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
        // TODO add your handling code here:
        EITLERP.data.Execute("DELETE FROM TR_COBOL",FinanceGlobal.FinURL);
        ExportTrType1();
        ExportTrType2();
        ExportTrType3();
        writeToFile(EITLERPGLOBAL.formatDateDB(txtFromDate.getText()),EITLERPGLOBAL.formatDateDB(txtToDate.getText()));
    }//GEN-LAST:event_jButton2ActionPerformed
    
    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        // TODO add your handling code here:
        EITLERP.data.Execute("DELETE FROM TR_COBOL",FinanceGlobal.FinURL);
        ExportTrType2();
        writeToFile(EITLERPGLOBAL.formatDateDB(txtFromDate.getText()),EITLERPGLOBAL.formatDateDB(txtToDate.getText()));
    }//GEN-LAST:event_jButton1ActionPerformed
    
    private void jButton7MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jButton7MouseClicked
        // TODO add your handling code here:
        
    }//GEN-LAST:event_jButton7MouseClicked
    
    private void jButton8ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton8ActionPerformed
        // TODO add your handling code here:
        FileDialog ff = new FileDialog(findParentFrame(this));
        ff.show();
        txtFile.setText(ff.getDirectory()+ff.getFile());
        
    }//GEN-LAST:event_jButton8ActionPerformed
    
    private void jButton7ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton7ActionPerformed
        // TODO add your handling code here:
        EITLERP.data.Execute("DELETE FROM TR_COBOL",FinanceGlobal.FinURL);
        ExportTrType3();
        writeToFile(EITLERPGLOBAL.formatDateDB(txtFromDate.getText()),EITLERPGLOBAL.formatDateDB(txtToDate.getText()));
    }//GEN-LAST:event_jButton7ActionPerformed
    
    private void writeToFile(String FromDate,String ToDate) {
        try{
            String FromdMonth,FromdYear,FromdDate,TodMonth,TodYear,TodDate,MainCode,SubCode,AllocCode,PoNo,PoAl ="";
            FromdMonth = FromDate.substring(5,7);
            FromdDate = FromDate.substring(8,10);
            FromdYear = FromDate.substring(2,4);
            TodMonth = ToDate.substring(5,7);
            TodDate = ToDate.substring(8,10);
            TodYear = ToDate.substring(2,4);
            BufferedWriter aFile=new BufferedWriter(new FileWriter(new File(txtFile.getText())));
            EITLERP.data.Execute("UPDATE TR_COBOL SET TR_PO_AL ='G ' WHERE TR_PO_NO LIKE 'B%'",FinanceGlobal.FinURL);
            //EITLERP.data.Execute("DELETE  FROM TR_COBOL WHERE TR_MAIN_CODE LIKE '<%' OR TR_SUB_CODE LIKE '<%' OR TR_ALLOC_CODE LIKE '<%'",FinanceGlobal.FinURL);
            ResultSet rsFile = EITLERP.data.getResult("SELECT * FROM TR_COBOL ",FinanceGlobal.FinURL);
            
            while (!rsFile.isAfterLast()) {
                
                MainCode = rsFile.getString("TR_MAIN_CODE");
                SubCode = rsFile.getString("TR_SUB_CODE");
                AllocCode = rsFile.getString("TR_ALLOC_CODE");
                PoNo =rsFile.getString("TR_PO_NO");
                PoAl =rsFile.getString("TR_PO_AL");
                
                if (PoNo.equals("")) {
                    PoNo ="000000";
                }
                if (PoAl.equals("")) {
                    PoAl ="  ";
                }
                if (MainCode.substring(0,1).equals("<")) {
                    MainCode ="000000";
                }
                if (!(SubCode.equals(""))) {
                    if(SubCode.substring(0,1).equals("<")) {
                        SubCode ="000000";
                    }
                }
                else if (SubCode.equals("")) {
                    SubCode="000000";
                }
                
                if (!(AllocCode.equals(""))) {
                    if(AllocCode.substring(0,1).equals("<")) {
                        AllocCode ="000000";
                    }
                }
                else if(AllocCode.equals("")) {
                    AllocCode="000000";
                }
                aFile.write(rsFile.getString("TR_REC_TYPE")+rsFile.getString("TR_INV_AGSR")+rsFile.getString("TR_DIV_CODE")+rsFile.getString("BOOK_CODE")+rsFile.getString("TR_YR")+rsFile.getString("TR_MT")+rsFile.getString("TR_DT")+rsFile.getString("TR_REF_AL")+rsFile.getString("TR_REF_NO")+MainCode+SubCode+rsFile.getString("TR_CHEQUE_NO")+rsFile.getString("TR_REF_SR")+rsFile.getString("TR_CHQ_BILL_DATE")+rsFile.getString("TR_DESCRIPTION")+rsFile.getString("SALETAX_CODE")+rsFile.getString("TR_AMT")+rsFile.getString("TR_AMT_SIGN")+AllocCode+PoAl+PoNo+"00"+rsFile.getString("TR_BILL_NO")+"00"+rsFile.getString("TR_INV_Y1Y2")+"000");
                aFile.newLine();
                rsFile.next();
            }
            aFile.close();
        }
        catch(Exception e)
        { e.printStackTrace();}
    }
    
    private void ExportTrType1(){
        
        // new Thread() {
        
        //    public void run(){
        boolean Done=false;
        long Counter=0;
        String VoucherNo="";
        String BlockNo="1";
        String chrPoAl="";
        String chrPoNo="";
        String PoNo="";
        String PoAl="";
        
        int refNo = 1 ;
        
        
        try {
            
            
            Connection objConn=EITLERP.data.getConn(FinanceGlobal.FinURL);
            Statement stTemp=objConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
            
            Statement stCobol=objConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
            ResultSet rsCobol=stCobol.executeQuery("SELECT * FROM TR_COBOL LIMIT 1");
            
            /*EITLERP.data.Execute("DELETE FROM TMP_GENERAL",FinanceGlobal.FinURL);
            String strQuery = "INSERT INTO TMP_GENERAL(COLUMN_1,COLUMN_2,COLUMN_3,COLUMN_4,COLUMN_5,COLUMN_6,COLUMN_7,COLUMN_8,COLUMN_9,COLUMN_10,COLUMN_11,COLUMN_12,COLUMN_13,COLUMN_14,COLUMN_15,COLUMN_16,COLUMN_17,COLUMN_18,COLUMN_19,COLUMN_20,COLUMN_21,COLUMN_22,COLUMN_23,COLUMN_24)" ;
            EITLERP.data.Execute(strQuery+" SELECT '01'  TR_REC_TYPE,'000000' TR_INV_AGSR,'03'  TR_DIV_CODE,A.BOOK_CODE  TR_BOOK_CODE,DATE_FORMAT(A.VOUCHER_DATE,'%y')  TR_YR,DATE_FORMAT(A.VOUCHER_DATE,'%m')  TR_MT,DATE_FORMAT(A.VOUCHER_DATE,'%d')  TR_DY,'' TR_REF_AL,'' TR_REF__NO,B.MAIN_ACCOUNT_CODE  TR_MAIN_CODE,B.SUB_ACCOUNT_CODE  TR_SUB_CODE,A.CHEQUE_NO TR_CHEQUE_NO,DATE_FORMAT(A.CHEQUE_DATE,'%d%m%y')  TR_CHEQ_BILL_DATE,A.REMARKS AS TR_DESCRIPTION,B.AMOUNT  TR_AMT,B.EFFECT TR_AMT_SIGN,'' TR_ALLOC_CODE,B.PO_NO  TR_PO_NO, A.ST_CATEGORY AS TR_SALETAX,B.INVOICE_NO  TR_BILL_NO,CONCAT(substr(year(B.INVOICE_DATE),3,2),(substr(year(B.INVOICE_DATE),3,2)+1))  TR_INV_Y1Y2 ,DATE_FORMAT(B.INVOICE_DATE,'%d%m%y') BILL_DATE,B.BLOCK_NO  AS EX_BLOCK_NO,A.VOUCHER_NO VOUCHER_NO FROM D_FIN_VOUCHER_HEADER A,D_FIN_VOUCHER_DETAIL_EX B  WHERE A.VOUCHER_NO = B.VOUCHER_NO AND A.VOUCHER_DATE >='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND A.VOUCHER_DATE <='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' AND A.VOUCHER_NO NOT LIKE 'M%' AND A.BOOK_CODE IN(04,12,10,13,15,16,17,18,19,20,24,40,41,42,43,44,61,63,64,65,67,70,71,72,73,74,75,76,77,78,79,80) AND A.COMPANY_ID =2  ORDER BY A.VOUCHER_NO,B.SR_NO",FinanceGlobal.FinURL);
            ResultSet rsTmp=EITLERP.data.getResult("SELECT * FROM TMP_GENERAL ORDER BY COLUMN_4,COLUMN_5,COLUMN_6,COLUMN_7,COLUMN_24,COLUMN_23,COLUMN_16",FinanceGlobal.FinURL);
            rsTmp.last();
            rsTmp.first();
            VoucherNo = rsTmp.getString("COLUMN_24");
            BlockNo = rsTmp.getString("COLUMN_23");*/
            
            ResultSet rsVoucher,rsBlock,rsHeader,rsTmp;
            //rsVoucher=EITLERP.data.getResult("SELECT DISTINCT(VOUCHER_NO) FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO NOT LIKE 'M%' AND BOOK_CODE IN (63) AND APPROVED ='1' AND CANCELLED ='0' AND VOUCHER_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND VOUCHER_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ORDER BY VOUCHER_DATE,BOOK_CODE",FinanceGlobal.FinURL);
            rsVoucher=EITLERP.data.getResult("SELECT DISTINCT(VOUCHER_NO) FROM D_FIN_VOUCHER_HEADER WHERE BOOK_CODE IN (23,26,27,28,29,30,31,32,33,34,35,36,37,38,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,70,71,72,73,74,75,76,77,78,79,80) AND VOUCHER_NO NOT LIKE 'M%'  AND APPROVED ='1' AND CANCELLED ='0' AND VOUCHER_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND VOUCHER_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ORDER BY VOUCHER_DATE,BOOK_CODE",FinanceGlobal.FinURL);
            //rsVoucher=EITLERP.data.getResult("SELECT DISTINCT(VOUCHER_NO) FROM D_FIN_VOUCHER_HEADER WHERE BOOK_CODE IN (36) AND VOUCHER_NO NOT LIKE 'M%'  AND APPROVED ='1' AND CANCELLED ='0' AND VOUCHER_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND VOUCHER_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ORDER BY VOUCHER_DATE,BOOK_CODE",FinanceGlobal.FinURL);
            rsVoucher.first();
            
            if(rsVoucher.getRow()>0) {
                while(!rsVoucher.isAfterLast()) {
                    
                    //For voucher header information
                    rsHeader=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO='"+rsVoucher.getString("VOUCHER_NO")+"'",FinanceGlobal.FinURL);
                    
                    VoucherNo=rsHeader.getString("VOUCHER_NO");
                    String VoucherDate=rsHeader.getString("VOUCHER_DATE");
                    
                    String Month=VoucherDate.substring(5,7);
                    String Day=VoucherDate.substring(8,10);
                    String Year=VoucherDate.substring(2,4);
                    String BookCode=rsHeader.getString("BOOK_CODE");
                    
                    
                    //Generate New Reference No.
                    String LastNo=Integer.toString(UtilFunctions.CInt(EITLERP.data.getStringValueFromDB("SELECT MAX(TR_REF_NO) AS MAX_NO FROM TR_COBOL WHERE TR_MT='"+Month+"' AND TR_DT='"+Day+"' AND BOOK_CODE='"+BookCode+"'",FinanceGlobal.FinURL))+1);
                    String RefNo=EITLERPGLOBAL.Replicate("0", 6-LastNo.length())+LastNo;
                    int RefSrNo=0;
                    
                    
                    rsBlock=EITLERP.data.getResult("SELECT DISTINCT(BLOCK_NO) FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"'",FinanceGlobal.FinURL);
                    rsBlock.first();
                    
                    if(rsBlock.getRow()>0) {
                        
                        while(!rsBlock.isAfterLast()) {
                            
                            BlockNo = rsBlock.getString("BLOCK_NO");
                            String Sign,ChequeNo,BillDate,ChequeDate,Description,SaleTaxCode,TrAmount,TrSign ="";
                            String BillNo,Yr1_Yr2,PoFlg,AllocationCode,strRefSrNo ="";
                            PoAl="";
                            PoNo="";
                            chrPoNo="";
                            //BlockNo = rsBlock.getString("BLOCK_NO");
                            if(EITLERP.data.IsRecordExist("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX A,D_FIN_TR_MAPPING B,D_FIN_VOUCHER_HEADER C WHERE A.VOUCHER_NO  ='"+VoucherNo+"' AND A.VOUCHER_NO =C.VOUCHER_NO AND B.ITEM_CODE = '"+rsHeader.getString("BOOK_CODE")+"' AND A.MAIN_ACCOUNT_CODE =B.MAIN_ACCOUNT_CODE AND A.BLOCK_NO ='"+BlockNo+"'",FinanceGlobal.FinURL)) {
                                if(EITLERP.data.IsRecordExist("SELECT B.MAIN_ACCOUNT_CODE,B.EFFECT FROM D_FIN_VOUCHER_HEADER A,D_FIN_VOUCHER_DETAIL_EX B,D_FIN_TR_MAPPING C WHERE A.VOUCHER_NO ='"+VoucherNo+"'  AND B.BLOCK_NO ='"+BlockNo+"' AND A.VOUCHER_NO = B.VOUCHER_NO AND A.BOOK_CODE =C.ITEM_CODE AND C.MAIN_ACCOUNT_CODE = B.MAIN_ACCOUNT_CODE",FinanceGlobal.FinURL)) {
                                    rsTmp = EITLERP.data.getResult("SELECT B.MAIN_ACCOUNT_CODE,B.EFFECT FROM D_FIN_VOUCHER_HEADER A,D_FIN_VOUCHER_DETAIL_EX B,D_FIN_TR_MAPPING C WHERE A.VOUCHER_NO ='"+VoucherNo+"'  AND B.BLOCK_NO ='"+BlockNo+"' AND A.VOUCHER_NO = B.VOUCHER_NO AND A.BOOK_CODE =C.ITEM_CODE AND C.MAIN_ACCOUNT_CODE = B.MAIN_ACCOUNT_CODE",FinanceGlobal.FinURL);
                                    System.out.println(VoucherNo +"Date :"+VoucherDate);
                                    AllocationCode = rsTmp.getString("MAIN_ACCOUNT_CODE");
                                    Sign = rsTmp.getString("EFFECT");
                                    
                                    rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO="+BlockNo+" AND EFFECT <>'"+Sign+"'",FinanceGlobal.FinURL);
                                    Sign=rsTmp.getString("EFFECT");
                                    
                                    // Export this entry to Cobol
                                    rsCobol.moveToInsertRow();
                                    rsCobol.updateString("TR_REC_TYPE", "01");
                                    rsCobol.updateString("TR_INV_AGSR", "000000");
                                    rsCobol.updateString("TR_DIV_CODE", "03");
                                    rsCobol.updateString("BOOK_CODE",rsHeader.getString("BOOK_CODE"));
                                    rsCobol.updateString("TR_YR",Year);
                                    rsCobol.updateString("TR_MT",Month);
                                    rsCobol.updateString("TR_DT",Day);
                                    rsCobol.updateString("TR_REF_AL","  ");
                                    rsCobol.updateString("TR_REF_NO",RefNo);
                                    rsCobol.updateString("TR_MAIN_CODE",rsTmp.getString("MAIN_ACCOUNT_CODE"));
                                    rsCobol.updateString("TR_SUB_CODE",rsTmp.getString("SUB_ACCOUNT_CODE"));
                                    
                                    
                                    //(1) Cheque No. Start ==================================
                                    if(!UtilFunctions.getString(rsHeader,"CHEQUE_NO","").equals("")) {
                                        ChequeNo=UtilFunctions.getString(rsHeader,"CHEQUE_NO","");
                                        
                                        if(ChequeNo.length()>8) {
                                            ChequeNo=ChequeNo.substring(0,8);
                                        }
                                        else {
                                            ChequeNo=EITLERPGLOBAL.padLeft(8,ChequeNo, "0");
                                        }
                                        
                                        rsCobol.updateString("TR_CHEQUE_NO", ChequeNo);
                                    }
                                    else {
                                        rsCobol.updateString("TR_CHEQUE_NO","00000000");
                                    }
                                    //==============Cheque No. Over ========================
                                    
                                    
                                    //(2) Cheque/Bill Date =====================================
                                    BillDate=UtilFunctions.getString(rsTmp,"INVOICE_DATE","0000-00-00");
                                    ChequeDate=UtilFunctions.getString(rsHeader,"CHEQUE_DATE","0000-00-00");
                                    
                                    
                                    if(!BillDate.trim().equals("")) {
                                        rsCobol.updateString("TR_CHQ_BILL_DATE", BillDate.substring(8,10)+BillDate.substring(5,7)+BillDate.substring(2,4));
                                    }
                                    else {
                                        if(!ChequeDate.trim().equals("")) {
                                            rsCobol.updateString("TR_CHQ_BILL_DATE", ChequeDate.substring(8,10)+ChequeDate.substring(5,7)+ChequeDate.substring(2,4));
                                        }
                                        else {
                                            //No bill date and cheque date specified
                                            rsCobol.updateString("TR_CHQ_BILL_DATE","000000");
                                        }
                                    }
                                    //================ Cheque/Bill Date Over =======================
                                    
                                    
                                    
                                    //(3) Description ==============================================
                                    Description=UtilFunctions.getString(rsHeader,"REMARKS","");
                                    if(Description.length()>25) {
                                        Description=Description.substring(0,25);
                                    }
                                    else {
                                        Description=EITLERPGLOBAL.padRight(25, Description," ");
                                    }
                                    
                                    rsCobol.updateString("TR_DESCRIPTION", Description);
                                    //==============================================================
                                    
                                    
                                    
                                    //(4) Sales Tax Category =========================================
                                    SaleTaxCode = UtilFunctions.getString(rsHeader,"ST_CATEGORY","");
                                    
                                    if(SaleTaxCode.length()>2) {
                                        SaleTaxCode=SaleTaxCode.substring(0,2);
                                    }
                                    else {
                                        SaleTaxCode=EITLERPGLOBAL.padLeft(2, SaleTaxCode,"0");
                                    }
                                    
                                    
                                    rsCobol.updateString("SALETAX_CODE", SaleTaxCode);
                                    //===============================================================
                                    
                                    //(5) Amount ======================================================
                                    TrAmount = Integer.toString(UtilFunctions.getInt(rsTmp,"AMOUNT",0)*100);
                                    //String TrAmount = Double.toString(EITLERPGLOBAL.round(UtilFunctions.getDouble(rsTmp,"AMOUNT", 0), 2));
                                    if(TrAmount.length()>11) {
                                        TrAmount=TrAmount.substring(0,11);
                                    }
                                    else {
                                        TrAmount=EITLERPGLOBAL.padLeft(11,TrAmount,"0");
                                    }
                                    
                                    rsCobol.updateString("TR_AMT", TrAmount);
                                    //=================================================================
                                    
                                    
                                    //(6) Amount Sign =====================================================
                                    TrSign = UtilFunctions.getString(rsTmp,"EFFECT","");
                                    rsCobol.updateString("TR_AMT_SIGN", TrSign);
                                    // Amount Sign Over ================================================
                                    
                                    
                                    //(7) PO No. and suffix ==============================================
                                    
                                    if(VoucherNo.equals("PA076100205")) {
                                        boolean halt=true;
                                    }
                                    PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                    
                                    if(PoAl.equals("")) {
                                        PoAl ="   ";
                                    }
                                    
                                    if (PoAl.substring(0,1).equals("B")) {
                                        chrPoAl = "G ";
                                    }
                                    else if (PoAl.substring(0,1).equals("P")) {
                                        chrPoAl = "P ";
                                    }
                                    else if (PoAl.substring(0,1).equals("W")) {
                                        chrPoAl = "W ";
                                    }
                                    
                                    //PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000").substring(0,1);
                                    
                                    else if (PoAl.substring(0,1).equals("A")) {
                                        if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                            chrPoAl = "A " ;
                                        else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                            chrPoAl = "CP";
                                        }
                                    }
                                    else if (PoAl.substring(0,2).equals("A3")) {
                                        chrPoAl = "CP";
                                    }
                                    else if (PoAl.substring(0,2).equals("D-")) {
                                        chrPoAl ="D ";
                                    }
                                    else if (PoAl.substring(0,2).equals("I/")) {
                                        chrPoAl ="I ";
                                    }
                                    else if (PoAl.substring(0,1).equals("S")) {
                                        chrPoAl ="S ";
                                    }
                                    else if (PoAl.substring(0,2).equals("RM")) {
                                        chrPoAl ="RM";
                                    }
                                    else if (PoAl.substring(0,2).equals("CA")) {
                                        chrPoAl ="CA";
                                    }
                                    
                                    else {
                                        chrPoAl ="  ";
                                    }
                                    
                                    rsCobol.updateString("TR_PO_AL",chrPoAl);  //REQUIRED TO BE CHANGED
                                    
                                    
                                    
                                    PoNo = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                    if(PoNo.trim().equals("")) {
                                        PoNo ="000000";
                                    }
                                    
                                    //System.out.println("PO Length" + PoNo.length());
                                    
                                    if (PoNo.substring(0,1).equals("B")) {
                                        if(PoNo.length()==6) {
                                            chrPoNo = "B" + PoNo.substring(1,6);
                                        }
                                        else {
                                            chrPoNo = "B" + PoNo.substring(2,7);
                                        }
                                    }
                                    else if (PoNo.substring(0,1).equals("G")) {
                                        chrPoNo = "B0" + PoNo.substring(2,6);
                                    }
                                    else if (PoNo.substring(0,1).equals("W")) {
                                        chrPoNo = PoNo.substring(1,7);
                                    }
                                    else if (PoNo.substring(0,1).equals("P")) {
                                        chrPoNo = PoNo.substring(1,7);
                                    }
                                    else if (PoNo.substring(0,1).equals("A")) {
                                        if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                            chrPoNo = "0" +PoNo.substring(1,6);
                                        else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                            chrPoNo = "A"+PoNo.substring(2,7);
                                        }
                                        
                                    }
                                    
                                    //PoNo = PoNo.substring(0,2);
                                    else if (PoNo.substring(0,2).equals("D-")) {
                                        chrPoNo = "0"+ PoNo.substring(2,7);
                                    }
                                    
                                    else if (PoNo.substring(0,2).equals("I/")) {
                                        chrPoNo = PoNo.substring(2,8);
                                    }
                                    
                                    else if (PoNo.substring(0,1).equals("S")) {
                                        
                                        if(PoNo.length()==6) {
                                            chrPoNo = "0" + PoNo.substring(1,6);
                                        }
                                        else {
                                            chrPoNo = "0" + PoNo.substring(2,7);
                                        }
                                        
                                    }
                                    else if (PoNo.substring(0,2).equals("CA")) {
                                        chrPoNo = "0"+PoNo.substring(2,7);
                                    }
                                    else if (PoNo.substring(0,2).equals("RM")) {
                                        chrPoNo = "0"+PoNo.substring(2,7);
                                    }
                                    else {
                                        chrPoNo = "000000" ;
                                    }
                                    
                                    
                                    rsCobol.updateString("TR_PO_NO",chrPoNo); //REQUIRED TO BE CHANGED
                                    //  PO Over ==================================================================
                                    
                                    
                                    //(7) PO Flag ================================================================
                                    PoFlg = UtilFunctions.getString(rsTmp,"COMPANY_ID","");
                                    
                                    if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2")) {
                                        PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'",EITLERPGLOBAL.DatabaseURL);
                                    }
                                    else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3"))
                                        
                                    {
                                        PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'","jdbc:mysql://200.0.0.227:3306/DINESHMILLSA");
                                    }
                                    
                                    rsCobol.updateString("TR_PO_FLG",PoFlg);//REQUIRED TO BE CHANGED
                                    //============================================================================
                                    
                                    
                                    
                                    //(8) Invoice No. ============================================================
                                    BillNo= UtilFunctions.getString(rsTmp,"INVOICE_NO","0");
                                    if(BillNo.length()>8) {
                                        BillNo=BillNo.substring(0,8);
                                    }
                                    else {
                                        BillNo=EITLERPGLOBAL.padLeft(8, BillNo,"0");
                                    }
                                    
                                    rsCobol.updateString("TR_BILL_NO",BillNo);
                                    //============================================================================
                                    
                                    
                                    
                                    //(9) Year ===================================================================
                                    Yr1_Yr2="0000";
                                    // Yr1_Yr2 = Integer.toString(EITLERPGLOBAL.FinYearFrom).substring(2,3)+Integer.toString(EITLERPGLOBAL.FinYearTo).substring(2,3);
                                    rsCobol.updateString("TR_INV_Y1Y2",Yr1_Yr2 );//REQUIRED TO BE CHANGED
                                    //============================================================================
                                    
                                    
                                    //(10) Reference sr. no. and fixed transaction code ==========================
                                    RefSrNo++;
                                    strRefSrNo=EITLERPGLOBAL.padLeft(4,Integer.toString(RefSrNo),"0");
                                    rsCobol.updateString("TR_REF_SR",strRefSrNo);
                                    rsCobol.updateString("TR_TRAN_CODE","000");
                                    //============================================================================
                                    
                                    
                                    //**** Find Opposite Entry ***********//
                                    //rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO="+BlockNo+" AND EFFECT<>'"+Sign+"'",FinanceGlobal.FinURL);
                                    //Replace allocation code of above record with this record's main code
                                    
                                    
                                    //(11) Allocation Code =======================================================
                                    //AllocationCode=UtilFunctions.getString(rsTmp,"MAIN_ACCOUNT_CODE","");
                                    //rsCobol.updateString("TR_ALLOC_CODE",AllocationCode);Commented By nisarg
                                    rsCobol.updateString("TR_ALLOC_CODE","000000");
                                    //============================================================================
                                    
                                    rsCobol.insertRow() ;
                                }
                                else if(EITLERP.data.IsRecordExist("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO="+BlockNo+" AND MAIN_ACCOUNT_CODE<>'' AND SUB_ACCOUNT_CODE<>''",FinanceGlobal.FinURL)) {
                                    rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO="+BlockNo+" AND MAIN_ACCOUNT_CODE<>'' AND SUB_ACCOUNT_CODE<>''",FinanceGlobal.FinURL);
                                    System.out.println(VoucherNo +"Date :"+VoucherDate);
                                    
                                    Sign=rsTmp.getString("EFFECT");
                                    
                                    // Export this entry to Cobol
                                    rsCobol.moveToInsertRow();
                                    rsCobol.updateString("TR_REC_TYPE", "01");
                                    rsCobol.updateString("TR_INV_AGSR", "000000");
                                    rsCobol.updateString("TR_DIV_CODE", "03");
                                    rsCobol.updateString("BOOK_CODE",rsHeader.getString("BOOK_CODE"));
                                    rsCobol.updateString("TR_YR",Year);
                                    rsCobol.updateString("TR_MT",Month);
                                    rsCobol.updateString("TR_DT",Day);
                                    rsCobol.updateString("TR_REF_AL","  ");
                                    rsCobol.updateString("TR_REF_NO",RefNo);
                                    rsCobol.updateString("TR_MAIN_CODE",rsTmp.getString("MAIN_ACCOUNT_CODE"));
                                    rsCobol.updateString("TR_SUB_CODE",rsTmp.getString("SUB_ACCOUNT_CODE"));
                                    
                                    
                                    //(1) Cheque No. Start ==================================
                                    if(!UtilFunctions.getString(rsHeader,"CHEQUE_NO","").equals("")) {
                                        ChequeNo=UtilFunctions.getString(rsHeader,"CHEQUE_NO","");
                                        
                                        if(ChequeNo.length()>8) {
                                            ChequeNo=ChequeNo.substring(0,8);
                                        }
                                        else {
                                            ChequeNo=EITLERPGLOBAL.padLeft(8,ChequeNo, "0");
                                        }
                                        
                                        rsCobol.updateString("TR_CHEQUE_NO", ChequeNo);
                                    }
                                    else {
                                        rsCobol.updateString("TR_CHEQUE_NO","00000000");
                                    }
                                    //==============Cheque No. Over ========================
                                    
                                    
                                    //(2) Cheque/Bill Date =====================================
                                    BillDate=UtilFunctions.getString(rsTmp,"INVOICE_DATE","0000-00-00");
                                    ChequeDate=UtilFunctions.getString(rsHeader,"CHEQUE_DATE","0000-00-00");
                                    
                                    
                                    if(!BillDate.trim().equals("")) {
                                        rsCobol.updateString("TR_CHQ_BILL_DATE", BillDate.substring(8,10)+BillDate.substring(5,7)+BillDate.substring(2,4));
                                    }
                                    else {
                                        if(!ChequeDate.trim().equals("")) {
                                            rsCobol.updateString("TR_CHQ_BILL_DATE", ChequeDate.substring(8,10)+ChequeDate.substring(5,7)+ChequeDate.substring(2,4));
                                        }
                                        else {
                                            //No bill date and cheque date specified
                                            rsCobol.updateString("TR_CHQ_BILL_DATE","000000");
                                        }
                                    }
                                    //================ Cheque/Bill Date Over =======================
                                    
                                    
                                    
                                    //(3) Description ==============================================
                                    Description=UtilFunctions.getString(rsHeader,"REMARKS","");
                                    if(Description.length()>25) {
                                        Description=Description.substring(0,25);
                                    }
                                    else {
                                        Description=EITLERPGLOBAL.padRight(25, Description," ");
                                    }
                                    
                                    rsCobol.updateString("TR_DESCRIPTION", Description);
                                    //==============================================================
                                    
                                    
                                    
                                    //(4) Sales Tax Category =========================================
                                    SaleTaxCode = UtilFunctions.getString(rsHeader,"ST_CATEGORY","");
                                    
                                    if(SaleTaxCode.length()>2) {
                                        SaleTaxCode=SaleTaxCode.substring(0,2);
                                    }
                                    else {
                                        SaleTaxCode=EITLERPGLOBAL.padLeft(2, SaleTaxCode,"0");
                                    }
                                    
                                    
                                    rsCobol.updateString("SALETAX_CODE", SaleTaxCode);
                                    //===============================================================
                                    
                                    //(5) Amount ======================================================
                                    TrAmount = Integer.toString(UtilFunctions.getInt(rsTmp,"AMOUNT",0)*100);
                                    //String TrAmount = Double.toString(EITLERPGLOBAL.round(UtilFunctions.getDouble(rsTmp,"AMOUNT", 0), 2));
                                    if(TrAmount.length()>11) {
                                        TrAmount=TrAmount.substring(0,11);
                                    }
                                    else {
                                        TrAmount=EITLERPGLOBAL.padLeft(11,TrAmount,"0");
                                    }
                                    
                                    rsCobol.updateString("TR_AMT", TrAmount);
                                    //=================================================================
                                    
                                    
                                    //(6) Amount Sign =====================================================
                                    TrSign = UtilFunctions.getString(rsTmp,"EFFECT","");
                                    rsCobol.updateString("TR_AMT_SIGN", TrSign);
                                    // Amount Sign Over ================================================
                                    
                                    
                                    //(7) PO No. and suffix ==============================================
                                    
                                    if(VoucherNo.equals("PA076100205")) {
                                        boolean halt=true;
                                    }
                                    PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                    
                                    if(PoAl.equals("")) {
                                        PoAl ="   ";
                                    }
                                    
                                    if (PoAl.substring(0,1).equals("B")) {
                                        chrPoAl = "G ";
                                    }
                                    else if (PoAl.substring(0,1).equals("P")) {
                                        chrPoAl = "P ";
                                    }
                                    else if (PoAl.substring(0,1).equals("W")) {
                                        chrPoAl = "W ";
                                    }
                                    
                                    //PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000").substring(0,1);
                                    
                                    else if (PoAl.substring(0,1).equals("A")) {
                                        if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                            chrPoAl = "A " ;
                                        else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                            chrPoAl = "CP";
                                        }
                                    }
                                    else if (PoAl.substring(0,2).equals("A3")) {
                                        chrPoAl = "CP";
                                    }
                                    else if (PoAl.substring(0,2).equals("D-")) {
                                        chrPoAl ="D ";
                                    }
                                    else if (PoAl.substring(0,2).equals("I/")) {
                                        chrPoAl ="I ";
                                    }
                                    else if (PoAl.substring(0,1).equals("S")){
                                        chrPoAl ="S ";
                                    }
                                    else if (PoAl.substring(0,2).equals("RM")) {
                                        chrPoAl ="RM";
                                    }
                                    else if (PoAl.substring(0,2).equals("CA")) {
                                        chrPoAl ="CA";
                                    }
                                    
                                    else {
                                        chrPoAl ="  ";
                                    }
                                    
                                    rsCobol.updateString("TR_PO_AL",chrPoAl);  //REQUIRED TO BE CHANGED
                                    
                                    
                                    
                                    PoNo = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                    if(PoNo.trim().equals("")) {
                                        PoNo ="000000";
                                    }
                                    
                                    //System.out.println("PO Length" + PoNo.length());
                                    
                                    if (PoNo.substring(0,1).equals("B")) {
                                        if(PoNo.length()==6) {
                                            chrPoNo = "B" + PoNo.substring(1,6);
                                        }
                                        else {
                                            chrPoNo = "B" + PoNo.substring(2,7);
                                        }
                                    }
                                    else if (PoNo.substring(0,1).equals("G")) {
                                        chrPoNo = "B0" + PoNo.substring(2,6);
                                    }
                                    else if (PoNo.substring(0,1).equals("W")) {
                                        chrPoNo = PoNo.substring(1,7);
                                    }
                                    else if (PoNo.substring(0,1).equals("P")) {
                                        chrPoNo = PoNo.substring(1,7);
                                    }
                                    else if (PoNo.substring(0,1).equals("A")) {
                                        if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                            chrPoNo = "0" +PoNo.substring(1,6);
                                        else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                            chrPoNo = "A"+PoNo.substring(2,7);
                                        }
                                        
                                    }
                                    
                                    //PoNo = PoNo.substring(0,2);
                                    else if (PoNo.substring(0,2).equals("D-")) {
                                        chrPoNo = "0"+ PoNo.substring(2,7);
                                    }
                                    
                                    else if (PoNo.substring(0,2).equals("I/")) {
                                        chrPoNo = PoNo.substring(2,8);
                                    }
                                    
                                    else if (PoNo.substring(0,1).equals("S")) {
                                        
                                        if(PoNo.length()==6) {
                                            chrPoNo = "0" + PoNo.substring(1,6);
                                        }
                                        else {
                                            chrPoNo = "0" + PoNo.substring(2,7);
                                        }
                                        
                                    }
                                    else if (PoNo.substring(0,2).equals("CA")) {
                                        chrPoNo = "0"+PoNo.substring(2,7);
                                    }
                                    else if (PoNo.substring(0,2).equals("RM")) {
                                        chrPoNo = "0"+PoNo.substring(2,7);
                                    }
                                    else {
                                        chrPoNo = "000000" ;
                                    }
                                    
                                    
                                    rsCobol.updateString("TR_PO_NO",chrPoNo); //REQUIRED TO BE CHANGED
                                    //  PO Over ==================================================================
                                    
                                    
                                    //(7) PO Flag ================================================================
                                    PoFlg = UtilFunctions.getString(rsTmp,"COMPANY_ID","");
                                    
                                    if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2")) {
                                        PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'",EITLERPGLOBAL.DatabaseURL);
                                    }
                                    else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3"))
                                        
                                    {
                                        PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'","jdbc:mysql://200.0.0.227:3306/DINESHMILLSA");
                                    }
                                    
                                    rsCobol.updateString("TR_PO_FLG",PoFlg);//REQUIRED TO BE CHANGED
                                    //============================================================================
                                    
                                    
                                    
                                    //(8) Invoice No. ============================================================
                                    BillNo= UtilFunctions.getString(rsTmp,"INVOICE_NO","0");
                                    if(BillNo.length()>8) {
                                        BillNo=BillNo.substring(0,8);
                                    }
                                    else {
                                        BillNo=EITLERPGLOBAL.padLeft(8, BillNo,"0");
                                    }
                                    
                                    rsCobol.updateString("TR_BILL_NO",BillNo);
                                    //============================================================================
                                    
                                    
                                    
                                    //(9) Year ===================================================================
                                    Yr1_Yr2="0000";
                                    // Yr1_Yr2 = Integer.toString(EITLERPGLOBAL.FinYearFrom).substring(2,3)+Integer.toString(EITLERPGLOBAL.FinYearTo).substring(2,3);
                                    rsCobol.updateString("TR_INV_Y1Y2",Yr1_Yr2 );//REQUIRED TO BE CHANGED
                                    //============================================================================
                                    
                                    
                                    //(10) Reference sr. no. and fixed transaction code ==========================
                                    RefSrNo++;
                                    strRefSrNo=EITLERPGLOBAL.padLeft(4,Integer.toString(RefSrNo),"0");
                                    rsCobol.updateString("TR_REF_SR",strRefSrNo);
                                    rsCobol.updateString("TR_TRAN_CODE","000");
                                    //============================================================================
                                    
                                    
                                    //**** Find Opposite Entry ***********//
                                    rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO="+BlockNo+" AND EFFECT<>'"+Sign+"'",FinanceGlobal.FinURL);
                                    //Replace allocation code of above record with this record's main code
                                    
                                    
                                    //(11) Allocation Code =======================================================
                                    AllocationCode=UtilFunctions.getString(rsTmp,"MAIN_ACCOUNT_CODE","");
                                    //rsCobol.updateString("TR_ALLOC_CODE",AllocationCode);commented by nisarg
                                    rsCobol.updateString("TR_ALLOC_CODE","000000");
                                    //============================================================================
                                    
                                    rsCobol.insertRow() ;
                                    
                                    
                                }
                                else {
                                    rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO='"+BlockNo+"' LIMIT 1",FinanceGlobal.FinURL);
                                    System.out.println(VoucherNo +"Date :"+VoucherDate);
                                    
                                    Sign=rsTmp.getString("EFFECT");
                                    
                                    // Export this entry to Cobol
                                    rsCobol.moveToInsertRow();
                                    rsCobol.updateString("TR_REC_TYPE", "01");
                                    rsCobol.updateString("TR_INV_AGSR", "000000");
                                    rsCobol.updateString("TR_DIV_CODE", "03");
                                    rsCobol.updateString("BOOK_CODE",rsHeader.getString("BOOK_CODE"));
                                    rsCobol.updateString("TR_YR",Year);
                                    rsCobol.updateString("TR_MT",Month);
                                    rsCobol.updateString("TR_DT",Day);
                                    rsCobol.updateString("TR_REF_AL","  ");
                                    rsCobol.updateString("TR_REF_NO",RefNo);
                                    rsCobol.updateString("TR_MAIN_CODE",rsTmp.getString("MAIN_ACCOUNT_CODE"));
                                    rsCobol.updateString("TR_SUB_CODE",rsTmp.getString("SUB_ACCOUNT_CODE"));
                                    
                                    
                                    //(1) Cheque No. Start ==================================
                                    if(!UtilFunctions.getString(rsHeader,"CHEQUE_NO","").equals("")) {
                                        ChequeNo=UtilFunctions.getString(rsHeader,"CHEQUE_NO","");
                                        
                                        if(ChequeNo.length()>8) {
                                            ChequeNo=ChequeNo.substring(0,8);
                                        }
                                        else {
                                            ChequeNo=EITLERPGLOBAL.padLeft(8,ChequeNo, "0");
                                        }
                                        
                                        rsCobol.updateString("TR_CHEQUE_NO", ChequeNo);
                                    }
                                    else {
                                        rsCobol.updateString("TR_CHEQUE_NO","00000000");
                                    }
                                    //==============Cheque No. Over ========================
                                    
                                    
                                    //(2) Cheque/Bill Date =====================================
                                    BillDate=UtilFunctions.getString(rsTmp,"INVOICE_DATE","0000-00-00");
                                    ChequeDate=UtilFunctions.getString(rsHeader,"CHEQUE_DATE","0000-00-00");
                                    
                                    
                                    if(!BillDate.trim().equals("")) {
                                        rsCobol.updateString("TR_CHQ_BILL_DATE", BillDate.substring(8,10)+BillDate.substring(5,7)+BillDate.substring(2,4));
                                    }
                                    else {
                                        if(!ChequeDate.trim().equals("")) {
                                            rsCobol.updateString("TR_CHQ_BILL_DATE", ChequeDate.substring(8,10)+ChequeDate.substring(5,7)+ChequeDate.substring(2,4));
                                        }
                                        else {
                                            //No bill date and cheque date specified
                                            rsCobol.updateString("TR_CHQ_BILL_DATE","000000");
                                        }
                                    }
                                    //================ Cheque/Bill Date Over =======================
                                    
                                    
                                    
                                    //(3) Description ==============================================
                                    Description=UtilFunctions.getString(rsHeader,"REMARKS","");
                                    if(Description.length()>25) {
                                        Description=Description.substring(0,25);
                                    }
                                    else {
                                        Description=EITLERPGLOBAL.padRight(25, Description," ");
                                    }
                                    
                                    rsCobol.updateString("TR_DESCRIPTION", Description);
                                    //==============================================================
                                    
                                    
                                    
                                    //(4) Sales Tax Category =========================================
                                    SaleTaxCode = UtilFunctions.getString(rsHeader,"ST_CATEGORY","");
                                    
                                    if(SaleTaxCode.length()>2) {
                                        SaleTaxCode=SaleTaxCode.substring(0,2);
                                    }
                                    else {
                                        SaleTaxCode=EITLERPGLOBAL.padLeft(2, SaleTaxCode,"0");
                                    }
                                    
                                    
                                    rsCobol.updateString("SALETAX_CODE", SaleTaxCode);
                                    //===============================================================
                                    
                                    //(5) Amount ======================================================
                                    TrAmount = Integer.toString(UtilFunctions.getInt(rsTmp,"AMOUNT",0)*100);
                                    //String TrAmount = Double.toString(EITLERPGLOBAL.round(UtilFunctions.getDouble(rsTmp,"AMOUNT", 0), 2));
                                    if(TrAmount.length()>11) {
                                        TrAmount=TrAmount.substring(0,11);
                                    }
                                    else {
                                        TrAmount=EITLERPGLOBAL.padLeft(11,TrAmount,"0");
                                    }
                                    
                                    rsCobol.updateString("TR_AMT", TrAmount);
                                    //=================================================================
                                    
                                    
                                    //(6) Amount Sign =====================================================
                                    TrSign = UtilFunctions.getString(rsTmp,"EFFECT","");
                                    rsCobol.updateString("TR_AMT_SIGN", TrSign);
                                    // Amount Sign Over ================================================
                                    
                                    
                                    //(7) PO No. and suffix ==============================================
                                    
                                    if(VoucherNo.equals("PA076100205")) {
                                        boolean halt=true;
                                    }
                                    PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                    
                                    if(PoAl.equals("")) {
                                        PoAl ="   ";
                                    }
                                    
                                    if (PoAl.substring(0,1).equals("B")) {
                                        chrPoAl = "G ";
                                    }
                                    else if (PoAl.substring(0,1).equals("P")) {
                                        chrPoAl = "P ";
                                    }
                                    else if (PoAl.substring(0,1).equals("W")) {
                                        chrPoAl = "W ";
                                    }
                                    
                                    //PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000").substring(0,1);
                                    
                                    else if (PoAl.substring(0,1).equals("A")) {
                                        if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                            chrPoAl = "A " ;
                                        else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                            chrPoAl = "CP";
                                        }
                                    }
                                    else if (PoAl.substring(0,2).equals("A3")) {
                                        chrPoAl = "CP";
                                    }
                                    else if (PoAl.substring(0,2).equals("D-")) {
                                        chrPoAl ="D ";
                                    }
                                    else if (PoAl.substring(0,2).equals("I/")) {
                                        chrPoAl ="I ";
                                    }
                                    else if (PoAl.substring(0,1).equals("S")){
                                        chrPoAl ="S ";
                                    }
                                    else if (PoAl.substring(0,2).equals("RM")) {
                                        chrPoAl ="RM";
                                    }
                                    else if (PoAl.substring(0,2).equals("CA")) {
                                        chrPoAl ="CA";
                                    }
                                    
                                    else {
                                        chrPoAl ="  ";
                                    }
                                    
                                    rsCobol.updateString("TR_PO_AL",chrPoAl);  //REQUIRED TO BE CHANGED
                                    
                                    
                                    
                                    PoNo = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                    if(PoNo.trim().equals("")) {
                                        PoNo ="000000";
                                    }
                                    
                                    //System.out.println("PO Length" + PoNo.length());
                                    
                                    if (PoNo.substring(0,1).equals("B")) {
                                        if(PoNo.length()==6) {
                                            chrPoNo = "B" + PoNo.substring(1,6);
                                        }
                                        else {
                                            chrPoNo = "B" + PoNo.substring(2,7);
                                        }
                                    }
                                    else if (PoNo.substring(0,1).equals("G")) {
                                        chrPoNo = "B0" + PoNo.substring(2,6);
                                    }
                                    else if (PoNo.substring(0,1).equals("W")) {
                                        chrPoNo = PoNo.substring(1,7);
                                    }
                                    else if (PoNo.substring(0,1).equals("P")) {
                                        chrPoNo = PoNo.substring(1,7);
                                    }
                                    else if (PoNo.substring(0,1).equals("A")) {
                                        if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                            chrPoNo = "0" +PoNo.substring(1,6);
                                        else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                            chrPoNo = "A"+PoNo.substring(2,7);
                                        }
                                        
                                    }
                                    
                                    //PoNo = PoNo.substring(0,2);
                                    else if (PoNo.substring(0,2).equals("D-")) {
                                        chrPoNo = "0"+ PoNo.substring(2,7);
                                    }
                                    
                                    else if (PoNo.substring(0,2).equals("I/")) {
                                        chrPoNo = PoNo.substring(2,8);
                                    }
                                    
                                    else if (PoNo.substring(0,1).equals("S")) {
                                        
                                        if(PoNo.length()==6) {
                                            chrPoNo = "0" + PoNo.substring(1,6);
                                        }
                                        else {
                                            chrPoNo = "0" + PoNo.substring(2,7);
                                        }
                                        
                                    }
                                    else if (PoNo.substring(0,2).equals("CA")) {
                                        chrPoNo = "0"+PoNo.substring(2,7);
                                    }
                                    else if (PoNo.substring(0,2).equals("RM")) {
                                        chrPoNo = "0"+PoNo.substring(2,7);
                                    }
                                    else {
                                        chrPoNo = "000000" ;
                                    }
                                    
                                    
                                    rsCobol.updateString("TR_PO_NO",chrPoNo); //REQUIRED TO BE CHANGED
                                    //  PO Over ==================================================================
                                    
                                    
                                    //(7) PO Flag ================================================================
                                    PoFlg = UtilFunctions.getString(rsTmp,"COMPANY_ID","");
                                    
                                    if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2")) {
                                        PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'",EITLERPGLOBAL.DatabaseURL);
                                    }
                                    else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3"))
                                        
                                    {
                                        PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'","jdbc:mysql://200.0.0.227:3306/DINESHMILLSA");
                                    }
                                    
                                    rsCobol.updateString("TR_PO_FLG",PoFlg);//REQUIRED TO BE CHANGED
                                    //============================================================================
                                    
                                    
                                    
                                    //(8) Invoice No. ============================================================
                                    BillNo= UtilFunctions.getString(rsTmp,"INVOICE_NO","0");
                                    if(BillNo.length()>8) {
                                        BillNo=BillNo.substring(0,8);
                                    }
                                    else {
                                        BillNo=EITLERPGLOBAL.padLeft(8, BillNo,"0");
                                    }
                                    
                                    rsCobol.updateString("TR_BILL_NO",BillNo);
                                    //============================================================================
                                    
                                    
                                    
                                    //(9) Year ===================================================================
                                    Yr1_Yr2="0000";
                                    // Yr1_Yr2 = Integer.toString(EITLERPGLOBAL.FinYearFrom).substring(2,3)+Integer.toString(EITLERPGLOBAL.FinYearTo).substring(2,3);
                                    rsCobol.updateString("TR_INV_Y1Y2",Yr1_Yr2 );//REQUIRED TO BE CHANGED
                                    //============================================================================
                                    
                                    
                                    //(10) Reference sr. no. and fixed transaction code ==========================
                                    RefSrNo++;
                                    strRefSrNo=EITLERPGLOBAL.padLeft(4,Integer.toString(RefSrNo),"0");
                                    rsCobol.updateString("TR_REF_SR",strRefSrNo);
                                    rsCobol.updateString("TR_TRAN_CODE","000");
                                    //============================================================================
                                    
                                    
                                    //**** Find Opposite Entry ***********//
                                    rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO="+BlockNo+" AND EFFECT<>'"+Sign+"'",FinanceGlobal.FinURL);
                                    //Replace allocation code of above record with this record's main code
                                    
                                    
                                    //(11) Allocation Code =======================================================
                                    AllocationCode=UtilFunctions.getString(rsTmp,"MAIN_ACCOUNT_CODE","");
                                    rsCobol.updateString("TR_ALLOC_CODE","000000");
                                    //============================================================================
                                    
                                    rsCobol.insertRow() ;
                                    
                                    
                                }
                            }
                            else {
                                System.out.println("Voucher No."+VoucherNo+"Block No."+BlockNo);
                                String JVRefNo = Integer.toString(UtilFunctions.CInt(EITLERP.data.getStringValueFromDB("SELECT MAX(TR_REF_NO) AS MAX_NO FROM TR_COBOL WHERE TR_MT='"+Month+"' AND TR_DT='"+Day+"' AND BOOK_CODE='25'",FinanceGlobal.FinURL))+1);
                                String JVRefNo1=EITLERPGLOBAL.Replicate("0",6-JVRefNo.length())+JVRefNo;
                                int JVRefSrNo=0;
                                
                                rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO="+BlockNo+" AND EFFECT  ='D'",FinanceGlobal.FinURL);
                                Sign=rsTmp.getString("EFFECT");
                                
                                // Export this entry to Cobol
                                rsCobol.moveToInsertRow();
                                rsCobol.updateString("TR_REC_TYPE", "01");
                                rsCobol.updateString("TR_INV_AGSR", "000000");
                                rsCobol.updateString("TR_DIV_CODE", "03");
                                rsCobol.updateString("BOOK_CODE","25");
                                rsCobol.updateString("TR_YR",Year);
                                rsCobol.updateString("TR_MT",Month);
                                rsCobol.updateString("TR_DT",Day);
                                rsCobol.updateString("TR_REF_AL","  ");
                                rsCobol.updateString("TR_REF_NO",JVRefNo1);
                                rsCobol.updateString("TR_MAIN_CODE",rsTmp.getString("MAIN_ACCOUNT_CODE"));
                                rsCobol.updateString("TR_SUB_CODE",rsTmp.getString("SUB_ACCOUNT_CODE"));
                                
                                
                                //(1) Cheque No. Start ==================================
                                if(!UtilFunctions.getString(rsHeader,"CHEQUE_NO","").equals("")) {
                                    ChequeNo=UtilFunctions.getString(rsHeader,"CHEQUE_NO","");
                                    
                                    if(ChequeNo.length()>8) {
                                        ChequeNo=ChequeNo.substring(0,8);
                                    }
                                    else {
                                        ChequeNo=EITLERPGLOBAL.padLeft(8,ChequeNo, "0");
                                    }
                                    
                                    rsCobol.updateString("TR_CHEQUE_NO", ChequeNo);
                                }
                                else {
                                    rsCobol.updateString("TR_CHEQUE_NO","00000000");
                                }
                                //==============Cheque No. Over ========================
                                
                                
                                //(2) Cheque/Bill Date =====================================
                                BillDate=UtilFunctions.getString(rsTmp,"INVOICE_DATE","0000-00-00");
                                ChequeDate=UtilFunctions.getString(rsHeader,"CHEQUE_DATE","0000-00-00");
                                
                                
                                if(!BillDate.trim().equals("")) {
                                    rsCobol.updateString("TR_CHQ_BILL_DATE", BillDate.substring(8,10)+BillDate.substring(5,7)+BillDate.substring(2,4));
                                }
                                else {
                                    if(!ChequeDate.trim().equals("")) {
                                        rsCobol.updateString("TR_CHQ_BILL_DATE", ChequeDate.substring(8,10)+ChequeDate.substring(5,7)+ChequeDate.substring(2,4));
                                    }
                                    else {
                                        //No bill date and cheque date specified
                                        rsCobol.updateString("TR_CHQ_BILL_DATE","000000");
                                    }
                                }
                                //================ Cheque/Bill Date Over =======================
                                
                                
                                
                                //(3) Description ==============================================
                                Description=UtilFunctions.getString(rsHeader,"REMARKS","");
                                if(Description.length()>25) {
                                    Description=Description.substring(0,25);
                                }
                                else {
                                    Description=EITLERPGLOBAL.padRight(25, Description," ");
                                }
                                
                                rsCobol.updateString("TR_DESCRIPTION", Description);
                                //==============================================================
                                
                                
                                
                                //(4) Sales Tax Category =========================================
                                SaleTaxCode = UtilFunctions.getString(rsHeader,"ST_CATEGORY","");
                                
                                if(SaleTaxCode.length()>2) {
                                    SaleTaxCode=SaleTaxCode.substring(0,2);
                                }
                                else {
                                    SaleTaxCode=EITLERPGLOBAL.padLeft(2, SaleTaxCode,"0");
                                }
                                
                                
                                rsCobol.updateString("SALETAX_CODE", SaleTaxCode);
                                //===============================================================
                                
                                //(5) Amount ======================================================
                                TrAmount = Integer.toString(UtilFunctions.getInt(rsTmp,"AMOUNT",0)*100);
                                //String TrAmount = Double.toString(EITLERPGLOBAL.round(UtilFunctions.getDouble(rsTmp,"AMOUNT", 0), 2));
                                if(TrAmount.length()>11) {
                                    TrAmount=TrAmount.substring(0,11);
                                }
                                else {
                                    TrAmount=EITLERPGLOBAL.padLeft(11,TrAmount,"0");
                                }
                                
                                rsCobol.updateString("TR_AMT", TrAmount);
                                //=================================================================
                                
                                
                                //(6) Amount Sign =====================================================
                                TrSign = UtilFunctions.getString(rsTmp,"EFFECT","");
                                rsCobol.updateString("TR_AMT_SIGN", TrSign);
                                // Amount Sign Over ================================================
                                
                                
                                //(7) PO No. and suffix ==============================================
                                
                                if(VoucherNo.equals("PA076100205")) {
                                    boolean halt=true;
                                }
                                PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                
                                if(PoAl.equals("")) {
                                    PoAl ="   ";
                                }
                                
                                if (PoAl.substring(0,1).equals("B")) {
                                    chrPoAl = "G ";
                                }
                                else if (PoAl.substring(0,1).equals("P")) {
                                    chrPoAl = "P ";
                                }
                                else if (PoAl.substring(0,1).equals("W")) {
                                    chrPoAl = "W ";
                                }
                                
                                //PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000").substring(0,1);
                                
                                else if (PoAl.substring(0,1).equals("A")) {
                                    if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                        chrPoAl = "A " ;
                                    else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                        chrPoAl = "CP";
                                    }
                                }
                                else if (PoAl.substring(0,2).equals("A3")) {
                                    chrPoAl = "CP";
                                }
                                else if (PoAl.substring(0,2).equals("D-")) {
                                    chrPoAl ="D ";
                                }
                                else if (PoAl.substring(0,2).equals("I/")) {
                                    chrPoAl ="I ";
                                }
                                else if (PoAl.substring(0,1).equals("S")) {
                                    chrPoAl ="S ";
                                }
                                else if (PoAl.substring(0,2).equals("RM")) {
                                    chrPoAl ="RM";
                                }
                                else if (PoAl.substring(0,2).equals("CA")) {
                                    chrPoAl ="CA";
                                }
                                
                                else {
                                    chrPoAl ="  ";
                                }
                                
                                rsCobol.updateString("TR_PO_AL",chrPoAl);  //REQUIRED TO BE CHANGED
                                
                                
                                
                                PoNo = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                if(PoNo.trim().equals("")) {
                                    PoNo ="000000";
                                }
                                
                                //System.out.println("PO Length" + PoNo.length());
                                
                                if (PoNo.substring(0,1).equals("B")) {
                                    if(PoNo.length()==6) {
                                        chrPoNo = "B" + PoNo.substring(1,6);
                                    }
                                    else {
                                        chrPoNo = "B" + PoNo.substring(2,7);
                                    }
                                }
                                else if (PoNo.substring(0,1).equals("G")) {
                                    chrPoNo = "B0" + PoNo.substring(2,6);
                                }
                                else if (PoNo.substring(0,1).equals("W")) {
                                    chrPoNo = PoNo.substring(1,7);
                                }
                                else if (PoNo.substring(0,1).equals("P")) {
                                    chrPoNo = PoNo.substring(1,7);
                                }
                                else if (PoNo.substring(0,1).equals("A")) {
                                    if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                        chrPoNo = "0" +PoNo.substring(1,6);
                                    else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                        chrPoNo = "A"+PoNo.substring(2,7);
                                    }
                                    
                                }
                                
                                //PoNo = PoNo.substring(0,2);
                                else if (PoNo.substring(0,2).equals("D-")) {
                                    chrPoNo = "0"+ PoNo.substring(2,7);
                                }
                                
                                else if (PoNo.substring(0,2).equals("I/")) {
                                    chrPoNo = PoNo.substring(2,8);
                                }
                                
                                else if (PoNo.substring(0,1).equals("S")) {
                                    
                                    if(PoNo.length()==6) {
                                        chrPoNo = "0" + PoNo.substring(1,6);
                                    }
                                    else {
                                        chrPoNo = "0" + PoNo.substring(2,7);
                                    }
                                    
                                }
                                else if (PoNo.substring(0,2).equals("CA")) {
                                    chrPoNo = "0"+PoNo.substring(2,7);
                                }
                                else if (PoNo.substring(0,2).equals("RM")) {
                                    chrPoNo = "0"+PoNo.substring(2,7);
                                }
                                else {
                                    chrPoNo = "000000" ;
                                }
                                
                                
                                rsCobol.updateString("TR_PO_NO",chrPoNo); //REQUIRED TO BE CHANGED
                                //  PO Over ==================================================================
                                
                                
                                //(7) PO Flag ================================================================
                                PoFlg = UtilFunctions.getString(rsTmp,"COMPANY_ID","");
                                
                                if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2")) {
                                    PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'",EITLERPGLOBAL.DatabaseURL);
                                }
                                else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3"))
                                    
                                {
                                    PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'","jdbc:mysql://200.0.0.227:3306/DINESHMILLSA");
                                }
                                
                                rsCobol.updateString("TR_PO_FLG",PoFlg);//REQUIRED TO BE CHANGED
                                //============================================================================
                                
                                
                                
                                //(8) Invoice No. ============================================================
                                BillNo= UtilFunctions.getString(rsTmp,"INVOICE_NO","0");
                                if(BillNo.length()>8) {
                                    BillNo=BillNo.substring(0,8);
                                }
                                else {
                                    BillNo=EITLERPGLOBAL.padLeft(8, BillNo,"0");
                                }
                                
                                rsCobol.updateString("TR_BILL_NO",BillNo);
                                //============================================================================
                                
                                
                                
                                //(9) Year ===================================================================
                                Yr1_Yr2="0000";
                                // Yr1_Yr2 = Integer.toString(EITLERPGLOBAL.FinYearFrom).substring(2,3)+Integer.toString(EITLERPGLOBAL.FinYearTo).substring(2,3);
                                rsCobol.updateString("TR_INV_Y1Y2",Yr1_Yr2 );//REQUIRED TO BE CHANGED
                                //============================================================================
                                
                                
                                //(10) Reference sr. no. and fixed transaction code ==========================
                                JVRefSrNo++;
                                strRefSrNo=EITLERPGLOBAL.padLeft(4,Integer.toString(JVRefSrNo),"0");
                                rsCobol.updateString("TR_REF_SR",strRefSrNo);
                                rsCobol.updateString("TR_TRAN_CODE","000");
                                //============================================================================
                                
                                
                                //**** Find Opposite Entry ***********//
                                //rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO="+BlockNo+" AND EFFECT<>'"+Sign+"'",FinanceGlobal.FinURL);
                                //Replace allocation code of above record with this record's main code
                                
                                
                                //(11) Allocation Code =======================================================
                                //AllocationCode=UtilFunctions.getString(rsTmp,"MAIN_ACCOUNT_CODE","");
                                rsCobol.updateString("TR_ALLOC_CODE","000000");
                                //============================================================================
                                
                                rsCobol.insertRow() ;
                                
                                rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO="+BlockNo+" AND EFFECT <>'"+Sign+"'",FinanceGlobal.FinURL);
                                Sign=rsTmp.getString("EFFECT");
                                
                                // Export this entry to Cobol
                                rsCobol.moveToInsertRow();
                                rsCobol.updateString("TR_REC_TYPE", "01");
                                rsCobol.updateString("TR_INV_AGSR", "000000");
                                rsCobol.updateString("TR_DIV_CODE", "03");
                                rsCobol.updateString("BOOK_CODE","25");
                                rsCobol.updateString("TR_YR",Year);
                                rsCobol.updateString("TR_MT",Month);
                                rsCobol.updateString("TR_DT",Day);
                                rsCobol.updateString("TR_REF_AL","  ");
                                rsCobol.updateString("TR_REF_NO",JVRefNo1);
                                rsCobol.updateString("TR_MAIN_CODE",rsTmp.getString("MAIN_ACCOUNT_CODE"));
                                rsCobol.updateString("TR_SUB_CODE",rsTmp.getString("SUB_ACCOUNT_CODE"));
                                
                                
                                //(1) Cheque No. Start ==================================
                                if(!UtilFunctions.getString(rsHeader,"CHEQUE_NO","").equals("")) {
                                    ChequeNo=UtilFunctions.getString(rsHeader,"CHEQUE_NO","");
                                    
                                    if(ChequeNo.length()>8) {
                                        ChequeNo=ChequeNo.substring(0,8);
                                    }
                                    else {
                                        ChequeNo=EITLERPGLOBAL.padLeft(8,ChequeNo, "0");
                                    }
                                    
                                    rsCobol.updateString("TR_CHEQUE_NO", ChequeNo);
                                }
                                else {
                                    rsCobol.updateString("TR_CHEQUE_NO","00000000");
                                }
                                //==============Cheque No. Over ========================
                                
                                
                                //(2) Cheque/Bill Date =====================================
                                BillDate=UtilFunctions.getString(rsTmp,"INVOICE_DATE","0000-00-00");
                                ChequeDate=UtilFunctions.getString(rsHeader,"CHEQUE_DATE","0000-00-00");
                                
                                
                                if(!BillDate.trim().equals("")) {
                                    rsCobol.updateString("TR_CHQ_BILL_DATE", BillDate.substring(8,10)+BillDate.substring(5,7)+BillDate.substring(2,4));
                                }
                                else {
                                    if(!ChequeDate.trim().equals("")) {
                                        rsCobol.updateString("TR_CHQ_BILL_DATE", ChequeDate.substring(8,10)+ChequeDate.substring(5,7)+ChequeDate.substring(2,4));
                                    }
                                    else {
                                        //No bill date and cheque date specified
                                        rsCobol.updateString("TR_CHQ_BILL_DATE","000000");
                                    }
                                }
                                //================ Cheque/Bill Date Over =======================
                                
                                
                                
                                //(3) Description ==============================================
                                Description=UtilFunctions.getString(rsHeader,"REMARKS","");
                                if(Description.length()>25) {
                                    Description=Description.substring(0,25);
                                }
                                else {
                                    Description=EITLERPGLOBAL.padRight(25, Description," ");
                                }
                                
                                rsCobol.updateString("TR_DESCRIPTION", Description);
                                //==============================================================
                                
                                
                                
                                //(4) Sales Tax Category =========================================
                                SaleTaxCode = UtilFunctions.getString(rsHeader,"ST_CATEGORY","");
                                
                                if(SaleTaxCode.length()>2) {
                                    SaleTaxCode=SaleTaxCode.substring(0,2);
                                }
                                else {
                                    SaleTaxCode=EITLERPGLOBAL.padLeft(2, SaleTaxCode,"0");
                                }
                                
                                
                                rsCobol.updateString("SALETAX_CODE", SaleTaxCode);
                                //===============================================================
                                
                                //(5) Amount ======================================================
                                TrAmount = Integer.toString(UtilFunctions.getInt(rsTmp,"AMOUNT",0)*100);
                                //String TrAmount = Double.toString(EITLERPGLOBAL.round(UtilFunctions.getDouble(rsTmp,"AMOUNT", 0), 2));
                                if(TrAmount.length()>11) {
                                    TrAmount=TrAmount.substring(0,11);
                                }
                                else {
                                    TrAmount=EITLERPGLOBAL.padLeft(11,TrAmount,"0");
                                }
                                
                                rsCobol.updateString("TR_AMT", TrAmount);
                                //=================================================================
                                
                                
                                //(6) Amount Sign =====================================================
                                TrSign = UtilFunctions.getString(rsTmp,"EFFECT","");
                                rsCobol.updateString("TR_AMT_SIGN", TrSign);
                                // Amount Sign Over ================================================
                                
                                
                                //(7) PO No. and suffix ==============================================
                                
                                if(VoucherNo.equals("PA076100205")) {
                                    boolean halt=true;
                                }
                                PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                
                                if(PoAl.equals("")) {
                                    PoAl ="   ";
                                }
                                
                                if (PoAl.substring(0,1).equals("B")) {
                                    chrPoAl = "G ";
                                }
                                else if (PoAl.substring(0,1).equals("P")) {
                                    chrPoAl = "P ";
                                }
                                else if (PoAl.substring(0,1).equals("W")) {
                                    chrPoAl = "W ";
                                }
                                
                                //PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000").substring(0,1);
                                
                                else if (PoAl.substring(0,1).equals("A")) {
                                    if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                        chrPoAl = "A " ;
                                    else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                        chrPoAl = "CP";
                                    }
                                }
                                else if (PoAl.substring(0,2).equals("A3")) {
                                    chrPoAl = "CP";
                                }
                                else if (PoAl.substring(0,2).equals("D-")) {
                                    chrPoAl ="D ";
                                }
                                else if (PoAl.substring(0,2).equals("I/")) {
                                    chrPoAl ="I ";
                                }
                                else if (PoAl.substring(0,1).equals("S")) {
                                    chrPoAl ="S ";
                                }
                                else if (PoAl.substring(0,2).equals("RM")) {
                                    chrPoAl ="RM";
                                }
                                else if (PoAl.substring(0,2).equals("CA")) {
                                    chrPoAl ="CA";
                                }
                                
                                else {
                                    chrPoAl ="  ";
                                }
                                
                                rsCobol.updateString("TR_PO_AL",chrPoAl);  //REQUIRED TO BE CHANGED
                                
                                
                                
                                PoNo = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                if(PoNo.trim().equals("")) {
                                    PoNo ="000000";
                                }
                                
                                //System.out.println("PO Length" + PoNo.length());
                                
                                if (PoNo.substring(0,1).equals("B")) {
                                    if(PoNo.length()==6) {
                                        chrPoNo = "B" + PoNo.substring(1,6);
                                    }
                                    else {
                                        chrPoNo = "B" + PoNo.substring(2,7);
                                    }
                                }
                                else if (PoNo.substring(0,1).equals("G")) {
                                    chrPoNo = "B0" + PoNo.substring(2,6);
                                }
                                else if (PoNo.substring(0,1).equals("W")) {
                                    chrPoNo = PoNo.substring(1,7);
                                }
                                else if (PoNo.substring(0,1).equals("P")) {
                                    chrPoNo = PoNo.substring(1,7);
                                }
                                else if (PoNo.substring(0,1).equals("A")) {
                                    if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                        chrPoNo = "0" +PoNo.substring(1,6);
                                    else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                        chrPoNo = "A"+PoNo.substring(2,7);
                                    }
                                    
                                }
                                
                                //PoNo = PoNo.substring(0,2);
                                else if (PoNo.substring(0,2).equals("D-")) {
                                    chrPoNo = "0"+ PoNo.substring(2,7);
                                }
                                
                                else if (PoNo.substring(0,2).equals("I/")) {
                                    chrPoNo = PoNo.substring(2,8);
                                }
                                
                                else if (PoNo.substring(0,1).equals("S")) {
                                    
                                    if(PoNo.length()==6) {
                                        chrPoNo = "0" + PoNo.substring(1,6);
                                    }
                                    else {
                                        chrPoNo = "0" + PoNo.substring(2,7);
                                    }
                                    
                                }
                                else if (PoNo.substring(0,2).equals("CA")) {
                                    chrPoNo = "0"+PoNo.substring(2,7);
                                }
                                else if (PoNo.substring(0,2).equals("RM")) {
                                    chrPoNo = "0"+PoNo.substring(2,7);
                                }
                                else {
                                    chrPoNo = "000000" ;
                                }
                                
                                
                                rsCobol.updateString("TR_PO_NO",chrPoNo); //REQUIRED TO BE CHANGED
                                //  PO Over ==================================================================
                                
                                
                                //(7) PO Flag ================================================================
                                PoFlg = UtilFunctions.getString(rsTmp,"COMPANY_ID","");
                                
                                if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2")) {
                                    PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'",EITLERPGLOBAL.DatabaseURL);
                                }
                                else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3"))
                                    
                                {
                                    PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'","jdbc:mysql://200.0.0.227:3306/DINESHMILLSA");
                                }
                                
                                rsCobol.updateString("TR_PO_FLG",PoFlg);//REQUIRED TO BE CHANGED
                                //============================================================================
                                
                                
                                
                                //(8) Invoice No. ============================================================
                                BillNo= UtilFunctions.getString(rsTmp,"INVOICE_NO","0");
                                if(BillNo.length()>8) {
                                    BillNo=BillNo.substring(0,8);
                                }
                                else {
                                    BillNo=EITLERPGLOBAL.padLeft(8, BillNo,"0");
                                }
                                
                                rsCobol.updateString("TR_BILL_NO",BillNo);
                                //============================================================================
                                
                                
                                
                                //(9) Year ===================================================================
                                Yr1_Yr2="0000";
                                // Yr1_Yr2 = Integer.toString(EITLERPGLOBAL.FinYearFrom).substring(2,3)+Integer.toString(EITLERPGLOBAL.FinYearTo).substring(2,3);
                                rsCobol.updateString("TR_INV_Y1Y2",Yr1_Yr2 );//REQUIRED TO BE CHANGED
                                //============================================================================
                                
                                
                                //(10) Reference sr. no. and fixed transaction code ==========================
                                JVRefSrNo++;
                                strRefSrNo=EITLERPGLOBAL.padLeft(4,Integer.toString(JVRefSrNo),"0");
                                rsCobol.updateString("TR_REF_SR",strRefSrNo);
                                rsCobol.updateString("TR_TRAN_CODE","000");
                                //============================================================================
                                
                                
                                //**** Find Opposite Entry ***********//
                                //rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO="+BlockNo+" AND EFFECT<>'"+Sign+"'",FinanceGlobal.FinURL);
                                //Replace allocation code of above record with this record's main code
                                
                                
                                //(11) Allocation Code =======================================================
                                //AllocationCode=UtilFunctions.getString(rsTmp,"MAIN_ACCOUNT_CODE","");
                                rsCobol.updateString("TR_ALLOC_CODE","000000");
                                //============================================================================
                                
                                rsCobol.insertRow() ;
                            }
                            
                            
                            rsBlock.next();
                            
                        }
                        
                    }
                    rsVoucher.next();
                    
                }
                
            }
        }
        
        catch(Exception e) {
            e.printStackTrace();
        }
        
    }
    
    private void ExportTrType3() {
        
        // new Thread() {
        
        //    public void run(){
        boolean Done=false;
        long Counter=0;
        String VoucherNo="";
        //String BlockNo="1";
        String chrPoAl="";
        String chrPoNo="";
        String PoNo="";
        String PoAl="";
        
        int refNo = 1 ;
        
        
        try {
            
            
            Connection objConn=EITLERP.data.getConn(FinanceGlobal.FinURL);
            Statement stTemp=objConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
            
            Statement stCobol=objConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
            ResultSet rsCobol=stCobol.executeQuery("SELECT * FROM TR_COBOL LIMIT 1");
            
            /*EITLERP.data.Execute("DELETE FROM TMP_GENERAL",FinanceGlobal.FinURL);
            String strQuery = "INSERT INTO TMP_GENERAL(COLUMN_1,COLUMN_2,COLUMN_3,COLUMN_4,COLUMN_5,COLUMN_6,COLUMN_7,COLUMN_8,COLUMN_9,COLUMN_10,COLUMN_11,COLUMN_12,COLUMN_13,COLUMN_14,COLUMN_15,COLUMN_16,COLUMN_17,COLUMN_18,COLUMN_19,COLUMN_20,COLUMN_21,COLUMN_22,COLUMN_23,COLUMN_24)" ;
            EITLERP.data.Execute(strQuery+" SELECT '01'  TR_REC_TYPE,'000000' TR_INV_AGSR,'03'  TR_DIV_CODE,A.BOOK_CODE  TR_BOOK_CODE,DATE_FORMAT(A.VOUCHER_DATE,'%y')  TR_YR,DATE_FORMAT(A.VOUCHER_DATE,'%m')  TR_MT,DATE_FORMAT(A.VOUCHER_DATE,'%d')  TR_DY,'' TR_REF_AL,'' TR_REF__NO,B.MAIN_ACCOUNT_CODE  TR_MAIN_CODE,B.SUB_ACCOUNT_CODE  TR_SUB_CODE,A.CHEQUE_NO TR_CHEQUE_NO,DATE_FORMAT(A.CHEQUE_DATE,'%d%m%y')  TR_CHEQ_BILL_DATE,A.REMARKS AS TR_DESCRIPTION,B.AMOUNT  TR_AMT,B.EFFECT TR_AMT_SIGN,'' TR_ALLOC_CODE,B.PO_NO  TR_PO_NO, A.ST_CATEGORY AS TR_SALETAX,B.INVOICE_NO  TR_BILL_NO,CONCAT(substr(year(B.INVOICE_DATE),3,2),(substr(year(B.INVOICE_DATE),3,2)+1))  TR_INV_Y1Y2 ,DATE_FORMAT(B.INVOICE_DATE,'%d%m%y') BILL_DATE,B.BLOCK_NO  AS EX_BLOCK_NO,A.VOUCHER_NO VOUCHER_NO FROM D_FIN_VOUCHER_HEADER A,D_FIN_VOUCHER_DETAIL_EX B  WHERE A.VOUCHER_NO = B.VOUCHER_NO AND A.VOUCHER_DATE >='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND A.VOUCHER_DATE <='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' AND A.VOUCHER_NO NOT LIKE 'M%' AND A.BOOK_CODE IN(04,12,10,13,15,16,17,18,19,20,24,40,41,42,43,44,61,63,64,65,67,70,71,72,73,74,75,76,77,78,79,80) AND A.COMPANY_ID =2  ORDER BY A.VOUCHER_NO,B.SR_NO",FinanceGlobal.FinURL);
            ResultSet rsTmp=EITLERP.data.getResult("SELECT * FROM TMP_GENERAL ORDER BY COLUMN_4,COLUMN_5,COLUMN_6,COLUMN_7,COLUMN_24,COLUMN_23,COLUMN_16",FinanceGlobal.FinURL);
            rsTmp.last();
            rsTmp.first();
            VoucherNo = rsTmp.getString("COLUMN_24");
            BlockNo = rsTmp.getString("COLUMN_23");*/
            
            ResultSet rsVoucher,rsBlock,rsHeader;
            
            //rsVoucher=EITLERP.data.getResult("SELECT DISTINCT(VOUCHER_NO) FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO NOT LIKE 'M%' AND LEGACY_NO <> '' AND BOOK_CODE IN (40,41,42,43,44,45,61,62,63,64,65) AND APPROVED ='1' AND CANCELLED ='0' AND LEGACY_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND LEGACY_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ORDER BY VOUCHER_DATE,BOOK_CODE",FinanceGlobal.FinURL);
            rsVoucher=EITLERP.data.getResult("SELECT DISTINCT(VOUCHER_NO) FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO NOT LIKE 'M%' AND LEGACY_NO <> '' AND BOOK_CODE IN (61,63,64) AND APPROVED ='1' AND CANCELLED ='0' AND LEGACY_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND LEGACY_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ORDER BY VOUCHER_DATE,BOOK_CODE",FinanceGlobal.FinURL);
            
            rsVoucher.first();
            
            if(rsVoucher.getRow()>0) {
                while(!rsVoucher.isAfterLast()) {
                    
                    //For voucher header information
                    rsHeader=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO='"+rsVoucher.getString("VOUCHER_NO")+"'",FinanceGlobal.FinURL);
                    
                    VoucherNo=rsHeader.getString("VOUCHER_NO");
                    //                    String VoucherDate=rsHeader.getString("VOUCHER_DATE");
                    String VoucherDate=rsHeader.getString("LEGACY_DATE");
                    
                    String Month=VoucherDate.substring(5,7);
                    String Day=VoucherDate.substring(8,10);
                    String Year=VoucherDate.substring(2,4);
                    String BookCode=rsHeader.getString("BOOK_CODE");
                    
                    
                    //Generate New Reference No.
                    //String LastNo=Integer.toString(UtilFunctions.CInt(EITLERP.data.getStringValueFromDB("SELECT MAX(TR_REF_NO) AS MAX_NO FROM TR_COBOL WHERE TR_MT='"+Month+"' AND TR_DT='"+Day+"' AND BOOK_CODE='"+BookCode+"'",FinanceGlobal.FinURL))+1);
                    //String RefNo= rsHeader.getString("LEGACY_NO"); //EITLERPGLOBAL.Replicate("0", 6-LastNo.length())+LastNo;
                    String RefNo= rsHeader.getString("LEGACY_NO"); //EITLERPGLOBAL.Replicate("0", 6-LastNo.length())+LastNo;
                    
                    
                    RefNo = EITLERPGLOBAL.padLeftEx(RefNo, "0", 6);
                    
                    if (RefNo.equals("000096")) {
                        System.out.println("Hi");
                    }
                    
                    
                    
                    int RefSrNo=0;
                    
                    
                    //rsBlock=EITLERP.data.getResult("SELECT SUM(AMOUNT) FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND SUB_ACCOUNT_CODE<>''",FinanceGlobal.FinURL);
                    //rsBlock.first();
                    
                    // HERE
                    //if(rsBlock.getRow()>0) {
                    
                    //while(!rsBlock.isAfterLast()) {
                    
                    String Sign,ChequeNo,BillDate,ChequeDate,Description,SaleTaxCode,TrAmount,TrSign ="";
                    String BillNo,Yr1_Yr2,PoFlg,AllocationCode,strRefSrNo ="";
                    PoAl="";
                    PoNo="";
                    chrPoNo="";
                    //BlockNo = rsBlock.getString("BLOCK_NO");
                    String strQry = "";
                    String Main_acc_code="",Sub_acc_code="",Effect="";
                    
                    if(EITLERP.data.IsRecordExist("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND SUB_ACCOUNT_CODE<>'' AND MAIN_ACCOUNT_CODE NOT IN ('231754','241201','241177','241184','241191') ",FinanceGlobal.FinURL)) {
                        //We found the record with both main and sub code, take it first
                        
                        strQry = "SELECT EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE " +
                        " FROM D_FIN_VOUCHER_DETAIL_EX " +
                        " WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND SUB_ACCOUNT_CODE<>'' AND MAIN_ACCOUNT_CODE NOT IN ('231754','241201','241177','241184','241191') ";
                        ResultSet rsTmp=EITLERP.data.getResult(strQry,FinanceGlobal.FinURL);
                        rsTmp.first();
                        
                        Main_acc_code=rsTmp.getString("MAIN_ACCOUNT_CODE");
                        Sub_acc_code=rsTmp.getString("SUB_ACCOUNT_CODE");
                        Effect=rsTmp.getString("EFFECT");
                        
                        //                                "AND MAIN_ACCOUNT_CODE NOT IN ('127097','127145','127176','127516','127523','127530','127547','132446','133052','133083','201052','201179','201193','201210','201344','201409','201430','201911','201928','210080','231211','231321','231510','231527','231589','261016','261023','271013','301017','301079','301251','301550','301749','301756','301938','303019','303026','303033','3030
                        //                                ','303064','303071','303150','304010','304027','304034','304065','304072','304151','305011','305028','305035','305066','305073','305080','308014','311038','315025','319029','403036','403043','403050','403067','403074','403081','403098','403115','403191','404099','404109','405021','405038','405052','406022','407102','408086','409018','409025','411024','411031','411079','411127','411134','411165','411172','419015','421014','421045','423016','425018','427027','435015','435022','435091','437110','437158','437165','437213','437220','439019','439026','441018','441056','441063','441070','443027','445043','445050','445067','450038','450045','450069','450083','450124','450203','450210','450227','450258','450306','450320','450344','450351','450368','450382','450399','450423','450454','450492','450540','450571','452016','499990')";
                        strQry = "SELECT VOUCHER_NO, INVOICE_DATE, PO_NO,INVOICE_NO,COMPANY_ID ,MAIN_ACCOUNT_CODE ,SUM(AMOUNT) AS AMOUNT "+
                        "FROM D_FIN_VOUCHER_DETAIL_EX "+
                        "WHERE VOUCHER_NO='"+ VoucherNo +"'  AND EFFECT='D' "+
                        "GROUP BY MAIN_ACCOUNT_CODE";
                        
                        rsTmp=EITLERP.data.getResult(strQry,FinanceGlobal.FinURL);
                        
                        if (rsTmp.getRow() >0) {
                            rsTmp.first();
                            
                            while (! rsTmp.isAfterLast()) {
                                
                                Sign=Effect;
                                
                                // Export this entry to Cobol
                                rsCobol.moveToInsertRow();
                                rsCobol.updateString("TR_REC_TYPE", "01");
                                rsCobol.updateString("TR_INV_AGSR", "000000");
                                rsCobol.updateString("TR_DIV_CODE", "03");
                                rsCobol.updateString("BOOK_CODE",rsHeader.getString("BOOK_CODE"));
                                rsCobol.updateString("TR_YR",Year);
                                rsCobol.updateString("TR_MT",Month);
                                rsCobol.updateString("TR_DT",Day);
                                rsCobol.updateString("TR_REF_AL","  ");
                                rsCobol.updateString("TR_REF_NO",RefNo);
                                rsCobol.updateString("TR_MAIN_CODE",Main_acc_code);
                                rsCobol.updateString("TR_SUB_CODE",Sub_acc_code);
                                
                                
                                //(1) Cheque No. Start ==================================
                                if(!UtilFunctions.getString(rsHeader,"CHEQUE_NO","").equals("")) {
                                    ChequeNo=UtilFunctions.getString(rsHeader,"CHEQUE_NO","");
                                    
                                    if(ChequeNo.length()>8) {
                                        ChequeNo=ChequeNo.substring(0,8);
                                    }
                                    else {
                                        ChequeNo=EITLERPGLOBAL.padLeft(8,ChequeNo, "0");
                                    }
                                    
                                    rsCobol.updateString("TR_CHEQUE_NO", ChequeNo);
                                }
                                else {
                                    rsCobol.updateString("TR_CHEQUE_NO","00000000");
                                }
                                //==============Cheque No. Over ========================
                                
                                
                                //(2) Cheque/Bill Date =====================================
                                BillDate=UtilFunctions.getString(rsTmp,"INVOICE_DATE","0000-00-00");
                                ChequeDate=UtilFunctions.getString(rsHeader,"CHEQUE_DATE","0000-00-00");
                                
                                
                                if(!BillDate.trim().equals("")) {
                                    rsCobol.updateString("TR_CHQ_BILL_DATE", BillDate.substring(8,10)+BillDate.substring(5,7)+BillDate.substring(2,4));
                                }
                                else {
                                    if(!ChequeDate.trim().equals("")) {
                                        rsCobol.updateString("TR_CHQ_BILL_DATE", ChequeDate.substring(8,10)+ChequeDate.substring(5,7)+ChequeDate.substring(2,4));
                                    }
                                    else {
                                        //No bill date and cheque date specified
                                        rsCobol.updateString("TR_CHQ_BILL_DATE","000000");
                                    }
                                }
                                //================ Cheque/Bill Date Over =======================
                                
                                
                                
                                //(3) Description ==============================================
                                Description=UtilFunctions.getString(rsHeader,"REMARKS","");
                                if(Description.trim().length()>25) {
                                    Description=Description.trim().substring(0,25);
                                }
                                else {
                                    Description=EITLERPGLOBAL.padRight(25, Description.trim()," ");
                                }
                                
                                rsCobol.updateString("TR_DESCRIPTION", Description);
                                //==============================================================
                                
                                
                                
                                //(4) Sales Tax Category =========================================
                                SaleTaxCode = UtilFunctions.getString(rsHeader,"ST_CATEGORY","");
                                
                                if(SaleTaxCode.length()>2) {
                                    SaleTaxCode=SaleTaxCode.substring(0,2);
                                }
                                else {
                                    SaleTaxCode=EITLERPGLOBAL.padLeft(2, SaleTaxCode,"0");
                                }
                                
                                
                                rsCobol.updateString("SALETAX_CODE", SaleTaxCode);
                                //===============================================================
                                
                                //(5) Amount ======================================================
                                TrAmount = Integer.toString(UtilFunctions.getInt(rsTmp,"AMOUNT",0)*100);
                                //String TrAmount = Double.toString(EITLERPGLOBAL.round(UtilFunctions.getDouble(rsTmp,"AMOUNT", 0), 2));
                                if(TrAmount.length()>11) {
                                    TrAmount=TrAmount.substring(0,11);
                                }
                                else {
                                    TrAmount=EITLERPGLOBAL.padLeft(11,TrAmount,"0");
                                }
                                
                                rsCobol.updateString("TR_AMT", TrAmount);
                                //=================================================================
                                
                                
                                //(6) Amount Sign =====================================================
                                TrSign = Effect;
                                rsCobol.updateString("TR_AMT_SIGN", TrSign);
                                // Amount Sign Over ================================================
                                
                                
                                //(7) PO No. and suffix ==============================================
                                
                                if(VoucherNo.equals("PA076100205")) {
                                    boolean halt=true;
                                }
                                PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                
                                if(PoAl.equals("")) {
                                    PoAl ="   ";
                                }
                                
                                if (PoAl.substring(0,1).equals("B")) {
                                    chrPoAl = "G ";
                                }
                                else if (PoAl.substring(0,1).equals("P")) {
                                    chrPoAl = "P ";
                                }
                                else if (PoAl.substring(0,1).equals("W")) {
                                    chrPoAl = "W ";
                                }
                                
                                //PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000").substring(0,1);
                                
                                else if (PoAl.substring(0,1).equals("A")) {
                                    if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                        chrPoAl = "A " ;
                                    else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                        chrPoAl = "CP";
                                    }
                                }
                                else if (PoAl.substring(0,2).equals("A3")) {
                                    chrPoAl = "CP";
                                }
                                else if (PoAl.substring(0,2).equals("D-")) {
                                    chrPoAl ="D ";
                                }
                                else if (PoAl.substring(0,2).equals("I/")) {
                                    chrPoAl ="I ";
                                }
                                else if (PoAl.substring(0,1).equals("S")){
                                    chrPoAl ="S ";
                                }
                                else if (PoAl.substring(0,2).equals("RM")) {
                                    chrPoAl ="RM";
                                }
                                else if (PoAl.substring(0,2).equals("CA")) {
                                    chrPoAl ="CA";
                                }
                                
                                else {
                                    chrPoAl ="  ";
                                }
                                
                                rsCobol.updateString("TR_PO_AL",chrPoAl);  //REQUIRED TO BE CHANGED
                                
                                
                                
                                PoNo = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                if(PoNo.trim().equals("")) {
                                    PoNo ="000000";
                                }
                                
                                // System.out.println("PO Length" + PoNo.length());
                                
                                if (PoNo.substring(0,1).equals("B")) {
                                    chrPoNo = "B" + PoNo.substring(2,7);
                                }
                                else if (PoNo.substring(0,1).equals("W")) {
                                    chrPoNo = PoNo.substring(1,7);
                                }
                                else if (PoNo.substring(0,1).equals("P")) {
                                    chrPoNo = PoNo.substring(1,7);
                                }
                                else if (PoNo.substring(0,1).equals("A")) {
                                    if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                        chrPoNo = "0" +PoNo.substring(1,6);
                                    else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                        chrPoNo = "A"+PoNo.substring(2,7);
                                    }
                                    
                                }
                                
                                //PoNo = PoNo.substring(0,2);
                                else if (PoNo.substring(0,2).equals("D-")) {
                                    chrPoNo = "0"+ PoNo.substring(2,7);
                                }
                                
                                else if (PoNo.substring(0,2).equals("I/")) {
                                    chrPoNo = PoNo.substring(2,8);
                                }
                                
                                else if (PoNo.substring(0,2).equals("S/")) {
                                    chrPoNo = "0" + PoNo.substring(2,7);
                                }
                                else if (PoNo.substring(0,2).equals("CA")) {
                                    chrPoNo = "0"+PoNo.substring(2,7);
                                }
                                else if (PoNo.substring(0,2).equals("RM")) {
                                    chrPoNo = "0"+PoNo.substring(2,7);
                                }
                                else {
                                    chrPoNo = "000000" ;
                                }
                                
                                
                                rsCobol.updateString("TR_PO_NO",chrPoNo); //REQUIRED TO BE CHANGED
                                //  PO Over ==================================================================
                                
                                
                                //(7) PO Flag ================================================================
                                PoFlg = UtilFunctions.getString(rsTmp,"COMPANY_ID","");
                                
                                if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2")) {
                                    PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'",EITLERPGLOBAL.DatabaseURL);
                                }
                                else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3"))
                                    
                                {
                                    PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'","jdbc:mysql://200.0.0.227:3306/DINESHMILLS");
                                }
                                
                                rsCobol.updateString("TR_PO_FLG",PoFlg);//REQUIRED TO BE CHANGED
                                //============================================================================
                                
                                
                                
                                //(8) Invoice No. ============================================================
                                BillNo= UtilFunctions.getString(rsTmp,"INVOICE_NO","0").trim();
                                
                                if(BillNo.length()>8) {
                                    //BillNo=BillNo.substring(0,8);
                                    BillNo=BillNo.substring(BillNo.length()-8);
                                }
                                else {
                                    BillNo=EITLERPGLOBAL.padLeft(8, BillNo,"0");
                                }
                                
                                rsCobol.updateString("TR_BILL_NO",BillNo);
                                //============================================================================
                                
                                
                                
                                //(9) Year ===================================================================
                                Yr1_Yr2="0000";
                                // Yr1_Yr2 = Integer.toString(EITLERPGLOBAL.FinYearFrom).substring(2,3)+Integer.toString(EITLERPGLOBAL.FinYearTo).substring(2,3);
                                rsCobol.updateString("TR_INV_Y1Y2",Yr1_Yr2 );//REQUIRED TO BE CHANGED
                                //============================================================================
                                
                                
                                //(10) Reference sr. no. and fixed transaction code ==========================
                                RefSrNo++;
                                strRefSrNo=EITLERPGLOBAL.padLeft(4,Integer.toString(RefSrNo),"0");
                                rsCobol.updateString("TR_REF_SR",strRefSrNo);
                                rsCobol.updateString("TR_TRAN_CODE","000");
                                //============================================================================
                                
                                
                                //**** Find Opposite Entry *********
                                //rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND EFFECT<>'"+Sign+"'",FinanceGlobal.FinURL);
                                //Replace allocation code of above record with this record's main code
                                
                                
                                //(11) Allocation Code =======================================================
                                AllocationCode=UtilFunctions.getString(rsTmp,"MAIN_ACCOUNT_CODE","");
                                rsCobol.updateString("TR_ALLOC_CODE",AllocationCode);
                                //============================================================================
                                
                                rsCobol.insertRow() ;
                                
                                rsTmp.next();
                            }
                        }
                        
                        
                    }
                    /*else {//No record found with main and sub code, take any record
                     
                        //                                    ResultSet rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO='"+BlockNo+"' ",FinanceGlobal.FinURL); //CHNAGES ON 20-03-2008
                        strQry = "SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND EFFECT ='C' AND BLOCK_NO='"+BlockNo+"' "+
                        "AND MAIN_ACCOUNT_CODE NOT IN ('127035')";
                        //"AND MAIN_ACCOUNT_CODE NOT IN ('127097','127145','127176','127516','127523','127530','127547','132446','133052','133083','201052','201179','201193','201210','201344','201409','201430','201911','201928','210080','231211','231321','231510','231527','231589','261016','261023','271013','301017','301079','301251','301550','301749','301756','301938','303019','303026','303033','303040','303064','303071','303150','304010','304027','304034','304065','304072','304151','305011','305028','305035','305066','305073','305080','308014','311038','315025','319029','403036','403043','403050','403067','403074','403081','403098','403115','403191','404099','404109','405021','405038','405052','406022','407102','408086','409018','409025','411024','411031','411079','411127','411134','411165','411172','419015','421014','421045','423016','425018','427027','435015','435022','435091','437110','437158','437165','437213','437220','439019','439026','441018','441056','441063','441070','443027','445043','445050','445067','450038','450045','450069','450083','450124','450203','450210','450227','450258','450306','450320','450344','450351','450368','450382','450399','450423','450454','450492','450540','450571','452016','499990')";
                        ResultSet rsTmp=EITLERP.data.getResult(strQry,FinanceGlobal.FinURL);
                     
                        if (rsTmp.getRow() > 0) {
                            Sign=rsTmp.getString("EFFECT"); //CHANGE TO REDUCE ERROR IN COBOL
                     
                            //Export this entry to Cobol
                     
                            // Export this entry to Cobol
                            rsCobol.moveToInsertRow();
                            rsCobol.updateString("TR_REC_TYPE", "01");
                            rsCobol.updateString("TR_INV_AGSR", "000000");
                            rsCobol.updateString("TR_DIV_CODE", "03");
                            rsCobol.updateString("BOOK_CODE",rsHeader.getString("BOOK_CODE"));
                            rsCobol.updateString("TR_YR",Year);
                            rsCobol.updateString("TR_MT",Month);
                            rsCobol.updateString("TR_DT",Day);
                            rsCobol.updateString("TR_REF_AL","  ");
                            rsCobol.updateString("TR_REF_NO",RefNo);
                            rsCobol.updateString("TR_MAIN_CODE",rsTmp.getString("MAIN_ACCOUNT_CODE"));
                            rsCobol.updateString("TR_SUB_CODE",rsTmp.getString("SUB_ACCOUNT_CODE"));
                     
                     
                            //(1) Cheque No. Start ==================================
                            if(!UtilFunctions.getString(rsHeader,"CHEQUE_NO","").equals("")) {
                                ChequeNo=UtilFunctions.getString(rsHeader,"CHEQUE_NO","");
                     
                                if(ChequeNo.length()>8) {
                                    ChequeNo=ChequeNo.substring(0,8);
                                }
                                else {
                                    ChequeNo=EITLERPGLOBAL.padLeft(8,ChequeNo, "0");
                                }
                     
                                rsCobol.updateString("TR_CHEQUE_NO", ChequeNo);
                            }
                            else {
                                rsCobol.updateString("TR_CHEQUE_NO","00000000");
                            }
                            //==============Cheque No. Over ========================
                     
                     
                            //(2) Cheque/Bill Date =====================================
                            BillDate=UtilFunctions.getString(rsTmp,"INVOICE_DATE","0000-00-00");
                            ChequeDate=UtilFunctions.getString(rsHeader,"CHEQUE_DATE","0000-00-00");
                     
                     
                            if(!BillDate.trim().equals("")) {
                                rsCobol.updateString("TR_CHQ_BILL_DATE", BillDate.substring(8,10)+BillDate.substring(5,7)+BillDate.substring(2,4));
                            }
                            else {
                                if(!ChequeDate.trim().equals("")) {
                                    rsCobol.updateString("TR_CHQ_BILL_DATE", ChequeDate.substring(8,10)+ChequeDate.substring(5,7)+ChequeDate.substring(2,4));
                                }
                                else {
                                    //No bill date and cheque date specified
                                    rsCobol.updateString("TR_CHQ_BILL_DATE","000000");
                                }
                            }
                            //================ Cheque/Bill Date Over =======================
                     
                     
                     
                            //(3) Description ==============================================
                            Description=UtilFunctions.getString(rsHeader,"REMARKS","");
                            if(Description.length()>25) {
                                Description=Description.substring(0,25);
                            }
                            else {
                                Description=EITLERPGLOBAL.padRight(25, Description," ");
                            }
                     
                            rsCobol.updateString("TR_DESCRIPTION", Description);
                            //==============================================================
                     
                     
                     
                            //(4) Sales Tax Category =========================================
                            SaleTaxCode = UtilFunctions.getString(rsHeader,"ST_CATEGORY","");
                     
                            if(SaleTaxCode.length()>2) {
                                SaleTaxCode=SaleTaxCode.substring(0,2);
                            }
                            else {
                                SaleTaxCode=EITLERPGLOBAL.padLeft(2, SaleTaxCode,"0");
                            }
                     
                     
                            rsCobol.updateString("SALETAX_CODE", SaleTaxCode);
                            //===============================================================
                     
                            //(5) Amount ======================================================
                            TrAmount = Integer.toString(UtilFunctions.getInt(rsTmp,"AMOUNT",0)*100);
                            //String TrAmount = Double.toString(EITLERPGLOBAL.round(UtilFunctions.getDouble(rsTmp,"AMOUNT", 0),2)*100);
                     
                            if(TrAmount.length()>11) {
                                TrAmount=TrAmount.substring(0,11);
                            }
                            else {
                                TrAmount=EITLERPGLOBAL.padLeft(11,TrAmount,"0");
                            }
                     
                            rsCobol.updateString("TR_AMT", TrAmount);
                            //=================================================================
                     
                     
                            //(6) Amount Sign =====================================================
                            TrSign = UtilFunctions.getString(rsTmp,"EFFECT","");
                            rsCobol.updateString("TR_AMT_SIGN", TrSign);
                            // Amount Sign Over ================================================
                     
                     
                            //(7) PO No. and suffix ==============================================
                     
                            PoAl =UtilFunctions.getString(rsTmp,"PO_NO","000000");
                     
                            if(PoAl.equals("")) {
                                PoAl = "   ";
                            }
                            if (PoAl.substring(0,1).equals("B")) {
                                chrPoAl = "G ";
                            }
                            else if (PoAl.substring(0,1).equals("P")) {
                                chrPoAl = "P ";
                            }
                            else if (PoAl.substring(0,1).equals("W")) {
                                chrPoAl = "W ";
                            }
                     
                            //PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000").substring(0,1);
                     
                            else if (PoAl.substring(0,1).equals("A")) {
                                if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                    chrPoAl = "A " ;
                                else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                    chrPoAl = "CP";
                                }
                            }
                            else if (PoAl.substring(0,2).equals("A3")) {
                                chrPoAl = "CP";
                            }
                            else if (PoAl.substring(0,2).equals("D-")) {
                                chrPoAl ="D ";
                            }
                            else if (PoAl.substring(0,2).equals("I/")) {
                                chrPoAl ="I ";
                            }
                            else if (PoAl.substring(0,1).equals("S")){
                                chrPoAl ="S ";
                            }
                            else if (PoAl.substring(0,2).equals("RM")) {
                                chrPoAl ="RM";
                            }
                            else if (PoAl.substring(0,2).equals("CA")) {
                                chrPoAl ="CA";
                            }
                     
                            else {
                                chrPoAl ="  ";
                            }
                            rsCobol.updateString("TR_PO_AL",chrPoAl);  //REQUIRED TO BE CHANGED
                     
                     
                     
                            PoNo = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                     
                     
                            if(PoNo.equals("")) {
                                PoNo ="000000";
                            }
                     
                            else if (PoNo.substring(0,1).equals("B")) {
                                chrPoNo = "B" + PoNo.substring(2,7);
                            }
                            else if (PoNo.substring(0,1).equals("W")) {
                                chrPoNo = PoNo.substring(1,7);
                            }
                            else if (PoNo.substring(0,1).equals("P")) {
                                chrPoNo = PoNo.substring(1,7);
                            }
                            else if (PoNo.substring(0,1).equals("A")) {
                                if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                    chrPoNo = "0" +PoNo.substring(1,6);
                                else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                    chrPoNo = "A"+PoNo.substring(2,7);
                                }
                     
                            }
                     
                            //PoNo = PoNo.substring(0,2);
                            else if (PoNo.substring(0,2).equals("D-")) {
                                chrPoNo = "0"+ PoNo.substring(2,7);
                            }
                            else if (PoNo.substring(0,2).equals("I/")) {
                                chrPoNo = PoNo.substring(2,8);
                            }
                            else if (PoNo.substring(0,2).equals("S/")) {
                                chrPoNo = "0" + PoNo.substring(2,7);
                            }
                            else if (PoNo.substring(0,2).equals("CA")) {
                                chrPoNo = "0"+PoNo.substring(2,7);
                            }
                            else if (PoNo.substring(0,2).equals("RM")) {
                                chrPoNo = "0"+PoNo.substring(2,7);
                            }
                            else {
                                chrPoNo ="000000" ;
                            }
                     
                     
                            rsCobol.updateString("TR_PO_NO",chrPoNo); //REQUIRED TO BE CHANGED
                            //  PO Over ==================================================================
                     
                     
                            //(7) PO Flag ================================================================
                            PoFlg = UtilFunctions.getString(rsTmp,"COMPANY_ID","");
                     
                            if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2")) {
                                PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'",EITLERPGLOBAL.DatabaseURL);
                            }
                            else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3"))
                     
                            {
                                PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'","jdbc:mysql://200.0.0.227:3306/DINESHMILLSA");
                            }
                     
                            rsCobol.updateString("TR_PO_FLG",PoFlg);//REQUIRED TO BE CHANGED
                            //============================================================================
                     
                     
                     
                            //(8) Invoice No. ============================================================
                            BillNo= UtilFunctions.getString(rsTmp,"INVOICE_NO","0");
                            if(BillNo.length()>8) {
                                BillNo=BillNo.substring(0,8);
                            }
                            else {
                                BillNo=EITLERPGLOBAL.padLeft(8, BillNo,"0");
                            }
                     
                            rsCobol.updateString("TR_BILL_NO",BillNo);
                            //============================================================================
                     
                     
                            //(9) Year ===================================================================
                     
                            Yr1_Yr2 = "0708";
                            //Yr1_Yr2 = Integer.toString(EITLERPGLOBAL.FinYearFrom).substring(2,3)+Integer.toString(EITLERPGLOBAL.FinYearTo).substring(2,3);
                            rsCobol.updateString("TR_INV_Y1Y2",Yr1_Yr2 );//REQUIRED TO BE CHANGED
                            //============================================================================
                     
                     
                            //(10) Reference sr. no. and fixed transaction code ==========================
                            RefSrNo++;
                            strRefSrNo=EITLERPGLOBAL.padLeft(4, Integer.toString(RefSrNo), "0");
                            rsCobol.updateString("TR_REF_SR",strRefSrNo);
                            rsCobol.updateString("TR_TRAN_CODE","000");
                            //============================================================================
                     
                     
                            //Find Opposite Entry
                            rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO="+BlockNo+" AND EFFECT<>'"+Sign+"'",FinanceGlobal.FinURL);
                            //Replace allocation code of above record with this record's main code
                     
                            //(11) Allocation Code =======================================================
                            AllocationCode=UtilFunctions.getString(rsTmp,"MAIN_ACCOUNT_CODE","");
                            rsCobol.updateString("TR_ALLOC_CODE",AllocationCode);
                            //============================================================================
                     
                            rsCobol.insertRow() ;
                        }
                    }
                     
                    //rsBlock.next();
                     
                    //}*/
                    
                    //}// HERE
                    rsVoucher.next();
                    
                }
                
            }
            
        }
        catch(Exception e) {
            e.printStackTrace();
        }
        
        
    }
    
    private void ExportTrType2() {
        
        boolean Done=false;
        long Counter=0;
        String VoucherNo="";
        String SrNo="1";
        String chrPoAl="";
        String chrPoNo="";
        String PoNo="";
        String PoAl="";
        
        int refNo = 1 ;
        
        
        try {
            
            
            Connection objConn=EITLERP.data.getConn(FinanceGlobal.FinURL);
            Statement stTemp=objConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
            
            Statement stCobol=objConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
            ResultSet rsCobol=stCobol.executeQuery("SELECT * FROM TR_COBOL LIMIT 1");
            
            /*EITLERP.data.Execute("DELETE FROM TMP_GENERAL",FinanceGlobal.FinURL);
            String strQuery = "INSERT INTO TMP_GENERAL(COLUMN_1,COLUMN_2,COLUMN_3,COLUMN_4,COLUMN_5,COLUMN_6,COLUMN_7,COLUMN_8,COLUMN_9,COLUMN_10,COLUMN_11,COLUMN_12,COLUMN_13,COLUMN_14,COLUMN_15,COLUMN_16,COLUMN_17,COLUMN_18,COLUMN_19,COLUMN_20,COLUMN_21,COLUMN_22,COLUMN_23,COLUMN_24)" ;
            EITLERP.data.Execute(strQuery+" SELECT '01'  TR_REC_TYPE,'000000' TR_INV_AGSR,'03'  TR_DIV_CODE,A.BOOK_CODE  TR_BOOK_CODE,DATE_FORMAT(A.VOUCHER_DATE,'%y')  TR_YR,DATE_FORMAT(A.VOUCHER_DATE,'%m')  TR_MT,DATE_FORMAT(A.VOUCHER_DATE,'%d')  TR_DY,'' TR_REF_AL,'' TR_REF__NO,B.MAIN_ACCOUNT_CODE  TR_MAIN_CODE,B.SUB_ACCOUNT_CODE  TR_SUB_CODE,A.CHEQUE_NO TR_CHEQUE_NO,DATE_FORMAT(A.CHEQUE_DATE,'%d%m%y')  TR_CHEQ_BILL_DATE,A.REMARKS AS TR_DESCRIPTION,B.AMOUNT  TR_AMT,B.EFFECT TR_AMT_SIGN,'' TR_ALLOC_CODE,B.PO_NO  TR_PO_NO, A.ST_CATEGORY AS TR_SALETAX,B.INVOICE_NO  TR_BILL_NO,CONCAT(substr(year(B.INVOICE_DATE),3,2),(substr(year(B.INVOICE_DATE),3,2)+1))  TR_INV_Y1Y2 ,DATE_FORMAT(B.INVOICE_DATE,'%d%m%y') BILL_DATE,B.BLOCK_NO  AS EX_BLOCK_NO,A.VOUCHER_NO VOUCHER_NO FROM D_FIN_VOUCHER_HEADER A,D_FIN_VOUCHER_DETAIL_EX B  WHERE A.VOUCHER_NO = B.VOUCHER_NO AND A.VOUCHER_DATE >='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND A.VOUCHER_DATE <='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' AND A.VOUCHER_NO NOT LIKE 'M%' AND A.BOOK_CODE IN(04,12,10,13,15,16,17,18,19,20,24,40,41,42,43,44,61,63,64,65,67,70,71,72,73,74,75,76,77,78,79,80) AND A.COMPANY_ID =2  ORDER BY A.VOUCHER_NO,B.SR_NO",FinanceGlobal.FinURL);
            ResultSet rsTmp=EITLERP.data.getResult("SELECT * FROM TMP_GENERAL ORDER BY COLUMN_4,COLUMN_5,COLUMN_6,COLUMN_7,COLUMN_24,COLUMN_23,COLUMN_16",FinanceGlobal.FinURL);
            rsTmp.last();
            rsTmp.first();
            VoucherNo = rsTmp.getString("COLUMN_24");
            BlockNo = rsTmp.getString("COLUMN_23");*/
            
            ResultSet rsVoucher,rsSr,rsHeader;
            //rsVoucher=EITLERP.data.getResult("SELECT DISTINCT(VOUCHER_NO) FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO NOT LIKE 'M%' AND BOOK_CODE IN (63) AND APPROVED ='1' AND CANCELLED ='0' AND VOUCHER_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND VOUCHER_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ORDER BY VOUCHER_DATE,BOOK_CODE",FinanceGlobal.FinURL);
            rsVoucher=EITLERP.data.getResult("SELECT DISTINCT(VOUCHER_NO) FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO NOT LIKE 'M%' AND BOOK_CODE IN (01,02,03,09,11,14,21,22,25,39,45,62) AND APPROVED ='1' AND CANCELLED ='0' AND VOUCHER_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND VOUCHER_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ORDER BY VOUCHER_DATE,BOOK_CODE",FinanceGlobal.FinURL);
            rsVoucher.last();
            System.out.print("No. of Voucher"+rsVoucher.getRow());
            rsVoucher.first();
            
            if(rsVoucher.getRow()>0) {
                while(!rsVoucher.isAfterLast()) {
                    
                    //For voucher header information
                    rsHeader=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO='"+rsVoucher.getString("VOUCHER_NO")+"'",FinanceGlobal.FinURL);
                    
                    VoucherNo=rsHeader.getString("VOUCHER_NO");
                    String VoucherDate=rsHeader.getString("VOUCHER_DATE");
                    
                    String Month=VoucherDate.substring(5,7);
                    String Day=VoucherDate.substring(8,10);
                    String Year=VoucherDate.substring(2,4);
                    String BookCode=rsHeader.getString("BOOK_CODE");
                    
                    
                    //Generate New Reference No.
                    String LastNo=Integer.toString(UtilFunctions.CInt(EITLERP.data.getStringValueFromDB("SELECT MAX(TR_REF_NO) AS MAX_NO FROM TR_COBOL WHERE TR_MT='"+Month+"' AND TR_DT='"+Day+"' AND BOOK_CODE='"+BookCode+"'",FinanceGlobal.FinURL))+1);
                    String RefNo=EITLERPGLOBAL.Replicate("0", 6-LastNo.length())+LastNo;
                    int RefSrNo=0;
                    
                    
                    rsSr=EITLERP.data.getResult("SELECT DISTINCT(SR_NO) FROM D_FIN_VOUCHER_DETAIL WHERE VOUCHER_NO='"+VoucherNo+"'",FinanceGlobal.FinURL);
                    rsSr.first();
                    
                    if(rsSr.getRow()>0) {
                        
                        while(!rsSr.isAfterLast()) {
                            
                            String Sign,ChequeNo,BillDate,ChequeDate,Description,SaleTaxCode,TrAmount,TrSign ="";
                            String BillNo,Yr1_Yr2,PoFlg,AllocationCode,strRefSrNo ="";
                            PoAl="";
                            PoNo="";
                            chrPoNo="";
                            SrNo = rsSr.getString("SR_NO");
                            
                            if(EITLERP.data.IsRecordExist("SELECT * FROM D_FIN_VOUCHER_DETAIL WHERE VOUCHER_NO='"+VoucherNo+"' AND SR_NO='"+SrNo+"'",FinanceGlobal.FinURL)) {//We found the record with both main and sub code, take it first
                                
                                ResultSet rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL WHERE VOUCHER_NO='"+VoucherNo+"' AND SR_NO='"+SrNo+"'",FinanceGlobal.FinURL);
                                Sign=rsTmp.getString("EFFECT");
                                
                                // Export this entry to Cobol
                                rsCobol.moveToInsertRow();
                                rsCobol.updateString("TR_REC_TYPE", "01");
                                rsCobol.updateString("TR_INV_AGSR", "000000");
                                rsCobol.updateString("TR_DIV_CODE", "03");
                                rsCobol.updateString("BOOK_CODE",rsHeader.getString("BOOK_CODE"));
                                rsCobol.updateString("TR_YR",Year);
                                rsCobol.updateString("TR_MT",Month);
                                rsCobol.updateString("TR_DT",Day);
                                rsCobol.updateString("TR_REF_AL","  ");
                                rsCobol.updateString("TR_REF_NO",RefNo);
                                rsCobol.updateString("TR_MAIN_CODE",rsTmp.getString("MAIN_ACCOUNT_CODE"));
                                rsCobol.updateString("TR_SUB_CODE",rsTmp.getString("SUB_ACCOUNT_CODE"));
                                
                                
                                //(1) Cheque No. Start ==================================
                                if(!UtilFunctions.getString(rsHeader,"CHEQUE_NO","").equals("")) {
                                    ChequeNo=UtilFunctions.getString(rsHeader,"CHEQUE_NO","");
                                    
                                    if(ChequeNo.length()>8) {
                                        ChequeNo=ChequeNo.substring(0,8);
                                    }
                                    else {
                                        ChequeNo=EITLERPGLOBAL.padLeft(8,ChequeNo, "0");
                                    }
                                    
                                    rsCobol.updateString("TR_CHEQUE_NO", ChequeNo);
                                }
                                else {
                                    rsCobol.updateString("TR_CHEQUE_NO","00000000");
                                }
                                //==============Cheque No. Over ========================
                                
                                
                                //(2) Cheque/Bill Date =====================================
                                BillDate=UtilFunctions.getString(rsTmp,"INVOICE_DATE","0000-00-00");
                                ChequeDate=UtilFunctions.getString(rsHeader,"CHEQUE_DATE","0000-00-00");
                                
                                
                                if(!BillDate.trim().equals("")) {
                                    rsCobol.updateString("TR_CHQ_BILL_DATE", BillDate.substring(8,10)+BillDate.substring(5,7)+BillDate.substring(2,4));
                                }
                                else {
                                    if(!ChequeDate.trim().equals("")) {
                                        rsCobol.updateString("TR_CHQ_BILL_DATE", ChequeDate.substring(8,10)+ChequeDate.substring(5,7)+ChequeDate.substring(2,4));
                                    }
                                    else {
                                        //No bill date and cheque date specified
                                        rsCobol.updateString("TR_CHQ_BILL_DATE","000000");
                                    }
                                }
                                //================ Cheque/Bill Date Over =======================
                                
                                
                                
                                //(3) Description ==============================================
                                Description=UtilFunctions.getString(rsHeader,"REMARKS","");
                                if(Description.length()>25) {
                                    Description=Description.substring(0,25);
                                }
                                else {
                                    Description=EITLERPGLOBAL.padRight(25, Description," ");
                                }
                                
                                rsCobol.updateString("TR_DESCRIPTION", Description);
                                //==============================================================
                                
                                
                                
                                //(4) Sales Tax Category =========================================
                                SaleTaxCode = UtilFunctions.getString(rsHeader,"ST_CATEGORY","");
                                
                                if(SaleTaxCode.length()>2) {
                                    SaleTaxCode=SaleTaxCode.substring(0,2);
                                }
                                else {
                                    SaleTaxCode=EITLERPGLOBAL.padLeft(2, SaleTaxCode,"0");
                                }
                                
                                
                                rsCobol.updateString("SALETAX_CODE", SaleTaxCode);
                                //===============================================================
                                
                                //(5) Amount ======================================================
                                TrAmount = Integer.toString(UtilFunctions.getInt(rsTmp,"AMOUNT",0)*100);
                                //String TrAmount = Double.toString(EITLERPGLOBAL.round(UtilFunctions.getDouble(rsTmp,"AMOUNT", 0), 2));
                                if(TrAmount.length()>11) {
                                    TrAmount=TrAmount.substring(0,11);
                                }
                                else {
                                    TrAmount=EITLERPGLOBAL.padLeft(11,TrAmount,"0");
                                }
                                
                                rsCobol.updateString("TR_AMT", TrAmount);
                                //=================================================================
                                
                                
                                //(6) Amount Sign =====================================================
                                TrSign = UtilFunctions.getString(rsTmp,"EFFECT","");
                                rsCobol.updateString("TR_AMT_SIGN", TrSign);
                                // Amount Sign Over ================================================
                                
                                
                                //(7) PO No. and suffix ==============================================
                                
                                if(VoucherNo.equals("PA076100205")) {
                                    boolean halt=true;
                                }
                                PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                
                                if(PoAl.equals("")) {
                                    PoAl ="   ";
                                }
                                
                                if (PoAl.substring(0,1).equals("B")) {
                                    chrPoAl = "G ";
                                }
                                else if (PoAl.substring(0,1).equals("P")) {
                                    chrPoAl = "P ";
                                }
                                else if (PoAl.substring(0,1).equals("W")) {
                                    chrPoAl = "W ";
                                }
                                
                                //PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000").substring(0,1);
                                
                                else if (PoAl.substring(0,1).equals("A")) {
                                    if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                        chrPoAl = "A " ;
                                    else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                        chrPoAl = "CP";
                                    }
                                }
                                else if (PoAl.substring(0,2).equals("A3")) {
                                    chrPoAl = "CP";
                                }
                                else if (PoAl.substring(0,2).equals("D-")) {
                                    chrPoAl ="D ";
                                }
                                else if (PoAl.substring(0,2).equals("I/")) {
                                    chrPoAl ="I ";
                                }
                                else if (PoAl.substring(0,1).equals("S")){
                                    chrPoAl ="S ";
                                }
                                else if (PoAl.substring(0,2).equals("RM")) {
                                    chrPoAl ="RM";
                                }
                                else if (PoAl.substring(0,2).equals("CA")) {
                                    chrPoAl ="CA";
                                }
                                
                                else {
                                    chrPoAl ="  ";
                                }
                                
                                rsCobol.updateString("TR_PO_AL",chrPoAl);  //REQUIRED TO BE CHANGED
                                
                                
                                
                                PoNo = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                if(PoNo.trim().equals("")) {
                                    PoNo ="000000";
                                }
                                
                                //System.out.println("PO Length" + PoNo.length());
                                
                                if (PoNo.substring(0,1).equals("B")) {
                                    chrPoNo = "B" + PoNo.substring(2,7);
                                }
                                else if (PoNo.substring(0,1).equals("W")) {
                                    chrPoNo = PoNo.substring(1,7);
                                }
                                else if (PoNo.substring(0,1).equals("P")) {
                                    chrPoNo = PoNo.substring(1,7);
                                }
                                else if (PoNo.substring(0,1).equals("A")) {
                                    if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                        chrPoNo = "0" +PoNo.substring(1,6);
                                    else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                        chrPoNo = "A"+PoNo.substring(2,7);
                                    }
                                    
                                }
                                
                                //PoNo = PoNo.substring(0,2);
                                else if (PoNo.substring(0,2).equals("D-")) {
                                    chrPoNo = "0"+ PoNo.substring(2,7);
                                }
                                
                                else if (PoNo.substring(0,2).equals("I/")) {
                                    chrPoNo = PoNo.substring(2,8);
                                }
                                
                                else if (PoNo.substring(0,2).equals("S/")) {
                                    chrPoNo = "0" + PoNo.substring(2,7);
                                }
                                else if (PoNo.substring(0,2).equals("CA")) {
                                    chrPoNo = "0"+PoNo.substring(2,7);
                                }
                                else if (PoNo.substring(0,2).equals("RM")) {
                                    chrPoNo = "0"+PoNo.substring(2,7);
                                }
                                else {
                                    chrPoNo = "000000" ;
                                }
                                
                                
                                rsCobol.updateString("TR_PO_NO",chrPoNo); //REQUIRED TO BE CHANGED
                                //  PO Over ==================================================================
                                
                                
                                //(7) PO Flag ================================================================
                                PoFlg = UtilFunctions.getString(rsTmp,"COMPANY_ID","");
                                
                                if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2")) {
                                    PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'",EITLERPGLOBAL.DatabaseURL);
                                }
                                else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3"))
                                    
                                {
                                    PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'","jdbc:mysql://200.0.0.227:3306/DINESHMILLSA");
                                }
                                
                                rsCobol.updateString("TR_PO_FLG",PoFlg);//REQUIRED TO BE CHANGED
                                //============================================================================
                                
                                
                                
                                //(8) Invoice No. ============================================================
                                BillNo= UtilFunctions.getString(rsTmp,"INVOICE_NO","0");
                                if(BillNo.length()>8) {
                                    BillNo=BillNo.substring(0,8);
                                }
                                else {
                                    BillNo=EITLERPGLOBAL.padLeft(8, BillNo,"0");
                                }
                                
                                rsCobol.updateString("TR_BILL_NO",BillNo);
                                //============================================================================
                                
                                
                                
                                //(9) Year ===================================================================
                                Yr1_Yr2="0000";
                                // Yr1_Yr2 = Integer.toString(EITLERPGLOBAL.FinYearFrom).substring(2,3)+Integer.toString(EITLERPGLOBAL.FinYearTo).substring(2,3);
                                rsCobol.updateString("TR_INV_Y1Y2",Yr1_Yr2 );//REQUIRED TO BE CHANGED
                                //============================================================================
                                
                                
                                //(10) Reference sr. no. and fixed transaction code ==========================
                                RefSrNo++;
                                strRefSrNo=EITLERPGLOBAL.padLeft(4,Integer.toString(RefSrNo),"0");
                                rsCobol.updateString("TR_REF_SR",strRefSrNo);
                                rsCobol.updateString("TR_TRAN_CODE","000");
                                //============================================================================
                                
                                
                                //**** Find Opposite Entry ***********//
                                //rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND BLOCK_NO="+BlockNo+" AND EFFECT<>'"+Sign+"'",FinanceGlobal.FinURL);
                                //Replace allocation code of above record with this record's main code
                                
                                
                                //(11) Allocation Code =======================================================
                                //AllocationCode=UtilFunctions.getString(rsTmp,"MAIN_ACCOUNT_CODE","");
                                rsCobol.updateString("TR_ALLOC_CODE","000000");
                                //============================================================================
                                
                                rsCobol.insertRow() ;
                                
                                
                            }
                            
                            
                            rsSr.next();
                            
                        }
                        
                    }
                    rsVoucher.next();
                    
                }
                
            }
            
        }
        catch(Exception e) {
            e.printStackTrace();
        }
        
        
    }
    
    
    private void CashVoucher1() {
        
        
        // new Thread() {
        
        //    public void run(){
        boolean Done=false;
        long Counter=0;
        String VoucherNo="";
        //String BlockNo="1";
        String chrPoAl="";
        String chrPoNo="";
        String PoNo="";
        String PoAl="";
        
        int refNo = 1 ;
        
        
        try {
            
            
            Connection objConn=EITLERP.data.getConn(FinanceGlobal.FinURL);
            Statement stTemp=objConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
            
            Statement stCobol=objConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
            ResultSet rsCobol=stCobol.executeQuery("SELECT * FROM TR_COBOL LIMIT 1");
            
            
            ResultSet rsVoucher,rsBlock,rsHeader;
            rsVoucher=EITLERP.data.getResult("SELECT DISTINCT(VOUCHER_NO) FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO NOT LIKE 'M%' AND LEGACY_NO <> '' AND BOOK_CODE IN (30,70) AND APPROVED ='1' AND CANCELLED ='0' AND LEGACY_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND LEGACY_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ORDER BY VOUCHER_DATE,BOOK_CODE",FinanceGlobal.FinURL);
            rsVoucher.first();
            
            if(rsVoucher.getRow()>0) {
                while(!rsVoucher.isAfterLast()) {
                    
                    //For voucher header information
                    rsHeader=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO='"+rsVoucher.getString("VOUCHER_NO")+"'",FinanceGlobal.FinURL);
                    
                    VoucherNo=rsHeader.getString("VOUCHER_NO");
                    //                    String VoucherDate=rsHeader.getString("VOUCHER_DATE");
                    String VoucherDate=rsHeader.getString("LEGACY_DATE");
                    
                    String Month=VoucherDate.substring(5,7);
                    String Day=VoucherDate.substring(8,10);
                    String Year=VoucherDate.substring(2,4);
                    String BookCode=rsHeader.getString("BOOK_CODE");
                    
                    String RefNo= rsHeader.getString("LEGACY_NO"); //EITLERPGLOBAL.Replicate("0", 6-LastNo.length())+LastNo;
                    RefNo = EITLERPGLOBAL.padLeftEx(RefNo, "0", 6);
                    
                    int RefSrNo=0;
                    
                    String Sign,ChequeNo,BillDate,ChequeDate,Description,SaleTaxCode,TrAmount,TrSign ="";
                    String BillNo,Yr1_Yr2,PoFlg,AllocationCode,strRefSrNo ="";
                    PoAl="";
                    PoNo="";
                    chrPoNo="";
                    //BlockNo = rsBlock.getString("BLOCK_NO");
                    String strQry = "";
                    String Main_acc_code="",Sub_acc_code="",Effect="";
                    
                    //if(EITLERP.data.IsRecordExist("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND SUB_ACCOUNT_CODE<>'' AND MAIN_ACCOUNT_CODE NOT IN ('231754','241201','241177','241184','241191') ",FinanceGlobal.FinURL)) {
                    if(EITLERP.data.IsRecordExist("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND EFFECT='D' ",FinanceGlobal.FinURL)) {
                        //We found the record with both main and sub code, take it first
                        
                        strQry = "SELECT EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE " +
                        " FROM D_FIN_VOUCHER_DETAIL_EX " +
                        //    " WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND SUB_ACCOUNT_CODE<>'' AND MAIN_ACCOUNT_CODE NOT IN ('231754','241201','241177','241184','241191') ";
                        " WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND EFFECT='D' ";
                        ResultSet rsTmp=EITLERP.data.getResult(strQry,FinanceGlobal.FinURL);
                        rsTmp.first();
                        
                        Main_acc_code=rsTmp.getString("MAIN_ACCOUNT_CODE");
                        Sub_acc_code=rsTmp.getString("SUB_ACCOUNT_CODE");
                        Effect=rsTmp.getString("EFFECT");
                        
                        strQry = "SELECT VOUCHER_NO, INVOICE_DATE, PO_NO,INVOICE_NO,COMPANY_ID ,MAIN_ACCOUNT_CODE ,SUM(AMOUNT) AS AMOUNT "+
                        "FROM D_FIN_VOUCHER_DETAIL_EX "+
                        "WHERE VOUCHER_NO='"+ VoucherNo +"'  AND EFFECT='C' "+
                        "GROUP BY MAIN_ACCOUNT_CODE";
                        
                        rsTmp=EITLERP.data.getResult(strQry,FinanceGlobal.FinURL);
                        
                        if (rsTmp.getRow() >0) {
                            rsTmp.first();
                            
                            while (! rsTmp.isAfterLast()) {
                                
                                Sign=Effect;
                                
                                // Export this entry to Cobol
                                rsCobol.moveToInsertRow();
                                rsCobol.updateString("TR_REC_TYPE", "01");
                                rsCobol.updateString("TR_INV_AGSR", "000000");
                                rsCobol.updateString("TR_DIV_CODE", "03");
                                rsCobol.updateString("BOOK_CODE",rsHeader.getString("BOOK_CODE"));
                                rsCobol.updateString("TR_YR",Year);
                                rsCobol.updateString("TR_MT",Month);
                                rsCobol.updateString("TR_DT",Day);
                                rsCobol.updateString("TR_REF_AL","  ");
                                rsCobol.updateString("TR_REF_NO",RefNo);
                                rsCobol.updateString("TR_MAIN_CODE",Main_acc_code);
                                rsCobol.updateString("TR_SUB_CODE",Sub_acc_code);
                                
                                
                                //(1) Cheque No. Start ==================================
                                if(!UtilFunctions.getString(rsHeader,"CHEQUE_NO","").equals("")) {
                                    ChequeNo=UtilFunctions.getString(rsHeader,"CHEQUE_NO","");
                                    
                                    if(ChequeNo.length()>8) {
                                        ChequeNo=ChequeNo.substring(0,8);
                                    }
                                    else {
                                        ChequeNo=EITLERPGLOBAL.padLeft(8,ChequeNo, "0");
                                    }
                                    
                                    rsCobol.updateString("TR_CHEQUE_NO", ChequeNo);
                                }
                                else {
                                    rsCobol.updateString("TR_CHEQUE_NO","00000000");
                                }
                                //==============Cheque No. Over ========================
                                
                                
                                //(2) Cheque/Bill Date =====================================
                                BillDate=UtilFunctions.getString(rsTmp,"INVOICE_DATE","0000-00-00");
                                ChequeDate=UtilFunctions.getString(rsHeader,"CHEQUE_DATE","0000-00-00");
                                
                                
                                if(!BillDate.trim().equals("")) {
                                    rsCobol.updateString("TR_CHQ_BILL_DATE", BillDate.substring(8,10)+BillDate.substring(5,7)+BillDate.substring(2,4));
                                }
                                else {
                                    if(!ChequeDate.trim().equals("")) {
                                        rsCobol.updateString("TR_CHQ_BILL_DATE", ChequeDate.substring(8,10)+ChequeDate.substring(5,7)+ChequeDate.substring(2,4));
                                    }
                                    else {
                                        //No bill date and cheque date specified
                                        rsCobol.updateString("TR_CHQ_BILL_DATE","000000");
                                    }
                                }
                                //================ Cheque/Bill Date Over =======================
                                
                                
                                
                                //(3) Description ==============================================
                                Description=UtilFunctions.getString(rsHeader,"REMARKS","");
                                if(Description.trim().length()>25) {
                                    Description=Description.trim().substring(0,25);
                                }
                                else {
                                    Description=EITLERPGLOBAL.padRight(25, Description.trim(),".");
                                }
                                
                                rsCobol.updateString("TR_DESCRIPTION", Description);
                                //==============================================================
                                
                                
                                
                                //(4) Sales Tax Category =========================================
                                SaleTaxCode = UtilFunctions.getString(rsHeader,"ST_CATEGORY","");
                                
                                if(SaleTaxCode.length()>2) {
                                    SaleTaxCode=SaleTaxCode.substring(0,2);
                                }
                                else {
                                    SaleTaxCode=EITLERPGLOBAL.padLeft(2, SaleTaxCode,"0");
                                }
                                
                                
                                rsCobol.updateString("SALETAX_CODE", SaleTaxCode);
                                //===============================================================
                                
                                //(5) Amount ======================================================
                                TrAmount = Integer.toString(UtilFunctions.getInt(rsTmp,"AMOUNT",0)*100);
                                //String TrAmount = Double.toString(EITLERPGLOBAL.round(UtilFunctions.getDouble(rsTmp,"AMOUNT", 0), 2));
                                if(TrAmount.length()>11) {
                                    TrAmount=TrAmount.substring(0,11);
                                }
                                else {
                                    TrAmount=EITLERPGLOBAL.padLeft(11,TrAmount,"0");
                                }
                                
                                rsCobol.updateString("TR_AMT", TrAmount);
                                //=================================================================
                                
                                
                                //(6) Amount Sign =====================================================
                                TrSign = Effect;
                                rsCobol.updateString("TR_AMT_SIGN", TrSign);
                                // Amount Sign Over ================================================
                                
                                
                                //(7) PO No. and suffix ==============================================
                                
                                if(VoucherNo.equals("PA076100205")) {
                                    boolean halt=true;
                                }
                                PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                
                                if(PoAl.equals("")) {
                                    PoAl ="   ";
                                }
                                
                                if (PoAl.substring(0,1).equals("B")) {
                                    chrPoAl = "G ";
                                }
                                else if (PoAl.substring(0,1).equals("P")) {
                                    chrPoAl = "P ";
                                }
                                else if (PoAl.substring(0,1).equals("W")) {
                                    chrPoAl = "W ";
                                }
                                
                                //PoAl = UtilFunctions.getString(rsTmp,"PO_NO","000000").substring(0,1);
                                
                                else if (PoAl.substring(0,1).equals("A")) {
                                    if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                        chrPoAl = "A " ;
                                    else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                        chrPoAl = "CP";
                                    }
                                }
                                else if (PoAl.substring(0,2).equals("A3")) {
                                    chrPoAl = "CP";
                                }
                                else if (PoAl.substring(0,2).equals("D-")) {
                                    chrPoAl ="D ";
                                }
                                else if (PoAl.substring(0,2).equals("I/")) {
                                    chrPoAl ="I ";
                                }
                                else if (PoAl.substring(0,1).equals("S")){
                                    chrPoAl ="S ";
                                }
                                else if (PoAl.substring(0,2).equals("RM")) {
                                    chrPoAl ="RM";
                                }
                                else if (PoAl.substring(0,2).equals("CA")) {
                                    chrPoAl ="CA";
                                }
                                
                                else {
                                    chrPoAl ="  ";
                                }
                                
                                rsCobol.updateString("TR_PO_AL",chrPoAl);  //REQUIRED TO BE CHANGED
                                
                                
                                
                                PoNo = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                                if(PoNo.trim().equals("")) {
                                    PoNo ="000000";
                                }
                                
                                // System.out.println("PO Length" + PoNo.length());
                                
                                if (PoNo.substring(0,1).equals("B")) {
                                    chrPoNo = "B" + PoNo.substring(2,7);
                                }
                                else if (PoNo.substring(0,1).equals("W")) {
                                    chrPoNo = PoNo.substring(1,7);
                                }
                                else if (PoNo.substring(0,1).equals("P")) {
                                    chrPoNo = PoNo.substring(1,7);
                                }
                                else if (PoNo.substring(0,1).equals("A")) {
                                    if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2"))
                                        chrPoNo = "0" +PoNo.substring(1,6);
                                    else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3")) {
                                        chrPoNo = "A"+PoNo.substring(2,7);
                                    }
                                    
                                }
                                
                                //PoNo = PoNo.substring(0,2);
                                else if (PoNo.substring(0,2).equals("D-")) {
                                    chrPoNo = "0"+ PoNo.substring(2,7);
                                }
                                
                                else if (PoNo.substring(0,2).equals("I/")) {
                                    chrPoNo = PoNo.substring(2,8);
                                }
                                
                                else if (PoNo.substring(0,2).equals("S/")) {
                                    chrPoNo = "0" + PoNo.substring(2,7);
                                }
                                else if (PoNo.substring(0,2).equals("CA")) {
                                    chrPoNo = "0"+PoNo.substring(2,7);
                                }
                                else if (PoNo.substring(0,2).equals("RM")) {
                                    chrPoNo = "0"+PoNo.substring(2,7);
                                }
                                else {
                                    chrPoNo = "000000" ;
                                }
                                
                                
                                rsCobol.updateString("TR_PO_NO",chrPoNo); //REQUIRED TO BE CHANGED
                                //  PO Over ==================================================================
                                
                                
                                //(7) PO Flag ================================================================
                                PoFlg = UtilFunctions.getString(rsTmp,"COMPANY_ID","");
                                
                                if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("2")) {
                                    PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'",EITLERPGLOBAL.DatabaseURL);
                                }
                                else if (UtilFunctions.getString(rsTmp,"COMPANY_ID","").equals("3"))
                                    
                                {
                                    PoFlg = PoFlg + EITLERP.data.getStringValueFromDB("SELECT PO_TYPE FROM D_PUR_PO_HEADER WHERE PO_NO ='" + chrPoNo+"'","jdbc:mysql://200.0.0.227:3306/DINESHMILLS");
                                }
                                
                                rsCobol.updateString("TR_PO_FLG",PoFlg);//REQUIRED TO BE CHANGED
                                //============================================================================
                                
                                
                                
                                //(8) Invoice No. ============================================================
                                BillNo= UtilFunctions.getString(rsTmp,"INVOICE_NO","0");
                                if(BillNo.length()>8) {
                                    BillNo=BillNo.substring(0,8);
                                }
                                else {
                                    BillNo=EITLERPGLOBAL.padLeft(8, BillNo,"0");
                                }
                                
                                rsCobol.updateString("TR_BILL_NO",BillNo);
                                //============================================================================
                                
                                
                                
                                //(9) Year ===================================================================
                                Yr1_Yr2="0000";
                                // Yr1_Yr2 = Integer.toString(EITLERPGLOBAL.FinYearFrom).substring(2,3)+Integer.toString(EITLERPGLOBAL.FinYearTo).substring(2,3);
                                rsCobol.updateString("TR_INV_Y1Y2",Yr1_Yr2 );//REQUIRED TO BE CHANGED
                                //============================================================================
                                
                                
                                //(10) Reference sr. no. and fixed transaction code ==========================
                                RefSrNo++;
                                strRefSrNo=EITLERPGLOBAL.padLeft(4,Integer.toString(RefSrNo),"0");
                                rsCobol.updateString("TR_REF_SR",strRefSrNo);
                                rsCobol.updateString("TR_TRAN_CODE","000");
                                //============================================================================
                                
                                
                                //**** Find Opposite Entry *********
                                //rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND EFFECT<>'"+Sign+"'",FinanceGlobal.FinURL);
                                //Replace allocation code of above record with this record's main code
                                
                                
                                //(11) Allocation Code =======================================================
                                AllocationCode=UtilFunctions.getString(rsTmp,"MAIN_ACCOUNT_CODE","");
                                //rsCobol.updateString("TR_ALLOC_CODE",AllocationCode);
                                rsCobol.updateString("TR_ALLOC_CODE","");
                                //============================================================================
                                
                                rsCobol.insertRow() ;
                                
                                rsTmp.next();
                            }
                        }
                        
                        
                    }
                    rsVoucher.next();
                    
                }
                
            }
            
        }
        catch(Exception e) {
            e.printStackTrace();
        }
        
        
    }
    // Start of Cash Voucher
    
    private void CashVoucher() {
        
        
        // new Thread() {
        
        //    public void run(){
        boolean Done=false;
        long Counter=0;
        String VoucherNo="";
        //String BlockNo="1";
        String chrPoAl="";
        String chrPoNo="";
        String PoNo="";
        String PoAl="";
        
        int refNo = 1 ;
        
        
        try {
            
            
            Connection objConn=EITLERP.data.getConn(FinanceGlobal.FinURL);
            Statement stTemp=objConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
            
            Statement stCobol=objConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
            ResultSet rsCobol=stCobol.executeQuery("SELECT * FROM TR_COBOL LIMIT 1");
            
            
            ResultSet rsVoucher,rsBlock,rsHeader;
            
            //rsVoucher=EITLERP.data.getResult("SELECT DISTINCT(VOUCHER_NO) FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO NOT LIKE 'M%' AND LEGACY_NO <> '' AND BOOK_CODE IN (30,70)  AND APPROVED ='1' AND CANCELLED ='0' AND LEGACY_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND LEGACY_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ORDER BY LEGACY_NO,BOOK_CODE",FinanceGlobal.FinURL);
            rsVoucher=EITLERP.data.getResult("SELECT DISTINCT(VOUCHER_NO) FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO NOT LIKE 'M%' AND LEGACY_NO <> '' AND BOOK_CODE IN (30)  AND APPROVED ='1' AND CANCELLED ='0' AND LEGACY_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND LEGACY_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ORDER BY LEGACY_NO,BOOK_CODE",FinanceGlobal.FinURL);
            
            rsVoucher.first();
            
            if(rsVoucher.getRow()>0) {
                while(!rsVoucher.isAfterLast()) {
                    
                    //For voucher header information
                    rsHeader=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO='"+rsVoucher.getString("VOUCHER_NO")+"'",FinanceGlobal.FinURL);
                    
                    VoucherNo=rsHeader.getString("VOUCHER_NO");
                    //                    String VoucherDate=rsHeader.getString("VOUCHER_DATE");
                    String VoucherDate=rsHeader.getString("LEGACY_DATE");
                    
                    String Month=VoucherDate.substring(5,7);
                    String Day=VoucherDate.substring(8,10);
                    String Year=VoucherDate.substring(2,4);
                    String BookCode=rsHeader.getString("BOOK_CODE");
                    
                    String RefNo= rsHeader.getString("LEGACY_NO"); //EITLERPGLOBAL.Replicate("0", 6-LastNo.length())+LastNo;
                    RefNo = EITLERPGLOBAL.padLeftEx(RefNo, "0", 6);
                    
                    int RefSrNo=0;
                    int VoucherType = rsHeader.getInt("VOUCHER_TYPE");
                    
                    String Sign,ChequeNo,BillDate,ChequeDate,Description,SaleTaxCode,TrAmount,TrSign ="";
                    String BillNo,Yr1_Yr2,PoFlg,AllocationCode,strRefSrNo ="";
                    PoAl="";
                    PoNo="";
                    chrPoNo="";
                    //BlockNo = rsBlock.getString("BLOCK_NO");
                    String strQry = "";
                    String Main_acc_code="",Sub_acc_code="",Effect="";
                    
                    if (VoucherType == 4) {
                        strQry = "SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND EFFECT ='D'  AND MAIN_ACCOUNT_CODE NOT IN ('231754','241201','241177','241184','241191') ";
                    }
                    else {
                        strQry = "SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND EFFECT ='C'  AND MAIN_ACCOUNT_CODE NOT IN ('231754','241201','241177','241184','241191') ";
                    }
                    
                    if(EITLERP.data.IsRecordExist(strQry,FinanceGlobal.FinURL)) {
                        //if(EITLERP.data.IsRecordExist("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND EFFECT ='D'  AND MAIN_ACCOUNT_CODE NOT IN ('231754','241201','241177','241184','241191') ",FinanceGlobal.FinURL)) {
                        //We found the record with both main and sub code, take it first
                        
                        // strQry = "SELECT EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE, AMOUNT " +
                        // " FROM D_FIN_VOUCHER_DETAIL_EX " +
                        // " WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>''  AND EFFECT ='D' AND MAIN_ACCOUNT_CODE NOT IN ('231754','241201','241177','241184','241191') ";
                        
                        ResultSet rsTmp=EITLERP.data.getResult(strQry,FinanceGlobal.FinURL);
                        rsTmp.first();
                        
                        //------- Start Coding
                        while (!rsTmp.isAfterLast()) {
                            Main_acc_code=rsTmp.getString("MAIN_ACCOUNT_CODE");
                            Sub_acc_code=rsTmp.getString("SUB_ACCOUNT_CODE");
                            Effect=rsTmp.getString("EFFECT");
                            
                            
                            // Export this entry to Cobol
                            rsCobol.moveToInsertRow();
                            rsCobol.updateString("TR_REC_TYPE", "01");
                            rsCobol.updateString("TR_INV_AGSR", "000000");
                            rsCobol.updateString("TR_DIV_CODE", "03");
                            rsCobol.updateString("BOOK_CODE",rsHeader.getString("BOOK_CODE"));
                            rsCobol.updateString("TR_YR",Year);
                            rsCobol.updateString("TR_MT",Month);
                            rsCobol.updateString("TR_DT",Day);
                            rsCobol.updateString("TR_REF_AL","  ");
                            rsCobol.updateString("TR_REF_NO",RefNo);
                            rsCobol.updateString("TR_MAIN_CODE",Main_acc_code);
                            rsCobol.updateString("TR_SUB_CODE",Sub_acc_code);
                            
                            
                            //(1) Cheque No. Start ==================================
                            if(!UtilFunctions.getString(rsHeader,"CHEQUE_NO","").equals("")) {
                                ChequeNo=UtilFunctions.getString(rsHeader,"CHEQUE_NO","");
                                
                                if(ChequeNo.length()>8) {
                                    ChequeNo=ChequeNo.substring(0,8);
                                }
                                else {
                                    ChequeNo=EITLERPGLOBAL.padLeft(8,ChequeNo, "0");
                                }
                                
                                rsCobol.updateString("TR_CHEQUE_NO", ChequeNo);
                            }
                            else {
                                rsCobol.updateString("TR_CHEQUE_NO","00000000");
                            }
                            //==============Cheque No. Over ========================
                            
                            
                            //(2) Cheque/Bill Date =====================================
                            BillDate=UtilFunctions.getString(rsTmp,"INVOICE_DATE","0000-00-00");
                            ChequeDate=UtilFunctions.getString(rsHeader,"CHEQUE_DATE","0000-00-00");
                            
                            
                            if(!BillDate.trim().equals("")) {
                                rsCobol.updateString("TR_CHQ_BILL_DATE", BillDate.substring(8,10)+BillDate.substring(5,7)+BillDate.substring(2,4));
                            }
                            else {
                                if(!ChequeDate.trim().equals("")) {
                                    rsCobol.updateString("TR_CHQ_BILL_DATE", ChequeDate.substring(8,10)+ChequeDate.substring(5,7)+ChequeDate.substring(2,4));
                                }
                                else {
                                    //No bill date and cheque date specified
                                    rsCobol.updateString("TR_CHQ_BILL_DATE","000000");
                                }
                            }
                            //================ Cheque/Bill Date Over =======================
                            
                            
                            
                            //(3) Description ==============================================
                            Description=UtilFunctions.getString(rsHeader,"REMARKS","");
                            if(Description.trim().length()>25) {
                                Description=Description.trim().substring(0,25);
                            }
                            else {
                                Description=EITLERPGLOBAL.padRight(25, Description.trim(),".");
                            }
                            
                            rsCobol.updateString("TR_DESCRIPTION", Description);
                            //==============================================================
                            
                            
                            
                            //(4) Sales Tax Category =========================================
                            SaleTaxCode = UtilFunctions.getString(rsHeader,"ST_CATEGORY","");
                            
                            if(SaleTaxCode.length()>2) {
                                SaleTaxCode=SaleTaxCode.substring(0,2);
                            }
                            else {
                                SaleTaxCode=EITLERPGLOBAL.padLeft(2, SaleTaxCode,"0");
                            }
                            
                            
                            rsCobol.updateString("SALETAX_CODE", SaleTaxCode);
                            //===============================================================
                            
                            //(5) Amount ======================================================
                            double prath=rsTmp.getDouble("AMOUNT");
                            
                            TrAmount = Integer.toString(UtilFunctions.getInt(rsTmp,"AMOUNT",0)*100);
                            //String TrAmount = Double.toString(EITLERPGLOBAL.round(UtilFunctions.getDouble(rsTmp,"AMOUNT", 0), 2));
                            if(TrAmount.length()>11) {
                                TrAmount=TrAmount.substring(0,11);
                            }
                            else {
                                TrAmount=EITLERPGLOBAL.padLeft(11,TrAmount,"0");
                            }
                            
                            rsCobol.updateString("TR_AMT", TrAmount);
                            //=================================================================
                            
                            
                            //(6) Amount Sign =====================================================
                            TrSign = Effect;
                            rsCobol.updateString("TR_AMT_SIGN", TrSign);
                            // Amount Sign Over ================================================
                            
                            rsCobol.updateString("TR_PO_AL","");  //REQUIRED TO BE CHANGED
                            
                            PoNo = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                            
                            // System.out.println("PO Length" + PoNo.length());
                            
                            rsCobol.updateString("TR_PO_NO",""); //REQUIRED TO BE CHANGED
                            //  PO Over ==================================================================
                            
                            
                            rsCobol.updateString("TR_PO_FLG","");//REQUIRED TO BE CHANGED
                            //============================================================================
                            
                            
                            
                            //(8) Invoice No. ============================================================
                            BillNo= UtilFunctions.getString(rsTmp,"INVOICE_NO"," ").trim();
                            if(BillNo.length()>8) {
                                //BillNo=BillNo.substring(0,8);
                                BillNo=BillNo.substring(BillNo.length()-8);
                            }
                            else {
                                BillNo=EITLERPGLOBAL.padLeft(8, BillNo," ");
                            }
                            
                            rsCobol.updateString("TR_BILL_NO",BillNo);
                            //============================================================================
                            
                            
                            
                            //(9) Year ===================================================================
                            Yr1_Yr2="0000";
                            // Yr1_Yr2 = Integer.toString(EITLERPGLOBAL.FinYearFrom).substring(2,3)+Integer.toString(EITLERPGLOBAL.FinYearTo).substring(2,3);
                            rsCobol.updateString("TR_INV_Y1Y2",Yr1_Yr2 );//REQUIRED TO BE CHANGED
                            //============================================================================
                            
                            
                            //(10) Reference sr. no. and fixed transaction code ==========================
                            RefSrNo++;
                            strRefSrNo=EITLERPGLOBAL.padLeft(4,Integer.toString(RefSrNo),"0");
                            rsCobol.updateString("TR_REF_SR",strRefSrNo);
                            rsCobol.updateString("TR_TRAN_CODE","000");
                            //============================================================================
                            
                            
                            //**** Find Opposite Entry *********
                            //rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND EFFECT<>'"+Sign+"'",FinanceGlobal.FinURL);
                            //Replace allocation code of above record with this record's main code
                            
                            
                            //(11) Allocation Code =======================================================
                            AllocationCode=UtilFunctions.getString(rsTmp,"MAIN_ACCOUNT_CODE","");
                            rsCobol.updateString("TR_ALLOC_CODE","");
                            //============================================================================
                            
                            rsCobol.insertRow() ;
                            
                            rsTmp.next();
                        }
                    }
                    
                    rsVoucher.next();
                }
                
            }
            
        }
        catch(Exception e) {
            e.printStackTrace();
        }
        
        
    }
    
    // End of Cash Voucher
    
    
    private void BankVoucher() {
        // new Thread() {
        
        //    public void run(){
        boolean Done=false;
        long Counter=0;
        String VoucherNo="";
        //String BlockNo="1";
        String chrPoAl="";
        String chrPoNo="";
        String PoNo="";
        String PoAl="";
        
        int refNo = 1 ;
        
        
        try {
            
            
            Connection objConn=EITLERP.data.getConn(FinanceGlobal.FinURL);
            Statement stTemp=objConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
            
            Statement stCobol=objConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
            ResultSet rsCobol=stCobol.executeQuery("SELECT * FROM TR_COBOL LIMIT 1");
            
            
            ResultSet rsVoucher,rsBlock,rsHeader;
            //            rsVoucher=EITLERP.data.getResult("SELECT DISTINCT(VOUCHER_NO) FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO NOT LIKE 'M%' AND LEGACY_NO <> '' AND BOOK_CODE IN (30,70) AND SUBSTRING(VOUCHER_NO,1,2)='CS'  AND APPROVED ='1' AND CANCELLED ='0' AND LEGACY_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND LEGACY_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ORDER BY VOUCHER_DATE,BOOK_CODE",FinanceGlobal.FinURL);
            //rsVoucher=EITLERP.data.getResult("SELECT DISTINCT(VOUCHER_NO) FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO NOT LIKE 'M%' AND LEGACY_NO <> '' AND BOOK_CODE IN (33,36,37,54,56,58,74,75)  AND APPROVED ='1' AND CANCELLED ='0' AND LEGACY_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND LEGACY_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ORDER BY LEGACY_NO,BOOK_CODE",FinanceGlobal.FinURL);
            rsVoucher=EITLERP.data.getResult("SELECT DISTINCT(VOUCHER_NO) FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO NOT LIKE 'M%' AND LEGACY_NO <> '' AND BOOK_CODE IN (31,34,54,58,74,75)  AND APPROVED ='1' AND CANCELLED ='0' AND LEGACY_DATE>='"+EITLERPGLOBAL.formatDateDB(txtFromDate.getText())+"' AND LEGACY_DATE<='"+EITLERPGLOBAL.formatDateDB(txtToDate.getText())+"' ORDER BY LEGACY_NO,BOOK_CODE",FinanceGlobal.FinURL);
            rsVoucher.first();
            
            if(rsVoucher.getRow()>0) {
                while(!rsVoucher.isAfterLast()) {
                    
                    //For voucher header information
                    rsHeader=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_HEADER WHERE VOUCHER_NO='"+rsVoucher.getString("VOUCHER_NO")+"'",FinanceGlobal.FinURL);
                    
                    VoucherNo=rsHeader.getString("VOUCHER_NO");
                    //                    String VoucherDate=rsHeader.getString("VOUCHER_DATE");
                    String VoucherDate=rsHeader.getString("LEGACY_DATE");
                    
                    String Month=VoucherDate.substring(5,7);
                    String Day=VoucherDate.substring(8,10);
                    String Year=VoucherDate.substring(2,4);
                    String BookCode=rsHeader.getString("BOOK_CODE");
                    
                    String RefNo= rsHeader.getString("LEGACY_NO"); //EITLERPGLOBAL.Replicate("0", 6-LastNo.length())+LastNo;
                    RefNo = EITLERPGLOBAL.padLeftEx(RefNo, "0", 6);
                    
                    int RefSrNo=0;
                    int VoucherType = rsHeader.getInt("VOUCHER_TYPE");
                    
                    String Sign,ChequeNo,BillDate,ChequeDate,Description,SaleTaxCode,TrAmount,TrSign ="";
                    String BillNo,Yr1_Yr2,PoFlg,AllocationCode,strRefSrNo ="";
                    PoAl="";
                    PoNo="";
                    chrPoNo="";
                    //BlockNo = rsBlock.getString("BLOCK_NO");
                    String strQry = "";
                    String Main_acc_code="",Sub_acc_code="",Effect="";
                    
                    try {
                        if (VoucherType == 2) {    // Payment Voucher
                            strQry = "SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND EFFECT ='D'  ";
                        }
                        else if (VoucherType ==6 ){ // Receipt Voucher
                            strQry = "SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND EFFECT ='C'  ";
                        }
                        else if (VoucherType == 10) // Payment Voucher 2
                        {
                            strQry = "SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND EFFECT ='D'  ";
                        }
                    }
                    catch (Exception e) {
                        
                    }
                    if(EITLERP.data.IsRecordExist(strQry,FinanceGlobal.FinURL)) {
                        //if(EITLERP.data.IsRecordExist("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>'' AND EFFECT ='D'  AND MAIN_ACCOUNT_CODE NOT IN ('231754','241201','241177','241184','241191') ",FinanceGlobal.FinURL)) {
                        //We found the record with both main and sub code, take it first
                        
                        // strQry = "SELECT EFFECT,MAIN_ACCOUNT_CODE,SUB_ACCOUNT_CODE, AMOUNT " +
                        // " FROM D_FIN_VOUCHER_DETAIL_EX " +
                        // " WHERE VOUCHER_NO='"+VoucherNo+"' AND MAIN_ACCOUNT_CODE<>''  AND EFFECT ='D' AND MAIN_ACCOUNT_CODE NOT IN ('231754','241201','241177','241184','241191') ";
                        
                        ResultSet rsTmp=EITLERP.data.getResult(strQry,FinanceGlobal.FinURL);
                        rsTmp.first();
                        
                        //------- Start Coding
                        while (!rsTmp.isAfterLast()) {
                            Main_acc_code=rsTmp.getString("MAIN_ACCOUNT_CODE");
                            Sub_acc_code=rsTmp.getString("SUB_ACCOUNT_CODE");
                            Effect=rsTmp.getString("EFFECT");
                            
                            
                            // Export this entry to Cobol
                            rsCobol.moveToInsertRow();
                            rsCobol.updateString("TR_REC_TYPE", "01");
                            rsCobol.updateString("TR_INV_AGSR", "000000");
                            rsCobol.updateString("TR_DIV_CODE", "03");
                            rsCobol.updateString("BOOK_CODE",rsHeader.getString("BOOK_CODE"));
                            rsCobol.updateString("TR_YR",Year);
                            rsCobol.updateString("TR_MT",Month);
                            rsCobol.updateString("TR_DT",Day);
                            rsCobol.updateString("TR_REF_AL","  ");
                            rsCobol.updateString("TR_REF_NO",RefNo);
                            rsCobol.updateString("TR_MAIN_CODE",Main_acc_code);
                            rsCobol.updateString("TR_SUB_CODE",Sub_acc_code);
                            
                            
                            //(1) Cheque No. Start ==================================
                            if(!UtilFunctions.getString(rsHeader,"CHEQUE_NO","").equals("")) {
                                ChequeNo=UtilFunctions.getString(rsHeader,"CHEQUE_NO","");
                                
                                if(ChequeNo.length()>8) {
                                    ChequeNo=ChequeNo.substring(0,8);
                                }
                                else {
                                    ChequeNo=EITLERPGLOBAL.padLeft(8,ChequeNo, "0");
                                }
                                
                                rsCobol.updateString("TR_CHEQUE_NO", ChequeNo);
                            }
                            else {
                                rsCobol.updateString("TR_CHEQUE_NO","00000000");
                            }
                            //==============Cheque No. Over ========================
                            
                            
                            //(2) Cheque/Bill Date =====================================
                            BillDate=UtilFunctions.getString(rsTmp,"INVOICE_DATE","0000-00-00");
                            ChequeDate=UtilFunctions.getString(rsHeader,"CHEQUE_DATE","0000-00-00");
                            
                            
                            if(!BillDate.trim().equals("")) {
                                rsCobol.updateString("TR_CHQ_BILL_DATE", BillDate.substring(8,10)+BillDate.substring(5,7)+BillDate.substring(2,4));
                            }
                            else {
                                if(!ChequeDate.trim().equals("")) {
                                    rsCobol.updateString("TR_CHQ_BILL_DATE", ChequeDate.substring(8,10)+ChequeDate.substring(5,7)+ChequeDate.substring(2,4));
                                }
                                else {
                                    //No bill date and cheque date specified
                                    rsCobol.updateString("TR_CHQ_BILL_DATE","000000");
                                }
                            }
                            //================ Cheque/Bill Date Over =======================
                            
                            
                            
                            //(3) Description ==============================================
                            Description=UtilFunctions.getString(rsHeader,"REMARKS","");
                            if(Description.trim().length()>25) {
                                Description=Description.trim().substring(0,25);
                            }
                            else {
                                Description=EITLERPGLOBAL.padRight(25, Description.trim()," ");
                            }
                            
                            rsCobol.updateString("TR_DESCRIPTION", Description);
                            //==============================================================
                            
                            
                            
                            //(4) Sales Tax Category =========================================
                            SaleTaxCode = UtilFunctions.getString(rsHeader,"ST_CATEGORY","");
                            
                            if(SaleTaxCode.length()>2) {
                                SaleTaxCode=SaleTaxCode.substring(0,2);
                            }
                            else {
                                SaleTaxCode=EITLERPGLOBAL.padLeft(2, SaleTaxCode,"0");
                            }
                            
                            
                            rsCobol.updateString("SALETAX_CODE", SaleTaxCode);
                            //===============================================================
                            
                            //(5) Amount ======================================================
                            double prath=rsTmp.getDouble("AMOUNT");
                            double prath1=rsTmp.getDouble("AMOUNT")*100;
                            
                            //TrAmount = Integer.toString(UtilFunctions.getInt(rsTmp,"AMOUNT",0)*100);
                            //TrAmount = Integer.toString(UtilFunctions.getInt(rsTmp,"AMOUNT",0)*100);
                            TrAmount = Long.toString((long)UtilFunctions.getDouble(rsTmp,"AMOUNT",0)*100);                            
                            
                            //TrAmount = Double.toString(EITLERPGLOBAL.round(UtilFunctions.getDouble(rsTmp,"AMOUNT", 0), 2));
                            if(TrAmount.length()>11) {
                                TrAmount=TrAmount.substring(0,11);
                            }
                            else {
                                TrAmount=EITLERPGLOBAL.padLeft(11,TrAmount,"0");
                            }
                            
                            rsCobol.updateString("TR_AMT", TrAmount);
                            //=================================================================
                            
                            
                            //(6) Amount Sign =====================================================
                            TrSign = Effect;
                            rsCobol.updateString("TR_AMT_SIGN", TrSign);
                            // Amount Sign Over ================================================
                            
                            rsCobol.updateString("TR_PO_AL","");  //REQUIRED TO BE CHANGED
                            
                            PoNo = UtilFunctions.getString(rsTmp,"PO_NO","000000");
                            
                            // System.out.println("PO Length" + PoNo.length());
                            
                            rsCobol.updateString("TR_PO_NO",""); //REQUIRED TO BE CHANGED
                            //  PO Over ==================================================================
                            
                            
                            rsCobol.updateString("TR_PO_FLG","");//REQUIRED TO BE CHANGED
                            //============================================================================
                            
                            
                            
                            //(8) Invoice No. ============================================================
                            BillNo= UtilFunctions.getString(rsTmp,"INVOICE_NO"," ").trim();
                            if(BillNo.length()>8) {
                                BillNo=BillNo.substring(0,8);
                            }
                            else {
                                BillNo=EITLERPGLOBAL.padLeft(8, BillNo," ");
                            }
                            
                            rsCobol.updateString("TR_BILL_NO",BillNo);
                            //============================================================================
                            
                            
                            
                            //(9) Year ===================================================================
                            Yr1_Yr2="0000";
                            // Yr1_Yr2 = Integer.toString(EITLERPGLOBAL.FinYearFrom).substring(2,3)+Integer.toString(EITLERPGLOBAL.FinYearTo).substring(2,3);
                            rsCobol.updateString("TR_INV_Y1Y2",Yr1_Yr2 );//REQUIRED TO BE CHANGED
                            //============================================================================
                            
                            
                            //(10) Reference sr. no. and fixed transaction code ==========================
                            RefSrNo++;
                            strRefSrNo=EITLERPGLOBAL.padLeft(4,Integer.toString(RefSrNo),"0");
                            rsCobol.updateString("TR_REF_SR",strRefSrNo);
                            rsCobol.updateString("TR_TRAN_CODE","000");
                            //============================================================================
                            
                            
                            //**** Find Opposite Entry *********
                            //rsTmp=EITLERP.data.getResult("SELECT * FROM D_FIN_VOUCHER_DETAIL_EX WHERE VOUCHER_NO='"+VoucherNo+"' AND EFFECT<>'"+Sign+"'",FinanceGlobal.FinURL);
                            //Replace allocation code of above record with this record's main code
                            
                            
                            //(11) Allocation Code =======================================================
                            AllocationCode=UtilFunctions.getString(rsTmp,"MAIN_ACCOUNT_CODE","");
                            rsCobol.updateString("TR_ALLOC_CODE","");
                            //============================================================================
                            
                            rsCobol.insertRow() ;
                            
                            rsTmp.next();
                        }
                    }
                    
                    rsVoucher.next();
                }
                
            }
            
        }
        catch(Exception e) {
            e.printStackTrace();
        }
        
        
        
    }
    
    
    
    private Frame findParentFrame(JApplet pApplet) {
        Container c = (Container) pApplet;
        while(c != null) {
            if (c instanceof Frame)
                return (Frame)c;
            
            c = c.getParent();
        }
        return (Frame)null;
    }
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton cmbCashVoucher;
    private javax.swing.JButton cmbCashVoucher1;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JButton jButton7;
    private javax.swing.JButton jButton8;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JTextField txtFile;
    private javax.swing.JTextField txtFromDate;
    private javax.swing.JTextField txtToDate;
    // End of variables declaration//GEN-END:variables
    
}



